define("qtek-2d/qtek-2d.amd",[],function(){console.log("Loaded qtek 2d module")}),define("qtek-2d",["qtek-2d/qtek-2d.amd"],function(a){return a}),define("qtek-2d/CanvasRenderer",["require","qtek/core/Base"],function(a){var b=a("qtek/core/Base"),c=b.derive(function(){return{canvas:null,ctx:null,width:0,height:0}},function(){this.canvas||(this.canvas=document.createElement("canvas")),this.width?this.canvas.width=this.width:this.width=this.canvas.width,this.height?this.canvas.height=this.height:this.height=this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.ctx.__GUID__=this.__GUID__},{resize:function(a,b){this.canvas.width=a,this.canvas.height=b,this.width=a,this.height=b},render:function(a,b){if(this.clearColor?(this.ctx.fillStyle=this.clearColor,this.ctx.fillRect(0,0,this.width,this.height)):this.ctx.clearRect(0,0,this.width,this.height),b){var c=b.getViewMatrix()._array;this.ctx.transform(c[0],c[1],c[2],c[3],c[4],c[5])}a.render(this.ctx)}});return c}),define("qtek-2d/Gradient",["require","qtek/core/Base","qtek/math/Vector2","qtek/core/Cache"],function(a){var b=a("qtek/core/Base"),c=(a("qtek/math/Vector2"),a("qtek/core/Cache")),d=b.derive(function(){return{stops:[]}},function(){this.cache=new c},{addColorStop:function(a,b){this.stops.push([a,b]),this.dirty()},removeAt:function(a){this.stops.splice(a,1),this.dirty()},dirty:function(){for(var a in this.cache._caches)this.cache._caches[a].dirty=!0},getInstance:function(a){return this.cache.use(a.__GUID__),(this.cache.get("dirty")||this.cache.miss("gradient"))&&this.update(a),this.cache.get("gradient")},update:function(){}});return d}),define("qtek-2d/LinearGradient",["require","./Gradient","qtek/math/Vector2"],function(a){var b=a("./Gradient"),c=a("qtek/math/Vector2"),d=b.derive(function(){return{start:new c,end:new c(100,0)}},{update:function(a){for(var b=a.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y),c=0;c<this.stops.length;c++){var d=this.stops[c];b.addColorStop(d[0],d[1])}this.cache.put("gradient",b)}});return d}),define("qtek-2d/Style",["require","qtek/core/Base"],function(a){function b(a){return(a||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}var c=a("qtek/core/Base"),d=/([0-9\-]+)\s+([0-9\-]+)\s+([0-9]+)\s+(.+)/,e=c.derive({},{bind:function(a){var c=this.fillStyle||this.fill,e=this.strokeStyle||this.stroke,f=this.globalAlpha||this.alpha,g=this.globalCompositeOperation||this.composite;if(this.shadow){var h=d.exec(b(this.shadow));if(h)var i=parseInt(h[1]),j=parseInt(h[2]),k=h[3],l=h[4]}i=this.shadowOffsetX||i,j=this.shadowOffsetY||j,k=this.shadowBlur||k,l=this.shadowColor||l,void 0!==f&&(a.globalAlpha=f),g&&(a.globalCompositeOperation=g),void 0!==this.lineWidth&&(a.lineWidth=this.lineWidth),void 0!==this.lineCap&&(a.lineCap=this.lineCap),void 0!==this.lineJoin&&(a.lineJoin=this.lineJoin),void 0!==this.miterLimit&&(a.miterLimit=this.miterLimit),void 0!==i&&(a.shadowOffsetX=i),void 0!==j&&(a.shadowOffsetY=j),void 0!==k&&(a.shadowBlur=k),void 0!==l&&(a.shadowColor=l),this.font&&(a.font=this.font),this.textAlign&&(a.textAlign=this.textAlign),this.textBaseline&&(a.textBaseline=this.textBaseline),c&&(a.fillStyle=c.getInstance?c.getInstance(a):c),e&&(a.strokeStyle=e.getInstance?e.getInstance(a):e),this.lineDash&&(a.setLineDash?(a.setLineDash(this.lineDash),"number"==typeof this.lineDashOffset&&(a.lineDashOffset=this.lineDashOffset)):console.warn("Browser does not support setLineDash method"))}});return e}),define("qtek-2d/Node",["require","qtek/core/Base","qtek/core/util","qtek/math/Vector2","qtek/math/Matrix2d","./Style","glmatrix"],function(a){function b(a,b){return a.z===b.z?a.__GUID__>b.__GUID__?1:-1:a.z>b.z?1:-1}var c=a("qtek/core/Base"),d=(a("qtek/core/util"),a("qtek/math/Vector2")),e=a("qtek/math/Matrix2d"),f=(a("./Style"),a("glmatrix")),g=f.mat2d,h=(f.vec2,c.derive(function(){return{name:"",boundingBox:{min:new d,max:new d},z:0,style:null,position:new d(0,0),rotation:0,scale:new d(1,1),autoUpdate:!0,transform:new e,transformInverse:new e,_prevRotation:0,visible:!0,_children:[],intersectLineWidth:0,clip:!1,fill:!0,stroke:!1,enablePicking:!0}},{updateTransform:function(){var a=this.transform._array;this.autoUpdate&&(this.scale._dirty||this.position._dirty||this.rotation!==this._prevRotation)&&(g.identity(a,a),g.scale(a,a,this.scale._array),g.rotate(a,a,this.rotation),g.translate(a,a,this.position._array),this._prevRotation=this.rotation,this.scale._dirty=!1,this.position._dirty=!1)},updateTransformInverse:function(){g.invert(this.transformInverse._array,this.transform._array)},intersectBoundingBox:function(a,b){var c=this.boundingBox;return c.min.x<a&&a<c.max.x&&c.min.y<b&&b<c.max.y},add:function(a){a&&(this._children.push(a),a.parent&&a.parent.remove(a),a.parent=this)},remove:function(a){a&&(this._children.splice(this._children.indexOf(a),1),a.parent=null)},children:function(){return this._children.slice()},childAt:function(a){return this._children[a]},draw:null,render:function(a){this.trigger("beforerender",a);var b=this.getSortedRenderQueue();if(this.style)if(!this.style instanceof Array)for(var c=0;c<this.style.length;c++)this.style[c].bind(a);else this.style.bind&&this.style.bind(a);a.save(),this.updateTransform();var d=this.transform._array;a.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this.draw&&this.draw(a),this.clip&&a.clip();for(var c=0;c<b.length;c++)b[c].render(a);a.restore(),this.trigger("afterrender",a)},traverse:function(a){a&&a(this);for(var b=this._children,c=0,d=b.length;d>c;c++)b[c].traverse(a)},intersect:function(){},getSortedRenderQueue:function(){var a=this._children.slice();return a.sort(b),a}}));return h}),define("qtek-2d/Pattern",["require","qtek/core/Base","qtek/math/Vector2","qtek/core/Cache"],function(a){var b=a("qtek/core/Base"),c=(a("qtek/math/Vector2"),a("qtek/core/Cache")),d=b.derive(function(){return{image:null,repetition:"repeat"}},function(){this.cache=new c},{getInstance:function(a){if(this.cache.use(a.__GUID__),this.cache.get("dirty")||this.cache.miss("pattern")){var b=a.createPattern(this.image,this.repetition);return this.cache.put("pattern",b),b}return this.cache.get("pattern")}});return d}),define("qtek-2d/RadialGradient",["require","./Gradient","qtek/math/Vector2"],function(a){var b=a("./Gradient"),c=a("qtek/math/Vector2"),d=b.derive(function(){return{start:new c,startRadius:0,end:new c,endRadius:0}},{update:function(a){for(var b=a.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius),c=0;c<this.stops.length;c++){var d=this.stops[c];b.addColorStop(d[0],d[1])}this.cache.put("gradient",b)}});return d}),define("qtek-2d/context/tool/math",[],function(){var a={area:function(a){var b=a.length/2;if(3>b)return 0;for(var c=0,d=2*(b-1),e=0;2*b>e;){var f=a[d],g=a[d+1],h=a[e],i=a[e+1];d=e,e+=2,c+=f*i-h*g}return c},isCCW:function(a){return this.area(a)<0},triangleArea:function(a,b,c,d,e,f){return(c-a)*(f-d)-(d-b)*(e-c)},isTriangleConvex:function(a,b,c,d,e,f){return 0>(c-a)*(f-d)-(d-b)*(e-c)},isPointInTriangle:function(b,c,d,e,f,g,h,i){return!(a.triangleArea(b,c,f,g,h,i)<=0||a.triangleArea(b,c,h,i,d,e)<=0||a.triangleArea(h,i,f,g,d,e)<=0)},approxEqualInt:function(a,b){return Math.abs(a-b)<.1},approxEqual:function(a,b){return Math.abs(a-b)<1e-5},reverse:function(a,b,c){for(var d=0;d<Math.floor(b/2);d++)for(var e=0;c>e;e++){var f=d*c+e,g=(b-d-1)*c+e,h=a[f];a[f]=a[g],a[g]=h}return a}};return a}),define("qtek-2d/context/tool/GJK",["require","./math"],function(a){var b=a("./math"),c=function(){this._D=[0,0],this._S=[0,0]};c.prototype.intersect=function(a,b){var c=this._D,d=this._S;c[0]=a[0]-b[0],c[1]=a[1]-b[1],this._support(a,b,c,d),c[0]=-d[0],c[1]=-d[1];for(var e=d.slice();;){if(this._support(a,b,c,d),c[0]*d[0]+c[1]*d[1]<=0)return!1;e.push(d[0]),e.push(d[1]);var f=this._updateSimplex(e,c);if(f)return!0}};var d=[0,0],e=[0,0];return c.prototype._updateSimplex=function(a,c){var f=a.length/2;switch(f){case 2:var g=a[2],h=a[3],i=a[0],j=a[1];e[0]=i-g,e[1]=j-h,e[0]*-g+e[1]*-h<0?(a.shift(),a.shift(),c[0]=-g,c[1]=-h):-e[1]*-g+e[0]*-h>0?(c[0]=-e[1],c[1]=e[0]):(c[0]=e[1],c[1]=-e[0]);break;case 3:var g=a[4],h=a[5],i=a[2],j=a[3],k=a[0],l=a[1];if(b.isTriangleConvex(g,h,k,l,i,j)||(i=a[0],j=a[1],k=a[2],l=a[3]),d[0]=k-g,d[1]=l-h,e[0]=i-g,e[1]=j-h,b.isTriangleConvex(0,0,g,h,k,l)){if(!b.isTriangleConvex(0,0,g,h,i,j))return!0;e[0]*-g+e[1]*-h>0?(a.length=4,a[0]=i,a[1]=j,a[2]=g,a[3]=h,-e[1]*-g+e[0]*-h>0?(c[0]=-e[1],c[1]=e[0]):(c[0]=e[1],c[1]=-e[0])):(a.length=2,a[0]=g,a[1]=h,c[0]=-g,c[1]=-h)}else-g*d[0]+-h*d[1]>0?(a.length=4,a[0]=k,a[1]=l,a[2]=g,a[3]=h,-d[1]*-g+d[0]*-h>0?(c[0]=-d[1],c[1]=d[0]):(c[0]=d[1],c[1]=-d[0])):(a.length=2,a[0]=g,a[1]=h,c[0]=-g,c[1]=-h)}},c.prototype._support=function(a,b,c,d){for(var e,f,g,h,i=-1/0,j=0;j<a.length;){var k=a[j++],l=a[j++],m=k*-c[0]+l*-c[1];m>i&&(i=m,e=k,f=l)}for(i=-1/0,j=0;j<b.length;)k=b[j++],l=b[j++],m=k*c[0]+l*c[1],m>i&&(i=m,g=k,h=l);return d[0]=g-e,d[1]=h-f,d},c}),define("qtek-2d/context/BezierCurveSegment",["require","./tool/math","glmatrix","./tool/GJK"],function(a){var b=a("./tool/math"),c=a("glmatrix"),d=c.vec3,e=c.vec2,f=(c.mat4,5e-5),g=a("./tool/GJK"),h=new g,i=function(a){return f>a&&a>-f?0:a},j=function(a,b,c,d,e,f,g,h){this.type=j.type,this.points=[a,b,c,d,e,f,g,h],this.thickness=0,this.coords=[],this.subCurveA=null,this.subCurveB=null,this.subdivisionLevel=0,this.triangles=[]};return j.prototype.strokeSteps=0,j.prototype.fx=0,j.prototype.fy=0,j.prototype.dfx=0,j.prototype.dfy=0,j.prototype.ddfx=0,j.prototype.ddfy=0,j.prototype.dddfx=0,j.prototype.dddfy=0,j.prototype.updateStrokeSegments=function(a,b){var c=this.points,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=(f-d)*a,m=(g-e)*b,n=(h-f)*a,o=(i-g)*b,p=(j-h)*a,q=(k-i)*b,r=Math.sqrt(l*l+m*m)+Math.sqrt(n*n+o*o)+Math.sqrt(p*p+q*q);this.strokeSteps=Math.ceil(.25*r);var s=1/(this.strokeSteps+1),t=s*s,u=t*s,v=3*s,w=3*t,x=6*t,y=6*u,z=d-2*f+h,A=e-2*g+i,B=3*(f-h)-d+j,C=3*(g-i)-e+k;this.fx=c[0],this.fy=c[1],this.dfx=(f-d)*v+z*w+B*u,this.dfy=(g-e)*v+A*w+C*u,this.ddfx=z*x+B*y,this.ddfy=A*x+C*y,this.dddfx=B*y,this.dddfy=C*y},j.prototype.reverse=function(){b.reverse(this.points,4,2),12===this.coords.length&&b.reverse(this.coords,4,3);for(var a=0;a<this.triangles.length;a++)this.triangles[a]=4-this.triangles[a];var c=this.points;this.fx=c[0],this.fy=c[1],this.dfx=-this.dfx,this.dfy=-this.dfy,this.ddfx=-this.ddfx,this.ddfy=-this.ddfy,this.dddfx=-this.dddfx,this.dddfy=-this.dddfy},j.prototype.subdivide=function(a){var b=this.points,c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],k=b[7],l=(e-c)*a+c,m=(f-d)*a+d,n=(g-e)*a+e,o=(h-f)*a+f,p=(i-g)*a+g,q=(k-h)*a+h,r=(n-l)*a+l,s=(o-m)*a+m,t=(p-n)*a+n,u=(q-o)*a+o,v=(t-r)*a+r,w=(u-s)*a+s,x=new j(c,d,l,m,r,s,v,w),y=new j(v,w,t,u,p,q,i,k);x.subdivisionLevel=this.subdivisionLevel+1,y.subdivisionLevel=this.subdivisionLevel+1,this.subCurveA=x,this.subCurveB=y},j.prototype.intersectCurve=function(a){return this.subCurveA?a.subCurveA?this.subCurveA.intersectCurve(a.subCurveA)||this.subCurveA.intersectCurve(a.subCurveB)||this.subCurveB.intersectCurve(a.subCurveA)||this.subCurveB.intersectCurve(a.subCurveB):this.subCurveA.intersectCurve(a)||this.subCurveB.intersectCurve(a):h.intersect(this.points,a.points)},j.prototype.updateTriangles=function(){for(var a=this._getTriangles(),b=0;b<a.length;b++)this.triangles[b]=a[b];this.triangles.length=a.length},j.prototype.updateTextureCoords=function(){var a,b,c,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w=d.fromValues(0,0,1),x=d.fromValues(0,0,1),y=d.fromValues(0,0,1),z=d.fromValues(0,0,1),A=d.create(),B=1/3,C=-1;return function(D){var E=this.coords,F=this.points,G=F[0],H=F[1],I=F[2],J=F[3],K=F[4],L=F[5],M=F[6],N=F[7];e.set(w,G,H),e.set(x,I,J),e.set(y,K,L),e.set(z,M,N),d.cross(A,z,y),a=d.dot(w,A),d.cross(A,w,z),b=d.dot(x,A),d.cross(A,x,w),c=d.dot(y,A),f=a-2*b+3*c,g=-b+3*c,h=3*c,f=i(f),g=i(g),h=i(h),t=1,(0!=f||0!=g||0!=h)&&(0==f&&0==g?(t=0>h?-t:t,E[0]=E[1]=E[2]=0,E[3]=B*t,E[4]=0,E[5]=B,E[6]=2/3*t,E[7]=B*t,E[8]=B,E[9]=E[10]=t,E[11]=1):(q=3*g*g-4*f*h,q=i(q),0==q&&0==f?(j=h,k=3*g,r=k-j,E[0]=j,E[1]=j*j*j,E[2]=1,E[3]=j-B*k,E[4]=j*j*-r,E[5]=1,E[6]=j-2*B*k,E[7]=r*r*j,E[8]=1,E[9]=-r,E[10]=-r*r*r,E[11]=1):q>=0?(p=Math.sqrt(3*q),j=3*g-p,k=6*f,l=3*g+p,m=k,v=Math.sqrt(j*j+k*k),j/=v,k/=v,v=Math.sqrt(l*l+m*m),l/=v,m/=v,r=k-j,s=m-l,t=0>f?-t:t,E[0]=j*l*t,E[1]=j*j*j*t,E[2]=l*l*l,E[3]=B*(3*j*l-j*m-k*l)*t,E[4]=j*j*-r*t,E[5]=l*l*-s,E[6]=B*(k*(m-2*l)+j*(3*l-2*m))*t,E[7]=r*r*j*t,E[8]=s*s*l,E[9]=r*s*t,E[10]=-r*r*r*t,E[11]=-s*s*s):(p=Math.sqrt(-q),j=g-p,k=2*f,l=g+p,m=k,v=Math.sqrt(j*j+k*k),j/=v,k/=v,v=Math.sqrt(l*l+m*m),l/=v,m/=v,n=j/k,o=l/m,C=n>0&&1>n?n:o>0&&1>o?o:-1,0>C||D?(r=k-j,s=m-l,u=i(j*l),t=f>0&&0>u||0>f&&u>0?-t:t,E[0]=u*t,E[1]=j*j*l*t,E[2]=j*l*l,E[3]=B*(-j*m-k*l+3*j*l)*t,E[4]=-B*j*(j*(m-3*l)+2*k*l)*t,E[5]=-B*l*(j*(2*m-3*l)+k*l),E[6]=B*(k*(m-2*l)+j*(3*l-2*m))*t,E[7]=B*r*(j*(2*m-3*l)+k*l)*t,E[8]=B*s*(j*(m-3*l)+2*k*l),E[9]=r*s*t,E[10]=-r*r*s*t,E[11]=-r*s*s):(this.subdivide(C),this.subCurveA.updateTextureCoords(!0),this.subCurveB.updateTextureCoords(!0)))),this.updateTriangles())}}(),j.prototype._getTriangles=function(){var a=[0,1,3,0,2,3],c=[1,0,3,1,2,3],d=[1,0,2,1,2,3],e=[0,1,3],f=[0,2,3];return function(){var g=this.points,h=g[0],i=g[1],j=g[2],k=g[3],l=g[4],m=g[5],n=g[6],o=g[7],p=b.isTriangleConvex(h,i,j,k,n,o);return p!=b.isTriangleConvex(h,i,l,m,n,o)?a:b.isTriangleConvex(h,i,j,k,l,m)^!p?b.isTriangleConvex(l,m,j,k,n,o)^!p?e:c:b.isTriangleConvex(j,k,l,m,n,o)^!p?f:d}}(),j.type=2,j}),define("qtek-2d/context/CanvasElement",["require"],function(){var a=function(){},b=["hasFill","hasStroke","getHashKey","updateVertices","afterDraw"],c=["updateElements","addElement","clearElements"];a._factories=[];var d=a._factories;return a.register=function(b,c){if(!(b&&!a._checkElementClass(b)||c&&!a._checkPrimitiveClass(c))){var e=d.length;return d.push({fElement:b,fPrimitive:c}),e}},a._checkElementClass=function(a){for(var c=!0,d=0;d<b.length;d++){var e=b[d];"undefined"==typeof a.prototype[e]&&(console.warn(e+" method must be implemented in Element"),c=!1)}return c},a._checkPrimitiveClass=function(a){for(var b=!0,d=0;d<c.length;d++){var e=c[d];"undefined"==typeof a.prototype[e]&&(console.warn(e+" method must be implemented in Element"),b=!1)}return b},a.setPrimitiveClass=function(b,c){if(a._checkPrimitiveClass(c)){var e=d[b];e&&(e.fPrimitive=c)}},a.setElementClass=function(b,c){if(a._checkElementClass(c)){var e=d[b];e&&(e.fElement=c)}},a.getPrimitiveClass=function(a){var b=d[a];return b?b.fPrimitive:void 0},a.getElementClass=function(a){var b=d[a];return b?b.fElement:void 0},a.createElement=function(a){var b=d[a];return b?new b.fElement:void 0},a.createPrimitive=function(a){var b=d[a];return b?new b.fPrimitive:void 0},a.getClassNumber=function(){return d.length},a}),define("qtek-2d/context/CanvasImage",["require","qtek/texture/Texture2D","qtek/math/Matrix2d","./CanvasElement","glmatrix"],function(a){var b=a("qtek/texture/Texture2D"),c=a("qtek/math/Matrix2d"),d=a("./CanvasElement"),e=a("glmatrix"),f=e.vec2,g=[],h=function(a){this._data=a,this._ref=0};h.prototype.reference=function(){return this._ref++,this._data},h.prototype.removeReference=function(){return this._ref>0&&this._ref--,0==this._ref},h.prototype.getData=function(){return this._data};var i=[0,1,2,1,3,2],j=function(a,b,d,e,g,h,i,k,l){this.eType=j.eType,this.image=a,this.depth=0,this._texture=j.getTexture(a),this.transform=new c;var m=1/a.width,n=1/a.height;this.quadPositions=[f.fromValues(h,i),f.fromValues(h,i+l),f.fromValues(h+k,i),f.fromValues(h+k,i+l)],this.quadTexcoords=[f.fromValues(b*m,d*n),f.fromValues(b*m,(d+g)*n),f.fromValues((b+e)*m,d*n),f.fromValues((b+e)*m,(d+g)*n)],this._verticesData=null};return j.prototype={constructor:j,begin:function(){},end:function(a){c.copy(this.transform,a.currentTransform),this.updateVertices()},getTexture:function(){return this._texture},hasFill:function(){return!0},hasStroke:function(){return!1},dispose:function(a){j.disposeImage(this.image,a.renderer.gl)},getHashKey:function(){return this.eType+"_"+this.image.__IID__},updateVertices:function(){this._verticesData||(this._verticesData={position:new Float32Array(18),texcoord:new Float32Array(12)});for(var a=this._verticesData.position,b=this._verticesData.texcoord,c=this.depth,d=0,e=0,f=0;6>f;f++){var g=i[f];a[d]=this.quadPositions[g][0],a[d+1]=this.quadPositions[g][1],a[d+2]=c,b[e]=this.quadTexcoords[g][0],b[e+1]=this.quadTexcoords[g][1],d+=3,e+=2}},getVertices:function(){return this._verticesData},afterDraw:function(){},clone:function(){}},j.getTexture=function(a){if("undefined"==typeof a.__IID__||"undefined"==typeof g[a.__IID__]){var c=g.length,d=new b;d.image=a,d.flipY=!1,a.__IID__=c,g.push(new h(d))}return g[a.__IID__].reference()},j.disposeImage=function(a,b){if(!a.__IID__){var c=a.__IID__,d=g[c];if(d){var e=d.removeReference();if(e){d.getData().dispose(b);var f=g[g.length-1];g[c]=f,g.pop(),a.__IID__=c}}}},j.eType=d.register(j,null,null),j}),define("qtek-2d/context/tool/color",[],function(){function a(a){return a=Math.round(a),0>a?0:a>255?255:a}function b(a){return 0>a?0:a>1?1:a}function c(b){return a("%"===b[b.length-1]?parseFloat(b)/100*255:parseInt(b))}function d(a){return b("%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))}function e(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}function f(b){var f=b.replace(/ /g,"").toLowerCase();if(f in g)return g[f].slice();if("#"===f[0]){if(4===f.length){var h=parseInt(f.substr(1),16);return h>=0&&4095>=h?[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,1]:null}if(7===f.length){var h=parseInt(f.substr(1),16);return h>=0&&16777215>=h?[(16711680&h)>>16,(65280&h)>>8,255&h,1]:null}return null}var i=f.indexOf("("),j=f.indexOf(")");if(-1!==i&&j+1===f.length){var k=f.substr(0,i),l=f.substr(i+1,j-(i+1)).split(","),m=1;switch(k){case"rgba":if(4!==l.length)return null;m=d(l.pop());case"rgb":return 3!==l.length?null:[c(l[0]),c(l[1]),c(l[2]),m];case"hsla":if(4!==l.length)return null;m=d(l.pop());case"hsl":if(3!==l.length)return null;var n=(parseFloat(l[0])%360+360)%360/360,o=d(l[1]),p=d(l[2]),q=.5>=p?p*(o+1):p+o-p*o,r=2*p-q;return[a(255*e(r,q,n+1/3)),a(255*e(r,q,n)),a(255*e(r,q,n-1/3)),m];default:return null}}return null}var g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};return{parse:f}}),define("qtek-2d/context/DrawingStyle",["require","./tool/color"],function(a){"use strict";var b=a("./tool/color"),c=function(){this.strokeStyle=[0,0,0,1],this.fillStyle=[0,0,0,1]};return c.prototype.lineWidth=1,c.prototype.globalAlpha=1,c.prototype.shadowOffsetX=0,c.prototype.shadowOffsetY=0,c.prototype.shadowBlur=0,c.prototype.shadowColor=[0,0,0],c.prototype.setStrokeStyle=function(a){if("string"==typeof a)var c=b.parse(a);else(3==a.length||4==a.length)&&(c=a);c?(this.strokeStyle[0]=c[0]/255,this.strokeStyle[1]=c[1]/255,this.strokeStyle[2]=c[2]/255,this.strokeStyle[3]=c[3]||1):(this.strokeStyle[0]=0,this.strokeStyle[1]=0,this.strokeStyle[2]=0,this.strokeStyle[3]=1)},c.prototype.setFillStyle=function(a){var c;"string"==typeof a?c=b.parse(a):(3==a.length||4==a.length)&&(c=a),c?(this.fillStyle[0]=c[0]/255,this.fillStyle[1]=c[1]/255,this.fillStyle[2]=c[2]/255,this.fillStyle[3]=c[3]||1):(this.fillStyle[0]=0,this.fillStyle[1]=0,this.fillStyle[2]=0,this.fillStyle[3]=1)},c.prototype.copy=function(a){this.strokeStyle=a.strokeStyle.slice(),this.fillStyle=a.fillStyle.slice(),this.lineWidth=a.lineWidth,this.globalAlpha=a.globalAlpha,this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor.slice()},c.prototype.clone=function(){},c}),define("qtek-2d/context/LineSegment",["require","./tool/math"],function(a){var b=a("./tool/math"),c=function(a,b,d,e){this.type=c.type,this.thickness=0,this.points=[a,b,d,e]};return c.prototype.strokeSteps=1,c.prototype.reverse=function(){b.reverse(this.points,2,2)},c.type=1,c}),define("qtek-2d/context/tool/Triangulation2",["require","qtek/core/LinkedList","./math"],function(a){"use strict";function b(a,b){this.p0=a,this.p1=b,this._linkedListEntry=null}var c=a("qtek/core/LinkedList"),d=a("./math"),e=1,f=2,g=function(){this.points=[],this.triangles=[],this.maxGridNumber=50,this.minGridNumber=0,this._gridNumber=20,this._boundingBox=[[1/0,1/0],[-1/0,-1/0]],this._nPoints=0,this._nTriangle=0,this._pointTypes=[],this._grids=[],this._gridWidth=0,this._gridHeight=0,this._edgeList=new c,this._edgeOut=[],this._edgeIn=[],this._candidates=[]};return g.prototype.triangulate=function(a){this._nPoints=a.length/2,this._nPoints<=3||(this._gridNumber=Math.ceil(Math.sqrt(this._nPoints)),this._gridNumber=Math.max(Math.min(this._gridNumber,this.maxGridNumber),this.minGridNumber),this.points=a,this._reset(),this._prepare(),this._earClipping(),this.triangles.length=3*this._nTriangle)},g.prototype._reset=function(){this._nTriangle=0,this._edgeList.clear(),this._candidates.length=0,this._boundingBox[0][0]=this._boundingBox[0][1]=1/0,this._boundingBox[1][0]=this._boundingBox[1][1]=-1/0;for(var a=this._gridNumber*this._gridNumber,b=this._grids.length,c=0;b>c;c++)this._grids[c].length=0;for(;a>c;c++)this._grids[c]=[];if(this._grids.length=a,b<this._nPoints){b=this._edgeIn.length;for(var c=b;c<this._nPoints;c++)this._edgeIn[c]=this._edgeOut[c]=null}else this._edgeIn.length=this._edgeOut.length=this._nPoints},g.prototype._prepare=function(){for(var a=this._boundingBox,b=this._nPoints,c=0,g=b-1;b>c;){var h=(c+1)%b,i=this.points[2*g],j=this.points[2*g+1],k=this.points[2*c],l=this.points[2*c+1],m=this.points[2*h],n=this.points[2*h+1];k<a[0][0]&&(a[0][0]=k),l<a[0][1]&&(a[0][1]=l),k>a[1][0]&&(a[1][0]=k),l>a[1][1]&&(a[1][1]=l),a[0][0]-=.1,a[0][1]-=.1,a[1][0]+=.1,a[1][1]+=.1;var o=d.triangleArea(i,j,k,l,m,n);Math.abs(o)<1?(this.points.splice(2*c,2),b--):(this._pointTypes[c]=0>o?e:f,0>o&&this._candidates.push(c),g=c,c++)}this._pointTypes.length=b,this._gridWidth=(a[1][0]-a[0][0])/this._gridNumber,this._gridHeight=(a[1][1]-a[0][1])/this._gridNumber;for(var c=0;b>c;c++)if(this._pointTypes[c]==f){var p=this.points[2*c],q=this.points[2*c+1],r=this._getPointHash(p,q);this._grids[r].push(c)}for(var c=0;b-1>c;c++)this._addEdge(c,c+1);this._addEdge(c,0)},g.prototype._earClipping=function(){for(var a=this._candidates,b=this._nPoints;a.length;){for(var c=!0,d=0;d<a.length;){var e=a[d];this._isEar(e)?(this._clipEar(e),a.splice(d,1),c=!1,b--):d++}c&&(this._clipEar(a.pop()),b--)}},g.prototype._isEar=function(a){var b=this._edgeIn[a],c=this._edgeOut[a],e=b.p0,g=c.p1,h=this.points[2*e],i=this.points[2*e+1],j=this.points[2*a],k=this.points[2*a+1],l=this.points[2*g],m=this.points[2*g+1];if(Math.abs(d.triangleArea(h,i,j,k,l,m))<1)return!0;for(var n=this._getTriangleGrids(h,i,j,k,l,m),o=n[0][1];o<=n[1][1];o++)for(var p=n[0][0];p<=n[1][0];p++)for(var q=o*this._gridNumber+p,r=this._grids[q],s=0;s<r.length;s++){var t=r[s];if(this._pointTypes[t]==f){var u=this.points[2*t],v=this.points[2*t+1];if(d.isPointInTriangle(h,i,j,k,l,m,u,v))return!1}}return!0},g.prototype._clipEar=function(a){var b=this._edgeIn[a],c=this._edgeOut[a],d=3*this._nTriangle;this.triangles[d]=b.p0,this.triangles[d+1]=b.p1,this.triangles[d+2]=c.p1,this._nTriangle++;var g=this._edgeIn[b.p0],h=this._edgeOut[c.p1];this._pointTypes[b.p0]==f&&this.isTriangleConvex2(g.p0,b.p0,c.p1)&&(this._candidates.push(b.p0),this._pointTypes[b.p0]=e),this._pointTypes[c.p1]==f&&this.isTriangleConvex2(b.p0,c.p1,h.p1)&&(this._candidates.push(c.p1),this._pointTypes[c.p1]=e),this._removeEdge(b),this._removeEdge(c),this._addEdge(b.p0,c.p1)},g.prototype._addEdge=function(a,c){var d=new b(a,c);this._edgeOut[a]=d,this._edgeIn[c]=d;var e=this._edgeList.insert(d);return d._linkedListEntry=e,d},g.prototype._removeEdge=function(a){this._edgeList.remove(a._linkedListEntry),this._edgeOut[a.p0]=null,this._edgeIn[a.p1]=null},g.prototype._getPointHash=function(a,b){var c=this._boundingBox;return Math.floor((b-c[0][1])/this._gridHeight)*this._gridNumber+Math.floor((a-c[0][0])/this._gridWidth)},g.prototype._getTriangleGrids=function(){var a,b,c,d,e=[[-1,-1],[-1,-1]];return function(f,g,h,i,j,k){var l=this._boundingBox;return a=c=f,b=d=g,a>h&&(a=h),b>i&&(b=i),h>c&&(c=h),i>d&&(d=i),a>j&&(a=j),b>k&&(b=k),j>c&&(c=j),k>d&&(d=k),e[0][0]=Math.floor((a-l[0][0])/this._gridWidth),e[1][0]=Math.floor((c-l[0][0])/this._gridWidth),e[0][1]=Math.floor((b-l[0][1])/this._gridHeight),e[1][1]=Math.floor((d-l[0][1])/this._gridHeight),e}}(),g.prototype.isTriangleConvex2=function(a,b,c){return this.triangleArea(a,b,c)<0},g.prototype.triangleArea=function(a,b,c){var d=this.points[2*a],e=this.points[2*a+1],f=this.points[2*b],g=this.points[2*b+1],h=this.points[2*c],i=this.points[2*c+1];return(f-d)*(i-g)-(g-e)*(h-f)},g}),define("qtek-2d/context/Polygon",["require","./tool/math","glmatrix","./tool/Triangulation2"],function(a){var b=a("./tool/math"),c=a("glmatrix"),d=c.vec2,e=a("./tool/Triangulation2"),f=new e,g=function(a){this.points=[],this.triangles=[],this._nPoints=0,this._isClosed=!1,this._isEnded=!1,this._x0=0,this._y0=0,this._xi=1,this._yi=1,this._autoUpdateBBox=a,this.boundingBox=a?[d.create(),d.create()]:null,this._isStatic=!1};return g.prototype.begin=function(a,b){if(this._isStatic&&(this._isStatic=!1,this.points=[],this.triangles=[]),this._nPoints=0,this._isClosed=!1,this._isEnded=!1,this.addPoint(a,b),this._x0=this._xi=a,this._y0=this._yi=b,this._autoUpdateBBox){var c=this.boundingBox;d.set(c[0],a,b),d.set(c[1],a,b)}},g.prototype.end=function(){this._isEnded||(this.points.length=2*this._nPoints,this._isEnded=!0)},g.prototype.addPoint=function(a,b){var c=2*this._nPoints;if(this.points[c]=a,this.points[c+1]=b,this._xi=a,this._yi=b,this._nPoints++,this._autoUpdateBBox){var d=this.boundingBox;a<d[0][0]&&(d[0][0]=a),b<d[0][1]&&(d[0][1]=b),a>d[1][0]&&(d[1][0]=a),b>d[1][1]&&(d[1][1]=b)}},g.prototype.triangulate=function(){this._nPoints<3||(3==this._nPoints?(this.triangles[0]=0,this.triangles[1]=1,this.triangles[2]=2,this.triangles.length=3):(f.triangles=this.triangles,f.triangulate(this.points),this.points=f.points,this._nPoints=this.points.length/2))},g.prototype.checkClose=function(a,c){return this._nPoints>=1&&b.approxEqualInt(a,this._x0)&&b.approxEqualInt(c,this._y0)?(this._isClosed=!0,!0):!1},g.prototype.isCCW=function(){return b.area(this.points)<0},g.prototype.area=function(){return b.area(this.points)},g.prototype.removeDuplicate=function(){for(var a=this.points,c=2*this._nPoints,d=0;c>d;)x0=a[d],y0=a[d+1],x1=a[(d+2)%c],y1=a[(d+3)%c],b.approxEqualInt(x0,x1)&&b.approxEqualInt(y0,y1)?(a.splice(d,2),this._nPoints--,c-=2):d+=2},g.prototype.updateBoundingBox=function(){this.boundingBox||(this.boundingBox=[d.create(),d.create()]);var a=this.boundingBox,b=this.points;a[0][0]=1/0,a[0][1]=1/0,a[1][0]=-1/0,a[1][1]=-1/0;for(var c=0;c<2*this._nPoints;){var e=b[c++],f=b[c++];e<a[0][0]&&(a[0][0]=e),f<a[0][1]&&(a[0][1]=f),e>a[1][0]&&(a[1][0]=e),f>a[1][1]&&(a[1][1]=f)}},g.prototype.isPointInPolygon=function(a,b){var c=this.boundingBox;return c[0][0]>a||c[1][0]<a||c[0][1]>b||c[1][1]<b?!1:void 0},g.prototype.toStatic=function(){this._isStatic||(this.points=new Float32Array(this.points),this.triangles=new Uint32Array(this.triangles),this._isStatic=!0)},g.prototype.reverse=function(){b.reverse(this.points,this._nPoints,2)},g}),define("qtek-2d/context/CanvasSubpath",["require","./tool/math","./LineSegment","./BezierCurveSegment","./Polygon","glmatrix"],function(a){var b=a("./tool/math"),c=a("./LineSegment"),d=a("./BezierCurveSegment"),e=a("./Polygon"),f=a("glmatrix"),g=(f.vec3,f.vec2),h=(f.mat4,function(){this.basePolygon=new e(!0),this.interiorPolygon=new e(!0),this.fillSegments=[],this.fillCurveSegments=[],this.strokeSegments=[],this.strokeVerticesArray=null,this._nFillSegments=0,this._nStrokeSegments=0,this._nFillCurveSegements=0,this._isClosed=!1,this._isEnded=!1,this._fill=!0,this._stroke=!1});return h.prototype.begin=function(a,b){this._nFillSegments=0,this._nStrokeSegments=0,this._nFillCurveSegements=0,this._isEnded=!1,this._isClosed=!1,this._fill=!1,this._stroke=!1,this.basePolygon.begin(a,b)},h.prototype.end=function(){if(!this._isEnded){this.strokeSegments.length=this._nStrokeSegments,this.fillSegments.length=this._nFillSegments,this.fillCurveSegments.length=this._nFillCurveSegements,this._isEnded=!0,this.basePolygon.end();var a=this.basePolygon.area();a>0?this.reverse():0==a&&this._nFillCurveSegements>0&&(b.isCCW(this.fillCurveSegments[0].points)||this.reverse())}},h.prototype.close=function(a){if(!this._isClosed){var b=this.basePolygon;
if(b._nPoints>1){var d=new c(b._xi,b._yi,b._x0,b._y0);d.thickness=a,this.strokeSegments[this._nStrokeSegments++]=d}this._isClosed=!0}},h.prototype.stroke=function(a,b){if(!this._stroke){this._stroke=!0;for(var c=0;c<this.strokeSegments.length;c++){var e=this.strokeSegments[c];e.type==d.type&&e.updateStrokeSegments(a,b)}this._convertLineToPolygon()}},h.prototype.updateStrokeThickness=function(a){if(this._stroke){for(var b=0;b<this.segments.length;b++){var c=this.strokeSegments[b];c.thickness=a}this._convertLineToPolygon()}},h.prototype.fill=function(){this._fill||(this._fill=!0,this._checkOverlap(),this._updateCurveTextureCoords(),this._updateSegments(),this._updateInteriorPolygon(),this.interiorPolygon.triangulate())},h.prototype.addLine=function(a,b,d,e,f){var g=this._checkClose(d,e);g?this._isClosed=!0:this.basePolygon.addPoint(d,e);var h=new c(a,b,d,e);return h.thickness=f,this.strokeSegments[this._nStrokeSegments++]=h,this.fillSegments[this._nFillSegments++]=h,g},h.prototype.addQuadraticBezierCurve=function(a,b,c,d,e,f,g){var h=e,i=f;return e=(e+2*c)/3,f=(f+2*d)/3,c=(a+2*c)/3,d=(b+2*d)/3,this.addCubicBezierCurve(a,b,c,d,e,f,h,i,g)},h.prototype.addCubicBezierCurve=function(a,b,c,e,f,g,h,i,j){var k=this._checkClose(h,i);k?this._isClosed=!0:this.basePolygon.addPoint(h,i);var l=new d(a,b,c,e,f,g,h,i);return l.thickness=j,this.strokeSegments[this._nStrokeSegments++]=l,this.fillSegments[this._nFillSegments++]=l,this.fillCurveSegments[this._nFillCurveSegements++]=l,k},h.prototype.isPointInSubpath=function(a,b){var c=this.interiorPolygon.boundingBox;return c[0][0]>a||c[1][0]<a||c[0][1]>b||c[1][1]<b?!1:void 0},h.prototype._checkClose=function(a,b){return this.basePolygon.checkClose(a,b)},h.prototype._updateCurveTextureCoords=function(){for(var a=0;a<this.fillSegments.length;a++){var b=this.fillSegments[a];b.type==d.type&&this._updateLeafCurveTextureCoords(b)}},h.prototype._updateLeafCurveTextureCoords=function(a){a.subCurveA?(this._updateLeafCurveTextureCoords(a.subCurveA),this._updateLeafCurveTextureCoords(a.subCurveB)):a.updateTextureCoords()},h.prototype._checkOverlap=function(){for(var a=[],c=this.fillCurveSegments.length,d=0;c>d;d++)for(var e=d+1;c>e;e++){var f=this.fillCurveSegments[d],g=this.fillCurveSegments[e];f.intersectCurve(g)&&(a.push(f),a.push(g))}for(;a.length;){var h=a.shift(),i=a.shift();h.subdivide(.5),h.subCurveA.intersectCurve(i)&&Math.abs(b.area(h.subCurveA.points))>1&&(a.push(i),a.push(h.subCurveA)),h.subCurveB.intersectCurve(i)&&Math.abs(b.area(h.subCurveB.points))>1&&(a.push(i),a.push(h.subCurveB))}},h.prototype._updateSegments=function(){this._nFillCurveSegements=0;for(var a=0;a<this._nFillSegments;){var b=this.fillSegments[a];b.type==d.type?b.subCurveA?(this.fillSegments.splice(a,1),this._nFillSegments--,a=this._replaceSubdividedCurve(b,a)):(this.fillCurveSegments[this._nFillCurveSegements++]=b,a++):a++}this.fillCurveSegments.length=this._nFillCurveSegements},h.prototype._replaceSubdividedCurve=function(a,b){return a.subCurveA?(b=this._replaceSubdividedCurve(a.subCurveA,b),this._replaceSubdividedCurve(a.subCurveB,b)):(this.fillSegments.splice(b,0,a),this._nFillSegments++,this.fillCurveSegments[this._nFillCurveSegements++]=a,b+1)},h.prototype._updateInteriorPolygon=function(){var a,e,f,g,h,i,j,k;if(!(this._nFillSegments<2)){var l=this.interiorPolygon,m=this.fillSegments[0];l.begin(m.points[0],m.points[1]);for(var n=0;n<this._nFillSegments;n++){var o=this.fillSegments[n];switch(o.type){case c.type:l.addPoint(o.points[2],o.points[3]);break;case d.type:a=o.points[0],e=o.points[1],f=o.points[2],g=o.points[3],h=o.points[4],i=o.points[5],j=o.points[6],k=o.points[7];var p=b.isTriangleConvex(a,e,f,g,j,k);p!=b.isTriangleConvex(a,e,h,i,j,k)?p?(l.addPoint(h,i),l.addPoint(j,k)):(l.addPoint(f,g),l.addPoint(j,k)):p?l.addPoint(j,k):b.isTriangleConvex(a,e,h,i,f,g)?b.isTriangleConvex(f,g,h,i,j,k)?(l.addPoint(f,g),l.addPoint(j,k)):(l.addPoint(f,g),l.addPoint(h,i),l.addPoint(j,k)):b.isTriangleConvex(h,i,f,g,j,k)?(l.addPoint(h,i),l.addPoint(j,k)):(l.addPoint(h,i),l.addPoint(f,g),l.addPoint(j,k))}}l.end(),l.removeDuplicate()}},h.prototype._convertLineToPolygon=function(){for(var a=g.create(),b=g.create(),e=g.create(),f=g.create(),h=g.create(),i=g.create(),j=g.create(),k=[],l=0;4>l;l++)k[l]=g.create();return function(){for(var l=0,m=this.strokeSegments.length,n=0;m>n;n++){var o=this.strokeSegments[n];l+=6*o.strokeSteps}this.strokeVerticesArray&&this.strokeVerticesArray.length==2*l||(this.strokeVerticesArray=new Float32Array(2*l));var p=this.strokeVerticesArray,q=0,r=this._isClosed?m-1:0;o=this.strokeSegments[r],g.set(a,o.points[0],o.points[1]);for(var s=0,n=r;m>n;s++){switch(o=this.strokeSegments[n],o.type){case c.type:if(0==s){if(g.set(b,o.points[2],o.points[3]),g.copy(e,b),g.sub(h,b,a),g.normalize(h,h),!this._isClosed){g.set(i,h[1],-h[0]);var t=o.thickness/2;g.scaleAndAdd(k[0],a,i,t),g.scaleAndAdd(k[1],a,i,-t)}}else{g.set(e,o.points[2],o.points[3]),g.copy(f,h),g.sub(h,e,b),g.normalize(h,h),g.set(i,f[0]-h[0],f[1]-h[1]),g.normalize(i,i),g.set(j,f[1],-f[0]);var u=g.dot(i,j);0>u&&(g.negate(i,i),u=-u);var t=o.thickness/u/2;g.scaleAndAdd(k[2],b,i,t),g.scaleAndAdd(k[3],b,i,-t),0!==n&&(p[q++]=k[0][0],p[q++]=k[0][1],p[q++]=k[1][0],p[q++]=k[1][1],p[q++]=k[2][0],p[q++]=k[2][1],p[q++]=k[1][0],p[q++]=k[1][1],p[q++]=k[3][0],p[q++]=k[3][1],p[q++]=k[2][0],p[q++]=k[2][1]),g.copy(a,b),g.copy(b,e),g.copy(k[0],k[2]),g.copy(k[1],k[3])}break;case d.type:var v=o.fx,w=o.fy,x=o.dfx,y=o.dfy,z=o.ddfx,A=o.ddfy,B=o.dddfx,C=o.dddfy,D=0;if(0==s){if(v+=x,w+=y,x+=z,y+=A,z+=B,A+=C,g.set(b,v,w),g.copy(e,b),g.sub(h,b,a),g.normalize(h,h),!this._isClosed){g.set(i,h[1],-h[0]);var t=o.thickness/2;g.scaleAndAdd(k[0],a,i,t),g.scaleAndAdd(k[1],a,i,-t)}D=1}for(var E=D;E<o.strokeSteps;E++){{f[0]-h[0],f[1]-h[1]}v+=x,w+=y,x+=z,y+=A,z+=B,A+=C,g.set(e,v+x,w+y),g.copy(f,h),g.sub(h,e,b),g.normalize(h,h),g.set(i,f[0]-h[0],f[1]-h[1]),g.normalize(i,i),g.set(j,f[1],-f[0]);var u=g.dot(i,j);0>u&&(g.negate(i,i),u=-u);var t=o.thickness/u/2;g.scaleAndAdd(k[2],b,i,t),g.scaleAndAdd(k[3],b,i,-t),0==s&&this._isClosed||1==s&&E==D&&this._isClosed||(p[q++]=k[0][0],p[q++]=k[0][1],p[q++]=k[1][0],p[q++]=k[1][1],p[q++]=k[2][0],p[q++]=k[2][1],p[q++]=k[1][0],p[q++]=k[1][1],p[q++]=k[3][0],p[q++]=k[3][1],p[q++]=k[2][0],p[q++]=k[2][1]),g.copy(a,b),g.copy(b,e),g.copy(k[0],k[2]),g.copy(k[1],k[3])}}this._isClosed?n=s:n++}this._isClosed?(g.set(k[2],p[0],p[1]),g.set(k[3],p[2],p[3])):(g.set(i,h[1],-h[0]),g.scaleAndAdd(k[2],e,i,o.thickness/2),g.scaleAndAdd(k[3],e,i,-o.thickness/2)),p[q++]=k[0][0],p[q++]=k[0][1],p[q++]=k[1][0],p[q++]=k[1][1],p[q++]=k[2][0],p[q++]=k[2][1],p[q++]=k[1][0],p[q++]=k[1][1],p[q++]=k[3][0],p[q++]=k[3][1],p[q++]=k[2][0],p[q++]=k[2][1]}}(),h.prototype.isValid=function(){if(this._nFillSegments>1)return!0;if(1==this._nFillSegments){if(this._nFillCurveSegements>0)return!0;if(this.basePolygon.points.length>2)return!0}},h.prototype.reverse=function(){b.reverse(this.fillSegments,this._nFillSegments,1),b.reverse(this.strokeSegments,this._nStrokeSegments,1);for(var a=0;a<this._nStrokeSegments;a++)this.strokeSegments[a].reverse()},h.prototype.toStatic=function(){this.basePolygon.toStatic(),this.interiorPolygon.toStatic(),this.fillSegments.length=0,this.strokeSegments.length=0,this.fillCurveSegments.length=0},h}),define("qtek-2d/context/tool/CachedList",["require"],function(){var a=function(a,b){this.factory=a,this.maxRange=b||50,this._size=0,this._data=[],this._max=0,this._needsClearCount=0};return a.prototype={constructor:a,increase:function(){var a=this._data[this._size];return a||(a=this._data[this._size]=new this.factory),this._size++,a},decrease:function(){this._size>0&&this._size--},clear:function(a){this.tick(a),this._size=0},tick:function(a){if(this._size>0&&this._max/this._size>2||this._max-this._size>this.maxRange?this._needsClearCount++:this._max<this._size?(this._needsClearCount=0,this._max=this._size):this._needsClearCount=0,this._needsClearCount>10){if(a)for(var b=this._size;b<this._data.length;b++)a(this._data[b]);this._max=this._data.length=this._size}},size:function(){return this._size},data:function(){return this._data},get:function(a){return this._data[a]}},a}),define("qtek-2d/context/CanvasPath",["require","qtek/math/Matrix2d","./DrawingStyle","./CanvasSubpath","./tool/CachedList","./CanvasElement","./tool/math","qtek/core/util"],function(a){var b=a("qtek/math/Matrix2d"),c=a("./DrawingStyle"),d=a("./CanvasSubpath"),e=a("./tool/CachedList"),f=a("./CanvasElement"),g=a("./tool/math"),h=a("qtek/core/util"),i=Math.PI/4,j=2*Math.PI,k=function(){this.eType=k.eType,this.subpaths=new e(d),this.drawingStyle=new c,this.transform=new b,this.depth=0,this._subpath=null,this._fill=!1,this._stroke=!1,this._firstCmd=!1,this._xi=0,this._yi=0,this._verticesData=null,this._fillColorChanged=!0,this._strokeColorChanged=!0,this._isStatic=!1};return k.prototype={constructor:k,getHashKey:function(){return this.eType},setStyle:function(a,b){"fillStyle"==a?this.setFillStyle(b):"strokeStyle"==a?this.setStrokeStyle(b):"lineWidth"==a||(this.drawingStyle[a]=b)},setStrokeLineWidth:function(a){if(this._stroke){if(this._isStatic)return void console.warn("Static path can't change its stroke line width");if(a!==this.drawingStyle.lineWidth){this.drawingStyle.lineWidth=a;for(var b=this.subpaths.data(),c=0;c<this.subpaths.size();c++)b[c].updateStrokeThickness(a);this._updateStrokeVertices()}}},setFillStyle:function(a){this.drawingStyle.setFillStyle(a),this._fillColorChanged=!0},setStrokeStyle:function(a){this.drawingStyle.setStrokeStyle(a),this._strokeColorChanged=!0},setGlobalAlpha:function(a){this.drawingStyle.globalAlpha=a,this._strokeColorChanged=!0,this._fillColorChanged=!0},moveTo:function(a,b){this._subpath&&this._endSubpath(),this._firstCmd=!1,this._subpath=this._beginSubpath(a,b),this._xi=a,this._yi=b},lineTo:function(a,b,c){if(!this._subpath){if(this._firstCmd)return this._subpath=this._beginSubpath(a,b),this._xi=a,this._yi=b,void(this._firstCmd=!1);this._subpath=this._beginSubpath(this._xi,this._yi)}var d=this._subpath.addLine(this._xi,this._yi,a,b,c);d&&this._endSubpath(),this._xi=a,this._yi=b},bezierCurveTo:function(a,b,c,d,e,f,g){if(!this._subpath){if(this._firstCmd)return this._subpath=this._beginSubpath(e,f),this._xi=e,this._yi=f,void(this._firstCmd=!1);this._subpath=this._beginSubpath(this._xi,this._yi)}var h=this._subpath.addCubicBezierCurve(this._xi,this._yi,a,b,c,d,e,f,g);h&&this._endSubpath(),this._xi=e,this._yi=f},quadraticCurveTo:function(a,b,c,d,e){if(!this._subpath){if(this._firstCmd)return this._subpath=this._beginSubpath(c,d),this._xi=c,this._yi=d,void(this._firstCmd=!1);this._subpath=this._beginSubpath(this._xi,this._yi)}var f=this._subpath.addQuadraticBezierCurve(this._xi,this._yi,a,b,c,d,e);f&&this._endSubpath(),this._xi=c,this._yi=d},arc:function(a,b,c,d,e,f,h){"undefined"==typeof f&&(f=!1);var k=a+c*Math.cos(d),l=b+c*Math.sin(d);if(this._subpath||(this._subpath=this._beginSubpath(k,l),this._xi=k,this._yi=l,this._firstCmd=!1),g.approxEqualInt(k,this._xi)&&g.approxEqualInt(l,this._yi)||this._subpath.addLine(this._xi,this._yi,k,l,h),0!=c&&!g.approxEqual(d,e)){d%=j,e%=j,0>d&&(d+=j),0>e&&(e+=j),f?e>=d&&(e-=j):d>=e&&(e+=j);var m=e-d,n=Math.ceil(Math.abs(m)/i*c/50);4>n&&(n=4);for(var o,p,q,r,s,t,u,v,w=m/n,x=d,y=.5522847498,z=0;n>z;z++){o=x+w,f?e>o&&(o=e,w=o-x):o>e&&(o=e,w=o-x),t=a+c*Math.cos(o),u=b+c*Math.sin(o),v=Math.tan(w/2),p=k-y*(l-b)*v,q=l+y*(k-a)*v,r=t+y*(u-b)*v,s=u-y*(t-a)*v;var A=this._subpath.addCubicBezierCurve(k,l,p,q,r,s,t,u,h);if(A){this._endSubpath();break}k=t,l=u,x=o}this._xi=t,this._yi=u}},arcTo:function(){},rect:function(a,b,c,d,e){this._endSubpath(),this._subpath=this._beginSubpath(a,b),this._firstCmd=!1,this._subpath.addLine(a,b,a,b+d,e),this._subpath.addLine(a,b+d,a+c,b+d,e),this._subpath.addLine(a+c,b+d,a+c,b,e),this._subpath.addLine(a+c,b,a,b,e),this._xi=a,this._yi=b,this._endSubpath()},begin:function(){this.subpaths.clear(),this._subpath=null,this._stroke=this._fill=!1,this._isStatic=!1,this._firstCmd=!0},end:function(){this._endSubpath(),this.updateVertices()},stroke:function(a){this._subpath&&this._endSubpath(),this.drawingStyle.setStrokeStyle(a.strokeStyle),this.drawingStyle.lineWidth=a.lineWidth,this.drawingStyle.globalAlpha=a.globalAlpha,b.copy(this.transform,a.currentTransform);for(var c=a.currentTransform._array,d=Math.sqrt(c[0]*c[0]+c[1]*c[1]),e=Math.sqrt(c[2]*c[2]+c[3]*c[3]),f=this.subpaths.data(),g=0;g<this.subpaths.size();g++)f[g].stroke(d,e);this._stroke=!0},fill:function(a){this._subpath&&this._endSubpath(),this.drawingStyle.setFillStyle(a.fillStyle),this.drawingStyle.globalAlpha=a.globalAlpha,b.copy(this.transform,a.currentTransform);for(var c=this.subpaths.data(),d=0;d<this.subpaths.size();d++)c[d].fill();this._fill=!0},hasFill:function(){return this._fill},hasStroke:function(){return this._stroke},close:function(a){this._subpath&&this._subpath.close(a)},updateVertices:function(){this._verticesData||(this._verticesData={}),this._fill&&this._updateFillVertices(),this._stroke&&this._updateStrokeVertices()},_updateFillVertices:function(){this._verticesData.fill||(this._verticesData.fill={position:null,coord:null});var a=this._verticesData.fill;a.dirty=!0;for(var b=0,c=this.subpaths.data(),d=this.subpaths.size(),e=0;d>e;e++){var f=c[e];if(f._fill){b+=f.interiorPolygon.triangles.length;for(var g=0;g<f.fillCurveSegments.length;g++)b+=f.fillCurveSegments[g].triangles.length}}a.position&&a.position.length===3*b||(a.position=new Float32Array(3*b),a.coord=new Float32Array(3*b));for(var h=a.position,i=a.coord,j=this.depth,k=0,e=0;d>e;e++){var f=c[e];if(f._fill){for(var l=f.interiorPolygon,m=0;m<l.triangles.length;m++){var n=l.triangles[m];h[k]=l.points[2*n],h[k+1]=l.points[2*n+1],h[k+2]=j,i[k]=0,i[k+1]=1,i[k+2]=1,k+=3}for(var o=f.fillCurveSegments,m=0;m<o.length;m++)for(var p=o[m],q=0;q<p.triangles.length;q++){var n=p.triangles[q],r=p.points,s=p.coords;i[k]=s[3*n],i[k+1]=s[3*n+1],i[k+2]=s[3*n+2],h[k]=r[2*n],h[k+1]=r[2*n+1],h[k+2]=j,k+=3}}}},_updateStrokeVertices:function(){this._verticesData.stroke||(this._verticesData.stroke={position:null});var a=this._verticesData.stroke;a.dirty=!0;for(var b=0,c=this.subpaths.size(),d=this.subpaths.data(),e=0;c>e;e++){var f=d[e];f._stroke&&(b+=f.strokeVerticesArray.length/2)}a.position&&a.position.length===3*b||(a.position=new Float32Array(3*b));for(var g=a.position,h=0,i=this.depth,c=this.subpaths.size(),d=this.subpaths.data(),e=0;c>e;e++){var f=d[e],j=f.strokeVerticesArray;if(f._stroke)for(var k=0;k<j.length/2;k++)g[h]=j[2*k],g[h+1]=j[2*k+1],g[h+2]=i+.002,h+=3}},getFillVertices:function(){return this._verticesData.fill},getFillVertexNumber:function(){return this._verticesData.fill.position.length/3},getStrokeVertices:function(){return this._verticesData.stroke},getStrokeVertexNumber:function(){return this._verticesData.stroke.position.length/3},afterDraw:function(){this.transform._dirty=!1,this._fillColorChanged=!1,this._strokeColorChanged=!1,this._fill&&(this._verticesData.fill.dirty=!1),this._stroke&&(this._verticesData.stroke.dirty=!1)},clone:function(a){var b=new k;return this._fill||this._stroke?(b._fill=this._fill,b._stroke=this._stroke,b.depth=a.requestDepthChannel(),b.drawingStyle.copy(this.drawingStyle),b.transform.copy(this.transform),b._verticesData={fill:h.clone(this._verticesData.fill),stroke:h.clone(this._verticesData.stroke)},b._verticesData.fill&&(b._verticesData.fill.dirty=!0),b._verticesData.stroke&&(b._verticesData.stroke.dirty=!0),b):(console.warn("Path must have fill or stroke"),b)},toStatic:function(){for(var a=this.subpaths.data(),b=this.subpaths.size(),c=0;b>c;c++)a[c].toStatic();this._isStatic=!0},_endSubpath:function(){this._subpath&&(this._subpath.isValid()?this._subpath.end():this.subpaths.decrease(),this._subpath=null)},_beginSubpath:function(a,b){var c=this.subpaths.increase();return c.begin(a,b),c}},k.eType=f.register(k,null,null),k}),define("qtek-2d/context/CanvasPointCloud",function(){}),define("qtek-2d/context/Geometry2D",["require","qtek/Geometry","qtek/StaticGeometry"],function(a){var b=a("qtek/Geometry"),c=a("qtek/StaticGeometry"),d=b.derive({_enabledAttributes:null,hint:b.DYNAMIC_DRAW},{dirty:function(){this._cache.dirtyAll()},getVertexNumber:c.prototype.getVertexNumber,getFaceNumber:c.prototype.getFaceNumber,isUseFace:c.prototype.isUseFace,getEnabledAttributes:c.prototype.getEnabledAttributes,getBufferChunks:c.prototype.getBufferChunks,_updateBuffer:c.prototype._updateBuffer});return d}),define("qtek-2d/context/Primitive",["require","qtek/Renderable","./Geometry2D","qtek/Material","qtek/Shader"],function(a){"use strict";var b=a("qtek/Renderable"),c=(a("./Geometry2D"),a("qtek/Material"),a("qtek/Shader"),b.derive({culling:!1,mode:b.TRIANGLES},{updateElements:function(){},addElement:function(){},clearElements:function(){},render:b.prototype.render}));return c}),define("qtek-2d/context/shader/path.essl",[],function(){return"@export buildin.2d.path.vertex\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec3 t0;\nattribute vec3 t1;\nattribute vec3 coord;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvarying vec4 v_Color;\nvarying vec3 v_klm;\n\nvoid main()\n{\n    mat3 localTransform = mat3(\n        t0.x, t1.x, 0.0,\n        t0.y, t1.y, 0.0,\n        t0.z, t1.z, 1.0\n    );\n    vec3 pos2d = vec3(position.xy, 1.0);\n    pos2d = localTransform * pos2d;\n    vec4 pos3d = vec4(pos2d.xy, position.z, 1.0);\n\n    v_Color = color;\n    v_klm = coord;\n    gl_Position = worldViewProjection * pos3d;\n}\n\n@end\n\n\n@export buildin.2d.path.fragment\n\nvarying vec4 v_Color;\nvarying vec3 v_klm;\n\n#ifdef ANTIALIASING\n    #extension GL_OES_standard_derivatives : enable\n#endif\n\nvoid main()\n{\n    #ifdef ANTIALIASING\n        // Gradients\n        vec3 px = dFdx(v_klm);\n        vec3 py = dFdy(v_klm);\n        // Chain rule\n        float k2 = v_klm.x * v_klm.x;\n        float c = k2 * v_klm.x - v_klm.y * v_klm.z;\n        float k23 = 3.0 * k2;\n        float cx = k23 * px.x - v_klm.z * px.y - v_klm.y * px.z;\n        float cy = k23 * py.x - v_klm.z * py.y - v_klm.y * py.z;\n        // Signed distance\n        float sd = c / sqrt(cx * cx + cy * cy);\n\n        float alpha = clamp(0.5 - sd, 0.0, 1.0);\n\n    #else\n        float alpha = step(v_klm.x * v_klm.x * v_klm.x, v_klm.y * v_klm.z);\n    #endif\n\n    gl_FragColor = v_Color;\n    gl_FragColor.a *= alpha;\n\n    if (gl_FragColor.a < 1e-3) {\n        discard;\n    }\n}\n\n@end"}),define("qtek-2d/context/PathPrimitive",["require","qtek/Geometry","qtek/Material","qtek/Shader","./Geometry2D","./CanvasPath","./CanvasElement","./Primitive","./shader/path.essl"],function(a){var b=a("qtek/Geometry"),c=a("qtek/Material"),d=a("qtek/Shader"),e=a("./Geometry2D"),f=a("./CanvasPath"),g=a("./CanvasElement"),h=a("./Primitive");d.import(a("./shader/path.essl"));var i=new d({vertex:d.source("buildin.2d.path.vertex"),fragment:d.source("buildin.2d.path.fragment")});i.define("fragment","ANTIALIASING");var j=h.derive(function(){return{geometry:new e({attributes:{position:new b.Attribute("position","float",3,null,!1),color:new b.Attribute("position","float",4,null,!1),t0:new b.Attribute("t0","float",3,null,!1),t1:new b.Attribute("t1","float",3,null,!1),coord:new b.Attribute("coord","float",3,null,!1)}}),material:new c({shader:i,transparent:!0,depthMask:!0,depthTest:!0}),_paths:[],_needsUpdateAll:!1}},{addElement:function(a){this._paths.push(a),this._needsUpdateAll=!0},clearElements:function(){this._paths.length=0},updateElements:function(){for(var a=this.geometry,b=0,c=0;c<this._paths.length;c++){var d=this._paths[c];d.hasFill()&&(b+=this._paths[c].getFillVertexNumber()),d.hasStroke()&&(b+=this._paths[c].getStrokeVertexNumber())}var e=this._needsUpdateAll;a.attributes.position.value&&a.getVertexNumber()===b||(a.attributes.position.value=new Float32Array(3*b),a.attributes.color.value=new Float32Array(4*b),a.attributes.t0.value=new Float32Array(3*b),a.attributes.t1.value=new Float32Array(3*b),a.attributes.coord.value=new Float32Array(3*b),e=!0);for(var f=0,g=0,h=a.attributes.t0.value,i=a.attributes.t1.value,j=a.attributes.color.value,k=a.attributes.position.value,l=a.attributes.coord.value,c=0;c<this._paths.length;c++){var d=this._paths[c],m=d.transform._array,n=d.depth,o=d.drawingStyle.globalAlpha,p=0,q=0;if(d.hasFill()){p=d.getFillVertexNumber();var r=d.getFillVertices();(r.dirty||e)&&(l.set(r.coord,f),k.set(r.position,f));for(var s=f+2;3*p+f>s;s+=3)k[s]=n;if(d._fillColorChanged||e)for(var t=d.drawingStyle.fillStyle,s=0;p>s;s++)j[g++]=t[0],j[g++]=t[1],j[g++]=t[2],j[g++]=t[3]*o;else g+=4*p;f+=3*p}if(d.hasStroke()){q=d.getStrokeVertexNumber();var r=d.getStrokeVertices();if((r.dirty||e)&&k.set(r.position,f),e)for(var s=f;f+3*q>s;)l[s++]=0,l[s++]=1,l[s++]=1;for(var s=f+2;f+3*q>s;s+=3)k[s]=n+.002;if(d._strokeColorChanged||e)for(var t=d.drawingStyle.strokeStyle,s=0;q>s;s++)j[g++]=t[0],j[g++]=t[1],j[g++]=t[2],j[g++]=t[3]*o;else g+=4*q}if(f-=3*p,d.transform._dirty||e)for(var s=0;p+q>s;s++)h[f]=m[0],h[f+1]=m[2],h[f+2]=m[4],i[f]=m[1],i[f+1]=m[3],i[f+2]=m[5],f+=3;else f+=3*(p+q)}this._needsUpdateAll=!1,a.dirty()}});return g.setPrimitiveClass(f.eType,j),j}),define("qtek-2d/context/shader/image.essl",[],function(){return"@export buildin.2d.image.vertex\n\nattribute vec3 position;\nattribute vec2 texcoord;\nattribute vec3 t0;\nattribute vec3 t1;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvarying vec2 v_Uv;\n\nvoid main()\n{\n    mat3 localTransform = mat3(\n        t0.x, t1.x, 0.0,\n        t0.y, t1.y, 0.0,\n        t0.z, t1.z, 1.0\n    );\n    vec3 pos2d = vec3(position.xy, 1.0);\n    pos2d = localTransform * pos2d;\n    vec4 pos3d = vec4(pos2d.xy, position.z, 1.0);\n\n    gl_Position = worldViewProjection * pos3d;\n    v_Uv = texcoord;\n}\n\n@end\n\n\n@export buildin.2d.image.fragment\n\nuniform sampler2D sprite;\n\nvarying vec2 v_Uv;\n\nvoid main()\n{\n    gl_FragColor = texture2D(sprite, v_Uv);\n}\n\n@end"}),define("qtek-2d/context/ImagePrimitive",["require","qtek/Geometry","qtek/Material","qtek/Shader","./Geometry2D","./CanvasImage","./CanvasElement","./Primitive","glmatrix","./shader/image.essl"],function(a){{var b=a("qtek/Geometry"),c=a("qtek/Material"),d=a("qtek/Shader"),e=a("./Geometry2D"),f=a("./CanvasImage"),g=a("./CanvasElement"),h=a("./Primitive"),i=a("glmatrix");i.vec2}d.import(a("./shader/image.essl"));var j=new d({vertex:d.source("buildin.2d.image.vertex"),fragment:d.source("buildin.2d.image.fragment")});j.enableTexture("sprite");var k=h.derive(function(){return{geometry:new e({attributes:{position:new b.Attribute("position","float",3,null,!1),texcoord:new b.Attribute("texcoord","float",2,null,!1),t0:new b.Attribute("t0","float",3,null,!1),t1:new b.Attribute("t1","float",3,null,!1)}}),material:new c({shader:j,transparent:!0,depthMask:!0,depthTest:!0}),_images:[],_inDescendantOrder:!1}},{addElement:function(a){this._images.push(a)},clearElements:function(){this._images.length=0,this._inDescendantOrder=!1},updateElements:function(a){if(0!=this._images.length){var b=this.geometry,c=6*this._images.length;b.attributes.position.value&&b.getVertexNumber()===c||(b.attributes.position.value=new Float32Array(3*c),b.attributes.texcoord.value=new Float32Array(2*c),b.attributes.t0.value=new Float32Array(3*c),b.attributes.t1.value=new Float32Array(3*c));var d=this._images[0].getTexture();this.material.set("sprite",d);var e=0,f=0,g=b.attributes.t0.value,h=b.attributes.t1.value;if(a&&!this._inDescendantOrder){for(var i=0,j=this._images.length;i<Math.floor(j/2);i++){var k=j-1,l=this._images[i];this._images[i]=this._images[k],this._images[k]=l}this._inDescendantOrder=!0}for(var i=0;i<this._images.length;i++){var m=this._images[i],n=m.depth,o=m.transform._array,p=m.getVertices();b.attributes.position.value.set(p.position,e),b.attributes.texcoord.value.set(p.texcoord,f);for(var q=e+2;18+e>q;q+=3)b.attributes.position.value[q]=n;for(var q=0;6>q;q++)g[e]=o[0],g[e+1]=o[2],g[e+2]=o[4],h[e]=o[1],h[e+1]=o[3],h[e+2]=o[5],e+=3,f+=2}b.dirty()}},_sortFunc:function(a,b){return b.depth-a.depth}});return g.setPrimitiveClass(f.eType,k),k}),define("qtek-2d/context/tool/ImageAtlas",["require","../CanvasImage","qtek/Texture"],function(a){var b=a("../CanvasImage"),c=a("qtek/Texture"),d=1024,e=window.devicePixelRatio||1,f=function(){this._canvas=document.createElement("canvas"),this._ctx2d=this._canvas.getContext("2d"),this._offsetX=0,this._offsetY=0,this._texture=null};f.prototype.clear=function(){this._canvas.width=d*e,this._canvas.height=d*e,this._offsetX=this._offsetY=0,this._nBlockSqrt=1,this._ctx2d.clearRect(0,0,this._canvas.width,this._canvas.height),this._ctx2d.scale(e,e),this._texture&&this._texture.dirty()};var g=/([0-9]+)px/;return f.prototype.addText=function(a,d,f,h,i,j){var k=this._ctx2d;k.fillStyle=j.fillStyle,k.strokeStyle=j.strokeStyle,k.font=j.font;var l=this._offsetX,m=this._offsetY,n=k.measureText(a).width;"undefined"!=typeof i&&(n=Math.min(n,i));var o=Math.max(+g.exec(k.font)[1],k.measureText("m").width),p=1.5*o;if(n>this._canvas.width/e&&console.warn("Text width no longer than "+this._canvas.width),l+n>this._canvas.width/e){if(l=0,m+p>this._canvas.height/e)return null;m+=p}switch(this._offsetY=m,this._offsetX=l+n,"fill"==d?"undefined"!=typeof i?k.fillText(a,l,m+o,i):k.fillText(a,l,m+o):"undefined"!=typeof i?k.strokeText(a,l,m+o,i):k.strokeText(a,l,m+o),j.textAlign){case"start":break;case"left":break;case"end":case"right":f-=n;break;case"center":f-=n/2}switch(j.textBaseline){case"alphabetic":case"ideographic":case"bottom":h-=o;break;case"top":case"hanging":break;case"middle":h-=o/2}var q=new b(this._canvas,l*e,m*e,n*e,p*e,f,h,n,p);return q&&(this._texture=q.getTexture(),this._texture.minFilter=c.NEAREST,this._texture.magFilter=c.NEAREST,this._texture.useMipmap=!1),q},f.prototype.measureText=function(a,b){var a=this._ctx2d;return a.font=_ctx.font,a.measureText(b)},f.prototype.addImage=function(){},f.prototype.getTexture=function(){return this._texture},f.prototype.dispose=function(a){this._texture.dispose(a)},f}),define("qtek-2d/context/Painter",["require","qtek/core/Base","qtek/Shader","qtek/math/Matrix2d","qtek/math/Matrix4","./tool/CachedList","./CanvasElement","./PathPrimitive","./ImagePrimitive","./CanvasPath","./CanvasImage","./tool/ImageAtlas"],function(a){"use strict";var b=a("qtek/core/Base"),c=(a("qtek/Shader"),a("qtek/math/Matrix2d")),d=a("qtek/math/Matrix4"),e=a("./tool/CachedList"),f=a("./CanvasElement"),g=(a("./PathPrimitive"),a("./ImagePrimitive"),a("./CanvasPath"),a("./CanvasImage"),a("./tool/ImageAtlas")),h=b.derive(function(){return{transform:new c,ctx:null,_elements:[],_primitives:[],_primitiveLists:[],_textAtlas:new e(g,2),_blending:!0,_blendFunc:null}},function(){for(var a=f.getClassNumber(),b=0;a>b;b++){var c=f.getPrimitiveClass(b);this._primitiveLists.push(c?new e(c,5):null)}this._disposePrimitive=this._disposePrimitive.bind(this),this._disposeImageAtlas=this._disposeImageAtlas.bind(this)},{addElement:function(a){a.depth=this.ctx.requestDepthChannel(),this._elements.push(a)},getElements:function(){return this._elements},draw:function(){var a=this.ctx,b=a.renderer.gl;this._blending?b.enable(b.BLEND):b.disable(b.BLEND);for(var c=0;c<this._primitives.length;c++)d.fromMat2d(this._primitives[c].worldTransform,this.transform),this._primitives[c].material.blend=this._blending&&this._blendFunc?this._blendFunc:null;a.renderer.renderQueue(this._primitives,a.camera);for(var c=0;c<this._elements.length;c++)this._elements[c].afterDraw()},repaint:function(){for(var a=0;a<this._primitives.length;a++)this._primitives[a].updateElements();this.draw()},enableBlending:function(){this._blending=!0},disableBlending:function(){this._blending=!1},setBlendFunc:function(a){this._blendFunc=a},begin:function(){this.beginTextAtlas();for(var a=0;a<this._primitives.length;a++)this._primitives[a].clearElements();this._primitives.length=0,this._elements.length=0;for(var a=0;a<this._primitiveLists.length;a++)this._primitiveLists[a]&&this._primitiveLists[a].clear(this._disposePrimitive)},end:function(){if(this._blending){for(var a,b=null,c=0;c<this._elements.length;c++){var d=this._elements[c],e=d.getHashKey();if(d.getHashKey()!=b){var f=this._primitiveLists[d.eType];f&&(a=f.increase(),a.clearElements()),a&&this._primitives.push(a),b=e}a&&a.addElement(d)}for(var c=0;c<this._primitives.length;c++)this._primitives[c].updateElements()}else{for(var c=0;c<this._primitiveLists.length;c++)if(this._primitiveLists[c]){var a=this._primitiveLists[c].increase();a.clearElements(),this._primitives.push(a)}for(var c=0;c<this._elements.length;c++){var d=this._elements[c],a=this._primitiveLists[d.eType].get(0);a.addElement(d)}for(var c=0;c<this._primitives.length;c++)this._primitives[c].updateElements(!0)}},beginTextAtlas:function(){this._textAtlas.clear(this._disposeImageAtlas)},getNewTextAtlas:function(){var a=this._textAtlas.increase();return a.clear(),a},endTextAtlas:function(){},dispose:function(){this.begin()},_disposePrimitive:function(a){a.geometry.dispose(this.ctx.renderer.gl)},_disposeImageAtlas:function(a){a.dispose(this.ctx.renderer.gl)},_eleDepthSortFunc:function(a,b){return a.depth-b.depth}});return h}),define("qtek-2d/context/shader/deferred/blend.essl",[],function(){return"@export buildin.2d.deferred.blend\n\nuniform sampler2D color1;\nuniform sampler2D depth1;\n\nuniform sampler2D color2;\nuniform sampler2D depth2;\n\nvarying vec2 v_Texcoord;\n\nfloat decodeFloat(const in vec4 colour)\n{\n    const vec4 bitShifts = vec4(1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0);\n    return dot(colour, bitShifts);\n}\n\nvoid main()\n{\n\n    vec4 c1 = texture2D(color1, v_Texcoord);\n    vec4 c2 = texture2D(color2, v_Texcoord);\n\n    #ifdef DEPTH_DECODE\n        float d1 = decodeFloat(texture2D(depth1, v_Texcoord));\n        float d2 = decodeFloat(texture2D(depth2, v_Texcoord));\n    #else\n        float d1 = texture2D(depth1, v_Texcoord).r;\n        float d2 = texture2D(depth2, v_Texcoord).r;\n    #endif\n\n    if (d1 > d2) {\n        gl_FragColor.rgb = c1.rgb * (1.0 - c2.a) + c2.rgb;\n    } else {\n        gl_FragColor.rgb = c2.rgb * (1.0 - c1.a) + c1.rgb;\n    }\n    gl_FragColor.a = c1.a + c2.a - c1.a *c2.a;\n\n    // TODO premultiplied alpha in renderer?\n    gl_FragColor.rgb /= gl_FragColor.a;\n}\n\n@end"}),define("qtek-2d/context/shader/deferred/depth.essl",[],function(){return"@export buildin.2d.deferred.depth.vertex\n\nattribute vec3 position;\nattribute vec3 t0;\nattribute vec3 t1;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvoid main()\n{\n    mat3 localTransform = mat3(\n        t0.x, t1.x, 0.0,\n        t0.y, t1.y, 0.0,\n        t0.z, t1.z, 1.0\n    );\n    vec3 pos2d = vec3(position.xy, 1.0);\n    pos2d = localTransform * pos2d;\n    vec4 pos3d = vec4(pos2d.xy, position.z, 1.0);\n\n    gl_Position = worldViewProjection * pos3d;\n}\n\n@end\n\n@export buildin.2d.deferred.depth.fragment\n\nvec4 encodeFloat(const in float depth)\n{\n    const vec4 bitShifts = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n\n    const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n    vec4 res = fract( depth * bitShifts );\n    res -= res.xxyz * bit_mask;\n\n    return res;\n}\n\nvoid main()\n{\n    float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)\n                    / (gl_DepthRange.far - gl_DepthRange.near);\n\n    gl_FragColor = encodeFloat(depth);\n}\n\n@end\n\n"}),define("qtek-2d/context/DeferredPainter",["require","qtek/core/Base","qtek/Shader","qtek/Material","qtek/compositor/Pass","qtek/FrameBuffer","qtek/core/glinfo","qtek/texture/Texture2D","qtek/math/Matrix2d","qtek/math/Matrix4","./tool/CachedList","./CanvasElement","./PathPrimitive","./ImagePrimitive","./CanvasPath","./CanvasImage","./tool/ImageAtlas","./shader/deferred/blend.essl","./shader/deferred/depth.essl"],function(a){var b=a("qtek/core/Base"),c=a("qtek/Shader"),d=a("qtek/Material"),e=a("qtek/compositor/Pass"),f=a("qtek/FrameBuffer"),g=a("qtek/core/glinfo"),h=a("qtek/texture/Texture2D"),i=a("qtek/math/Matrix2d"),j=a("qtek/math/Matrix4"),k=a("./tool/CachedList"),l=(a("./CanvasElement"),a("./PathPrimitive")),m=a("./ImagePrimitive"),n=a("./CanvasPath"),o=a("./CanvasImage"),p=a("./tool/ImageAtlas");
c.import(a("./shader/deferred/blend.essl")),c.import(a("./shader/deferred/depth.essl"));var q=new c({vertex:c.source("buildin.2d.deferred.depth.vertex"),fragment:c.source("buildin.2d.deferred.depth.fragment")}),r=new d({shader:q}),s=new e({fragment:c.source("buildin.2d.deferred.blend")}),t=b.derive(function(){return{transform:new i,ctx:null,_elements:[],_pathPrimitives:[],_imagePrimitives:[],_textAtlas:new k(p,2),_imagePrimitiveList:new k(m),_pathPrimitiveList:new k(l,2),_pathColorTexture:null,_pathDepthTexture:null,_imageColorTexture:null,_imageDepthTexture:null,frameBuffer:new f,_blendFunc:null}},{addElement:function(a){a.depth=this.ctx.requestDepthChannel(),this._elements.push(a)},getElements:function(){return this._elements},draw:function(){var a=this.ctx,b=a.renderer.gl;b.depthMask(!0),b.enable(b.BLEND);for(var c=0;c<this._pathPrimitives.length;c++)j.fromMat2d(this._pathPrimitives[c].worldTransform,this.transform),this._pathPrimitives[c].material.blend=this._blendFunc;for(var c=0;c<this._imagePrimitives.length;c++)j.fromMat2d(this._imagePrimitives[c].worldTransform,this.transform),this._imagePrimitives[c].material.blend=this._blendFunc;if(0==this._pathPrimitives.length||0==this._imagePrimitives.length)this._pathPrimitives.length>0&&a.renderer.renderQueue(this._pathPrimitives,a.camera),this._imagePrimitives.length>0&&a.renderer.renderQueue(this._imagePrimitives,a.camera);else{var d=g.getExtension(b,"WEBGL_depth_texture");this._pathColorTexture=this._checkTexture(this._pathColorTexture,a),this._pathDepthTexture=this._checkTexture(this._pathDepthTexture,a),this._imageColorTexture=this._checkTexture(this._imageColorTexture,a),this._imageDepthTexture=this._checkTexture(this._imageDepthTexture,a),d&&(this._pathDepthTexture.format=b.DEPTH_COMPONENT,this._pathDepthTexture.type=b.UNSIGNED_SHORT,this._imageDepthTexture.format=b.DEPTH_COMPONENT,this._imageDepthTexture.type=b.UNSIGNED_SHORT),this.frameBuffer.attach(b,this._pathColorTexture),d&&this.frameBuffer.attach(b,this._pathDepthTexture,b.DEPTH_ATTACHMENT),this.frameBuffer.bind(a.renderer),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),a.renderer.renderQueue(this._pathPrimitives,a.camera),d||(this.frameBuffer.attach(b,this._pathDepthTexture),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),a.renderer.renderQueue(this._pathPrimitives,a.camera,r)),this.frameBuffer.attach(b,this._imageColorTexture),d&&this.frameBuffer.attach(b,this._imageDepthTexture,b.DEPTH_ATTACHMENT),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),a.renderer.renderQueue(this._imagePrimitives,a.camera),d||(this.frameBuffer.attach(b,this._imageDepthTexture),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),a.renderer.renderQueue(this._imagePrimitives,a.camera,r)),this.frameBuffer.unbind(a.renderer),b.depthMask(!1),b.disable(b.DEPTH_TEST),s.setUniform("color1",this._pathColorTexture),s.setUniform("depth1",this._pathDepthTexture),s.setUniform("color2",this._imageColorTexture),s.setUniform("depth2",this._imageDepthTexture),s.material.depthTest=!1,s.material.depthMask=!1,s.material.transparent=!0,d?s.material.shader.unDefine("fragment","DEPTH_DECODE"):s.material.shader.define("fragment","DEPTH_DECODE"),a.renderer.clear=0,s.render(a.renderer),a.renderer.clear=b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT}for(var c=0;c<this._elements.length;c++)this._elements[c].afterDraw()},_checkTexture:function(a,b){return a&&a.width===b.renderer.width&&a.height===b.renderer.height||(a&&a.dispose(b.renderer.gl),a=new h({width:b.renderer.width,height:b.renderer.height,minFilter:b.renderer.gl.NEAREST,magFilter:b.renderer.gl.NEAREST})),a},repaint:function(){for(var a=0;a<this._pathPrimitives.length;a++)this._pathPrimitives[a].updateElements();for(var a=0;a<this._imagePrimitives.length;a++)this._imagePrimitives[a].updateElements();this.draw()},setBlendFunc:function(a){this._blendFunc=a},begin:function(){this.beginTextAtlas();for(var a=0;a<this._pathPrimitives.length;a++)this._pathPrimitives[a].clearElements();for(var a=0;a<this._imagePrimitives.length;a++)this._imagePrimitives[a].clearElements();this._pathPrimitives.length=0,this._elements.length=0,this._imagePrimitiveList.clear(this._disposePrimitive),this._pathPrimitiveList.clear(this._disposePrimitive)},end:function(){for(var a,b,c=null,d=0;d<this._elements.length;d++){var e=this._elements[d];switch(e.eType){case o.eType:var f=e.getHashKey();c!==f&&(c=f,b=this._imagePrimitiveList.increase(),this._imagePrimitives.push(b)),b.addElement(e);break;case n.eType:a||(a=this._pathPrimitiveList.increase(),this._pathPrimitives.push(a)),a.addElement(e);break;default:console.warn("Deferred painter only support CanvasImage and CanvasPath")}}for(var d=0;d<this._pathPrimitives.length;d++)this._pathPrimitives[d].updateElements();for(var d=0;d<this._imagePrimitives.length;d++)this._imagePrimitives[d].updateElements()},beginTextAtlas:function(){this._textAtlas.clear(this._disposeImageAtlas)},getNewTextAtlas:function(){var a=this._textAtlas.increase();return a.clear(),a},dispose:function(){this.begin()},_disposePrimitive:function(a){a.geometry.dispose(this.ctx.renderer.gl)},_disposeImageAtlas:function(a){a.dispose(this.ctx.renderer.gl)},_eleDepthSortFunc:function(a,b){return a.depth-b.depth}});return t}),define("qtek-2d/context/States",["require","glmatrix"],function(a){var b=a("glmatrix"),c=b.mat2d,d=function(){this._matrix=c.create()};return d.prototype={constructor:d,load:function(a){a.strokeStyle=this.strokeStyle,a.fillStyle=this.fillStyle,a.globalAlpha=this.globalAlpha,a.lineWidth=this.lineWidth,a.font=this.font,a.textBaseline=this.textBaseline,a.textAlign=this.textAlign,c.copy(a.currentTransform._array,this._matrix)},save:function(a){this.strokeStyle=a.strokeStyle,this.fillStyle=a.fillStyle,this.globalAlpha=a.globalAlpha,this.lineWidth=a.lineWidth,this.font=a.font,this.textBaseline=a.textBaseline,this.textAlign=a.textAlign,c.copy(this._matrix,a.currentTransform._array)}},d}),define("qtek-2d/context/Context2D",["require","qtek/math/Matrix2d","glmatrix","qtek/core/Base","qtek/Renderer","qtek/camera/Orthographic","./Painter","./DeferredPainter","./CanvasPath","./CanvasImage","./States"],function(a){"use strict";var b=a("qtek/math/Matrix2d"),c=a("glmatrix"),d=c.vec2,e=c.mat2d,f=a("qtek/core/Base"),g=a("qtek/Renderer"),h=a("qtek/camera/Orthographic"),i=a("./Painter"),j=a("./DeferredPainter"),k=a("./CanvasPath"),l=a("./CanvasImage"),m=a("./States"),n=d.create(),o=f.derive({canvas:null,renderer:null,camera:null,depthChannelGap:.01,_path:null,_polygon:null,_painter:null,_textAtlas:null,_depth:1},function(){var a=this.canvas.width,c=this.canvas.height;this.canvas&&!this.renderer&&(this.renderer=new g({canvas:this.canvas})),this.camera||(this.camera=new h({left:-a/2,right:a/2,top:c/2,bottom:-c/2,far:50,near:0}),this.camera.scale.y=-1,this.camera.position.x=a/2,this.camera.position.y=c/2,this.camera.position.z=this.camera.far,this.camera.update(!0)),this.currentTransform=new b,this._statesStack=[]},{strokeStyle:"#000000",fillStyle:"#000000",globalAlpha:1,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic",lineWidth:1,lineCap:"",lineJoin:"",save:function(){var a=new m;a.save(this),this._statesStack.push(a)},restore:function(){if(this._statesStack.length>0){var a=this._statesStack.pop();a.load(this)}},scale:function(a,b){n[0]=a,n[1]=b;var c=this.currentTransform._array;e.scale(c,c,n)},rotate:function(a){var b=this.currentTransform._array;e.rotate(b,b,a)},translate:function(a,b){n[0]=a,n[1]=b;var c=this.currentTransform._array;e.translate(c,c,n)},transform:function(a,b,c,d,e,f){var g=this.currentTransform._array,h=g[0],i=g[1],j=g[2],k=g[3],l=g[4],m=g[5];g[0]=a*h+b*j,g[1]=a*i+b*k,g[2]=c*h+d*j,g[3]=c*i+d*k,g[4]=h*e+j*f+l,g[5]=i*e+k*f+m},setTransform:function(a,b,c,d,e,f){var g=this.currentTransform._array;g[0]=a,g[1]=b,g[2]=c,g[3]=d,g[4]=e,g[5]=f},drawImage:function(a,b,c,d,e,f,g,h,i){if(this._painter){this._path&&this.endPath(),3==arguments.length?(f=b,g=c,b=0,c=0,h=d=a.width,i=e=a.height):5==arguments.length&&(f=b,g=c,h=d,i=e,b=0,c=0,d=a.height,e=a.height);var j=new l(a,b,c,d,e,f,g,h,i);return j.end(this),this._painter.addElement(j),j}},createLinearGradient:function(){},createRadialGradient:function(){},createPattern:function(){},strokeText:function(a,b,c,d){return this._drawText(a,"stroke",b,c,d)},fillText:function(a,b,c,d){return this._drawText(a,"fill",b,c,d)},_drawText:function(a,b,c,d,e){if(this._painter){this._path&&this.endPath(),this._textAtlas||(this._textAtlas=this._painter.getNewTextAtlas());var f=this._textAtlas.addText(a,b,c,d,e,this);return f||(this._textAtlas=this._painter.getNewTextAtlas(),f=this._textAtlas.addText(a,b,c,d,e,this)),f.end(this),this._painter.addElement(f),f}},measureText:function(a){return this._textAtlas||(this._textAtlas=this._painter.getNewTextAtlas()),this._textAtlas.measureText(a)},clearRect:function(){},fillRect:function(){},strokeRect:function(){},beginPath:function(a){return this._path&&this.endPath(),a||(a=new k),a.begin(this),this._path=a,a},closePath:function(){this._path&&this._path.close(this.lineWidth)},fill:function(){this._path&&this._path.fill(this)},stroke:function(){this._path&&this._path.stroke(this)},clip:function(){console.warn("TODO")},moveTo:function(a,b){this._path&&this._path.moveTo(a,b)},lineTo:function(a,b){this._path&&this._path.lineTo(a,b,this.lineWidth)},quadraticCurveTo:function(a,b,c,d){this._path&&this._path.quadraticCurveTo(a,b,c,d,this.lineWidth)},bezierCurveTo:function(a,b,c,d,e,f){this._path&&this._path.bezierCurveTo(a,b,c,d,e,f,this.lineWidth)},arc:function(a,b,c,d,e,f){this._path&&this._path.arc(a,b,c,d,e,f,this.lineWidth)},arcTo:function(){},rect:function(a,b,c,d){this._path&&this._path.rect(a,b,c,d,this.lineWidth)},isPointInPath:function(){},createImageData:function(){},getImageData:function(){},putImageData:function(){},beginDraw:function(a,b){return a||(a="deferred"==b?new j:new i),this.setPainter(a),a},setPainter:function(a){this._painter!==a&&(this._painter&&this._painter.end(),a.ctx=this,this._textAtlas=null,this._painter=a,a.begin())},addPath:function(a){this._painter&&this._painter.addElement(a)},addImage:function(a){this._painter&&this._painter.addElement(a)},clearColor:function(a){var b=this.renderer.gl;a&&b.clearColor(a[0],a[1],a[2],a[3]),b.clear(b.COLOR_BUFFER_BIT)},clearDepth:function(){var a=this.renderer.gl;a.clear(a.DEPTH_BUFFER_BIT),this._depth=1},clear:function(a){var b=this.renderer.gl;a&&b.clearColor(a[0],a[1],a[2],a[3]),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),this._depth=1},endDraw:function(){this._painter&&(this._path&&this.endPath(),this._painter.end(),this._painter.draw(),this._painter=null)},repaint:function(a){var b=a.getElements(),c=b[b.length-1];c&&this.setDepthChannel(c.depth),a.repaint()},draw:function(a){var b=a.getElements(),c=b[b.length-1];c&&this.setDepthChannel(c.depth),a.draw()},endPath:function(){this._path&&(this._path.end(this),this._painter&&this._painter.addElement(this._path),this._path=null)},requestDepthChannel:function(){return this.setDepthChannel(this._depth+this.depthChannelGap),this._depth},setDepthChannel:function(a){this._depth=a,this._depth>this.camera.far&&(this.camera.far*=2,this.camera.position.z=this.camera.far,this.camera.update(!0))},identity:function(){e.identity(this.currentTransform._array)},resize:function(a,b){this.renderer.resize(a,b),a=this.renderer.width,b=this.renderer.height,this.camera.left=-a/2,this.camera.right=a/2,this.camera.top=b/2,this.camera.bottom=-b/2,this.camera.position.x=a/2,this.camera.position.y=b/2,this.camera.update(!0)}});return o}),define("qtek-2d/context/PointCloudPrimitive",function(){}),define("qtek-2d/context/tool/SplayTree",["require"],function(){function a(){}return a.Node=function(a,b){this.key=a,this.value=b,this.left=null,this.right=null},a.Node.prototype.traverse=function(a,b){for(var c=this;c;){var d=c.left;d&&d.traverse(a,b),a(c,b),c=c.right}},a.prototype.root_=null,a.prototype.isEmpty=function(){return!this.root_},a.prototype.insert=function(b,c){if(this.isEmpty())return this.root_=new a.Node(b,c),this.root_;if(this.splay_(b),this.root_.key!=b){var d=new a.Node(b,c);return b>this.root_.key?(d.left=this.root_,d.right=this.root_.right,this.root_.right=null):(d.right=this.root_,d.left=this.root_.left,this.root_.left=null),this.root_=d,d}},a.prototype.remove=function(a){if(this.isEmpty())throw Error("Key not found: "+a);if(this.splay_(a),this.root_.key!=a)throw Error("Key not found: "+a);var b=this.root_;if(this.root_.left){var c=this.root_.right;this.root_=this.root_.left,this.splay_(a),this.root_.right=c}else this.root_=this.root_.right;return b},a.prototype.find=function(a){return this.isEmpty()?null:(this.splay_(a),this.root_.key==a?this.root_:null)},a.prototype.findMax=function(a){if(this.isEmpty())return null;for(var b=a||this.root_;b.right;)b=b.right;return b},a.prototype.findGreatestLessThan=function(a){return this.isEmpty()?null:(this.splay_(a),this.root_.key<a?this.root_:this.root_.left?this.findMax(this.root_.left):null)},a.prototype.exportKeys=function(){var a=[];return this.isEmpty()||this.root_.traverse(function(b){a.push(b.key)}),a},a.prototype.splay_=function(b){if(!this.isEmpty()){var c,d,e;c=d=e=new a.Node(null,null);for(var f=this.root_;;)if(b<f.key){if(!f.left)break;if(b<f.left.key){var g=f.left;if(f.left=g.right,g.right=f,f=g,!f.left)break}e.left=f,e=f,f=f.left}else{if(!(b>f.key))break;if(!f.right)break;if(b>f.right.key){var g=f.right;if(f.right=g.left,g.left=f,f=g,!f.right)break}d.right=f,d=f,f=f.right}d.right=f.left,e.left=f.right,f.left=c.right,f.right=c.left,this.root_=f}},a.prototype.traverse=function(a,b){this.root_&&this.root_.traverse(a,b)},a.prototype.traverseBreadthFirst=function(a){if(!a(this.root_.value))for(var b=[this.root_],c=1;c>0;){for(var d=new Array(2*b.length),e=0,f=0;c>f;f++){var g=b[f],h=g.left,i=g.right;if(h){if(a(h.value))return;d[e++]=h}if(i){if(a(i.value))return;d[e++]=i}}b=d,c=e}},a.prototype.clear=function(){this.root_=null},a}),define("qtek-2d/shape/Circle",["require","../Node","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("qtek/math/Vector2"),d=b.derive(function(){return{center:new c,radius:0}},{computeBoundingBox:function(){this.boundingBox={min:new c(this.center.x-this.radius,this.center.y-this.radius),max:new c(this.center.x+this.radius,this.center.y+this.radius)}},draw:function(a){a.beginPath(),a.arc(this.center.x,this.center.y,this.radius,0,2*Math.PI,!1),this.stroke&&a.stroke(),this.fill&&a.fill()},intersect:function(){return vec2.len([this.center[0]-x,this.center[1]-y])<this.radius}});return d}),define("qtek-2d/util",["require","qtek/math/Vector2","glmatrix"],function(a){var b=a("qtek/math/Vector2"),c=a("glmatrix"),d=(c.vec2,new b,{fixPos:function(a){return a.x+=.5,a.y+=.5,a},fixPosArray:function(a){for(var b=a.length,c=0;b>c;c++)this.fixPos(a[c]);return a},computeBoundingBox:function(a,b,c){for(var d=a[0].x,e=a[0].x,f=a[0].y,g=a[0].y,h=1;h<a.length;h++){var i=a[h];i.x<d&&(d=i.x),i.x>e&&(e=i.x),i.y<f&&(f=i.y),i.y>g&&(g=i.y)}b.set(d,f),c.set(e,g)},computeCubeBezierBoundingBox:function(a,b,c,e,f,g){var h=d._computeCubeBezierExtremitiesDim(a.x,b.x,c.x,e.x),i=d._computeCubeBezierExtremitiesDim(a.y,b.y,c.y,e.y);h.push(a.x,e.x),i.push(a.y,e.y);var j=Math.min.apply(null,h),k=Math.max.apply(null,h),l=Math.min.apply(null,i),m=Math.max.apply(null,i);f.set(j,l),g.set(k,m)},_computeCubeBezierExtremitiesDim:function(a,b,c,d){var e=[],f=6*c-12*b+6*a,g=9*b+3*d-3*a-9*c,h=3*b-3*a,i=f*f-4*g*h;if(i>0){var j=Math.sqrt(i),k=(-f+j)/(2*g),l=(-f-j)/(2*g);e.push(k,l)}else 0==i&&e.push(-f/(2*g));for(var m=[],n=0;n<e.length;n++){var o=e[n];if(Math.abs(2*g*o+f)>1e-4&&1>o&&o>0){var p=1-o,q=p*p*p*a+3*p*p*o*b+3*p*o*o*c+o*o*o*d;m.push(q)}}return m},computeQuadraticBezierBoundingBox:function(a,c,e,f,g){var h=a.x+e.x-2*c.x;if(0===h)var i=.5;else var i=(a.x-c.x)/h;if(h=a.y+e.y-2*c.y,0===h)var j=.5;else var j=(a.y-c.y)/h;i=Math.max(Math.min(i,1),0),j=Math.max(Math.min(j,1),0);var k=1-i,l=1-j,m=k*k*a.x+2*k*i*c.x+i*i*e.x,n=k*k*a.y+2*k*i*c.y+i*i*e.y,o=l*l*a.x+2*l*j*c.x+j*j*e.x,p=l*l*a.y+2*l*j*c.y+j*j*e.y;return d.computeBoundingBox([a.clone(),e.clone(),new b(m,n),new b(o,p)],f,g)},computeArcBoundingBox:function(){var a=new b,c=new b,e=[new b,new b,new b,new b];return function(b,f,g,h,i,j,k){i=i?1:-1,a.set(Math.cos(g),Math.sin(g)*i).scale(f).add(b),c.set(Math.cos(h),Math.sin(h)*i).scale(f).add(b),g%=2*Math.PI,0>g&&(g+=2*Math.PI),h%=2*Math.PI,0>h&&(h+=2*Math.PI),g>h&&(h+=2*Math.PI);for(var l=0,m=0;h>m;m+=Math.PI/2)m>g&&e[l++].set(Math.cos(m),Math.sin(m)*i).scale(f).add(b);var n=e.slice(0,l);n.push(a,c),d.computeBoundingBox(n,j,k)}}()});return d}),define("qtek-2d/shape/Rectangle",["require","../Node","../util","qtek/math/Vector2"],function(a){var b=a("../Node"),c=(a("../util"),a("qtek/math/Vector2")),d=b.derive(function(){return{start:new c(0,0),size:new c(0,0)}},{computeBoundingBox:function(){return{min:this.start.clone(),max:this.size.clone().add(this.start)}},draw:function(a){var b=this.start;a.beginPath(),a.rect(b.x,b.y,this.size.x,this.size.y),this.stroke&&a.stroke(),this.fill&&a.fill()},intersect:function(a,b){return this.intersectBoundingBox(a,b)}});return d}),define("qtek-2d/shape/Ellipse",["require","../Node","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("qtek/math/Vector2"),d=b.derive(function(){return{center:new c,radius:new c}},{computeBoundingBox:function(){this.boundingBox={min:this.center.clone().sub(this.radius),max:this.center.clone().add(this.radius)}},draw:function(a){a.save(),a.translate(this.center.x,this.center.y),a.scale(1,this.radius.y/this.radius.x),a.beginPath(),a.arc(0,0,this.radius.x,0,2*Math.PI,!1),this.stroke&&a.stroke(),this.fill&&a.fill(),a.restore()},intersect:function(){return vec2.len([this.center[0]-x,this.center[1]-y])<this.radius}});return d}),define("qtek-2d/shape/Line",["require","../Node","../util","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("../util"),d=a("qtek/math/Vector2"),e=b.derive(function(){return{start:new d,end:new d,width:0}},{computeBoundingBox:function(){this.boundingBox=c.computeBoundingBox([this.start,this.end],this.boundingBox.min,this.boundingBox.max),this.boundingBox.min.x==this.boundingBox.max.x&&(this.boundingBox.min.x-=this.width/2,this.boundingBox.max.x+=this.width/2),this.boundingBox.min.y==this.boundingBox.max.y&&(this.boundingBox.min.y-=this.width/2,this.boundingBox.max.y+=this.width/2)},draw:function(a){var b=this.start,c=this.end;a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.stroke()},intersect:function(){var a=new d,b=new d,c=new d;return function(d,e){if(!this.intersectBoundingBox(d,e))return!1;var f=this.start,g=this.end;a.set(d,e),b.copy(a).sub(f),c.copy(g).sub(f);var h=b.length(),i=c.length(),j=h*b.scale(1/h).dot(i.scale(1/i)),k=h*h-j*j;return k<this.width*this.width*.25}}});return e}),define("qtek-2d/shape/Path",["require","../Node","../util","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("../util"),d=a("qtek/math/Vector2"),e=new d,f=new d,g=b.derive(function(){return{segments:[],closePath:!1}},{computeBoundingBox:function(){var a=this.segments.length,b=this.segments,d=this.boundingBox.min,g=this.boundingBox.max;d.set(999999,999999),g.set(-999999,-999999);for(var h=1;a>h;h++)if(b[h-1].handleOut||b[h].handleIn){{c.computeCubeBezierBoundingBox(b[h-1].point,b[h-1].handleOut||b[h-1].point,b[h].handleIn||b[h].point,b[h].point,e,f)}d.min(e),g.max(f)}else d.min(b[h-1].point),d.min(b[h].point),g.max(b[h-1].point),g.max(b[h].point)},draw:function(a){var b=this.segments.length,c=this.segments;a.beginPath(),a.moveTo(c[0].point.x,c[0].point.y);for(var d=1;b>d;d++)if(c[d-1].handleOut||c[d].handleIn){var e=c[d-1].handleOut||c[d-1].point,f=c[d].handleIn||c[d].point;a.bezierCurveTo(e.x,e.y,f.x,f.y,c[d].point.x,c[d].point.y)}else a.lineTo(c[d].point.x,c[d].point.y);if(this.closePath)if(c[b-1].handleOut||c[0].handleIn){var e=c[b-1].handleOut||c[b-1].point,f=c[0].handleIn||c[0].point;a.bezierCurveTo(e.x,e.y,f.x,f.y,c[0].point.x,c[0].point.y)}else a.lineTo(c[0].point.x,c[0].point.y);this.fill&&a.fill(),this.stroke&&a.stroke()},smooth:function(a){for(var b=this.segments.length,c=this.segments,e=new d,f=0;b>f;f++){var g=c[f].point,h=0==f?c[b-1].point:c[f-1].point,i=f==b-1?c[0].point:c[f+1].point,a=c[f].smoothLevel||a||1;e.copy(i).sub(h).scale(.25),e.scale(a),c[f].handleIn?c[f].handleIn.copy(g).sub(e):c[f].handleIn=g.clone().sub(e),c[f].handleOut?c[f].handleOut.copy(g).add(e):c[f].handleOut=g.clone().add(e)}},pushPoints:function(a){for(var b=0;b<a.length;b++)this.segments.push({point:a[b],handleIn:null,handleOut:null})}});return g}),define("qtek-2d/shape/Polygon",["require","../Node","../util","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("../util"),d=a("qtek/math/Vector2"),e=b.derive(function(){return{points:[]}},{computeBoundingBox:function(){this.boundingBox=c.computeBoundingBox(this.points,this.boundingBox.min,this.boundingBox.max)},draw:function(a){var b=this.points;a.beginPath(),a.moveTo(b[0].x,b[0].y);for(var c=1;c<b.length;c++)a.lineTo(b[c].x,b[c].y);a.closePath(),this.stroke&&a.stroke(),this.fill&&a.fill()},intersect:function(a,b){if(!this.intersectBoundingBox(a,b))return!1;for(var c=this.points.length,e=0,f=this.points,g=new d,h=new d,i=0;c>i;i++){g.set(a,b).sub(f[i]).normalize().negate();var j=(i+1)%c;h.set(a,b).sub(f[j]).normalize().negate();var k=Math.acos(g.dot(h));e+=k}return Math.length(e-2*Math.PI)<.001}});return e}),define("qtek-2d/shape/Text",["require","../Node","../util","qtek/math/Vector2"],function(a){var b=a("../Node"),c=(a("../util"),a("qtek/math/Vector2")),d=b.derive(function(){return{text:"",start:new c,size:new c}},{computeBoundingBox:function(){this.boundingBox={min:this.start.clone(),max:this.start.clone().add(this.size)}},draw:function(a){var b=this.start;this.fill&&(this.size.length&&this.size.x?a.fillText(this.text,b.x,b.y,this.size.x):a.fillText(this.text,b.x,b.y)),this.stroke&&(this.size.length&&this.size.x?a.strokeText(this.text,b.x,b.y,this.size.x):a.strokeText(this.text,b.x,b.y))},resize:function(a){(!this.size.x||this.needResize)&&(this.size.x=a.measureText(this.text).width,this.size.y=a.measureText("m").width)},intersect:function(a,b){return this.intersectBoundingBox(a,b)}});return d}),define("qtek-2d/shape/TextBox",["require","../Node","qtek/math/Vector2","./Text","qtek/core/util"],function(a){var b=a("../Node"),c=a("qtek/math/Vector2"),d=a("./Text"),e=a("qtek/core/util"),f=b.derive(function(){return{start:new c,width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeBoundingBox:function(){},draw:function(a){if(this.text!=this._oldText)if(this._oldText=this.text,this.font&&(a.font=this.font),this.wordBreak)this._texts=this.computeWordBreak(a);else if(this.wordWrap)this._texts=this.computeWordWrap(a);else{var b=new d({text:this.text});this.extendCommonProperties(b),this._texts=[b]}a.save(),a.textBaseline="top";for(var c=0;c<this._texts.length;c++){var e=this._texts[c];e.draw(a)}a.restore()},computeWordWrap:function(a){if(this.text){for(var b,e,f,g=this.text.split(" "),h=g.length,i=0,j=[],k=a.measureText("m").width,l=0;h>l;l++)e=l==h-1?g[l]:g[l]+" ",b=a.measureText(e).width,i+b>this.width||!f?(f=new d({text:e,start:this.start.clone().add(new c(0,this.lineHeight*(j.length+1)-k))}),this.extendCommonProperties(f),j.push(f),i=b):(i+=b,f.text+=e);return j}},computeWordBreak:function(a){if(this.text){for(var b,e,f,g=this.text.length,h=a.measureText(this.text[0]).width,i=[],j=a.measureText("m").width,k=0;g>k;k++)if(e=this.text[k],b=a.measureText(e).width,h+b>this.width||!f){var f=new d({text:e,start:this.start.clone().add(new c(0,this.lineHeight*(i.length+1)-j))});this.extendCommonProperties(f),i.push(f),h=b}else h+=b,f.text+=e;return i}},extendCommonProperties:function(a){e.extend(a,{fill:this.fill,stroke:this.stroke})},intersect:function(){}});return f}),define("qtek-2d/shape/SVGPath",["require","../Node","../util","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("../util"),d=a("qtek/math/Vector2"),e={m:1,M:1,z:1,Z:1,l:1,L:1,h:1,H:1,v:1,V:1,c:1,C:1,s:1,S:1,q:1,Q:1,t:1,T:1,a:1,A:1},f=b.derive(function(){return{description:"",_ops:[]}},{draw:function(a){this._ops.length||this.parse(),a.beginPath();for(var b=0;b<this._ops.length;b++){var c=this._ops[b];switch(c[0]){case"m":a.moveTo(c[1]||0,c[2]||0);break;case"l":a.lineTo(c[1]||0,c[2]||0);break;case"c":a.bezierCurveTo(c[1]||0,c[2]||0,c[3]||0,c[4]||0,c[5]||0,c[6]||0);break;case"q":a.quadraticCurveTo(c[1]||0,c[2]||0,c[3]||0,c[4]||0);break;case"z":a.closePath()}}this.fill&&a.fill(),this.stroke&&a.stroke()},computeBoundingBox:function(){var a=new d,b=new d,e=new d,f=new d,g=new d,h=new d;return function(){this._ops.length||this.parse();for(var i=new d(999999,999999),j=new d(-999999,-999999),k=0;k<this._ops.length;k++){var l=this._ops[k];switch(l[0]){case"m":a.set(l[1],l[2]);break;case"l":b.set(l[1],l[2]),a.copy(b),i.min(a).min(b),j.max(a).max(b);break;case"c":b.set(l[1],l[2]),e.set(l[3],l[4]),f.set(l[5],l[6]),c.computeCubeBezierBoundingBox(a,b,e,f,g,h),a.copy(f),i.min(g),j.max(h);break;case"q":b.set(l[1],l[2]),e.set(l[3],l[4]);{c.computeQuadraticBezierBoundingBox(a,b,e,g,h)}a.copy(e),i.min(g),i.max(h);break;case"z":}}this.boundingBox={min:i,max:j}}}(),parse:function(a){function b(){return p=k[n+1],k[n++]}function c(){return p=k[n+1],q=k[n++],parseFloat(q)}var d=0,f=0,g=0,h=0,i=0,j=0;a=a||this.description;var k=a.replace(/\s*,\s*/g," ");k=k.replace(/(-)/g," $1"),k=k.replace(/([mMzZlLhHvVcCsSqQtTaA])/g," $1 "),k=k.split(/\s+/);for(var l="",m="",n=0,o=k.length,p=k[0];o>=n;)if(p)switch(e[p]&&(m=l,l=p,n++),l){case"m":d=c()+d,f=c()+f,this._ops.push(["m",d,f]);break;case"M":d=c(),f=c(),this._ops.push(["m",d,f]);break;case"z":case"Z":p=k[n],this._ops.push(["z"]);break;case"l":d=c()+d,f=c()+f,this._ops.push(["l",d,f]);break;case"L":d=c(),f=c(),this._ops.push(["l",d,f]);break;case"h":d=c()+d,this._ops.push(["l",d,f]);break;case"H":d=c(),this._ops.push(["l",d,f]);break;case"v":f=c()+f,this._ops.push(["l",d,f]);break;case"V":f=c(),this._ops.push(["l",d,f]);break;case"c":g=c()+d,h=c()+f,i=c()+d,j=c()+f,d=c()+d,f=c()+f,this._ops.push(["c",g,h,i,j,d,f]);break;case"C":g=c(),h=c(),i=c(),j=c(),d=c(),f=c(),this._ops.push(["c",g,h,i,j,d,f]);break;case"s":"c"===m||"C"===m||"s"===m||"S"===m?(g=2*d-i,h=2*f-j):(g=d,h=f),i=c()+d,j=c()+f,d=c()+d,f=c()+f,this._ops.push(["c",g,h,i,j,d,f]);break;case"S":"c"===m||"C"===m||"s"===m||"S"===m?(g=2*d-i,h=2*f-j):(g=d,h=f),i=c(),j=c(),d=c(),f=c(),this._ops.push(["c",g,h,i,j,d,f]);break;case"q":g=c()+d,h=c()+f,d=c()+d,f=c()+f,this._ops.push(["q",g,h,d,f]);break;case"Q":g=c(),h=c(),d=c(),f=c(),this._ops.push(["q",g,h,d,f]);break;case"t":"q"===m||"Q"===m||"t"===m||"T"===m?(g=2*d-g,h=2*f-h):(g=d,h=f),d=c()+d,f=c()+f,this._ops.push(["q",g,h,d,f]);break;case"T":"q"===m||"Q"===m||"t"===m||"T"===m?(g=2*d-g,h=2*f-h):(g=d,h=f),d=c(),f=c(),this._ops.push(["q",g,h,d,f]);break;case"a":case"A":c(),c(),c(),c(),c(),c(),c(),console.warn("Elliptical arc is not supported yet");break;default:b();continue}else p=k[++n];var q}});return f}),define("qtek-2d/loader/SVG",["require","qtek/core/Base","qtek/core/request","../Node","../shape/Circle","../shape/Rectangle","../shape/Ellipse","../shape/Line","../shape/Path","../shape/Polygon","../shape/TextBox","../shape/SVGPath","../LinearGradient","../RadialGradient","../Pattern","../Style","qtek/math/Vector2","qtek/core/util"],function(a){function b(a,b){for(var c=a.firstChild;c;){if(1===c.nodeType){var d=c.getAttribute("offset");d=d.indexOf("%")>0?parseInt(d)/100:d?parseFloat(d):0;var e=c.getAttribute("stop-color")||"#000000";b.addColorStop(d,e)}c=c.nextSibling}}function c(a,b){b.stroke=a.stroke,b.fill=a.fill}function d(a){for(var b=a.trim().replace(/,/g," ").split(/\s+/),c=[],d=0;d<b.length;d+=2){var e=parseFloat(b[d]),f=parseFloat(b[d+1]);c.push(new u(e,f))}return c}function e(a,b,c){g(a,b);var d={fill:a.getAttribute("fill"),stroke:a.getAttribute("stroke"),lineWidth:a.getAttribute("stroke-width"),opacity:a.getAttribute("opacity"),lineDash:a.getAttribute("stroke-dasharray"),lineDashOffset:a.getAttribute("stroke-dashoffset"),lineCap:a.getAttribute("stroke-linecap"),lineJoin:a.getAttribute("stroke-linjoin"),miterLimit:a.getAttribute("stroke-miterlimit")};v.extend(d,h(a)),b.style=new t({fill:f(d.fill,c),stroke:f(d.stroke,c),lineWidth:parseFloat(d.lineWidth)||1,opacity:parseFloat(d.opacity)||1,lineDashOffset:d.lineDashOffset,lineCap:d.lineCap,lineJoin:d.lineJoin,miterLimit:parseFloat(d.miterLimit)}),d.lineDash&&(b.style.lineDash=d.lineDash.trim().split(/\s*,\s*/)),d.stroke&&"none"!==d.stroke&&(b.stroke=!0)}function f(a,b){var c=z.exec(a);if(c){var d=c[1].trim(),e=b[d];return e}return a}function g(a,b){var c=a.getAttribute("transform");if(c){var d=b.transform;d.identity();var e=[];c.replace(A,function(a,b,c){e.push(b,c)});for(var f=e.length-1;f>0;f-=2){var g=e[f],h=e[f-1];switch(h){case"translate":g=g.trim().split(/\s+/),d.translate(new u(parseFloat(g[0]),parseFloat(g[1]||0)));break;case"scale":g=g.trim().split(/\s+/),d.scale(new u(parseFloat(g[0]),parseFloat(g[1]||g[0])));break;case"rotate":g=g.trim().split(/\s*/),d.rotate(parseFloat(g[0]));break;case"skew":g=g.trim().split(/\s*/),console.warn("Skew transform is not supported yet");break;case"matrix":var g=g.trim().split(/\s*,\s*/),i=d._array;i[0]=parseFloat(g[0]),i[1]=parseFloat(g[1]),i[2]=parseFloat(g[2]),i[3]=parseFloat(g[3]),i[4]=parseFloat(g[4]),i[5]=parseFloat(g[5])}}}b.autoUpdate=!1}function h(a){var b=a.getAttribute("style");if(b){var c={};return b=b.replace(/\s*([;:])\s*/g,"$1"),b.replace(B,function(a,b,d){c[b]=d}),{fill:c.fill,stroke:c.stroke,lineWidth:c["stroke-width"],opacity:c.opacity,lineDash:c["stroke-dasharray"],lineDashOffset:c["stroke-dashoffset"],lineCap:c["stroke-linecap"],lineJoin:c["stroke-linjoin"],miterLimit:c["stroke-miterlimit"]}}return{}}var i=a("qtek/core/Base"),j=a("qtek/core/request"),k=a("../Node"),l=a("../shape/Circle"),m=a("../shape/Rectangle"),n=a("../shape/Ellipse"),o=a("../shape/Line"),p=a("../shape/Path"),q=a("../shape/Polygon"),r=(a("../shape/TextBox"),a("../shape/SVGPath")),s=a("../LinearGradient"),t=(a("../RadialGradient"),a("../Pattern"),a("../Style")),u=a("qtek/math/Vector2"),v=a("qtek/core/util"),w=i.derive(function(){return{defs:{},root:null}},{load:function(a){var b=this;this.defs={},j.get({url:a,onprogress:function(a,c,d){b.trigger("progress",a,c,d)},onerror:function(a){b.trigger("error",a)},responseType:"text",onload:function(a){b.parse(a)}})},parse:function(a){if("string"==typeof a)for(var b=new DOMParser,c=b.parseFromString(a,"text/xml"),d=c.firstChild;"svg"!=d.nodeName.toLowerCase()||1!=d.nodeType;)d=d.nextSibling;else var d=a;var e=new k;this.root=e;{var f=d.getAttribute("viewBox")||"",g=f.split(/\s+/),h=(parseFloat(d.getAttribute("width")||0),parseFloat(d.getAttribute("height")||0),parseFloat(g[0]||0)),i=parseFloat(g[1]||0);parseFloat(g[2]),parseFloat(g[3])}e.position.set(h,i);for(var j=d.firstChild;j;)this._parseNode(j,e),j=j.nextSibling;return this.trigger("success",e),e},_parseNode:function(a,b){var c=a.nodeName.toLowerCase();if("defs"===c&&(this._isDefine=!0),this._isDefine){var d=y[c];if(d){var e=d.call(this,a),f=a.getAttribute("id");f&&(this.defs[f]=e)}}else{var d=x[c];if(d){var g=d.call(this,a,b);b.add(g)}}for(var h=a.firstChild;h;)1===h.nodeType&&this._parseNode(h,g),h=h.nextSibling;"defs"===c&&(this._isDefine=!1)}}),x={g:function(a,b){var d=new k;return b&&c(b,d),e(a,d,this.defs),d},rect:function(a,b){var d=new m;b&&c(b,d),e(a,d,this.defs);{var f=parseFloat(a.getAttribute("x")||0),g=parseFloat(a.getAttribute("y")||0);parseFloat(a.getAttribute("width")||0),parseFloat(a.getAttribute("height")||0)}return d.start.set(f,g),d.size.set(f,g),d},circle:function(a,b){var d=new l;b&&c(b,d),e(a,d,this.defs);var f=parseFloat(a.getAttribute("cx")||0),g=parseFloat(a.getAttribute("cy")||0),h=parseFloat(a.getAttribute("r")||0);return d.center.set(f,g),d.radius=h,d},line:function(a,b){var d=new o;b&&c(b,d),e(a,d,this.defs);var f=parseFloat(a.getAttribute("x1")||0),g=parseFloat(a.getAttribute("y1")||0),h=parseFloat(a.getAttribute("x2")||0),i=parseFloat(a.getAttribute("y2")||0);
return d.start.set(f,g),d.end.set(h,i),d},ellipse:function(a,b){var d=new n;b&&c(b,d),e(a,d,this.defs);var f=parseFloat(a.getAttribute("cx")||0),g=parseFloat(a.getAttribute("cy")||0),h=parseFloat(a.getAttribute("rx")||0),i=parseFloat(a.getAttribute("ry")||0);return d.center.set(f,g),d.radius.set(h,i),d},polygon:function(a,b){var f=a.getAttribute("points");f&&(f=d(f));var g=new q({points:f});return b&&c(b,g),e(a,g,this.defs),g},polyline:function(a,b){var f=new p;b&&c(b,f),e(a,f,this.defs);var g=a.getAttribute("points");return g&&(g=d(g),f.pushPoints(g)),f},image:function(){},text:function(){},path:function(a,b){var d=new r;b&&c(b,d),e(a,d,this.defs);var f=a.getAttribute("d")||"";return d.description=f,d}},y={lineargradient:function(a){var c=parseInt(a.getAttribute("x1")||0),d=parseInt(a.getAttribute("y1")||0),e=parseInt(a.getAttribute("x2")||10),f=parseInt(a.getAttribute("y2")||0),g=new s;return g.start.set(c,d),g.end.set(e,f),b(a,g),g},radialgradient:function(){}},z=/url\(\s*#(.*?)\)/,A=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.,]*)\)/g,B=/(\S*?):(.*?);/g;return w}),define("qtek-2d/picking/Box",function(){}),define("qtek-2d/picking/Pixel",["require","qtek/core/Base"],function(a){function b(a){var b=a>>16,c=a-(b<<8)>>8,d=a-(b<<16)-(c<<8);return[b,c,d]}function c(a,b,c){return(a<<16)+(b<<8)+c}var d=a("qtek/core/Base"),e=d.derive(function(){return{downSampleRatio:1,width:100,height:100,lookupOffset:1,_canvas:null,_context:null,_imageData:null,_lookupTable:[]}},function(){this.init()},{init:function(){var a=document.createElement("canvas");this._canvas=a,this._context=a.getContext("2d"),this.resize(this.width,this.height)},setPrecision:function(a){this._canvas.width=this.width*a,this._canvas.height=this.height*a,this.downSampleRatio=a},resize:function(a,b){this._canvas.width=a*this.downSampleRatio,this._canvas.height=b*this.downSampleRatio,this.width=a,this.height=b},update:function(a,b){var c=this._context;if(c.clearRect(0,0,this._canvas.width,this._canvas.height),c.save(),c.scale(this.downSampleRatio,this.downSampleRatio),this._lookupTable.length=0,b){var d=b.getViewMatrix()._array;c.transform(d[0],d[1],d[2],d[3],d[4],d[5])}this._renderNode(a,c),c.restore();var e=c.getImageData(0,0,this._canvas.width,this._canvas.height);this._imageData=e.data},_renderNode:function(a,c){c.save(),a.updateTransform();var d=a.transform._array;if(c.transform(d[0],d[1],d[2],d[3],d[4],d[5]),a.clip&&c.clip(),a.draw&&a.enablePicking===!0){var e=this._lookupTable,f=b(e.length+this.lookupOffset),g="rgb("+f.join(",")+")";this._lookupTable.push(a),c.fillStyle=g,c.strokeStyle=g,a.draw(c,!0)}for(var h=a.getSortedRenderQueue(),i=0;i<h.length;i++){var j=h[i];this._renderNode(j,c)}c.restore()},pick:function(a,b){{var c=this.downSampleRatio;this._canvas.width,this._canvas.height}a=Math.ceil(c*a),b=Math.ceil(c*b);for(var d,e=[this._sample(a,b),this._sample(a-1,b),this._sample(a+1,b),this._sample(a,b-1),this._sample(a,b+1)],f={},g=0,h=0;h<e.length;h++){var i=e[h];f[i]?f[i]++:f[i]=1,f[i]>g&&(g=f[i],d=i)}var i=d-this.lookupOffset;if(i&&g>=2){var j=this._lookupTable[i];return j}},_sample:function(a,b){a=Math.max(Math.min(a,this._canvas.width),1),b=Math.max(Math.min(b,this._canvas.height),1);var d=4*((b-1)*this._canvas.width+(a-1)),e=this._imageData,f=e[d],g=e[d+1],h=e[d+2];return c(f,g,h)}});return e}),define("qtek-2d/shape/Image",["require","../Node","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("qtek/math/Vector2"),d={},e=b.derive(function(){return{image:null,start:new c,size:null}},{computeBoundingBox:function(){this.size&&(this.boundingBox={min:this.start.clone(),max:this.start.clone().add(this.size)})},draw:function(a,b){this.image&&!b&&(this.size?a.drawImage(this.image,this.start.x,this.start.y,this.size.x,this.size.y):a.drawImage(this.image,this.start.x,this.start.y))},intersect:function(a,b){return this.intersectBoundingBox(a,b)}});return e.load=function(a,b){if(d[a]){var c=d[a];c.constructor==Array?c.push(b):b(c)}else{d[a]=[b];var c=new Image;c.onload=function(){d[a].forEach(function(a){a(c)}),d[a]=c,c.onload=null},c.src=a}},e}),define("qtek-2d/shape/RoundedRectangle",["require","../Node","../util","qtek/math/Vector2"],function(a){var b=a("../Node"),c=a("../util"),d=a("qtek/math/Vector2"),e=b.derive(function(){return{start:new d,size:new d,radius:0}},{computeBoundingBox:function(){this.boundingBox={min:this.start.clone(),max:this.size.clone().add(this.start)}},draw:function(a){if(this.radius.constructor==Number)var b=[this.radius,this.radius,this.radius,this.radius];else if(2==this.radius.length)var b=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var b=this.radius;var e=this.fixAA?c.fixPos(this.start.clone()):this.start,f=this.size,g=(new d).copy(e).add(new d(b[0],0)),h=(new d).copy(e).add(new d(f.x,0)),i=(new d).copy(e).add(f),j=(new d).copy(e).add(new d(0,f.y));a.beginPath(),a.moveTo(g.x,g.y),b[1]?a.arcTo(h.x,h.y,i.x,i.y,b[1]):a.lineTo(h.x,h.y),b[2]?a.arcTo(i.x,i.y,j.x,j.y,b[2]):a.lineTo(i.x,i.y),b[3]?a.arcTo(j.x,j.y,e.x,e.y,b[3]):a.lineTo(j.x,j.y),b[0]?a.arcTo(e.x,e.y,h.x,h.y,b[0]):a.lineTo(e.x,e.y),this.stroke&&a.stroke(),this.fill&&a.fill()},intersect:function(){return!1}});return e});