// (c) 2010-2013 Thomas Fuchs

// Zepto.js may be freely distributed under the MIT license.

/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

/**
 * @license RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

// (c) Dean McNamee <dean@gmail.com>, 2012.
//
// https://github.com/deanm/css-color-parser-js
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to
// deal in the Software without restriction, including without limitation the
// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
// sell copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
// FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
// IN THE SOFTWARE.

/*!
 * ZRender, a lightweight canvas library with a MVC architecture, data-driven 
 * and provides an event model like DOM.
 *  
 * Copyright (c) 2013, Baidu Inc.
 * All rights reserved.
 * 
 * LICENSE
 * https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
 */

define("zrender-x/tool/util",["require"],function(e){function n(e){if(typeof e=="object"){var r=e;if(e instanceof Array){r=[];for(i=0,len=e.length;i<len;i++)r[i]=n(e[i])}else if(!t[Object.prototype.toString.call(e)]){r={};for(var s in e)e.hasOwnProperty(s)&&(r[s]=n(e[s]))}return r}return e}function r(e,n,r,i){if(n.hasOwnProperty(r))if(typeof e[r]=="object"&&!t[Object.prototype.toString.call(e[r])])s(e[r],n[r],i);else if(i||!(r in e))e[r]=n[r]}function s(e,t,n){for(var i in t)r(e,t,i,n);return e}function u(){return o||(o=document.createElement("canvas").getContext("2d")),o}function d(){return f||(a=document.createElement("canvas"),l=a.width,c=a.height,f=a.getContext("2d")),f}function v(e,t){var n=100,r;e+h>l&&(l=e+h+n,a.width=l,r=!0),t+p>c&&(c=t+p+n,a.height=c,r=!0),e<-h&&(h=Math.ceil(-e/n)*n,l+=h,a.width=l,r=!0),t<-p&&(p=Math.ceil(-t/n)*n,c+=p,a.height=c,r=!0),r&&f.translate(h,p)}function m(){return{x:h,y:p}}function g(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function y(e,t){function r(){}var n=e.prototype;r.prototype=t.prototype,e.prototype=new r;for(var i in n)e.prototype[i]=n[i];e.prototype.constructor=e}var t={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1},o,a,f,l,c,h=0,p=0;return{inherits:y,clone:n,merge:s,getContext:u,getPixelContext:d,getPixelOffset:m,adjustCanvasSize:v,indexOf:g}}),define("zrender-x/config",{EVENT:{RESIZE:"resize",CLICK:"click",MOUSEWHEEL:"mousewheel",MOUSEMOVE:"mousemove",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",GLOBALOUT:"globalout",DRAGSTART:"dragstart",DRAGEND:"dragend",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",touchClickDelay:300},catchBrushException:!1,debugMode:0}),define("zrender-x/tool/log",["require","../config"],function(e){var t=e("../config");return function(){if(t.debugMode===0)return;if(t.debugMode==1)for(var e in arguments)throw new Error(arguments[e]);else if(t.debugMode>1)for(var e in arguments)console.log(arguments[e])}}),define("zrender-x/tool/guid",[],function(){var e=2311;return function(){return"zrender__"+e++}}),define("zrender-x/tool/env",[],function(){function e(e){var t=this.os={},n=this.browser={},r=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),i=e.match(/(Android);?[\s\/]+([\d.]+)?/),s=e.match(/(iPad).*OS\s([\d_]+)/),o=e.match(/(iPod)(.*OS\s([\d_]+))?/),u=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),a=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),f=a&&e.match(/TouchPad/),l=e.match(/Kindle\/([\d.]+)/),c=e.match(/Silk\/([\d._]+)/),h=e.match(/(BlackBerry).*Version\/([\d.]+)/),p=e.match(/(BB10).*Version\/([\d.]+)/),d=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),v=e.match(/PlayBook/),m=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),g=e.match(/Firefox\/([\d.]+)/),y=e.match(/MSIE ([\d.]+)/),b=r&&e.match(/Mobile\//)&&!m,w=e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/)&&!m,y=e.match(/MSIE\s([\d.]+)/);if(n.webkit=!!r)n.version=r[1];return i&&(t.android=!0,t.version=i[2]),u&&!o&&(t.ios=t.iphone=!0,t.version=u[2].replace(/_/g,".")),s&&(t.ios=t.ipad=!0,t.version=s[2].replace(/_/g,".")),o&&(t.ios=t.ipod=!0,t.version=o[3]?o[3].replace(/_/g,"."):null),a&&(t.webos=!0,t.version=a[2]),f&&(t.touchpad=!0),h&&(t.blackberry=!0,t.version=h[2]),p&&(t.bb10=!0,t.version=p[2]),d&&(t.rimtabletos=!0,t.version=d[2]),v&&(n.playbook=!0),l&&(t.kindle=!0,t.version=l[1]),c&&(n.silk=!0,n.version=c[1]),!c&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0),m&&(n.chrome=!0,n.version=m[1]),g&&(n.firefox=!0,n.version=g[1]),y&&(n.ie=!0,n.version=y[1]),b&&(e.match(/Safari/)||!!t.ios)&&(n.safari=!0),w&&(n.webview=!0),y&&(n.ie=!0,n.version=y[1]),t.tablet=!!(s||v||i&&!e.match(/Mobile/)||g&&e.match(/Tablet/)||y&&!e.match(/Phone/)&&e.match(/Touch/)),t.phone=!!(!t.tablet&&!t.ipod&&(i||u||a||h||p||m&&e.match(/Android/)||m&&e.match(/CriOS\/([\d.]+)/)||g&&e.match(/Mobile/)||y&&e.match(/Touch/))),{browser:n,os:t,canvasSupported:document.createElement("canvas").getContext?!0:!1}}return e(navigator.userAgent)}),define("zrender-x/tool/event",[],function(){function e(e){return typeof e.zrenderX!="undefined"&&e.zrenderX||typeof e.offsetX!="undefined"&&e.offsetX||typeof e.layerX!="undefined"&&e.layerX||typeof e.clientX!="undefined"&&e.clientX}function t(e){return typeof e.zrenderY!="undefined"&&e.zrenderY||typeof e.offsetY!="undefined"&&e.offsetY||typeof e.layerY!="undefined"&&e.layerY||typeof e.clientY!="undefined"&&e.clientY}function n(e){return typeof e.wheelDelta!="undefined"&&e.wheelDelta||typeof e.detail!="undefined"&&-e.detail}function i(){this._handlers={}}var r=typeof window.addEventListener=="function"?function(e){e.preventDefault(),e.stopPropagation()}:function(e){e.returnValue=!1,e.cancelBubble=!0};return i.prototype.one=function(e,t,n){var r=this._handlers;return!t||!e?this:(r[e]||(r[e]=[]),r[e].push({h:t,one:!0,ctx:n||this}),this)},i.prototype.bind=function(e,t,n){var r=this._handlers;return!t||!e?this:(r[e]||(r[e]=[]),r[e].push({h:t,one:!1,ctx:n||this}),this)},i.prototype.unbind=function(e,t){var n=this._handlers;if(!e)return this._handlers={},this;if(t){if(n[e]){var r=[];for(var i=0,s=n[e].length;i<s;i++)n[e][i]["h"]!=t&&r.push(n[e][i]);n[e]=r}n[e]&&n[e].length===0&&delete n[e]}else delete n[e];return this},i.prototype.dispatch=function(e){var t=arguments,n=t.length;n>3&&(t=Array.prototype.slice.call(t,1));if(this._handlers[e]){var r=this._handlers[e],i=r.length;for(var s=0;s<i;){switch(n){case 1:r[s].h.call(r[s].ctx);break;case 2:r[s].h.call(r[s].ctx,t[1]);break;case 3:r[s].h.call(r[s].ctx,t[1],t[2]);break;default:r[s].h.apply(r[s].ctx,t)}r[s].one?(r.splice(s,1),i--):s++}}return this},i.prototype.dispatchWithContext=function(e){var t=arguments,n=t.length;n>4&&(t=Array.prototype.slice.call(t,1,t.length-1));var r=t[t.length-1];if(this._handlers[e]){var i=this._handlers[e],s=i.length;for(var o=0;o<s;){switch(n){case 1:i[o].h.call(r);break;case 2:i[o].h.call(r,t[1]);break;case 3:i[o].h.call(r,t[1],t[2]);break;default:i[o].h.apply(r,t)}i[o].one?(i.splice(o,1),s--):o++}}return this},{getX:e,getY:t,getDelta:n,stop:r,Dispatcher:i}}),define("zrender-x/Handler",["require","./config","./tool/env","./tool/event","./tool/util"],function(e){function a(e,t){return function(n){return e.call(t,n)}}function f(e){var t=o.length;while(t--){var n=o[t];e["_"+n+"Handler"]=a(u[n],e)}}function l(e,t,i){r.Dispatcher.call(this),this.root=e,this.storage=t,this.painter=i,this._lastX=this._lastY=this._mouseX=this._mouseY=0,this._findHover=a(h,this),f(this),window.addEventListener?(window.addEventListener("resize",this._resizeHandler),n.os.tablet||n.os.phone?(e.addEventListener("touchstart",this._touchstartHandler),e.addEventListener("touchmove",this._touchmoveHandler),e.addEventListener("touchend",this._touchendHandler)):(e.addEventListener("click",this._clickHandler),e.addEventListener("mousewheel",this._mousewheelHandler),e.addEventListener("mousemove",this._mousemoveHandler),e.addEventListener("mousedown",this._mousedownHandler),e.addEventListener("mouseup",this._mouseupHandler)),e.addEventListener("DOMMouseScroll",this._mousewheelHandler),e.addEventListener("mouseout",this._mouseoutHandler)):(window.attachEvent("onresize",this._resizeHandler),e.attachEvent("onclick",this._clickHandler),e.attachEvent("onmousewheel",this._mousewheelHandler),e.attachEvent("onmousemove",this._mousemoveHandler),e.attachEvent("onmouseout",this._mouseoutHandler),e.attachEvent("onmousedown",this._mousedownHandler),e.attachEvent("onmouseup",this._mouseupHandler))}function h(e){if(this._draggingTarget&&this._draggingTarget.id==e.id||e.isSilent())return!1;var t=this._event;if(e.isCover(this._mouseX,this._mouseY)){var n=e.parent;while(n){if(n.clipShape&&!n.clipShape.isCover(this._mouseX,this._mouseY))return!1;n=n.parent}return this._lastHover!=e&&(this._processOutShape(t),this._processDragLeave(t),this._lastHover=e,this._processDragEnter(t)),this._processOverShape(t),this._processDragOver(t),this._hasfound=1,!0}return!1}var t=e("./config"),n=e("./tool/env"),r=e("./tool/event"),i=e("./tool/util"),s=t.EVENT,o=["resize","click","mousewheel","mousemove","mouseout","mouseup","mousedown","touchstart","touchend","touchmove"],u={resize:function(e){e=e||window.event,this._lastHover=null,this._isMouseDown=0,this.dispatch(s.RESIZE,e)},click:function(e){e=this._zrenderEventFixed(e);var t=this._lastHover;(t&&t.clickable||!t)&&this._dispatchAgency(t,s.CLICK,e),this._mousemoveHandler(e)},mousewheel:function(e){e=this._zrenderEventFixed(e),this._dispatchAgency(this._lastHover,s.MOUSEWHEEL,e),this._mousemoveHandler(e)},mousemove:function(e){e=this._zrenderEventFixed(e),this._lastX=this._mouseX,this._lastY=this._mouseY,this._mouseX=r.getX(e),this._mouseY=r.getY(e),this._processDragStart(e),this._hasfound=0,this._event=e,this.storage.iterShape(this._findHover,{normal:"down"});if(!this._hasfound){if(!this._draggingTarget||this._lastHover&&this._lastHover!=this._draggingTarget)this._processOutShape(e),this._processDragLeave(e);this._lastHover=null}this._draggingTarget&&this.storage.drift(this._draggingTarget.id,this._mouseX-this._lastX,this._mouseY-this._lastY);var t="default";this._draggingTarget||this._hasfound&&this._lastHover.draggable?t="move":this._hasfound&&this._lastHover.clickable&&(t="pointer"),this.root.style.cursor=t,this._dispatchAgency(this._lastHover,s.MOUSEMOVE,e)},mouseout:function(e){e=this._zrenderEventFixed(e);var t=e.toElement||e.relatedTarget;if(t!=this.root)while(t&&t.nodeType!=9){if(t==this.root){this._mousemoveHandler(e);return}t=t.parentNode}e.zrenderX=this._lastX,e.zrenderY=this._lastY,this.root.style.cursor="default",this._isMouseDown=0,this._processOutShape(e),this._processDrop(e),this._processDragEnd(e),this.dispatch(s.GLOBALOUT,e)},mousedown:function(e){if(this._lastDownButton==2){this._lastDownButton=e.button,this._mouseDownTarget=null;return}this._lastMouseDownMoment=new Date,e=this._zrenderEventFixed(e),this._isMouseDown=1,this._mouseDownTarget=this._lastHover,this._dispatchAgency(this._lastHover,s.MOUSEDOWN,e),this._lastDownButton=e.button},mouseup:function(e){e=this._zrenderEventFixed(e),this.root.style.cursor="default",this._isMouseDown=0,this._mouseDownTarget=null,this._dispatchAgency(this._lastHover,s.MOUSEUP,e),this._processDrop(e),this._processDragEnd(e)},touchstart:function(e){e=this._zrenderEventFixed(e,!0),this._lastTouchMoment=new Date,this._mobildFindFixed(e),this._mousedownHandler(e)},touchmove:function(e){e=this._zrenderEventFixed(e,!0),this._mousemoveHandler(e),this._isDragging&&r.stop(e)},touchend:function(e){e=this._zrenderEventFixed(e,!0),this._mouseupHandler(e),new Date-this._lastTouchMoment<s.touchClickDelay&&(this._mobildFindFixed(e),this._clickHandler(e))}};l.prototype.on=function(e,t){return this.bind(e,t),this},l.prototype.un=function(e,t){return this.unbind(e,t),this},l.prototype.trigger=function(e,t){switch(e){case s.RESIZE:case s.CLICK:case s.MOUSEWHEEL:case s.MOUSEMOVE:case s.MOUSEDOWN:case s.MOUSEUP:case s.MOUSEOUT:this["_"+e+"Handler"](t)}},l.prototype.dispose=function(){var e=this.root;window.removeEventListener?(window.removeEventListener("resize",this._resizeHandler),n.os.tablet||n.os.phone?(e.removeEventListener("touchstart",this._touchstartHandler),e.removeEventListener("touchmove",this._touchmoveHandler),e.removeEventListener("touchend",this._touchendHandler)):(e.removeEventListener("click",this._clickHandler),e.removeEventListener("mousewheel",this._mousewheelHandler),e.removeEventListener("mousemove",this._mousemoveHandler),e.removeEventListener("mousedown",this._mousedownHandler),e.removeEventListener("mouseup",this._mouseupHandler)),e.removeEventListener("DOMMouseScroll",this._mousewheelHandler),e.removeEventListener("mouseout",this._mouseoutHandler)):(window.detachEvent("onresize",this._resizeHandler),e.detachEvent("onclick",this._clickHandler),e.detachEvent("onmousewheel",this._mousewheelHandler),e.detachEvent("onmousemove",this._mousemoveHandler),e.detachEvent("onmouseout",this._mouseoutHandler),e.detachEvent("onmousedown",this._mousedownHandler),e.detachEvent("onmouseup",this._mouseupHandler)),this.root=this.storage=this.painter=null,this.un()},l.prototype._processDragStart=function(e){var t=this._lastHover;if(this._isMouseDown&&t&&t.draggable&&!this._draggingTarget&&this._mouseDownTarget==t){if(t.dragEnableTime&&new Date-this._lastMouseDownMoment<t.dragEnableTime)return;var n=t;this._draggingTarget=n,this._isDragging=1,n.invisible=!0,this.storage.mod(n.id),this._dispatchAgency(n,s.DRAGSTART,e),this.painter.refresh()}},l.prototype._processDragEnter=function(e){this._draggingTarget&&this._dispatchAgency(this._lastHover,s.DRAGENTER,e,this._draggingTarget)},l.prototype._processDragOver=function(e){this._draggingTarget&&this._dispatchAgency(this._lastHover,s.DRAGOVER,e,this._draggingTarget)},l.prototype._processDragLeave=function(e){this._draggingTarget&&this._dispatchAgency(this._lastHover,s.DRAGLEAVE,e,this._draggingTarget)},l.prototype._processDrop=function(e){this._draggingTarget&&(this._draggingTarget.invisible=!1,this.storage.mod(this._draggingTarget.id),this.painter.refresh(),this._dispatchAgency(this._lastHover,s.DROP,e,this._draggingTarget))},l.prototype._processDragEnd=function(e){this._draggingTarget&&(this._dispatchAgency(this._draggingTarget,s.DRAGEND,e),this._lastHover=null),this._isDragging=0,this._draggingTarget=null},l.prototype._processOverShape=function(e){this._dispatchAgency(this._lastHover,s.MOUSEOVER,e)},l.prototype._processOutShape=function(e){this._dispatchAgency(this._lastHover,s.MOUSEOUT,e)},l.prototype._dispatchAgency=function(e,t,n,r){var i="on"+t,s={type:t,event:n,target:e,cancelBubble:!1},o=e;r&&(s.dragged=r);while(o){o[i]&&o[i](s),o.dispatch(t,s),o=o.parent;if(s.cancelBubble)break}e?s.cancelBubble||this.dispatch(t,s):r||this.dispatch(t,{type:t,event:n})};var c=[{x:10},{x:-20},{x:10,y:10},{y:-20}];return l.prototype._mobildFindFixed=function(e){this._lastHover=null,this._mouseX=e.zrenderX,this._mouseY=e.zrenderY,this._event=e,this.storage.iterShape(this._findHover,{normal:"down"});for(var t=0;!this._lastHover&&t<c.length;t++){var n=c[t];n.x&&(this._mouseX+=n.x),n.y&&(this._mouseX+=n.y),this.storage.iterShape(this._findHover,{normal:"down"})}this._lastHover&&(e.zrenderX=this._mouseX,e.zrenderY=this._mouseY)},l.prototype._zrenderEventFixed=function(e,t){if(e.zrenderFixed)return e;if(!t){e=e||window.event;var n=e.toElement||e.relatedTarget||e.srcElement||e.target;n&&(e.zrenderX=(typeof e.offsetX!="undefined"?e.offsetX:e.layerX)+n.offsetLeft,e.zrenderY=(typeof e.offsetY!="undefined"?e.offsetY:e.layerY)+n.offsetTop)}else{var r=e.type!="touchend"?e.targetTouches[0]:e.changedTouches[0];if(r){var i=this.root.getBoundingClientRect();e.zrenderX=r.clientX-i.left,e.zrenderY=r.clientY-i.top}}return e.zrenderFixed=1,e},i.merge(l.prototype,r.Dispatcher.prototype,!0),l}),function(e){var t={};typeof exports=="undefined"?typeof define=="function"&&typeof define.amd=="object"&&define.amd?(t.exports={},define("glmatrix",[],function(){return t.exports})):t.exports=typeof window!="undefined"?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!n)var n=typeof Float32Array!="undefined"?Float32Array:Array;if(!r)var r=Math.random;var i={};i.setMatrixArrayType=function(e){n=e},typeof e!="undefined"&&(e.glMatrix=i);var s=Math.PI/180;i.toRadian=function(e){return e*s};var o={};o.create=function(){var e=new n(2);return e[0]=0,e[1]=0,e},o.clone=function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},o.fromValues=function(e,t){var r=new n(2);return r[0]=e,r[1]=t,r},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},o.set=function(e,t,n){return e[0]=t,e[1]=n,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},o.div=o.divide,o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},o.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},o.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},o.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},o.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},o.random=function(e,t){t=t||1;var n=r()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},o.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},o.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},o.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},o.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,a;n||(n=2),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),o.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},typeof e!="undefined"&&(e.vec2=o);var u={};u.create=function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},u.clone=function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},u.fromValues=function(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},u.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},u.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},u.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},u.sub=u.subtract,u.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},u.mul=u.multiply,u.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},u.div=u.divide,u.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},u.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},u.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},u.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},u.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},u.dist=u.distance,u.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},u.len=u.length,u.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},u.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},u.cross=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];return e[0]=i*a-s*u,e[1]=s*o-r*a,e[2]=r*u-i*o,e},u.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e},u.random=function(e,t){t=t||1;var n=r()*2*Math.PI,i=r()*2-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=i*t,e},u.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12],e[1]=n[1]*r+n[5]*i+n[9]*s+n[13],e[2]=n[2]*r+n[6]*i+n[10]*s+n[14],e},u.transformMat3=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e},u.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},u.forEach=function(){var e=u.create();return function(t,n,r,i,s,o){var u,a;n||(n=3),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),u.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},typeof e!="undefined"&&(e.vec3=u);var a={};a.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},a.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.fromValues=function(e,t,r,i){var s=new n(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},a.div=a.divide,a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},a.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},a.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},a.random=function(e,t){return t=t||1,e[0]=r(),e[1]=r(),e[2]=r(),e[3]=r(),a.normalize(e,e),a.scale(e,e,t),e},a.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e},a.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},a.forEach=function(){var e=a.create();return function(t,n,r,i,s,o){var u,a;n||(n=4),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),a.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.vec4=a);var f={};f.create=function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},f.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},f.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},f.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},f.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},f.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},f.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*u+i*f,e[1]=r*a+i*l,e[2]=s*u+o*f,e[3]=s*a+o*l,e},f.mul=f.multiply,f.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=r*-u+i*a,e[2]=s*a+o*u,e[3]=s*-u+o*a,e},f.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];return e[0]=r*u,e[1]=i*a,e[2]=s*u,e[3]=o*a,e},f.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.mat2=f);var l={};l.create=function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},l.clone=function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},l.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},l.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=n*s-r*i;return a?(a=1/a,e[0]=s*a,e[1]=-r*a,e[2]=-i*a,e[3]=n*a,e[4]=(i*u-s*o)*a,e[5]=(r*o-n*u)*a,e):null},l.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},l.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1],c=n[2],h=n[3],p=n[4],d=n[5];return e[0]=r*f+i*c,e[1]=r*l+i*h,e[2]=s*f+o*c,e[3]=s*l+o*h,e[4]=f*u+c*a+p,e[5]=l*u+h*a+d,e},l.mul=l.multiply,l.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*f,e[1]=-r*f+i*l,e[2]=s*l+o*f,e[3]=-s*f+l*o,e[4]=l*u+f*a,e[5]=l*a-f*u,e},l.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=t[0]*r,e[1]=t[1]*i,e[2]=t[2]*r,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*i,e},l.translate=function(e,t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+n[0],e[5]=t[5]+n[1],e},l.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},typeof e!="undefined"&&(e.mat2d=l);var c={};c.create=function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},c.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},c.clone=function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},c.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},c.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*r+i*f)*d,e[2]=(u*r-i*o)*d,e[3]=h*d,e[4]=(l*n-i*a)*d,e[5]=(-u*n+i*s)*d,e[6]=p*d,e[7]=(-f*n+r*a)*d,e[8]=(o*n-r*s)*d,e):null},c.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return e[0]=o*l-u*f,e[1]=i*f-r*l,e[2]=r*u-i*o,e[3]=u*a-s*l,e[4]=n*l-i*a,e[5]=i*s-n*u,e[6]=s*f-o*a,e[7]=r*a-n*f,e[8]=n*o-r*s,e},c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},c.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return e[0]=h*r+p*o+d*f,e[1]=h*i+p*u+d*l,e[2]=h*s+p*a+d*c,e[3]=v*r+m*o+g*f,e[4]=v*i+m*u+g*l,e[5]=v*s+m*a+g*c,e[6]=y*r+b*o+w*f,e[7]=y*i+b*u+w*l,e[8]=y*s+b*a+w*c,e},c.mul=c.multiply,c.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=u,e[5]=a,e[6]=h*r+p*o+f,e[7]=h*i+p*u+l,e[8]=h*s+p*a+c,e},c.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*r+h*o,e[1]=p*i+h*u,e[2]=p*s+h*a,e[3]=p*o-h*r,e[4]=p*u-h*i,e[5]=p*a-h*s,e[6]=f,e[7]=l,e[8]=c,e},c.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},c.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},c.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=r*o,c=r*u,h=i*o,p=i*u,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-c-d,e[3]=l-g,e[6]=h+m,e[1]=l+g,e[4]=1-f-d,e[7]=p-v,e[2]=h-m,e[5]=p+v,e[8]=1-f-c,e},c.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(a*C-o*A-f*N)*O,e[2]=(o*L-u*C+f*T)*O,e[3]=(i*L-r*A-s*k)*O,e[4]=(n*A-i*C+s*N)*O,e[5]=(r*C-n*L-s*T)*O,e[6]=(v*x-m*S+g*E)*O,e[7]=(m*w-d*x-g*b)*O,e[8]=(d*S-v*w+g*y)*O,e):null},c.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},typeof e!="undefined"&&(e.mat3=c);var h={};h.create=function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.clone=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},h.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(i*L-r*A-s*k)*O,e[2]=(v*x-m*S+g*E)*O,e[3]=(h*S-c*x-p*E)*O,e[4]=(a*C-o*A-f*N)*O,e[5]=(n*A-i*C+s*N)*O,e[6]=(m*w-d*x-g*b)*O,e[7]=(l*x-h*w+p*b)*O,e[8]=(o*L-u*C+f*T)*O,e[9]=(r*C-n*L-s*T)*O,e[10]=(d*S-v*w+g*y)*O,e[11]=(c*w-l*S-p*y)*O,e[12]=(u*N-o*k-a*T)*O,e[13]=(n*k-r*N+i*T)*O,e[14]=(v*b-d*E-m*y)*O,e[15]=(l*E-c*b+h*y)*O,e):null},h.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h),e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h)),e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a),e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a)),e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h)),e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h),e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a)),e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a),e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c),e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c)),e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u),e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u)),e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c)),e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c),e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u)),e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u),e},h.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x},h.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=n[0],w=n[1],E=n[2],S=n[3];return e[0]=b*r+w*u+E*c+S*v,e[1]=b*i+w*a+E*h+S*m,e[2]=b*s+w*f+E*p+S*g,e[3]=b*o+w*l+E*d+S*y,b=n[4],w=n[5],E=n[6],S=n[7],e[4]=b*r+w*u+E*c+S*v,e[5]=b*i+w*a+E*h+S*m,e[6]=b*s+w*f+E*p+S*g,e[7]=b*o+w*l+E*d+S*y,b=n[8],w=n[9],E=n[10],S=n[11],e[8]=b*r+w*u+E*c+S*v,e[9]=b*i+w*a+E*h+S*m,e[10]=b*s+w*f+E*p+S*g,e[11]=b*o+w*l+E*d+S*y,b=n[12],w=n[13],E=n[14],S=n[15],e[12]=b*r+w*u+E*c+S*v,e[13]=b*i+w*a+E*h+S*m,e[14]=b*s+w*f+E*p+S*g,e[15]=b*o+w*l+E*d+S*y,e},h.mul=h.multiply,h.translate=function(e,t,n){var r=n[0],i=n[1],s=n[2],o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;return o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],y=t[12],b=t[13],w=t[14],E=t[15],e[0]=o+f*r,e[1]=u+f*i,e[2]=a+f*s,e[3]=f,e[4]=l+p*r,e[5]=c+p*i,e[6]=h+p*s,e[7]=p,e[8]=d+g*r,e[9]=v+g*i,e[10]=m+g*s,e[11]=g,e[12]=y+E*r,e[13]=b+E*i,e[14]=w+E*s,e[15]=E,e},h.scale=function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.rotate=function(e,n,r,i){var s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return Math.abs(a)<t?null:(a=1/a,s*=a,o*=a,u*=a,f=Math.sin(r),l=Math.cos(r),c=1-l,h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11],T=s*s*c+l,N=o*s*c+u*f,C=u*s*c-o*f,k=s*o*c-u*f,L=o*o*c+l,A=u*o*c+s*f,O=s*u*c+o*f,M=o*u*c-s*f,_=u*u*c+l,e[0]=h*T+m*N+w*C,e[1]=p*T+g*N+E*C,e[2]=d*T+y*N+S*C,e[3]=v*T+b*N+x*C,e[4]=h*k+m*L+w*A,e[5]=p*k+g*L+E*A,e[6]=d*k+y*L+S*A,e[7]=v*k+b*L+x*A,e[8]=h*O+m*M+w*_,e[9]=p*O+g*M+E*_,e[10]=d*O+y*M+S*_,e[11]=v*O+b*M+x*_,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},h.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+f*r,e[5]=o*i+l*r,e[6]=u*i+c*r,e[7]=a*i+h*r,e[8]=f*i-s*r,e[9]=l*i-o*r,e[10]=c*i-u*r,e[11]=h*i-a*r,e},h.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-f*r,e[1]=o*i-l*r,e[2]=u*i-c*r,e[3]=a*i-h*r,e[8]=s*r+f*i,e[9]=o*r+l*i,e[10]=u*r+c*i,e[11]=a*r+h*i,e},h.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+f*r,e[1]=o*i+l*r,e[2]=u*i+c*r,e[3]=a*i+h*r,e[4]=f*i-s*r,e[5]=l*i-o*r,e[6]=c*i-u*r,e[7]=h*i-a*r,e},h.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return e[0]=1-(p+v),e[1]=c+y,e[2]=h-g,e[3]=0,e[4]=c-y,e[5]=1-(l+v),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},h.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=r*o,c=r*u,h=i*o,p=i*u,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-c-d,e[1]=l+g,e[2]=h-m,e[3]=0,e[4]=l-g,e[5]=1-f-d,e[6]=p+v,e[7]=0,e[8]=h+m,e[9]=p-v,e[10]=1-f-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},h.frustum=function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);return e[0]=s*2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*a,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*a,e[10]=(o+s)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*f,e[15]=0,e},h.perspective=function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},h.ortho=function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*a,e[14]=(o+s)*f,e[15]=1,e},h.lookAt=function(e,n,r,i){var s,o,u,a,f,l,c,p,d,v,m=n[0],g=n[1],y=n[2],b=i[0],w=i[1],E=i[2],S=r[0],x=r[1],T=r[2];return Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t?h.identity(e):(c=m-S,p=g-x,d=y-T,v=1/Math.sqrt(c*c+p*p+d*d),c*=v,p*=v,d*=v,s=w*d-E*p,o=E*c-b*d,u=b*p-w*c,v=Math.sqrt(s*s+o*o+u*u),v?(v=1/v,s*=v,o*=v,u*=v):(s=0,o=0,u=0),a=p*u-d*o,f=d*s-c*u,l=c*o-p*s,v=Math.sqrt(a*a+f*f+l*l),v?(v=1/v,a*=v,f*=v,l*=v):(a=0,f=0,l=0),e[0]=s,e[1]=a,e[2]=c,e[3]=0,e[4]=o,e[5]=f,e[6]=p,e[7]=0,e[8]=u,e[9]=l,e[10]=d,e[11]=0,e[12]=-(s*m+o*g+u*y),e[13]=-(a*m+f*g+l*y),e[14]=-(c*m+p*g+d*y),e[15]=1,e)},h.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},typeof e!="undefined"&&(e.mat4=h);var p={};p.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},p.rotationTo=function(){var e=u.create(),t=u.fromValues(1,0,0),n=u.fromValues(0,1,0);return function(r,i,s){var o=u.dot(i,s);return o<-0.999999?(u.cross(e,t,i),u.length(e)<1e-6&&u.cross(e,n,i),u.normalize(e,e),p.setAxisAngle(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(u.cross(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,p.normalize(r,r))}}(),p.setAxes=function(){var e=c.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],p.normalize(t,p.fromMat3(t,e))}}(),p.clone=a.clone,p.fromValues=a.fromValues,p.copy=a.copy,p.set=a.set,p.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},p.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},p.add=a.add,p.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},p.mul=p.multiply,p.scale=a.scale,p.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+o*u,e[1]=i*a+s*u,e[2]=s*a-i*u,e[3]=o*a-r*u,e},p.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*u,e[1]=i*a+o*u,e[2]=s*a+r*u,e[3]=o*a-i*u,e},p.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=i*a-r*u,e[2]=s*a+o*u,e[3]=o*a-s*u,e},p.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},p.dot=a.dot,p.lerp=a.lerp,p.slerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=n[3],h,p,d,v,m;return p=i*a+s*f+o*l+u*c,p<0&&(p=-p,a=-a,f=-f,l=-l,c=-c),1-p>1e-6?(h=Math.acos(p),d=Math.sin(h),v=Math.sin((1-r)*h)/d,m=Math.sin(r*h)/d):(v=1-r,m=r),e[0]=v*i+m*a,e[1]=v*s+m*f,e[2]=v*o+m*l,e[3]=v*u+m*c,e},p.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=s*u,e},p.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},p.length=a.length,p.len=p.length,p.squaredLength=a.squaredLength,p.sqrLen=p.squaredLength,p.normalize=a.normalize,p.fromMat3=function(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[7]-t[5])*r,e[1]=(t[2]-t[6])*r,e[2]=(t[3]-t[1])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[i*3+i]-t[s*3+s]-t[o*3+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[o*3+s]-t[s*3+o])*r,e[s]=(t[s*3+i]+t[i*3+s])*r,e[o]=(t[o*3+i]+t[i*3+o])*r}return e},p.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.quat=p)}(t.exports)}(this),define("zrender-x/tool/math",["require","glmatrix"],function(e){function s(e,n){return Math.sin(n?e*t:e)}function o(e,n){return Math.cos(n?e*t:e)}function u(e){return e*t}function a(e){return e/t}function l(e,t,n,r){i.identity(e);if(r&&(r[0]!==1||r[1]!==1)){var s=r[2]||0,o=r[3]||0;if(s||o)f[0]=-s,f[1]=-o,i.translate(e,e,f);i.scale(e,e,r);if(s||o)f[0]=s,f[1]=o,i.translate(e,e,f)}if(n)if(typeof n=="number")i.rotate(e,e,n);else if(n[0]!==0){var s=n[1]||0,o=n[2]||0;if(s||o)f[0]=-s,f[1]=-o,i.translate(e,e,f);i.rotate(e,e,n[0]);if(s||o)f[0]=s,f[1]=o,i.translate(e,e,f)}t&&(t[0]!==0||t[1]!==0)&&i.translate(e,e,t)}var t=Math.PI/180,n=e("glmatrix"),r=n.vec2,i=n.mat2d,f=r.create();return{sin:s,cos:o,degreeToRadian:u,radianToDegree:a,updateTransform:l}}),define("zrender-x/Layer",["require","./tool/util","./tool/log","./config","./tool/math","glmatrix"],function(e){function l(){this.position=o.create(),this.rotation=u.create(),this.scale=a.fromValues(1,1,0,0),this.bundle=null,this.transform=f.create(),this.invTransform=f.create(),this.unusedCount=0,this._config={blending:!0,blendFunc:null,painterType:"normal",panable:!1,zoomable:!1,onpan:null,onzoom:null},this._painterTypeChanged=!1,this.dirty=!0}var t=e("./tool/util"),n=e("./tool/log"),r=e("./config"),i=e("./tool/math"),s=e("glmatrix"),o=s.vec2,u=s.vec3,a=s.vec4,f=s.mat2d;return l.prototype.setConfig=function(e,t){if(e=="painterType"&&this._config[e]!==t){if(t!=="deferred"&&t!=="normal"){console.warn("Unknown painter type "+t);return}this._painterTypeChanged=!0}this._config[e]=t},l.prototype.getConfig=function(e,t){return this._config[e]},l.prototype.isPainterTypeChanged=function(){return this._painterTypeChanged},l.prototype.updateTransform=function(){i.updateTransform(this.transform,this.position,this.rotation,this.scale),f.invert(this.invTransform,this.transform)},l.prototype.clear=function(){this.bundle&&this.bundle.dispose()},l}),define("qtek/math/Matrix2d",["require","glmatrix"],function(e){function r(e){return{configurable:!1,set:function(t){this._array[e]=t,this._dirty=!0},get:function(){return this._array[e]}}}var t=e("glmatrix"),n=t.mat2d,i=function(){this._array=n.create(),this._dirty=!0};return i.prototype={constructor:i,clone:function(){return(new i).copy(this)},copy:function(e){return n.copy(this._array,e._array),this._dirty=!0,this},determinant:function(){return n.determinant(this._array)},identity:function(){return n.identity(this._array),this._dirty=!0,this},invert:function(){return n.invert(this._array,this._array),this._dirty=!0,this},mul:function(e){return n.mul(this._array,this._array,e._array),this._dirty=!0,this},mulLeft:function(e){return n.mul(this._array,e._array,this._array),this._dirty=!0,this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this._dirty=!0,this},multiplyLeft:function(e){return n.multiply(this._array,e._array,this._array),this._dirty=!0,this},rotate:function(e){return n.rotate(this._array,this._array,e),this._dirty=!0,this},scale:function(e){return n.scale(this._array,this._array,e._array),this._dirty=!0,this},translate:function(e){return n.translate(this._array,this._array,e._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},i.copy=function(e,t){return n.copy(e._array,t._array),e._dirty=!0,e},i.determinant=function(e){return n.determinant(e._array)},i.identity=function(e){return n.identity(e._array),e._dirty=!0,e},i.invert=function(e,t){return n.invert(e._array,t._array),e._dirty=!0,e},i.mul=function(e,t,r){return n.mul(e._array,t._array,r._array),e._dirty=!0,e},i.multiply=i.mul,i.rotate=function(e,t,r){return n.rotate(e._array,t._array,r),e._dirty=!0,e},i.scale=function(e,t,r){return n.scale(e._array,t._array,r._array),e._dirty=!0,e},i.translate=function(e,t,r){return n.translate(e._array,t._array,r._array),e._dirty=!0,e},i}),define("qtek/core/mixin/derive",["require"],function(e){function t(e,t,i){typeof t=="object"&&(i=t,t=null);var s=this,o;if(!(e instanceof Function)){o=[];for(var u in e)e.hasOwnProperty(u)&&o.push(u)}var a=function(t){s.apply(this,arguments),e instanceof Function?n(this,e.call(this)):r(this,e,o);if(this.constructor===a){var i=a.__initializers__;for(var u=0;u<i.length;u++)i[u].apply(this,arguments)}};a.__super__=s,s.__initializers__?a.__initializers__=s.__initializers__.slice():a.__initializers__=[],t&&a.__initializers__.push(t);var f=function(){};return f.prototype=s.prototype,a.prototype=new f,a.prototype.constructor=a,n(a.prototype,i),a.derive=s.derive,a}function n(e,t){if(!t)return;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function r(e,t,n){for(var r=0;r<n.length;r++){var i=n[r];e[i]=t[i]}}return{derive:t}}),define("qtek/core/mixin/notifier",[],function(){function e(e,t){this.action=e,this.context=t}var t={trigger:function(e){if(!this.hasOwnProperty("__handlers__"))return;if(!this.__handlers__.hasOwnProperty(e))return;var t=this.__handlers__[e],n=t.length,r=-1,i=arguments;switch(i.length){case 1:while(++r<n)t[r].action.call(t[r].context);return;case 2:while(++r<n)t[r].action.call(t[r].context,i[1]);return;case 3:while(++r<n)t[r].action.call(t[r].context,i[1],i[2]);return;case 4:while(++r<n)t[r].action.call(t[r].context,i[1],i[2],i[3]);return;case 5:while(++r<n)t[r].action.call(t[r].context,i[1],i[2],i[3],i[4]);return;default:while(++r<n)t[r].action.apply(t[r].context,Array.prototype.slice.call(i,1));return}},on:function(t,n,r){if(!t||!n)return;var i=this.__handlers__||(this.__handlers__={});if(!i[t])i[t]=[];else if(this.has(t,n))return;var s=new e(n,r||this);return i[t].push(s),this},once:function(e,t,n){function i(){r.off(e,i),t.apply(this,arguments)}if(!e||!t)return;var r=this;return this.on(e,i,n)},before:function(e,t,n){if(!e||!t)return;return e="before"+e,this.on(e,t,n)},after:function(e,t,n){if(!e||!t)return;return e="after"+e,this.on(e,t,n)},success:function(e,t){return this.once("success",e,t)},error:function(e,t){return this.once("error",e,t)},off:function(e,t){var n=this.__handlers__||(this.__handlers__={});if(!t){n[e]=[];return}if(n[e]){var r=n[e],i=[];for(var s=0;s<r.length;s++)t&&r[s].action!==t&&i.push(r[s]);n[e]=i}return this},has:function(e,t){var n=this.__handlers__;if(!n||!n[e])return!1;var r=n[e];for(var i=0;i<r.length;i++)if(r[i].action===t)return!0}};return t}),define("qtek/core/util",["require"],function(e){var t=0,n={genGUID:function(){return++t},relative2absolute:function(e,t){if(!t||e.match(/^\//))return e;var n=e.split("/"),r=t.split("/"),i=n[0];while(i==="."||i==="..")i===".."&&r.pop(),n.shift(),i=n[0];return r.join("/")+"/"+n.join("/")},extend:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},defaults:function(e,t){if(t)for(var n in t)e[n]===undefined&&(e[n]=t[n]);return e},extendWithPropList:function(e,t,n){if(t)for(var r=0;r<n.length;r++){var i=n[r];e[i]=t[i]}return e},defaultsWithPropList:function(e,t,n){if(t)for(var r=0;r<n.length;r++){var i=n[r];e[i]===undefined&&(e[i]=t[i])}return e},each:function(e,t,n){if(!e||!t)return;if(e.forEach)e.forEach(t,n);else if(e.length===+e.length)for(var r=0,i=e.length;r<i;r++)t.call(n,e[r],r,e);else for(var s in e)e.hasOwnProperty(s)&&t.call(n,e[s],s,e)},isObject:function(e){return e===Object(e)},isArray:function(e){return e instanceof Array},isArrayLike:function(e){return e?e.length===+e.length:!1},clone:function(e){if(!n.isObject(e))return e;if(n.isArray(e))return e.slice();if(n.isArrayLike(e)){var t=new e.constructor(e.length);for(var r=0;r<e.length;r++)t[r]=e[r];return t}return n.extend({},e)}};return n}),define("qtek/core/Base",["require","./mixin/derive","./mixin/notifier","./util"],function(e){var t=e("./mixin/derive"),n=e("./mixin/notifier"),r=e("./util"),i=function(){this.__GUID__=r.genGUID()};return i.__initializers__=[function(e){r.extend(this,e)}],r.extend(i,t),r.extend(i.prototype,n),i}),define("qtek/core/glenum",[],function(){return{DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444}}),define("qtek/core/Cache",[],function(){var e=function(){this._contextId=0,this._caches=[],this._context={}};return e.prototype={use:function(e,t){this._caches[e]||(this._caches[e]={},t&&(this._caches[e]=t())),this._contextId=e,this._context=this._caches[e]},put:function(e,t){this._context[e]=t},get:function(e){return this._context[e]},dirty:function(e){e=e||"";var t="__dirty__"+e;this.put(t,!0)},dirtyAll:function(e){e=e||"";var t="__dirty__"+e;for(var n=0;n<this._caches.length;n++)this._caches[n]&&(this._caches[n][t]=!0)},fresh:function(e){e=e||"";var t="__dirty__"+e;this.put(t,!1)},freshAll:function(e){e=e||"";var t="__dirty__"+e;for(var n=0;n<this._caches.length;n++)this._caches[n]&&(this._caches[n][t]=!1)},isDirty:function(e){e=e||"";var t="__dirty__"+e;return!this._context.hasOwnProperty(t)||this._context[t]===!0},deleteContext:function(e){delete this._caches[e],this._context={}},"delete":function(e){delete this._context[e]},clearAll:function(){this._caches={}},getContext:function(){return this._context},miss:function(e){return!this._context.hasOwnProperty(e)}},e.prototype.constructor=e,e}),define("qtek/Texture",["require","./core/Base","./core/glenum","./core/Cache"],function(e){var t=e("./core/Base"),n=e("./core/glenum"),r=e("./core/Cache"),i=t.derive({width:512,height:512,type:n.UNSIGNED_BYTE,format:n.RGBA,wrapS:n.CLAMP_TO_EDGE,wrapT:n.CLAMP_TO_EDGE,minFilter:n.LINEAR_MIPMAP_LINEAR,magFilter:n.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1},function(){this._cache=new r},{getWebGLTexture:function(e){return this._cache.use(e.__GLID__),this._cache.miss("webgl_texture")&&this._cache.put("webgl_texture",e.createTexture()),this.dynamic?this.update(e):this._cache.isDirty()&&(this.update(e),this._cache.fresh()),this._cache.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){this._cache.dirtyAll()},update:function(e){},beforeUpdate:function(e){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment),this.fallBack()},fallBack:function(){var e=this.isPowerOfTwo();this.format===n.DEPTH_COMPONENT&&(this.useMipmap=!1);if(!e||!this.useMipmap){this.NPOT=!0,this._minFilterOriginal=this.minFilter,this._magFilterOriginal=this.magFilter,this._wrapSOriginal=this.wrapS,this._wrapTOriginal=this.wrapT;if(this.minFilter==n.NEAREST_MIPMAP_NEAREST||this.minFilter==n.NEAREST_MIPMAP_LINEAR)this.minFilter=n.NEAREST;else if(this.minFilter==n.LINEAR_MIPMAP_LINEAR||this.minFilter==n.LINEAR_MIPMAP_NEAREST)this.minFilter=n.LINEAR;this.wrapS=n.CLAMP_TO_EDGE,this.wrapT=n.CLAMP_TO_EDGE}else this._minFilterOriginal&&(this.minFilter=this._minFilterOriginal),this._magFilterOriginal&&(this.magFilter=this._magFilterOriginal),this._wrapSOriginal&&(this.wrapS=this._wrapSOriginal),this._wrapTOriginal&&(this.wrapT=this._wrapTOriginal)},nextHighestPowerOfTwo:function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},dispose:function(e){this._cache.use(e.__GLID__),this._cache.get("webgl_texture")&&e.deleteTexture(this._cache.get("webgl_texture")),this._cache.deleteContext(e.__GLID__)},isRenderable:function(){},isPowerOfTwo:function(){}});return i.BYTE=n.BYTE,i.UNSIGNED_BYTE=n.UNSIGNED_BYTE,i.SHORT=n.SHORT,i.UNSIGNED_SHORT=n.UNSIGNED_SHORT,i.INT=n.INT,i.UNSIGNED_INT=n.UNSIGNED_INT,i.FLOAT=n.FLOAT,i.HALF_FLOAT=36193,i.DEPTH_COMPONENT=n.DEPTH_COMPONENT,i.ALPHA=n.ALPHA,i.RGB=n.RGB,i.RGBA=n.RGBA,i.LUMINANCE=n.LUMINANCE,i.LUMINANCE_ALPHA=n.LUMINANCE_ALPHA,i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,i.NEAREST=n.NEAREST,i.LINEAR=n.LINEAR,i.NEAREST_MIPMAP_NEAREST=n.NEAREST_MIPMAP_NEAREST,i.LINEAR_MIPMAP_NEAREST=n.LINEAR_MIPMAP_NEAREST,i.NEAREST_MIPMAP_LINEAR=n.NEAREST_MIPMAP_LINEAR,i.LINEAR_MIPMAP_LINEAR=n.LINEAR_MIPMAP_LINEAR,i.TEXTURE_MAG_FILTER=n.TEXTURE_MAG_FILTER,i.TEXTURE_MIN_FILTER=n.TEXTURE_MIN_FILTER,i.REPEAT=n.REPEAT,i.CLAMP_TO_EDGE=n.CLAMP_TO_EDGE,i.MIRRORED_REPEAT=n.MIRRORED_REPEAT,i}),define("qtek/core/glinfo",[],function(){var e=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","WEBGL_draw_buffers"],t={},n={initialize:function(n){if(t[n.__GLID__])return;t[n.__GLID__]={};for(var r=0;r<e.length;r++){var i=e[r];this._createExtension(n,i)}},getExtension:function(e,n){var r=e.__GLID__;if(t[r])return typeof t[r][n]=="undefined"&&this._createExtension(e,n),t[r][n]},dispose:function(e){delete t[e.__GLID__]},_createExtension:function(e,n){var r=e.getExtension(n);r||(r=e.getExtension("MOZ_"+n)),r||(r=e.getExtension("WEBKIT_"+n)),t[e.__GLID__][n]=r}};return n}),define("qtek/math/Vector3",["require","glmatrix"],function(e){var t=e("glmatrix"),n=t.vec3,r=function(e,t,r){e=e||0,t=t||0,r=r||0,this._array=n.fromValues(e,t,r),this._dirty=!0};return r.prototype={constructor:r,get x(){return this._array[0]},set x(e){this._array[0]=e,this._dirty=!0},get y(){return this._array[1]},set y(e){this._array[1]=e,this._dirty=!0},get z(){return this._array[2]},set z(e){this._array[2]=e,this._dirty=!0},add:function(e){return n.add(this._array,this._array,e._array),this._dirty=!0,this},set:function(e,t,n){return this._array[0]=e,this._array[1]=t,this._array[2]=n,this._dirty=!0,this},setArray:function(e){return this._array[0]=e[0],this._array[1]=e[1],this._array[2]=e[2],this._dirty=!0,this},clone:function(){return new r(this.x,this.y,this.z)},copy:function(e){return n.copy(this._array,e._array),this._dirty=!0,this},cross:function(e,t){return n.cross(e._array,this._array,t._array),e._dirty=!0,this},dist:function(e){return n.dist(this._array,e._array)},distance:function(e){return n.distance(this._array,e._array)},div:function(e){return n.div(this._array,this._array,e._array),this._dirty=!0,this},divide:function(e){return n.divide(this._array,this._array,e._array),this._dirty=!0,this},dot:function(e){return n.dot(this._array,e._array)},len:function(){return n.len(this._array)},length:function(){return n.length(this._array)},lerp:function(e,t,r){return n.lerp(this._array,e._array,t._array,r),this._dirty=!0,this},min:function(e){return n.min(this._array,this._array,e._array),this._dirty=!0,this},max:function(e){return n.max(this._array,this._array,e._array),this._dirty=!0,this},mul:function(e){return n.mul(this._array,this._array,e._array),this._dirty=!0,this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this._dirty=!0,this},negate:function(){return n.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return n.normalize(this._array,this._array),this._dirty=!0,this},random:function(e){return n.random(this._array,e),this._dirty=!0,this},scale:function(e){return n.scale(this._array,this._array,e),this._dirty=!0,this},scaleAndAdd:function(e,t){return n.scaleAndAdd(this._array,this._array,e._array,t),this._dirty=!0,this},sqrDist:function(e){return n.sqrDist(this._array,e._array)},squaredDistance:function(e){return n.squaredDistance(this._array,e._array)},sqrLen:function(){return n.sqrLen(this._array)},squaredLength:function(){return n.squaredLength(this._array)},sub:function(e){return n.sub(this._array,this._array,e._array),this._dirty=!0,this},subtract:function(e){return n.subtract(this._array,this._array,e._array),this._dirty=!0,this},transformMat3:function(e){return n.transformMat3(this._array,this._array,e._array),this._dirty=!0,this},transformMat4:function(e){return n.transformMat4(this._array,this._array,e._array),this._dirty=!0,this},transformQuat:function(e){return n.transformQuat(this._array,this._array,e._array),this._dirty=!0,this},applyProjection:function(e){var t=this._array;e=e._array;if(e[15]===0){var n=-1/t[2];t[0]=e[0]*t[0]*n,t[1]=e[5]*t[1]*n,t[2]=(e[10]*t[2]+e[14])*n}else t[0]=e[0]*t[0]+e[12],t[1]=e[5]*t[1]+e[13],t[2]=e[10]*t[2]+e[14];return this._dirty=!0,this},setEulerFromQuaternion:function(e){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},r.add=function(e,t,r){return n.add(e._array,t._array,r._array),e._dirty=!0,e},r.set=function(e,t,r,i){n.set(e._array,t,r,i),e._dirty=!0},r.copy=function(e,t){return n.copy(e._array,t._array),e._dirty=!0,e},r.cross=function(e,t,r){return n.cross(e._array,t._array,r._array),e._dirty=!0,e},r.dist=function(e,t){return n.distance(e._array,t._array)},r.distance=r.dist,r.div=function(e,t,r){return n.divide(e._array,t._array,r._array),e._dirty=!0,e},r.divide=r.div,r.dot=function(e,t){return n.dot(e._array,t._array)},r.len=function(e){return n.length(e._array)},r.lerp=function(e,t,r,i){return n.lerp(e._array,t._array,r._array,i),e._dirty=!0,e},r.min=function(e,t,r){return n.min(e._array,t._array,r._array),e._dirty=!0,e},r.max=function(e,t,r){return n.max(e._array,t._array,r._array),e._dirty=!0,e},r.mul=function(e,t,r){return n.multiply(e._array,t._array,r._array),e._dirty=!0,e},r.multiply=r.mul,r.negate=function(e,t){return n.negate(e._array,t._array),e._dirty=!0,e},r.normalize=function(e,t){return n.normalize(e._array,t._array),e._dirty=!0,e},r.random=function(e,t){return n.random(e._array,t),e._dirty=!0,e},r.scale=function(e,t,r){return n.scale(e._array,t._array,r),e._dirty=!0,e},r.scaleAndAdd=function(e,t,r,i){return n.scaleAndAdd(e._array,t._array,r._array,i),e._dirty=!0,e},r.sqrDist=function(e,t){return n.sqrDist(e._array,t._array)},r.squaredDistance=r.sqrDist,r.sqrLen=function(e){return n.sqrLen(e._array)},r.squaredLength=r.sqrLen,r.sub=function(e,t,r){return n.subtract(e._array,t._array,r._array),e._dirty=!0,e},r.subtract=r.sub,r.transformMat3=function(e,t,r){return n.transformMat3(e._array,t._array,r._array),e._dirty=!0,e},r.transformMat4=function(e,t,r){return n.transformMat4(e._array,t._array,r._array),e._dirty=!0,e},r.transformQuat=function(e,t,r){return n.transformQuat(e._array,t._array,r._array),e._dirty=!0,e},r.POSITIVE_X=new r(1,0,0),r.NEGATIVE_X=new r(-1,0,0),r.POSITIVE_Y=new r(0,1,0),r.NEGATIVE_Y=new r(0,-1,0),r.POSITIVE_Z=new r(0,0,1),r.NEGATIVE_Z=new r(0,0,-1),r.UP=new r(0,1,0),r.ZERO=new r(0,0,0),r}),define("qtek/math/BoundingBox",["require","./Vector3","glmatrix"],function(e){var t=e("./Vector3"),n=e("glmatrix"),r=n.vec3,i=r.transformMat4,s=r.copy,o=r.set,u=function(e,n){this.min=e||new t(Infinity,Infinity,Infinity),this.max=n||new t(-Infinity,-Infinity,-Infinity);var i=[];for(var s=0;s<8;s++)i[s]=r.fromValues(0,0,0);this.vertices=i};return u.prototype={constructor:u,updateFromVertices:function(e){if(e.length>0){var t=this.min._array,n=this.max._array;s(t,e[0]),s(n,e[0]);for(var r=1;r<e.length;r++){var i=e[r];t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.min(i[2],t[2]),n[0]=Math.max(i[0],n[0]),n[1]=Math.max(i[1],n[1]),n[2]=Math.max(i[2],n[2])}this.min._dirty=!0,this.max._dirty=!0}},union:function(e){r.min(this.min._array,this.min._array,e.min._array),r.max(this.max._array,this.max._array,e.max._array),this.min._dirty=!0,this.max._dirty=!0},intersectBoundingBox:function(e){var t=this.min._array,n=this.max._array,r=e.min._array,i=e.max._array;return!(t[0]>i[0]||t[1]>i[1]||t[2]>i[1]||n[0]<r[0]||n[1]<r[1]||n[2]<r[2])},applyTransform:function(e){if(this.min._dirty||this.max._dirty)this.updateVertices(),this.min._dirty=!1,this.max._dirty=!1;var t=e._array,n=this.min._array,r=this.max._array,o=this.vertices,u=o[0];i(u,u,t),s(n,u),s(r,u);for(var a=1;a<8;a++)u=o[a],i(u,u,t),n[0]=Math.min(u[0],n[0]),n[1]=Math.min(u[1],n[1]),n[2]=Math.min(u[2],n[2]),r[0]=Math.max(u[0],r[0]),r[1]=Math.max(u[1],r[1]),r[2]=Math.max(u[2],r[2]);this.min._dirty=!0,this.max._dirty=!0},applyProjection:function(e){if(this.min._dirty||this.max._dirty)this.updateVertices(),this.min._dirty=!1,this.max._dirty=!1;var t=e._array,n=this.vertices[0],r=this.vertices[3],i=this.vertices[7],s=this.min._array,o=this.max._array;if(t[15]===1)s[0]=t[0]*n[0]+t[12],s[1]=t[5]*n[1]+t[13],o[2]=t[10]*n[2]+t[14],o[0]=t[0]*i[0]+t[12],o[1]=t[5]*i[1]+t[13],s[2]=t[10]*i[2]+t[14];else{var u=-1/n[2];s[0]=t[0]*n[0]*u,s[1]=t[5]*n[1]*u,o[2]=(t[10]*n[2]+t[14])*u,u=-1/r[2],o[0]=t[0]*r[0]*u,o[1]=t[5]*r[1]*u,u=-1/i[2],s[2]=(t[10]*i[2]+t[14])*u}this.min._dirty=!0,this.max._dirty=!0},updateVertices:function(){var e=this.min._array,t=this.max._array,n=this.vertices;o(n[0],e[0],e[1],e[2]),o(n[1],e[0],t[1],e[2]),o(n[2],t[0],e[1],e[2]),o(n[3],t[0],t[1],e[2]),o(n[4],e[0],e[1],t[2]),o(n[5],e[0],t[1],t[2]),o(n[6],t[0],e[1],t[2]),o(n[7],t[0],t[1],t[2])},copy:function(e){s(this.min._array,e.min._array),s(this.max._array,e.max._array),this.min._dirty=!0,this.max._dirty=!0},clone:function(){var e=new u;return e.copy(this),e}},u}),define("qtek/math/Matrix4",["require","glmatrix","./Vector3"],function(e){function u(e){return{set:function(t){this._array[e]=t,this._dirty=!0},get:function(){return this._array[e]}}}var t=e("glmatrix"),n=e("./Vector3"),r=t.mat4,i=t.vec3,s=t.mat3,o=t.quat,a=function(){this._axisX=new n,this._axisY=new n,this._axisZ=new n,this._array=r.create(),this._dirty=!0};return a.prototype={constructor:a,get forward(){var e=this._array;return this._axisZ.set(e[8],e[9],e[10]),this._axisZ},set forward(e){var t=this._array;e=e._array,t[8]=e[0],t[9]=e[1],t[10]=e[2],this._dirty=!0},get up(){var e=this._array;return this._axisY.set(e[4],e[5],e[6]),this._axisY},set up(e){var t=this._array;e=e._array,t[4]=e[0],t[5]=e[1],t[6]=e[2],this._dirty=!0},get right(){var e=this._array;return this._axisX.set(e[0],e[1],e[2]),this._axisX},set right(e){var t=this._array;e=e._array,t[0]=e[0],t[1]=e[1],t[2]=e[2],this._dirty=!0},adjoint:function(){return r.adjoint(this._array,this._array),this._dirty=!0,this},clone:function(){return(new a).copy(this)},copy:function(e){return r.copy(this._array,e._array),this._dirty=!0,this},determinant:function(){return r.determinant(this._array)},fromQuat:function(e){return r.fromQuat(this._array,e._array),this._dirty=!0,this},fromRotationTranslation:function(e,t){return r.fromRotationTranslation(this._array,e._array,t._array),this._dirty=!0,this},fromMat2d:function(e){return a.fromMat2d(this,e),this},frustum:function(e,t,n,i,s,o){return r.frustum(this._array,e,t,n,i,s,o),this._dirty=!0,this},identity:function(){return r.identity(this._array),this._dirty=!0,this},invert:function(){return r.invert(this._array,this._array),this._dirty=!0,this},lookAt:function(e,t,n){return r.lookAt(this._array,e._array,t._array,n._array),this._dirty=!0,this},mul:function(e){return r.mul(this._array,this._array,e._array),this._dirty=!0,this},mulLeft:function(e){return r.mul(this._array,e._array,this._array),this._dirty=!0,this},multiply:function(e){return r.multiply(this._array,this._array,e._array),this._dirty=!0,this},multiplyLeft:function(e){return r.multiply(this._array,e._array,this._array),this._dirty=!0,this},ortho:function(e,t,n,i,s,o){return r.ortho(this._array,e,t,n,i,s,o),this._dirty=!0,this},perspective:function(e,t,n,i){return r.perspective(this._array,e,t,n,i),this._dirty=!0,this},rotate:function(e,t){return r.rotate(this._array,this._array,e,t._array),this._dirty=!0,this},rotateX:function(e){return r.rotateX(this._array,this._array,e),this._dirty=!0,this},rotateY:function(e){return r.rotateY(this._array,this._array,e),this._dirty=!0,this},rotateZ:function(e){return r.rotateZ(this._array,this._array,e),this._dirty=!0,this},scale:function(e){return r.scale(this._array,this._array,e._array),this._dirty=!0,this},translate:function(e){return r.translate(this._array,this._array,e._array),this._dirty=!0,this},transpose:function(){return r.transpose(this._array,this._array),this._dirty=!0,this},decomposeMatrix:function(){var e=i.create(),t=i.create(),n=i.create(),r=s.create();return function(u,a,f){var l=this._array;i.set(e,l[0],l[1],l[2]),i.set(t,l[4],l[5],l[6]),i.set(n,l[8],l[9],l[10]),u.x=i.length(e),u.y=i.length(t),u.z=i.length(n),f.set(l[12],l[13],l[14]),s.fromMat4(r,l),s.transpose(r,r),r[0]/=u.x,r[1]/=u.x,r[2]/=u.x,r[3]/=u.y,r[4]/=u.y,r[5]/=u.y,r[6]/=u.z,r[7]/=u.z,r[8]/=u.z,o.fromMat3(a._array,r),o.normalize(a._array,a._array),u._dirty=!0,a._dirty=!0,f._dirty=!0}}(),toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},a.adjoint=function(e,t){return r.adjoint(e._array,t._array),e._dirty=!0,e},a.copy=function(e,t){return r.copy(e._array,t._array),e._dirty=!0,e},a.determinant=function(e){return r.determinant(e._array)},a.identity=function(e){return r.identity(e._array),e._dirty=!0,e},a.ortho=function(e,t,n,i,s,o,u){return r.ortho(e._array,t,n,i,s,o,u),e._dirty=!0,e},a.perspective=function(e,t,n,i,s){return r.perspective(e._array,t,n,i,s),e._dirty=!0,e},a.lookAt=function(e,t,n,i){return r.lookAt(e._array,t._array,n._array,i._array),e._dirty=!0,e},a.invert=function(e,t){return r.invert(e._array,t._array),e._dirty=!0,e},a.mul=function(e,t,n){return r.mul(e._array,t._array,n._array),e._dirty=!0,e},a.multiply=a.mul,a.fromQuat=function(e,t){return r.fromQuat(e._array,t._array),e._dirty=!0,e},a.fromRotationTranslation=function(e,t,n){return r.fromRotationTranslation(e._array,t._array,n._array),e._dirty=!0,e},a.fromMat2d=function(e,t){e._dirty=!0;var t=t._array,e=e._array;return e[0]=t[0],e[4]=t[2],e[12]=t[4],e[1]=t[1],e[5]=t[3],e[13]=t[5],e},a.rotate=function(e,t,n,i){return r.rotate(e._array,t._array,n,i._array),e._dirty=!0,e},a.rotateX=function(e,t,n){return r.rotateX(e._array,t._array,n),e._dirty=!0,e},a.rotateY=function(e,t,n){return r.rotateY(e._array,t._array,n),e._dirty=!0,e},a.rotateZ=function(e,t,n){return r.rotateZ(e._array,t._array,n),e._dirty=!0,e},a.scale=function(e,t,n){return r.scale(e._array,t._array,n._array),e._dirty=!0,e},a.transpose=function(e,t){return r.transpose(e._array,t._array),e._dirty=!0,e},a.translate=function(e,t,n){return r.translate(e._array,t._array,n._array),e._dirty=!0,e},a}),define("qtek/Shader",["require","./core/Base","./core/util","./core/Cache","glmatrix"],function(e){function w(){return{locations:{},attriblocations:{}}}function E(e){var t=e.split("\n");for(var n=0,r=t.length;n<r;n++)t[n]=n+1+": "+t[n];return t.join("\n")}var t=e("./core/Base"),n=e("./core/util"),r=e("./core/Cache"),i=e("glmatrix"),s=i.mat2,o=i.mat3,u=i.mat4,a=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\w\,]+)?(\[.*?\])?\s*(:\s*([\S\s]+?))?;/g,f=/attribute\s+(float|int|vec2|vec3|vec4)\s+(\w*)\s*(:\s*(\w+))?;/g,l=/#define\s+(\w+)?(\s+[\w-.]+)?\s*\n/g,c={bool:"1i","int":"1i",sampler2D:"t",samplerCube:"t","float":"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"},h={bool:function(){return!0},"int":function(){return 0},"float":function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return[0,0]},vec3:function(){return[0,0,0]},vec4:function(){return[0,0,0,0]},ivec2:function(){return[0,0]},ivec3:function(){return[0,0,0]},ivec4:function(){return[0,0,0,0]},mat2:function(){return s.create()},mat3:function(){return o.create()},mat4:function(){return u.create()},array:function(){return[]}},p=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT","SKIN_MATRIX"],d=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],v={},m=1,g=2,y=3,b=t.derive(function(){return{vertex:"",fragment:"",precision:"mediump",attribSemantics:{},matrixSemantics:{},matrixSemanticKeys:[],uniformTemplates:{},attributeTemplates:{},vertexDefines:{},fragmentDefines:{},lightNumber:{},_uniformList:[],_textureStatus:{},_vertexProcessed:"",_fragmentProcessed:"",_currentLocationsMap:{}}},function(){this._cache=new r,this._updateShaderString()},{setVertex:function(e){this.vertex=e,this._updateShaderString(),this.dirty()},setFragment:function(e){this.fragment=e,this._updateShaderString(),this.dirty()},bind:function(e){this._cache.use(e.__GLID__,w),this._currentLocationsMap=this._cache.get("locations");if(this._cache.isDirty()){this._updateShaderString();var t=this._buildProgram(e,this._vertexProcessed,this._fragmentProcessed);this._cache.fresh();if(t)return t}e.useProgram(this._cache.get("program"))},dirty:function(){this._cache.dirtyAll();for(var e=0;e<this._cache._caches.length;e++)if(this._cache._caches[e]){var t=this._cache._caches[e];t.locations={},t.attriblocations={}}},_updateShaderString:function(){if(this.vertex!==this._vertexPrev||this.fragment!==this._fragmentPrev)this._parseImport(),this.attribSemantics={},this.matrixSemantics={},this._textureStatus={},this._parseUniforms(),this._parseAttributes(),this._parseDefines(),this._vertexPrev=this.vertex,this._fragmentPrev=this.fragment;this._addDefine()},define:function(e,t,n){n=n!==undefined?n:null,(e=="vertex"||e=="both")&&this.vertexDefines[t]!==n&&(this.vertexDefines[t]=n,this.dirty()),(e=="fragment"||e=="both")&&this.fragmentDefines[t]!==n&&(this.fragmentDefines[t]=n,e!=="both"&&this.dirty())},unDefine:function(e,t){(e=="vertex"||e=="both")&&this.isDefined("vertex",t)&&(delete this.vertexDefines[t],this.dirty()),(e=="fragment"||e=="both")&&this.isDefined("fragment",t)&&(delete this.fragmentDefines[t],e!=="both"&&this.dirty())},isDefined:function(e,t){switch(e){case"vertex":return this.vertexDefines[t]!==undefined;case"fragment":return this.fragmentDefines[t]!==undefined}},getDefine:function(e,t){switch(e){case"vertex":return this.vertexDefines[t];case"fragment":return this.fragmentDefines[t]}},enableTexture:function(e){var t=this._textureStatus[e];if(t){var n=t.enabled;n||(t.enabled=!0,this.dirty())}},enableTexturesAll:function(){for(var e in this._textureStatus)this._textureStatus[e].enabled=!0;this.dirty()},disableTexture:function(e){var t=this._textureStatus[e];if(t){var n=!t.enabled;n||(t.enabled=!1,this.dirty())}},disableTexturesAll:function(){for(var e in this._textureStatus)this._textureStatus[e].enabled=!1;this.dirty()},isTextureEnabled:function(e){return this._textureStatus[e].enabled},hasUniform:function(e){var t=this._currentLocationsMap[e];return t!==null&&t!==undefined},setUniform:function(e,t,n,r){var i=this._currentLocationsMap,s=i[n];if(s===null||s===undefined)return!1;switch(t){case"m4":e.uniformMatrix4fv(s,!1,r);break;case"2i":e.uniform2i(s,r[0],r[1]);break;case"2f":e.uniform2f(s,r[0],r[1]);break;case"3i":e.uniform3i(s,r[0],r[1],r[2]);break;case"3f":e.uniform3f(s,r[0],r[1],r[2]);break;case"4i":e.uniform4i(s,r[0],r[1],r[2],r[3]);break;case"4f":e.uniform4f(s,r[0],r[1],r[2],r[3]);break;case"1i":e.uniform1i(s,r);break;case"1f":e.uniform1f(s,r);break;case"1fv":e.uniform1fv(s,r);break;case"1iv":e.uniform1iv(s,r);break;case"2iv":e.uniform2iv(s,r);break;case"2fv":e.uniform2fv(s,r);break;case"3iv":e.uniform3iv(s,r);break;case"3fv":e.uniform3fv(s,r);break;case"4iv":e.uniform4iv(s,r);break;case"4fv":e.uniform4fv(s,r);break;case"m2":case"m2v":e.uniformMatrix2fv(s,!1,r);break;case"m3":case"m3v":e.uniformMatrix3fv(s,!1,r);break;case"m4v":if(r instanceof Array){var o=new Float32Array(r.length*16),u=0;for(var a=0;a<r.length;a++){var f=r[a];for(var l=0;l<16;l++)o[u++]=f[l]}e.uniformMatrix4fv(s,!1,o)}else r instanceof Float32Array&&e.uniformMatrix4fv(s,!1,r)}return!0},setUniformBySemantic:function(e,t,n){var r=this.attribSemantics[t];return r?this.setUniform(e,r.type,r.symbol,n):!1},enableAttributes:function(e,t){var n=this._cache.get("program"),r=this._cache.get("attriblocations"),i=v[e.__GLID__];i||(i=v[e.__GLID__]=[]);var s=[];for(var o=0;o<t.length;o++){var u=t[o];if(!this.attributeTemplates[u]){s[o]=-1;continue}var a=r[u];if(a===undefined){a=e.getAttribLocation(n,u);if(a===-1){s[o]=-1;continue}r[u]=a}s[o]=a,i[a]?i[a]=g:i[a]=m}for(var o=0;o<i.length;o++)switch(i[o]){case m:e.enableVertexAttribArray(o),i[o]=y;break;case g:i[o]=y;break;case y:e.disableVertexAttribArray(o),i[o]=0}return s},_parseImport:function(){this._vertexProcessedWithoutDefine=b.parseImport(this.vertex),this._fragmentProcessedWithoutDefine=b.parseImport(this.fragment)},_addDefine:function(){var e=[];for(var t in this.lightNumber){var n=this.lightNumber[t];n>0&&e.push("#define "+t.toUpperCase()+"_NUMBER "+n)}for(var r in this._textureStatus){var i=this._textureStatus[r];i.enabled&&e.push("#define "+r.toUpperCase()+"_ENABLED")}for(var r in this.vertexDefines){var s=this.vertexDefines[r];s===null?e.push("#define "+r):e.push("#define "+r+" "+s.toString())}this._vertexProcessed=e.join("\n")+"\n"+this._vertexProcessedWithoutDefine,e=[];for(var t in this.lightNumber){var n=this.lightNumber[t];n>0&&e.push("#define "+t.toUpperCase()+"_NUMBER "+n)}for(var r in this._textureStatus){var i=this._textureStatus[r];i.enabled&&e.push("#define "+r.toUpperCase()+"_ENABLED")}for(var r in this.fragmentDefines){var s=this.fragmentDefines[r];s===null?e.push("#define "+r):e.push("#define "+r+" "+s.toString())}var o=e.join("\n")+"\n"+this._fragmentProcessedWithoutDefine;this._fragmentProcessed=["precision",this.precision,"float"].join(" ")+";\n"+o},_parseUniforms:function(){function r(r,i,s,o,u,a){if(i&&s){var f=c[i],l=!0,v;if(f){t._uniformList.push(s);if(i==="sampler2D"||i==="samplerCube")t._textureStatus[s]={enabled:!1,shaderType:n};o&&(f+="v");if(a)if(p.indexOf(a)>=0)t.attribSemantics[a]={symbol:s,type:f},l=!1;else if(d.indexOf(a)>=0){var m=!1,g=a;a.match(/TRANSPOSE$/)&&(m=!0,g=a.slice(0,-9)),t.matrixSemantics[a]={symbol:s,type:f,isTranspose:m,semanticNoTranspose:g},l=!1}else if(a==="unconfigurable")l=!1;else{v=t._parseDefaultValue(i,a);if(!v)throw new Error('Unkown semantic "'+a+'"');a=""}l&&(e[s]={type:f,value:o?h.array:v||h[i],semantic:a||null})}return["uniform",i,s,o].join(" ")+";\n"}}var e={},t=this,n="vertex";this._uniformList=[],this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(a,r),n="fragment",this._fragmentProcessedWithoutDefine=this._fragmentProcessedWithoutDefine.replace(a,r),t.matrixSemanticKeys=Object.keys(this.matrixSemantics),this.uniformTemplates=e},_parseDefaultValue:function(e,t){var n=/\[\s*(.*)\s*\]/;if(e==="vec2"||e==="vec3"||e==="vec4"){var r=n.exec(t)[1];if(r){var i=r.split(/\s*,\s*/);return function(){return new Float32Array(i)}}return}if(e==="bool")return function(){return t.toLowerCase()==="true"?!0:!1};if(e==="float")return function(){return parseFloat(t)}},createUniforms:function(){var e={};for(var t in this.uniformTemplates){var n=this.uniformTemplates[t];e[t]={type:n.type,value:n.value()}}return e},_parseAttributes:function(){function n(n,r,i,s,o){if(r&&i){var u=1;switch(r){case"vec4":u=4;break;case"vec3":u=3;break;case"vec2":u=2;break;case"float":u=1}e[i]={type:"float",size:u,semantic:o||null};if(o){if(p.indexOf(o)<0)throw new Error('Unkown semantic "'+o+'"');t.attribSemantics[o]={symbol:i,type:r}}}return["attribute",r,i].join(" ")+";\n"}var e={},t=this;this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(f,n),this.attributeTemplates=e},_parseDefines:function(){function n(n,r,i){var s=t==="vertex"?e.vertexDefines:e.fragmentDefines;return s[r]||(i=="false"?s[r]=!1:i=="true"?s[r]=!0:s[r]=i?parseFloat(i):null),""}var e=this,t="vertex";this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(l,n),t="fragment",this._fragmentProcessedWithoutDefine=this._fragmentProcessedWithoutDefine.replace(l,n)},_buildProgram:function(e,t,n){this._cache.get("program")&&e.deleteProgram(this._cache.get("program"));var r=e.createProgram(),i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i);var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,n),e.compileShader(s);var o=this._checkShaderErrorMsg(e,i,t);if(o)return o;o=this._checkShaderErrorMsg(e,s,n);if(o)return o;e.attachShader(r,i),e.attachShader(r,s),this.attribSemantics.POSITION&&e.bindAttribLocation(r,0,this.attribSemantics.POSITION.symbol),e.linkProgram(r);if(!e.getProgramParameter(r,e.LINK_STATUS))return"Could not link program\nVALIDATE_STATUS: "+e.getProgramParameter(r,e.VALIDATE_STATUS)+", gl error ["+e.getError()+"]";for(var u=0;u<this._uniformList.length;u++){var a=this._uniformList[u],f=this._cache.get("locations");f[a]=e.getUniformLocation(r,a)}e.deleteShader(i),e.deleteShader(s),this._cache.put("program",r)},_checkShaderErrorMsg:function(e,t,n){if(!e.getShaderParameter(t,e.COMPILE_STATUS))return[e.getShaderInfoLog(t),E(n)].join("\n")},clone:function(){var e=new b({vertex:this.vertex,fragment:this.fragment,vertexDefines:n.clone(this.vertexDefines),fragmentDefines:n.clone(this.fragmentDefines)});for(var t in this._textureStatus)e._textureStatus[t]=n.clone(this._textureStatus[t]);return e},dispose:function(e){this._cache.use(e.__GLID__);var t=this._cache.get("program");t&&e.deleteProgram(t),this._cache.deleteContext(e.__GLID__),this._locations={}}}),S=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;b.parseImport=function(e){return e=e.replace(S,function(e,t,n){var e=b.source(n);return e?b.parseImport(e):(console.warn('Shader chunk "'+n+'" not existed in library'),"")}),e};var x=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;return b["import"]=function(e){e.replace(x,function(e,t,n,r){var r=r.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"");if(r){var i=n.split("."),s=b.codes,o=0,u;while(o<i.length-1)u=i[o++],s[u]||(s[u]={}),s=s[u];u=i[o],s[u]=r}return r})},b.codes={},b.source=function(e){var t=e.split("."),n=b.codes,r=0;while(n&&r<t.length){var i=t[r++];n=n[i]}if(!n){console.warn('Shader "'+e+'" not existed in library');return}return n},b}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.5",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);c.onXhr&&c.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("qtek/shader/source/basic.essl",[],function(){return"@export buildin.basic.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nuniform vec2 uvRepeat : [1.0, 1.0];\n\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 position : POSITION;\n\nattribute vec3 barycentric;\n\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n\nuniform mat4 skinMatrix[JOINT_NUMBER] : SKIN_MATRIX;\n#endif\n\nvarying vec2 v_Texcoord;\nvarying vec3 v_Barycentric;\n\nvoid main()\n{\n    vec3 skinnedPosition = position;\n\n    #ifdef SKINNING\n        \n        @import buildin.chunk.skin_matrix\n        \n        skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n    #endif\n\n    v_Texcoord = texcoord * uvRepeat;\n    v_Barycentric = barycentric;\n\n    gl_Position = worldViewProjection * vec4(skinnedPosition, 1.0);\n}\n\n@end\n\n\n\n\n@export buildin.basic.fragment\n\nvarying vec2 v_Texcoord;\nuniform sampler2D diffuseMap;\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform vec3 emission : [0.0, 0.0, 0.0];\nuniform float alpha : 1.0;\n\n// Uniforms for wireframe\nuniform float lineWidth : 0.0;\nuniform vec3 lineColor : [0.0, 0.0, 0.0];\nvarying vec3 v_Barycentric;\n\n#extension GL_OES_standard_derivatives : enable\n@import buildin.util.edge_factor\n\nvoid main()\n{\n\n    #ifdef RENDER_TEXCOORD\n        gl_FragColor = vec4(v_Texcoord, 1.0, 1.0);\n        return;\n    #endif\n\n    gl_FragColor = vec4(color, alpha);\n    \n    #ifdef DIFFUSEMAP_ENABLED\n        vec4 tex = texture2D( diffuseMap, v_Texcoord );\n\n        #ifdef SRGB_DECODE\n            tex.rgb = pow(tex.rgb, vec3(2.2));\n        #endif\n        \n        #if defined(DIFFUSEMAP_ALPHA_ALPHA)\n            gl_FragColor.a = tex.a;\n        #endif\n\n        gl_FragColor.rgb *= tex.rgb;\n    #endif\n\n    gl_FragColor.rgb += emission;\n    if( lineWidth > 0.01)\n    {\n        gl_FragColor.rgb = gl_FragColor.rgb * mix(lineColor, vec3(1.0), edgeFactor(lineWidth));\n    }\n}\n\n@end"}),define("qtek/shader/source/lambert.essl",[],function(){return"/**\n * http://en.wikipedia.org/wiki/Lambertian_reflectance\n */\n\n@export buildin.lambert.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n\nuniform vec2 uvRepeat : [1.0, 1.0];\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 normal : NORMAL;\n\nattribute vec3 barycentric;\n\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n\nuniform mat4 skinMatrix[JOINT_NUMBER] : SKIN_MATRIX;\n#endif\n\nvarying vec2 v_Texcoord;\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\nvarying vec3 v_Barycentric;\n\nvoid main()\n{\n\n    vec3 skinnedPosition = position;\n    vec3 skinnedNormal = normal;\n\n    #ifdef SKINNING\n        \n        @import buildin.chunk.skin_matrix\n\n        skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n        // Normal matrix ???\n        skinnedNormal = (skinMatrixWS * vec4(normal, 0.0)).xyz;\n    #endif\n\n    gl_Position = worldViewProjection * vec4( skinnedPosition, 1.0 );\n\n    v_Texcoord = texcoord * uvRepeat;\n    v_Normal = normalize( ( worldInverseTranspose * vec4(skinnedNormal, 0.0) ).xyz );\n    v_WorldPosition = ( world * vec4( skinnedPosition, 1.0) ).xyz;\n\n    v_Barycentric = barycentric;\n}\n\n@end\n\n\n\n\n@export buildin.lambert.fragment\n\nvarying vec2 v_Texcoord;\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\nuniform sampler2D alphaMap;\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform vec3 emission : [0.0, 0.0, 0.0];\nuniform float alpha : 1.0;\n\n// Uniforms for wireframe\nuniform float lineWidth : 0.0;\nuniform vec3 lineColor : [0.0, 0.0, 0.0];\nvarying vec3 v_Barycentric;\n\n#ifdef AMBIENT_LIGHT_NUMBER\n@import buildin.header.ambient_light\n#endif\n#ifdef POINT_LIGHT_NUMBER\n@import buildin.header.point_light\n#endif\n#ifdef DIRECTIONAL_LIGHT_NUMBER\n@import buildin.header.directional_light\n#endif\n#ifdef SPOT_LIGHT_NUMBER\n@import buildin.header.spot_light\n#endif\n\n#extension GL_OES_standard_derivatives : enable\n// Import util functions and uniforms needed\n@import buildin.util.calculate_attenuation\n\n@import buildin.util.edge_factor\n\n@import buildin.plugin.compute_shadow_map\n\nvoid main()\n{\n    #ifdef RENDER_NORMAL\n        gl_FragColor = vec4(v_Normal, 1.0);\n        return;\n    #endif\n    #ifdef RENDER_TEXCOORD\n        gl_FragColor = vec4(v_Texcoord, 1.0, 1.0);\n        return;\n    #endif\n\n    gl_FragColor = vec4(color, alpha);\n\n    #ifdef DIFFUSEMAP_ENABLED\n        vec4 tex = texture2D( diffuseMap, v_Texcoord );\n        #ifdef SRGB_DECODE\n            tex.rgb = pow(tex.rgb, vec3(2.2));\n        #endif\n        gl_FragColor.rgb *= tex.rgb;\n        #ifdef DIFFUSEMAP_ALPHA_ALPHA\n            gl_FragColor.a *= tex.a;\n        #endif\n    #endif\n\n    vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n    \n    #ifdef AMBIENT_LIGHT_NUMBER\n        for(int i = 0; i < AMBIENT_LIGHT_NUMBER; i++)\n        {\n            diffuseColor += ambientLightColor[i];\n        }\n    #endif\n    // Compute point light color\n    #ifdef POINT_LIGHT_NUMBER\n        #if defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[POINT_LIGHT_NUMBER];\n            if( shadowEnabled )\n            {\n                computeShadowOfPointLights( v_WorldPosition, shadowContribs );\n            }\n        #endif\n        for(int i = 0; i < POINT_LIGHT_NUMBER; i++)\n        {\n\n            vec3 lightPosition = pointLightPosition[i];\n            vec3 lightColor = pointLightColor[i];\n            float range = pointLightRange[i];\n\n            vec3 lightDirection = lightPosition - v_WorldPosition;\n\n            // Calculate point light attenuation\n            float dist = length(lightDirection);\n            float attenuation = lightAttenuation(dist, range);\n\n            // Normalize vectors\n            lightDirection /= dist;\n\n            float ndl = dot( v_Normal, lightDirection );\n\n            float shadowContrib = 1.0;\n            #if defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n                if( shadowEnabled )\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            diffuseColor += lightColor * clamp(ndl, 0.0, 1.0) * attenuation * shadowContrib;\n        }\n    #endif\n    #ifdef DIRECTIONAL_LIGHT_NUMBER\n        #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[DIRECTIONAL_LIGHT_NUMBER];\n            if(shadowEnabled)\n            {\n                computeShadowOfDirectionalLights( v_WorldPosition, shadowContribs );\n            }\n        #endif\n        for(int i = 0; i < DIRECTIONAL_LIGHT_NUMBER; i++)\n        {\n            vec3 lightDirection = -directionalLightDirection[i];\n            vec3 lightColor = directionalLightColor[i];\n            \n            float ndl = dot( v_Normal, normalize( lightDirection ) );\n\n            float shadowContrib = 1.0;\n            #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER)\n                if( shadowEnabled )\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            diffuseColor += lightColor * clamp(ndl, 0.0, 1.0) * shadowContrib;\n        }\n    #endif\n    \n    #ifdef SPOT_LIGHT_NUMBER\n        #if defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[SPOT_LIGHT_NUMBER];\n            if( shadowEnabled )\n            {\n                computeShadowOfSpotLights( v_WorldPosition, shadowContribs );\n            }\n        #endif\n        for(int i = 0; i < SPOT_LIGHT_NUMBER; i++)\n        {\n            vec3 lightPosition = -spotLightPosition[i];\n            vec3 spotLightDirection = -normalize( spotLightDirection[i] );\n            vec3 lightColor = spotLightColor[i];\n            float range = spotLightRange[i];\n            float a = spotLightUmbraAngleCosine[i];\n            float b = spotLightPenumbraAngleCosine[i];\n            float falloffFactor = spotLightFalloffFactor[i];\n\n            vec3 lightDirection = lightPosition - v_WorldPosition;\n            // Calculate attenuation\n            float dist = length(lightDirection);\n            float attenuation = lightAttenuation(dist, range); \n\n            // Normalize light direction\n            lightDirection /= dist;\n            // Calculate spot light fall off\n            float c = dot(spotLightDirection, lightDirection);\n\n            float falloff;\n            falloff = clamp((c - a) /( b - a), 0.0, 1.0);\n            falloff = pow(falloff, falloffFactor);\n\n            float ndl = dot(v_Normal, lightDirection);\n            ndl = clamp(ndl, 0.0, 1.0);\n\n            float shadowContrib = 1.0;\n            #if defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n                if( shadowEnabled )\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            diffuseColor += lightColor * ndl * attenuation * (1.0-falloff) * shadowContrib;\n\n        }\n    #endif\n\n    gl_FragColor.rgb *= diffuseColor;\n    gl_FragColor.rgb += emission;\n    if(lineWidth > 0.01)\n    {\n        gl_FragColor.rgb = gl_FragColor.rgb * mix(lineColor, vec3(1.0), edgeFactor(lineWidth));\n    }\n}\n\n@end"}),define("qtek/shader/source/phong.essl",[],function(){return"\n// http://en.wikipedia.org/wiki/Blinn%E2%80%93Phong_shading_model\n\n@export buildin.phong.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n\nuniform vec2 uvRepeat : [1.0, 1.0];\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 normal : NORMAL;\nattribute vec4 tangent : TANGENT;\n\n#ifdef VERTEX_COLOR\nattribute vec4 color : COLOR;\n#endif\n\nattribute vec3 barycentric;\n\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n\nuniform mat4 skinMatrix[JOINT_NUMBER] : SKIN_MATRIX;\n#endif\n\nvarying vec2 v_Texcoord;\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\nvarying vec3 v_Barycentric;\n\n#ifdef NORMALMAP_ENABLED\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\nvoid main()\n{\n    \n    vec3 skinnedPosition = position;\n    vec3 skinnedNormal = normal;\n    vec3 skinnedTangent = tangent.xyz;\n    #ifdef SKINNING\n        \n        @import buildin.chunk.skin_matrix\n\n        skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n        // Normal matrix ???\n        skinnedNormal = (skinMatrixWS * vec4(normal, 0.0)).xyz;\n        skinnedTangent = (skinMatrixWS * vec4(tangent.xyz, 0.0)).xyz;\n    #endif\n\n    gl_Position = worldViewProjection * vec4(skinnedPosition, 1.0);\n\n    v_Texcoord = texcoord * uvRepeat;\n    v_WorldPosition = (world * vec4(skinnedPosition, 1.0)).xyz;\n    v_Barycentric = barycentric;\n\n    v_Normal = normalize((worldInverseTranspose * vec4(skinnedNormal, 0.0)).xyz);\n    \n    #ifdef NORMALMAP_ENABLED\n        v_Tangent = normalize((worldInverseTranspose * vec4(skinnedTangent, 0.0)).xyz);\n        v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n    #endif\n\n    #ifdef VERTEX_COLOR\n        v_Color = color;\n    #endif\n}\n\n@end\n\n\n@export buildin.phong.fragment\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\nvarying vec2 v_Texcoord;\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\n#ifdef NORMALMAP_ENABLED\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\nuniform sampler2D diffuseMap;\nuniform sampler2D normalMap;\nuniform samplerCube environmentMap;\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\n\nuniform float shininess : 30;\n\nuniform vec3 specularColor : [1.0, 1.0, 1.0];\nuniform vec3 emission : [0.0, 0.0, 0.0];\n\nuniform float reflectivity : 0.5;\n\n// Uniforms for wireframe\nuniform float lineWidth : 0.0;\nuniform vec3 lineColor : [0.0, 0.0, 0.0];\nvarying vec3 v_Barycentric;\n\n#ifdef AMBIENT_LIGHT_NUMBER\n@import buildin.header.ambient_light\n#endif\n#ifdef POINT_LIGHT_NUMBER\n@import buildin.header.point_light\n#endif\n#ifdef DIRECTIONAL_LIGHT_NUMBER\n@import buildin.header.directional_light\n#endif\n#ifdef SPOT_LIGHT_NUMBER\n@import buildin.header.spot_light\n#endif\n\n#extension GL_OES_standard_derivatives : enable\n// Import util functions and uniforms needed\n@import buildin.util.calculate_attenuation\n\n@import buildin.util.edge_factor\n\n@import buildin.plugin.compute_shadow_map\n\nvoid main()\n{\n    #ifdef RENDER_TEXCOORD\n        gl_FragColor = vec4(v_Texcoord, 1.0, 1.0);\n        return;\n    #endif\n\n    vec4 finalColor = vec4(color, alpha);\n\n    vec3 eyePos = viewInverse[3].xyz;\n    vec3 viewDirection = normalize(eyePos - v_WorldPosition);\n\n    #ifdef DIFFUSEMAP_ENABLED\n        vec4 tex = texture2D(diffuseMap, v_Texcoord);\n        #ifdef SRGB_DECODE\n            tex.rgb = pow(tex.rgb, vec3(2.2));\n        #endif\n        finalColor.rgb *= tex.rgb;\n        #ifdef DIFFUSEMAP_ALPHA_ALPHA\n            finalColor.a *= tex.a;\n        #endif\n    #endif\n\n    vec3 normal = v_Normal;\n    #ifdef NORMALMAP_ENABLED\n        normal = texture2D(normalMap, v_Texcoord).xyz * 2.0 - 1.0;\n        mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);\n        normal = normalize(tbn * normal);\n    #endif\n\n    #ifdef RENDER_NORMAL\n        gl_FragColor = vec4(normal, 1.0);\n        return;\n    #endif\n\n    // Diffuse part of all lights\n    vec3 diffuseTerm = vec3(0.0, 0.0, 0.0);\n    // Specular part of all lights\n    vec3 specularTerm = vec3(0.0, 0.0, 0.0);\n    \n    #ifdef AMBIENT_LIGHT_NUMBER\n        for(int i = 0; i < AMBIENT_LIGHT_NUMBER; i++)\n        {\n            diffuseTerm += ambientLightColor[i];\n        }\n    #endif\n    #ifdef POINT_LIGHT_NUMBER\n        #if defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[POINT_LIGHT_NUMBER];\n            if(shadowEnabled)\n            {\n                computeShadowOfPointLights(v_WorldPosition, shadowContribs);\n            }\n        #endif\n        for(int i = 0; i < POINT_LIGHT_NUMBER; i++)\n        {\n            vec3 lightPosition = pointLightPosition[i];\n            vec3 lightColor = pointLightColor[i];\n            float range = pointLightRange[i];\n\n            vec3 lightDirection = lightPosition - v_WorldPosition;\n\n            // Calculate point light attenuation\n            float dist = length(lightDirection);\n            float attenuation = lightAttenuation(dist, range); \n\n            // Normalize vectors\n            lightDirection /= dist;\n            vec3 halfVector = normalize(lightDirection + viewDirection);\n\n            float ndh = dot(normal, halfVector);\n            ndh = clamp(ndh, 0.0, 1.0);\n\n            float ndl = dot(normal,  lightDirection);\n            ndl = clamp(ndl, 0.0, 1.0);\n\n            float shadowContrib = 1.0;\n            #if defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n                if(shadowEnabled)\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            vec3 li = lightColor * ndl * attenuation * shadowContrib;\n\n            diffuseTerm += li;\n            if (shininess > 0.0)\n            {\n                specularTerm += li * pow(ndh, shininess);\n            }\n\n        }\n    #endif\n\n    #ifdef DIRECTIONAL_LIGHT_NUMBER\n        #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[DIRECTIONAL_LIGHT_NUMBER];\n            if(shadowEnabled)\n            {\n                computeShadowOfDirectionalLights(v_WorldPosition, shadowContribs);\n            }\n        #endif\n        for(int i = 0; i < DIRECTIONAL_LIGHT_NUMBER; i++)\n        {\n\n            vec3 lightDirection = -normalize(directionalLightDirection[i]);\n            vec3 lightColor = directionalLightColor[i];\n\n            vec3 halfVector = normalize(lightDirection + viewDirection);\n\n            float ndh = dot(normal, halfVector);\n            ndh = clamp(ndh, 0.0, 1.0);\n\n            float ndl = dot(normal, lightDirection);\n            ndl = clamp(ndl, 0.0, 1.0);\n\n            float shadowContrib = 1.0;\n            #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER)\n                if(shadowEnabled)\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            vec3 li = lightColor * ndl * shadowContrib;\n\n            diffuseTerm += li;\n            if (shininess > 0.0)\n            {\n                specularTerm += li * pow(ndh, shininess);\n            }\n        }\n    #endif\n\n    #ifdef SPOT_LIGHT_NUMBER\n        #if defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[SPOT_LIGHT_NUMBER];\n            if(shadowEnabled)\n            {\n                computeShadowOfSpotLights(v_WorldPosition, shadowContribs);\n            }\n        #endif\n        for(int i = 0; i < SPOT_LIGHT_NUMBER; i++)\n        {\n            vec3 lightPosition = spotLightPosition[i];\n            vec3 spotLightDirection = -normalize(spotLightDirection[i]);\n            vec3 lightColor = spotLightColor[i];\n            float range = spotLightRange[i];\n            float a = spotLightUmbraAngleCosine[i];\n            float b = spotLightPenumbraAngleCosine[i];\n            float falloffFactor = spotLightFalloffFactor[i];\n\n            vec3 lightDirection = lightPosition - v_WorldPosition;\n            // Calculate attenuation\n            float dist = length(lightDirection);\n            float attenuation = lightAttenuation(dist, range); \n\n            // Normalize light direction\n            lightDirection /= dist;\n            // Calculate spot light fall off\n            float c = dot(spotLightDirection, lightDirection);\n\n            float falloff;\n            // Fomular from real-time-rendering\n            falloff = clamp((c - a) /( b - a), 0.0, 1.0);\n            falloff = pow(falloff, falloffFactor);\n\n            vec3 halfVector = normalize(lightDirection + viewDirection);\n\n            float ndh = dot(normal, halfVector);\n            ndh = clamp(ndh, 0.0, 1.0);\n\n            float ndl = dot(normal, lightDirection);\n            ndl = clamp(ndl, 0.0, 1.0);\n\n            float shadowContrib = 1.0;\n            #if defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n                if (shadowEnabled)\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            vec3 li = lightColor * ndl * attenuation * (1.0-falloff) * shadowContrib;\n\n            diffuseTerm += li;\n            if (shininess > 0.0)\n            {\n                specularTerm += li * pow(ndh, shininess);\n            }\n        }\n    #endif\n\n    finalColor.rgb *= diffuseTerm;\n    finalColor.rgb += specularTerm * specularColor;\n    finalColor.rgb += emission;\n\n    #ifdef ENVIRONMENTMAP_ENABLED\n        vec3 envTex = textureCube(environmentMap, reflect(-viewDirection, normal)).xyz;\n        finalColor.rgb = finalColor.rgb + envTex * reflectivity;\n    #endif\n\n    if(lineWidth > 0.01)\n    {\n        finalColor.rgb = finalColor.rgb * mix(lineColor, vec3(1.0), edgeFactor(lineWidth));\n    }\n\n    #ifdef GAMMA_ENCODE\n        finalColor.rgb = pow(finalColor.rgb, vec3(1 / 2.2));\n    #endif\n\n    gl_FragColor = finalColor;\n}\n\n@end"}),define("qtek/shader/source/physical.essl",[],function(){return"\n// http://blog.selfshadow.com/publications/s2013-shading-course/\n\n@export buildin.physical.vertex\n\n@import buildin.phong.vertex\n\n@end\n\n\n@export buildin.physical.fragment\n\n#define PI 3.14159265358979\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\nvarying vec2 v_Texcoord;\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\n#ifdef NORMALMAP_ENABLED\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\nuniform sampler2D diffuseMap;\nuniform sampler2D normalMap;\nuniform samplerCube environmentMap;\n\nuniform vec3 color : [1.0, 1.0, 1.0];\nuniform float alpha : 1.0;\n\nuniform float glossiness : 0.5;\n\nuniform vec3 specularColor : [0.1, 0.1, 0.1];\nuniform vec3 emission : [0.0, 0.0, 0.0];\n\n// Uniforms for wireframe\nuniform float lineWidth : 0.0;\nuniform vec3 lineColor : [0.0, 0.0, 0.0];\nvarying vec3 v_Barycentric;\n\n#ifdef AMBIENT_LIGHT_NUMBER\n@import buildin.header.ambient_light\n#endif\n#ifdef POINT_LIGHT_NUMBER\n@import buildin.header.point_light\n#endif\n#ifdef DIRECTIONAL_LIGHT_NUMBER\n@import buildin.header.directional_light\n#endif\n#ifdef SPOT_LIGHT_NUMBER\n@import buildin.header.spot_light\n#endif\n\n#extension GL_OES_standard_derivatives : enable\n\n// Import util functions and uniforms needed\n@import buildin.util.calculate_attenuation\n\n@import buildin.util.edge_factor\n\n@import buildin.plugin.compute_shadow_map\n\n\nfloat G_Smith(float glossiness, float ndv, float ndl)\n{\n    // float k = (roughness+1.0) * (roughness+1.0) * 0.125;\n    float roughness = 1.0 - glossiness;\n    float k = roughness * roughness / 2.0;\n    float G1V = ndv / (ndv * (1.0 - k) + k);\n    float G1L = ndl / (ndl * (1.0 - k) + k);\n    return G1L * G1V;\n}\n\nvec3 F_Schlick(float ldn) {\n    return specularColor + (1.0 - specularColor) * pow(1.0 - ldn, 5.0);\n}\n\nfloat D_Phong(float g, float ndh) {\n    // from black ops 2\n    float a = pow(8192.0, g);\n    return (a + 2.0) / 8.0 * pow(ndh, a);\n}\n\nfloat D_GGX(float g, float ndh) {\n    float r = 1.0 - g;\n    float a = r * r;\n    float tmp = ndh * ndh * (a - 1.0) + 1.0;\n    return a / (PI * tmp * tmp);\n}\n\nvoid main()\n{\n    #ifdef RENDER_TEXCOORD\n        gl_FragColor = vec4(v_Texcoord, 1.0, 1.0);\n        return;\n    #endif\n\n    vec4 finalColor = vec4(color, alpha);\n\n    vec3 eyePos = viewInverse[3].xyz;\n    vec3 V = normalize(eyePos - v_WorldPosition);\n    float g = glossiness;\n\n    #ifdef DIFFUSEMAP_ENABLED\n        vec4 tex = texture2D(diffuseMap, v_Texcoord);\n        #ifdef SRGB_DECODE\n            tex.rgb = pow(tex.rgb, vec3(2.2));\n        #endif\n        finalColor.rgb *= tex.rgb;\n        #ifdef DIFFUSEMAP_ALPHA_ALPHA\n            finalColor.a *= tex.a;\n        #endif\n        #ifdef DIFFUSEMAP_ALPHA_GLOSS\n            g *= tex.a;\n        #endif\n    #endif\n\n    vec3 N = v_Normal;\n    #ifdef NORMALMAP_ENABLED\n        N = texture2D(normalMap, v_Texcoord).xyz * 2.0 - 1.0;\n        mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);\n        N = normalize(tbn * N);\n    #endif\n\n    #ifdef RENDER_NORMAL\n        gl_FragColor = vec4(N, 1.0);\n        return;\n    #endif\n\n    #ifdef RENDER_GLOSSINESS\n        gl_FragColor = vec4(vec3(g), 1.0);\n        return;\n    #endif\n\n    float ndv = dot(N, V);\n\n    // Diffuse part of all lights\n    vec3 diffuseTerm = vec3(0.0, 0.0, 0.0);\n    // Specular part of all lights\n    vec3 specularTerm = vec3(0.0, 0.0, 0.0);\n    \n    #ifdef AMBIENT_LIGHT_NUMBER\n        for(int i = 0; i < AMBIENT_LIGHT_NUMBER; i++)\n        {\n            // Hemisphere ambient lighting from cryengine\n            diffuseTerm += ambientLightColor[i] * (clamp(N.y * 0.7, 0.0, 1.0) + 0.3);\n            // diffuseTerm += ambientLightColor[i];\n        }\n    #endif\n    #ifdef POINT_LIGHT_NUMBER\n        #if defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[POINT_LIGHT_NUMBER];\n            if(shadowEnabled)\n            {\n                computeShadowOfPointLights(v_WorldPosition, shadowContribs);\n            }\n        #endif\n        for(int i = 0; i < POINT_LIGHT_NUMBER; i++)\n        {\n\n            vec3 lightPosition = pointLightPosition[i];\n            vec3 lc = pointLightColor[i];\n            float range = pointLightRange[i];\n\n            vec3 L = lightPosition - v_WorldPosition;\n\n            // Calculate point light attenuation\n            float dist = length(L);\n            float attenuation = lightAttenuation(dist, range); \n            L /= dist;\n            vec3 H = normalize(L + V);\n            float ndl = clamp(dot(N, L), 0.0, 1.0);\n            float ndh = clamp(dot(N, H), 0.0, 1.0);\n            float ldn = clamp(dot(L, N), 0.0, 1.0);\n\n            float shadowContrib = 1.0;\n            #if defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n                if(shadowEnabled)\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            vec3 li = lc * ndl * attenuation * shadowContrib;\n            diffuseTerm += li;\n            specularTerm += li * F_Schlick(ldn) * D_Phong(g, ndh);\n        }\n    #endif\n\n    #ifdef DIRECTIONAL_LIGHT_NUMBER\n        #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[DIRECTIONAL_LIGHT_NUMBER];\n            if(shadowEnabled)\n            {\n                computeShadowOfDirectionalLights(v_WorldPosition, shadowContribs);\n            }\n        #endif\n        for(int i = 0; i < DIRECTIONAL_LIGHT_NUMBER; i++)\n        {\n\n            vec3 L = -normalize(directionalLightDirection[i]);\n            vec3 lc = directionalLightColor[i];\n\n            vec3 H = normalize(L + V);\n            float ndl = clamp(dot(N, L), 0.0, 1.0);\n            float ndh = clamp(dot(N, H), 0.0, 1.0);\n            float ldn = clamp(dot(L, N), 0.0, 1.0);\n\n            float shadowContrib = 1.0;\n            #if defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER)\n                if(shadowEnabled)\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            vec3 li = lc * ndl * shadowContrib;\n\n            diffuseTerm += li;\n            specularTerm += li * F_Schlick(ldn) * D_Phong(g, ndh);\n        }\n    #endif\n\n    #ifdef SPOT_LIGHT_NUMBER\n        #if defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n            float shadowContribs[SPOT_LIGHT_NUMBER];\n            if(shadowEnabled)\n            {\n                computeShadowOfSpotLights(v_WorldPosition, shadowContribs);\n            }\n        #endif\n        for(int i = 0; i < SPOT_LIGHT_NUMBER; i++)\n        {\n            vec3 lightPosition = spotLightPosition[i];\n            vec3 spotLightDirection = -normalize(spotLightDirection[i]);\n            vec3 lc = spotLightColor[i];\n            float range = spotLightRange[i];\n            float a = spotLightUmbraAngleCosine[i];\n            float b = spotLightPenumbraAngleCosine[i];\n            float falloffFactor = spotLightFalloffFactor[i];\n\n            vec3 L = lightPosition - v_WorldPosition;\n            // Calculate attenuation\n            float dist = length(L);\n            float attenuation = lightAttenuation(dist, range); \n\n            // Normalize light direction\n            L /= dist;\n            // Calculate spot light fall off\n            float c = dot(spotLightDirection, L);\n\n            float falloff;\n            // Fomular from real-time-rendering\n            falloff = clamp((c - a) /( b - a), 0.0, 1.0);\n            falloff = pow(falloff, falloffFactor);\n\n            vec3 H = normalize(L + V);\n            float ndl = clamp(dot(N, L), 0.0, 1.0);\n            float ndh = clamp(dot(N, H), 0.0, 1.0);\n            float ldn = clamp(dot(L, N), 0.0, 1.0);\n\n            float shadowContrib = 1.0;\n            #if defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n                if (shadowEnabled)\n                {\n                    shadowContrib = shadowContribs[i];\n                }\n            #endif\n\n            vec3 li = lc * attenuation * (1.0-falloff) * shadowContrib * ndl;\n\n            diffuseTerm += li;\n            specularTerm += li * F_Schlick(ldn) * D_Phong(g, ndh);\n        }\n    #endif\n\n    finalColor.rgb *= diffuseTerm;\n    finalColor.rgb += specularTerm;\n    finalColor.rgb += emission;\n\n    #ifdef ENVIRONMENTMAP_ENABLED\n        vec3 envTex = textureCube(environmentMap, reflect(-V, N)).xyz;\n        finalColor.rgb = finalColor.rgb + envTex * g;\n    #endif\n\n    if(lineWidth > 0.)\n    {\n        finalColor.rgb = finalColor.rgb * mix(lineColor, vec3(1.0), edgeFactor(lineWidth));\n    }\n\n    #ifdef GAMMA_ENCODE\n        finalColor.rgb = pow(finalColor.rgb, vec3(1 / 2.2));\n    #endif\n    gl_FragColor = finalColor;\n}\n\n@end"}),define("qtek/shader/source/wireframe.essl",[],function(){return"@export buildin.wireframe.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 world : WORLD;\n\nattribute vec3 position : POSITION;\nattribute vec3 barycentric;\n\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n\nuniform mat4 skinMatrix[JOINT_NUMBER] : SKIN_MATRIX;\n#endif\n\nvarying vec3 v_Barycentric;\n\nvoid main()\n{\n\n    vec3 skinnedPosition = position;\n    #ifdef SKINNING\n\n        @import buildin.chunk.skin_matrix\n\n        skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n    #endif\n\n    gl_Position = worldViewProjection * vec4(skinnedPosition, 1.0 );\n\n    v_Barycentric = barycentric;\n}\n\n@end\n\n\n@export buildin.wireframe.fragment\n\nuniform vec3 color : [0.0, 0.0, 0.0];\n\nuniform float alpha : 1.0;\nuniform float lineWidth : 1.0;\n\nvarying vec3 v_Barycentric;\n\n#extension GL_OES_standard_derivatives : enable\n\n@import buildin.util.edge_factor\n\nvoid main()\n{\n\n    gl_FragColor.rgb = color;\n    gl_FragColor.a = ( 1.0-edgeFactor(lineWidth) ) * alpha;\n}\n\n@end"}),define("qtek/shader/source/skybox.essl",[],function(){return"@export buildin.skybox.vertex\n\nuniform mat4 world : WORLD;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\n\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n    v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n\n@end\n\n@export buildin.skybox.fragment\n\nuniform mat4 viewInverse : VIEWINVERSE;\nuniform samplerCube environmentMap;\n\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n    vec3 eyePos = viewInverse[3].xyz;\n    vec3 viewDirection = normalize(v_WorldPosition - eyePos);\n\n    vec3 tex = textureCube(environmentMap, viewDirection).xyz;\n\n    #ifdef SRGB_DECODE\n        tex.rgb = pow(tex.rgb, vec3(2.2));\n    #endif\n    \n    gl_FragColor = vec4(tex, 1.0);\n}\n@end"}),define("qtek/shader/source/util.essl",[],function(){return"// Use light attenuation formula in\n// http://blog.slindev.com/2011/01/10/natural-light-attenuation/\n@export buildin.util.calculate_attenuation\n\nuniform float attenuationFactor : 5.0;\n\nfloat lightAttenuation(float dist, float range)\n{\n    float attenuation = 1.0;\n    if( range > 0.0)\n    {\n        attenuation = dist*dist/(range*range);\n        float att_s = attenuationFactor;\n        attenuation = 1.0/(attenuation*att_s+1.0);\n        att_s = 1.0/(att_s+1.0);\n        attenuation = attenuation - att_s;\n        attenuation /= 1.0 - att_s;\n    }\n    return attenuation;\n}\n\n@end\n\n//http://codeflow.org/entries/2012/aug/02/easy-wireframe-display-with-barycentric-coordinates/\n@export buildin.util.edge_factor\n\nfloat edgeFactor(float width)\n{\n    vec3 d = fwidth(v_Barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * width, v_Barycentric);\n    return min(min(a3.x, a3.y), a3.z);\n}\n\n@end\n\n// Pack depth\n// Float value can only be [0.0 - 1.0) ?\n@export buildin.util.encode_float\nvec4 encodeFloat( const in float depth )\n{\n\n    const vec4 bitShifts = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\n    const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n    vec4 res = fract( depth * bitShifts );\n    res -= res.xxyz * bit_mask;\n\n    return res;\n}\n@end\n\n@export buildin.util.decode_float\nfloat decodeFloat(const in vec4 colour)\n{\n    const vec4 bitShifts = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n    return dot(colour, bitShifts);\n}\n@end\n\n// http://graphicrants.blogspot.com/2009/04/rgbm-color-encoding.html\n@export buildin.util.rgbm_decode\nvec3 RGBMDecode(vec4 rgbm, float range) {\n  return range * rgbm.rgb * rgbm.a;\n}\n@end\n\n@export buildin.util.rgbm_encode\nvec4 RGBMEncode(vec3 color, float range) {\n    vec4 rgbm;\n    color *= 1.0 / range;\n    rgbm.a = clamp(max(max(color.r, color.g), max(color.b, 1e-6 ) ), 0.0, 1.0);\n    rgbm.a = ceil(rgbm.a * 255.0) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n@end\n\n\n@export buildin.chunk.skin_matrix\n\n// Weighted Sum Skinning Matrix\nmat4 skinMatrixWS;\nif (joint.x >= 0.0)\n{\n    skinMatrixWS = skinMatrix[int(joint.x)] * weight.x;\n}\nif (joint.y >= 0.0)\n{\n    skinMatrixWS += skinMatrix[int(joint.y)] * weight.y;\n}\nif (joint.z >= 0.0)\n{\n    skinMatrixWS += skinMatrix[int(joint.z)] * weight.z;\n}\nif (joint.w >= 0.0)\n{\n    skinMatrixWS += skinMatrix[int(joint.w)] * (1.0-weight.x-weight.y-weight.z);\n}\n@end\n"}),define("qtek/shader/source/prez.essl",[],function(){return"// Shader for prez pass\n@export buildin.prez.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\n\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n\nuniform mat4 skinMatrix[JOINT_NUMBER] : SKIN_MATRIX;\n#endif\n\nvoid main()\n{\n\n    vec3 skinnedPosition = position;\n\n    #ifdef SKINNING\n        \n        @import buildin.chunk.skin_matrix\n        \n        skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n    #endif\n    \n    gl_Position = worldViewProjection * vec4(skinnedPosition, 1.0);\n}\n\n@end\n\n\n@export buildin.prez.fragment\n\nvoid main()\n{\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n\n@end"}),define("qtek/shader/source/shadowmap.essl",[],function(){return"\n@export buildin.sm.depth.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\n\n#ifdef SHADOW_TRANSPARENT \nattribute vec2 texcoord : TEXCOORD_0;\n#endif\n\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n\nuniform mat4 skinMatrix[JOINT_NUMBER] : SKIN_MATRIX;\n#endif\n\nvarying vec4 v_ViewPosition;\n\n#ifdef SHADOW_TRANSPARENT\nvarying vec2 v_Texcoord;\n#endif\n\nvoid main(){\n    \n    vec3 skinnedPosition = position;\n    \n    #ifdef SKINNING\n\n        @import buildin.chunk.skin_matrix\n\n        skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n    #endif\n\n    v_ViewPosition = worldViewProjection * vec4(skinnedPosition, 1.0);\n    gl_Position = v_ViewPosition;\n\n    #ifdef SHADOW_TRANSPARENT\n        v_Texcoord = texcoord;\n    #endif\n}\n@end\n\n@export buildin.sm.depth.fragment\n\nvarying vec4 v_ViewPosition;\n\n#ifdef SHADOW_TRANSPARENT\nvarying vec2 v_Texcoord;\n#endif\n\nuniform float bias : 0.001;\nuniform float slopeScale : 1.0;\n\n#ifdef SHADOW_TRANSPARENT\nuniform sampler2D transparentMap;\n#endif\n\n#extension GL_OES_standard_derivatives : enable\n\n@import buildin.util.encode_float\n\nvoid main(){\n    // Whats the difference between gl_FragCoord.z and this v_ViewPosition\n    // gl_FragCoord consider the polygon offset ?\n    float depth = v_ViewPosition.z / v_ViewPosition.w;\n    // float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n    #ifdef USE_VSM\n        depth = depth * 0.5 + 0.5;\n        float moment1 = depth;\n        float moment2 = depth * depth;\n\n        // Adjusting moments using partial derivative\n        float dx = dFdx(depth);\n        float dy = dFdy(depth);\n        moment2 += 0.25*(dx*dx+dy*dy);\n\n        gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);\n    #else\n        // Add slope scaled bias using partial derivative\n        float dx = dFdx(depth);\n        float dy = dFdy(depth);\n        depth += sqrt(dx*dx + dy*dy) * slopeScale + bias;\n\n        #ifdef SHADOW_TRANSPARENT\n            if (texture2D(transparentMap, v_Texcoord).a <= 0.1) {\n                // Hi-Z\n                gl_FragColor = encodeFloat(0.9999);\n                return;\n            }\n        #endif\n\n        gl_FragColor = encodeFloat(depth * 0.5 + 0.5);\n    #endif\n}\n@end\n\n@export buildin.sm.debug_depth\n\nuniform sampler2D depthMap;\nvarying vec2 v_Texcoord;\n\n@import buildin.util.decode_float\n\nvoid main() {\n    vec4 tex = texture2D(depthMap, v_Texcoord);\n    #ifdef USE_VSM\n        gl_FragColor = vec4(tex.rgb, 1.0);\n    #else\n        float depth = decodeFloat(tex);\n        gl_FragColor = vec4(depth, depth, depth, 1.0);\n    #endif\n}\n\n@end\n\n\n@export buildin.sm.distance.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 world : WORLD;\n\nattribute vec3 position : POSITION;\n\n#ifdef SKINNING\nattribute vec3 boneWeight;\nattribute vec4 boneIndex;\n\nuniform mat4 skinMatrix[JOINT_NUMBER] : SKIN_MATRIX;\n#endif\n\nvarying vec3 v_WorldPosition;\n\nvoid main(){\n\n    vec3 skinnedPosition = position;\n    #ifdef SKINNING\n        @import buildin.chunk.skin_matrix\n\n        skinnedPosition = (skinMatrixWS * vec4(position, 1.0)).xyz;\n    #endif\n\n    gl_Position = worldViewProjection * vec4(skinnedPosition , 1.0);\n    v_WorldPosition = (world * vec4(skinnedPosition, 1.0)).xyz;\n}\n\n@end\n\n@export buildin.sm.distance.fragment\n\nuniform vec3 lightPosition;\nuniform float range : 100;\n\nvarying vec3 v_WorldPosition;\n\n@import buildin.util.encode_float\n\nvoid main(){\n    float dist = distance(lightPosition, v_WorldPosition);\n    #ifdef USE_VSM\n        gl_FragColor = vec4(dist, dist * dist, 0.0, 0.0);\n    #else\n        dist = dist / range;\n        gl_FragColor = encodeFloat(dist);\n    #endif\n}\n@end\n\n@export buildin.plugin.compute_shadow_map\n\n#if defined(SPOT_LIGHT_SHADOWMAP_NUMBER) || defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER) || defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n\n#ifdef SPOT_LIGHT_SHADOWMAP_NUMBER\nuniform sampler2D spotLightShadowMaps[SPOT_LIGHT_SHADOWMAP_NUMBER];\nuniform mat4 spotLightMatrices[SPOT_LIGHT_SHADOWMAP_NUMBER];\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER\n#if defined(SHADOW_CASCADE)\nuniform sampler2D directionalLightShadowMaps[SHADOW_CASCADE];\nuniform mat4 directionalLightMatrices[SHADOW_CASCADE];\nuniform float shadowCascadeClipsNear[SHADOW_CASCADE];\nuniform float shadowCascadeClipsFar[SHADOW_CASCADE];\n#else\nuniform sampler2D directionalLightShadowMaps[DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER];\nuniform mat4 directionalLightMatrices[DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER];\n#endif\n#endif\n\n#ifdef POINT_LIGHT_SHADOWMAP_NUMBER\nuniform samplerCube pointLightShadowMaps[POINT_LIGHT_SHADOWMAP_NUMBER];\nuniform float pointLightRanges[POINT_LIGHT_SHADOWMAP_NUMBER];\n#endif\n\nuniform bool shadowEnabled : true;\n\n@import buildin.util.decode_float\n\n#if defined(DIRECTIONAL_LIGHT_NUMBER) || defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n\nfloat tapShadowMap(sampler2D map, vec2 uv, float z){\n    vec4 tex = texture2D(map, uv);\n    return decodeFloat(tex) * 2.0 - 1.0< z ? 0.0 : 1.0;\n}\n\nfloat pcf(sampler2D map, vec2 uv, float z){\n\n    float shadowContrib = tapShadowMap(map, uv, z);\n    float offset = 1.0 / 2048.0;\n    shadowContrib += tapShadowMap(map, uv+vec2(offset, 0.0), z);\n    shadowContrib += tapShadowMap(map, uv+vec2(offset, offset), z);\n    shadowContrib += tapShadowMap(map, uv+vec2(-offset, offset), z);\n    shadowContrib += tapShadowMap(map, uv+vec2(0.0, offset), z);\n    shadowContrib += tapShadowMap(map, uv+vec2(-offset, 0.0), z);\n    shadowContrib += tapShadowMap(map, uv+vec2(-offset, -offset), z);\n    shadowContrib += tapShadowMap(map, uv+vec2(offset, -offset), z);\n    shadowContrib += tapShadowMap(map, uv+vec2(0.0, -offset), z);\n\n    return shadowContrib / 9.0;\n}\nfloat chebyshevUpperBound(vec2 moments, float z){\n    float p = 0.0;\n    z = z * 0.5 + 0.5;\n    if (z <= moments.x) {\n        p = 1.0;\n    }\n    float variance = moments.y - moments.x * moments.x;\n    // http://fabiensanglard.net/shadowmappingVSM/\n    variance = max(variance, 0.0000001);\n    // Compute probabilistic upper bound. \n    float mD = moments.x - z;\n    float pMax = variance / (variance + mD * mD);\n    // Now reduce light-bleeding by removing the [0, x] tail and linearly rescaling (x, 1]\n    // TODO : bleedBias parameter ?\n    pMax = clamp((pMax-0.4)/(1.0-0.4), 0.0, 1.0);\n    return max(p, pMax);\n}\nfloat computeShadowContrib(sampler2D map, mat4 lightVPM, vec3 position){\n    \n    vec4 posInLightSpace = lightVPM * vec4(v_WorldPosition, 1.0);\n    posInLightSpace.xyz /= posInLightSpace.w;\n    float z = posInLightSpace.z;\n    // In frustum\n    if(all(greaterThan(posInLightSpace.xyz, vec3(-0.99, -0.99, -1.0))) &&\n        all(lessThan(posInLightSpace.xyz, vec3(0.99, 0.99, 1.0)))){\n        // To texture uv\n        vec2 uv = (posInLightSpace.xy+1.0) / 2.0;\n\n        #ifdef USE_VSM\n            vec2 moments = texture2D(map, uv).xy;\n            return chebyshevUpperBound(moments, z);\n        #else\n            return pcf(map, uv, z);\n        #endif\n    }\n    return 1.0;\n}\n\n#endif\n\n#ifdef POINT_LIGHT_SHADOWMAP_NUMBER\n\nfloat computeShadowOfCube(samplerCube map, vec3 direction, float range){\n    vec4 shadowTex = textureCube(map, direction);\n    float dist = length(direction);\n\n    #ifdef USE_VSM\n        vec2 moments = shadowTex.xy;\n        float variance = moments.y - moments.x * moments.x;\n        float mD = moments.x - dist;\n        float p = variance / (variance + mD * mD);\n        if(moments.x + 0.001 < dist){\n            return clamp(p, 0.0, 1.0);\n        }else{\n            return 1.0;\n        }\n    #else\n        if((decodeFloat(shadowTex) + 0.0002) * range < dist){\n            return 0.0;\n        }else{\n            return 1.0;\n        }\n    #endif\n}\n#endif\n\n#if defined(SPOT_LIGHT_SHADOWMAP_NUMBER)\n\nvoid computeShadowOfSpotLights(vec3 position, inout float shadowContribs[SPOT_LIGHT_NUMBER] ){\n    for(int i = 0; i < SPOT_LIGHT_SHADOWMAP_NUMBER; i++){\n        float shadowContrib = computeShadowContrib(spotLightShadowMaps[i], spotLightMatrices[i], position);\n        shadowContribs[i] = shadowContrib;\n    }\n    // set default fallof of rest lights\n    for(int i = SPOT_LIGHT_SHADOWMAP_NUMBER; i < SPOT_LIGHT_NUMBER; i++){\n        shadowContribs[i] = 1.0;\n    }\n}\n\n#endif\n\n\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER)\n\n#ifdef SHADOW_CASCADE\n\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_NUMBER]){\n    // http://www.opengl.org/wiki/Compute_eye_space_from_window_space\n    float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)\n                    / (gl_DepthRange.far - gl_DepthRange.near);\n\n    for (int i = 0; i < SHADOW_CASCADE; i++) {\n        if (\n            depth >= shadowCascadeClipsNear[i] &&\n            depth <= shadowCascadeClipsFar[i]\n        ) {\n            float shadowContrib = computeShadowContrib(directionalLightShadowMaps[i], directionalLightMatrices[i], position);\n            // TODO Will get a sampler needs to be be uniform error in native gl\n            shadowContribs[0] = shadowContrib;\n        }\n    }\n    // set default fallof of rest lights\n    for(int i = DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER; i < DIRECTIONAL_LIGHT_NUMBER; i++){\n        shadowContribs[i] = 1.0;\n    }\n}\n\n#else\n\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_NUMBER]){\n    for(int i = 0; i < DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER; i++){\n        float shadowContrib = computeShadowContrib(directionalLightShadowMaps[i], directionalLightMatrices[i], position);\n        shadowContribs[i] = shadowContrib;\n    }\n    // set default fallof of rest lights\n    for(int i = DIRECTIONAL_LIGHT_SHADOWMAP_NUMBER; i < DIRECTIONAL_LIGHT_NUMBER; i++){\n        shadowContribs[i] = 1.0;\n    }\n}\n#endif\n\n#endif\n\n\n#if defined(POINT_LIGHT_SHADOWMAP_NUMBER)\n\nvoid computeShadowOfPointLights(vec3 position, inout float shadowContribs[POINT_LIGHT_NUMBER] ){\n    for(int i = 0; i < POINT_LIGHT_SHADOWMAP_NUMBER; i++){\n        vec3 lightPosition = pointLightPosition[i];\n        vec3 direction = position - lightPosition;\n        shadowContribs[i] = computeShadowOfCube(pointLightShadowMaps[i], direction, pointLightRanges[i]);\n    }\n    for(int i = POINT_LIGHT_SHADOWMAP_NUMBER; i < POINT_LIGHT_NUMBER; i++){\n        shadowContribs[i] = 1.0;\n    }\n}\n\n#endif\n\n#endif\n\n@end"}),define("qtek/shader/source/compositor/vertex.essl",[],function(){return"\n@export buildin.compositor.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n    v_Texcoord = texcoord;\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n\n@end"}),define("qtek/shader/source/compositor/coloradjust.essl",[],function(){return'@export buildin.compositor.coloradjust\n\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float brightness : 0.0;\nuniform float contrast : 1.0;\nuniform float exposure : 0.0;\nuniform float gamma : 1.0;\nuniform float saturation : 1.0;\n\n// Values from "Graphics Shaders: Theory and Practice" by Bailey and Cunningham\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord);\n\n    // brightness\n    vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);\n    // contrast\n    color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n    // exposure\n    color = clamp( color * pow(2.0, exposure), 0.0, 1.0);\n    // gamma\n    color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);\n    // saturation\n    float luminance = dot( color, w );\n    color = mix(vec3(luminance), color, saturation);\n    \n    gl_FragColor = vec4(color, tex.a);\n}\n\n@end\n\n// Seperate shader for float texture\n@export buildin.compositor.brightness\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float brightness : 0.0;\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord);\n    vec3 color = tex.rgb + vec3(brightness);\n    gl_FragColor = vec4(color, tex.a);\n}\n@end\n\n@export buildin.compositor.contrast\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float contrast : 1.0;\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord);\n    vec3 color = (tex.rgb-vec3(0.5))*contrast+vec3(0.5);\n    gl_FragColor = vec4(color, tex.a);\n}\n@end\n\n@export buildin.compositor.exposure\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float exposure : 0.0;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n    vec3 color = tex.rgb * pow(2.0, exposure);\n    gl_FragColor = vec4(color, tex.a);\n}\n@end\n\n@export buildin.compositor.gamma\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float gamma : 1.0;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n    vec3 color = pow(tex.rgb, vec3(gamma));\n    gl_FragColor = vec4(color, tex.a);\n}\n@end\n\n@export buildin.compositor.saturation\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float saturation : 1.0;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n    vec3 color = tex.rgb;\n    float luminance = dot(color, w);\n    color = mix(vec3(luminance), color, saturation);\n    gl_FragColor = vec4(color, tex.a);\n}\n@end'}),define("qtek/shader/source/compositor/blur.essl",[],function(){return"@export buildin.compositor.gaussian_blur_h\n\nuniform sampler2D texture; // the texture with the scene you want to blur\nvarying vec2 v_Texcoord;\n \nuniform float blurSize : 2.0; \nuniform float textureWidth : 512.0;\n\nvoid main(void)\n{\n   vec4 sum = vec4(0.0);\n   float blurOffset = blurSize / textureWidth;\n   // blur in y (vertical)\n   // take nine samples, with the distance blurSize between them\n   sum += texture2D(texture, vec2(max(v_Texcoord.x - 4.0*blurOffset, 0.0), v_Texcoord.y)) * 0.05;\n   sum += texture2D(texture, vec2(max(v_Texcoord.x - 3.0*blurOffset, 0.0), v_Texcoord.y)) * 0.09;\n   sum += texture2D(texture, vec2(max(v_Texcoord.x - 2.0*blurOffset, 0.0), v_Texcoord.y)) * 0.12;\n   sum += texture2D(texture, vec2(max(v_Texcoord.x - blurOffset, 0.0), v_Texcoord.y)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y)) * 0.18;\n   sum += texture2D(texture, vec2(min(v_Texcoord.x + blurOffset, 1.0), v_Texcoord.y)) * 0.15;\n   sum += texture2D(texture, vec2(min(v_Texcoord.x + 2.0*blurOffset, 1.0), v_Texcoord.y)) * 0.12;\n   sum += texture2D(texture, vec2(min(v_Texcoord.x + 3.0*blurOffset, 1.0), v_Texcoord.y)) * 0.09;\n   sum += texture2D(texture, vec2(min(v_Texcoord.x + 4.0*blurOffset, 1.0), v_Texcoord.y)) * 0.05;\n \n   gl_FragColor = sum;\n}\n\n@end\n\n@export buildin.compositor.gaussian_blur_v\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n \nuniform float blurSize : 2.0;\nuniform float textureHeight : 512.0;\n \nvoid main(void)\n{\n   vec4 sum = vec4(0.0);\n   float blurOffset = blurSize / textureHeight;\n   // blur in y (vertical)\n   // take nine samples, with the distance blurSize between them\n   sum += texture2D(texture, vec2(v_Texcoord.x, max(v_Texcoord.y - 4.0*blurOffset, 0.0))) * 0.05;\n   sum += texture2D(texture, vec2(v_Texcoord.x, max(v_Texcoord.y - 3.0*blurOffset, 0.0))) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x, max(v_Texcoord.y - 2.0*blurOffset, 0.0))) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x, max(v_Texcoord.y - blurOffset, 0.0))) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y)) * 0.18;\n   sum += texture2D(texture, vec2(v_Texcoord.x, min(v_Texcoord.y + blurOffset, 1.0))) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, min(v_Texcoord.y + 2.0*blurOffset, 1.0))) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x, min(v_Texcoord.y + 3.0*blurOffset, 1.0))) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x, min(v_Texcoord.y + 4.0*blurOffset, 1.0))) * 0.05;\n \n   gl_FragColor = sum;\n}\n\n@end\n\n@export buildin.compositor.box_blur\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 3.0;\nuniform vec2 textureSize : [512.0, 512.0];\n\nvoid main(void){\n\n   vec4 tex = texture2D(texture, v_Texcoord);\n   vec2 offset = blurSize / textureSize;\n\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, 0.0) );\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(0.0, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, 0.0) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, -offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, -offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(0.0, -offset.y) );\n\n   tex /= 9.0;\n\n   gl_FragColor = tex;\n}\n\n@end\n\n// http://www.slideshare.net/DICEStudio/five-rendering-ideas-from-battlefield-3-need-for-speed-the-run\n@export buildin.compositor.hexagonal_blur_mrt_1\n\n// MRT in chrome\n// https://www.khronos.org/registry/webgl/sdk/tests/conformance/extensions/webgl-draw-buffers.html\n#extension GL_EXT_draw_buffers : require\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 2.0;\n\nuniform vec2 textureSize : [512.0, 512.0];\n\nvoid main(void){\n   vec2 offset = blurSize / textureSize;\n\n   vec4 color = vec4(0.0);\n   // Top\n   for(int i = 0; i < 10; i++){\n      color += 1.0/10.0 * texture2D(texture, v_Texcoord + vec2(0.0, offset.y * float(i)) );\n   }\n   gl_FragData[0] = color;\n   vec4 color2 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   gl_FragData[1] = (color + color2) / 2.0;\n}\n\n@end\n\n@export buildin.compositor.hexagonal_blur_mrt_2\n\nuniform sampler2D texture0;\nuniform sampler2D texture1;\n\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 2.0;\n\nuniform vec2 textureSize : [512.0, 512.0];\n\nvoid main(void){\n   vec2 offset = blurSize / textureSize;\n\n   vec4 color1 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color1 += 1.0/10.0 * texture2D(texture0, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   vec4 color2 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture1, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   gl_FragColor = (color1 + color2) / 2.0;\n}\n\n@end\n\n\n@export buildin.compositor.hexagonal_blur_1\n\n#define KERNEL_SIZE 10\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform vec2 textureSize : [512.0, 512.0];\n\nvoid main(void){\n   vec2 offset = blurSize / textureSize;\n\n   vec4 color = vec4(0.0);\n   float fKernelSize = float(KERNEL_SIZE);\n   // Top\n   for(int i = 0; i < KERNEL_SIZE; i++){\n      color += 1.0 / fKernelSize * texture2D(texture, v_Texcoord + vec2(0.0, offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n\n@end\n\n@export buildin.compositor.hexagonal_blur_2\n\n#define KERNEL_SIZE 10\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform vec2 textureSize : [512.0, 512.0];\n\nvoid main(void){\n   vec2 offset = blurSize / textureSize;\n   offset.y /= 2.0;\n\n   vec4 color = vec4(0.0);\n   float fKernelSize = float(KERNEL_SIZE);\n   // Down left\n   for(int i = 0; i < KERNEL_SIZE; i++){\n      color += 1.0/fKernelSize * texture2D(texture, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n@end\n\n@export buildin.compositor.hexagonal_blur_3\n\n#define KERNEL_SIZE 10\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\n\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform vec2 textureSize : [512.0, 512.0];\n\nvoid main(void){\n   vec2 offset = blurSize / textureSize;\n   offset.y /= 2.0;\n\n   vec4 color1 = vec4(0.0);\n   float fKernelSize = float(KERNEL_SIZE);\n   // Down left\n   for(int i = 0; i < KERNEL_SIZE; i++){\n      color1 += 1.0/fKernelSize * texture2D(texture1, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   vec4 color2 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < KERNEL_SIZE; i++){\n      color2 += 1.0/fKernelSize * texture2D(texture1, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   vec4 color3 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < KERNEL_SIZE; i++){\n      color3 += 1.0/fKernelSize * texture2D(texture2, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   gl_FragColor = (color1 + color2 + color3) / 3.0;\n}\n\n@end"}),define("qtek/shader/source/compositor/lum.essl",[],function(){return"\n@export buildin.compositor.lum\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord );\n    float luminance = dot(tex.rgb, w);\n\n    gl_FragColor = vec4(vec3(luminance), 1.0);\n}\n\n@end"}),define("qtek/shader/source/compositor/lut.essl",[],function(){return"\n// https://github.com/BradLarson/GPUImage?source=c\n@export buildin.compositor.lut\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\nuniform sampler2D lookup;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n\n    float blueColor = tex.b * 63.0;\n    \n    vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n    \n    vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n    \n    vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec4 newColor1 = texture2D(lookup, texPos1);\n    vec4 newColor2 = texture2D(lookup, texPos2);\n    \n    vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n    gl_FragColor = vec4(newColor.rgb, tex.w);\n}\n\n@end"}),define("qtek/shader/source/compositor/output.essl",[],function(){return"@export buildin.compositor.output\n\n#define OUTPUT_ALPHA;\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n\n    gl_FragColor.rgb = tex.rgb;\n\n    #ifdef OUTPUT_ALPHA\n        gl_FragColor.a = tex.a;\n    #else\n        gl_FragColor.a = 1.0;\n    #endif\n\n}\n\n@end"}),define("qtek/shader/source/compositor/hdr.essl",[],function(){return"// HDR Pipeline\n@export buildin.compositor.hdr.bright\n\nuniform sampler2D texture;\nuniform float threshold : 1;\nuniform float scale : 1.0;\n\nvarying vec2 v_Texcoord;\n\nconst vec3 lumWeight = vec3(0.2125, 0.7154, 0.0721);\n\n@import buildin.util.rgbm_decode\n@import buildin.util.rgbm_encode\n\nvoid main()\n{\n    #ifdef TEXTURE_ENABLED\n        #ifdef RGBM_DECODE\n            vec3 tex = RGBMDecode(texture2D(texture, v_Texcoord));\n        #else\n            vec3 tex = texture2D(texture, v_Texcoord).rgb;\n        #endif\n    #else\n        vec3 tex = vec3(0.0);\n    #endif\n\n    float lum = dot(tex, lumWeight);\n    if (lum > threshold)\n    {\n        gl_FragColor.rgb = tex * scale;\n    }\n    else\n    {\n        gl_FragColor.rgb = vec3(0.0);\n    }\n    gl_FragColor.a = 1.0;\n\n    #ifdef RGBM_ENCODE\n        gl_FragColor.rgba = RGBMEncode(gl_FragColor.rgb);\n    #endif\n}\n@end\n\n@export buildin.compositor.hdr.log_lum\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n    float luminance = dot(tex.rgb, w);\n    luminance = log(luminance + 0.001);\n\n    gl_FragColor = vec4(vec3(luminance), 1.0);\n}\n\n@end\n\n@export buildin.compositor.hdr.lum_adaption\nvarying vec2 v_Texcoord;\n\nuniform sampler2D adaptedLum;\nuniform sampler2D currentLum;\n\nuniform float frameTime : 0.02;\n\nvoid main()\n{\n    float fAdaptedLum = texture2D(adaptedLum, vec2(0.5, 0.5)).r;\n    float fCurrentLum = exp(texture2D(currentLum, vec2(0.5, 0.5)).r);\n\n    fAdaptedLum += (fCurrentLum - fAdaptedLum) * (1.0 - pow(0.98, 30.0 * frameTime));\n    gl_FragColor.rgb = vec3(fAdaptedLum);\n    gl_FragColor.a = 1.0;\n}\n@end\n\n// Tone mapping with gamma correction\n// http://filmicgames.com/archives/75\n@export buildin.compositor.hdr.tonemapping\n\nuniform sampler2D texture;\nuniform sampler2D bloom;\nuniform sampler2D lensflare;\nuniform sampler2D lum;\n\nuniform float exposure : 1.0;\n\nvarying vec2 v_Texcoord;\n\nconst float A = 0.22;   // Shoulder Strength\nconst float B = 0.30;   // Linear Strength\nconst float C = 0.10;   // Linear Angle\nconst float D = 0.20;   // Toe Strength\nconst float E = 0.01;   // Toe Numerator\nconst float F = 0.30;   // Toe Denominator\nconst vec3 whiteScale = vec3(11.2);\n\nvec3 uncharted2ToneMap(vec3 x)\n{\n    return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\n\nvec3 filmicToneMap(vec3 color)\n{\n    vec3 x = max(vec3(0.0), color - 0.004);\n    return (x*(6.2*x+0.5))/(x*(6.2*x+1.7)+0.06);\n}\n\nfloat eyeAdaption(float fLum)\n{\n    return mix(0.2, fLum, 0.5);\n}\n\nvoid main()\n{\n    vec3 tex = vec3(0.0);\n    float a = 1.0;\n    #ifdef TEXTURE_ENABLED\n        vec4 res = texture2D(texture, v_Texcoord);\n        a = res.a;\n        tex = res.rgb;\n    #endif\n\n    #ifdef BLOOM_ENABLED\n        tex += texture2D(bloom, v_Texcoord).rgb * 0.25;\n    #endif\n\n    #ifdef LENSFLARE_ENABLED\n        tex += texture2D(lensflare, v_Texcoord).rgb;\n    #endif\n\n    // Adjust exposure\n    // From KlayGE\n    #ifdef LUM_ENABLED\n        float fLum = texture2D(lum, vec2(0.5, 0.5)).r;\n        float adaptedLumDest = 3.0 / (max(0.1, 1.0 + 10.0*eyeAdaption(fLum)));\n        float exposureBias = adaptedLumDest * exposure;\n    #else\n        float exposureBias = exposure;\n    #endif\n    tex *= exposureBias;\n\n    // Do tone mapping\n    vec3 color = uncharted2ToneMap(tex) / uncharted2ToneMap(whiteScale);\n    color = pow(color, vec3(1.0/2.2));\n    // vec3 color = filmicToneMap(tex);\n\n    #ifdef RGBM_ENCODE\n        gl_FragColor.rgba = RGBMEncode(color);\n    #else\n        gl_FragColor = vec4(color, a);\n    #endif\n}\n\n@end"}),define("qtek/shader/source/compositor/lensflare.essl",[],function(){return"// john-chapman-graphics.blogspot.co.uk/2013/02/pseudo-lens-flare.html\n@export buildin.compositor.lensflare\n\n#define SAMPLE_NUMBER 8\n\nuniform sampler2D texture;\nuniform sampler2D lensColor;\n\nuniform vec2 textureSize : [512, 512];\n\nuniform float dispersal : 0.3;\nuniform float haloWidth : 0.4;\nuniform float distortion : 1.0;\n\nvarying vec2 v_Texcoord;\n\nvec4 textureDistorted(\n    in vec2 texcoord,\n    in vec2 direction,\n    in vec3 distortion\n) {\n    return vec4(\n        texture2D(texture, texcoord + direction * distortion.r).r,\n        texture2D(texture, texcoord + direction * distortion.g).g,\n        texture2D(texture, texcoord + direction * distortion.b).b,\n        1.0\n    );\n}\n\nvoid main()\n{\n    vec2 texcoord = -v_Texcoord + vec2(1.0); // Flip texcoords\n    vec2 textureOffset = 1.0 / textureSize;\n\n    vec2 ghostVec = (vec2(0.5) - texcoord) * dispersal;\n    vec2 haloVec = normalize(ghostVec) * haloWidth;\n\n    vec3 distortion = vec3(-textureOffset.x * distortion, 0.0, textureOffset.x * distortion);\n    //Sample ghost\n    vec4 result = vec4(0.0);\n    for (int i = 0; i < SAMPLE_NUMBER; i++)\n    {\n        vec2 offset = fract(texcoord + ghostVec * float(i));\n\n        float weight = length(vec2(0.5) - offset) / length(vec2(0.5));\n        weight = pow(1.0 - weight, 10.0);\n\n        result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n    }\n\n    result *= texture2D(lensColor, vec2(length(vec2(0.5) - texcoord)) / length(vec2(0.5)));\n    //Sample halo\n    float weight = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n    weight = pow(1.0 - weight, 10.0);\n    vec2 offset = fract(texcoord + haloVec);\n    result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n\n    gl_FragColor = result;\n}\n@end"}),define("qtek/shader/source/compositor/blend.essl",[],function(){return"@export buildin.compositor.blend\n// Blend at most 4 textures\n#ifdef TEXTURE1_ENABLED\nuniform sampler2D texture1;\nuniform float weight1 : 1.0;\n#endif\n#ifdef TEXTURE2_ENABLED\nuniform sampler2D texture2;\nuniform float weight2 : 1.0;\n#endif\n#ifdef TEXTURE3_ENABLED\nuniform sampler2D texture3;\nuniform float weight3 : 1.0;\n#endif\n#ifdef TEXTURE4_ENABLED\nuniform sampler2D texture4;\nuniform float weight4 : 1.0;\n#endif\n\nvarying vec2 v_Texcoord;\n\nvoid main()\n{\n    vec3 tex = vec3(0.0);\n    #ifdef TEXTURE1_ENABLED\n        tex += texture2D(texture1, v_Texcoord).rgb * weight1;\n    #endif\n    #ifdef TEXTURE2_ENABLED\n        tex += texture2D(texture2, v_Texcoord).rgb * weight2;\n    #endif\n    #ifdef TEXTURE3_ENABLED\n        tex += texture2D(texture3, v_Texcoord).rgb * weight3;\n    #endif\n    #ifdef TEXTURE4_ENABLED\n        tex += texture2D(texture4, v_Texcoord).rgb * weight4;\n    #endif\n\n    gl_FragColor = vec4(tex, 1.0);\n}\n@end"}),define("qtek/shader/source/compositor/fxaa.essl",[],function(){return"// https://github.com/mitsuhiko/webgl-meincraft/blob/master/assets/shaders/fxaa.glsl\n@export buildin.compositor.fxaa\n\nuniform sampler2D texture;\nuniform vec2 viewportSize : [512, 512];\n\nvarying vec2 v_Texcoord;\n\n#define FXAA_REDUCE_MIN   (1.0/128.0)\n#define FXAA_REDUCE_MUL   (1.0/8.0)\n#define FXAA_SPAN_MAX     8.0\n\nvoid main()\n{\n    vec2 resolution = 1.0 / viewportSize;\n    vec3 rgbNW = texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;\n    vec3 rgbNE = texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;\n    vec3 rgbSW = texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;\n    vec3 rgbSE = texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;\n    vec4 rgbaM  = texture2D( texture,  gl_FragCoord.xy  * resolution );\n    vec3 rgbM  = rgbaM.xyz;\n    float opacity  = rgbaM.w;\n\n    vec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n    float lumaNW = dot( rgbNW, luma );\n    float lumaNE = dot( rgbNE, luma );\n    float lumaSW = dot( rgbSW, luma );\n    float lumaSE = dot( rgbSE, luma );\n    float lumaM  = dot( rgbM,  luma );\n    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n\n    vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\n\n    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n    dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),\n          max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                dir * rcpDirMin)) * resolution;\n\n    vec3 rgbA = texture2D( texture, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz;\n    rgbA += texture2D( texture, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz;\n    rgbA *= 0.5;\n\n    vec3 rgbB = texture2D( texture, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz;\n    rgbB += texture2D( texture, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz;\n    rgbB *= 0.25;\n    rgbB += rgbA * 0.5;\n\n    float lumaB = dot( rgbB, luma );\n\n    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )\n    {\n\n        gl_FragColor = vec4( rgbA, opacity );\n\n    } else {\n\n        gl_FragColor = vec4( rgbB, opacity );\n\n    }\n}\n\n@end"}),define("qtek/shader/library",["require","../Shader","../core/util","./source/basic.essl","./source/lambert.essl","./source/phong.essl","./source/physical.essl","./source/wireframe.essl","./source/skybox.essl","./source/util.essl","./source/prez.essl","./source/shadowmap.essl","./source/compositor/vertex.essl","./source/compositor/coloradjust.essl","./source/compositor/blur.essl","./source/compositor/lum.essl","./source/compositor/lut.essl","./source/compositor/output.essl","./source/compositor/hdr.essl","./source/compositor/lensflare.essl","./source/compositor/blend.essl","./source/compositor/fxaa.essl"],function(e){function s(e,n){var s=[],o={},u={};typeof n=="string"?s=Array.prototype.slice.call(arguments,1):Object.prototype.toString.call(n)=="[object Object]"?(s=n.textures||[],o=n.vertexDefines||{},u=n.fragmentDefines||{}):n instanceof Array&&(s=n);var a=Object.keys(o),f=Object.keys(u);s.sort(),a.sort(),f.sort();var l=[e];l=l.concat(s);for(var c=0;c<a.length;c++)l.push(o[a[c]]);for(var c=0;c<f.length;c++)l.push(u[f[c]]);var h=l.join("_");if(i[h])return i[h];var p=r[e];if(!p){console.error('Shader "'+e+'"'+" is not in the library");return}var d=new t({vertex:p.vertex,fragment:p.fragment});for(var c=0;c<s.length;c++)d.enableTexture(s[c]);for(var e in o)d.define("vertex",e,o[e]);for(var e in u)d.define("fragment",e,u[e]);return i[h]=d,d}function o(e,t,n){r[e]={vertex:t,fragment:n}}function u(){i={}}var t=e("../Shader"),n=e("../core/util"),r={},i={};return t["import"](e("./source/basic.essl")),t["import"](e("./source/lambert.essl")),t["import"](e("./source/phong.essl")),t["import"](e("./source/physical.essl")),t["import"](e("./source/wireframe.essl")),t["import"](e("./source/skybox.essl")),t["import"](e("./source/util.essl")),t["import"](e("./source/prez.essl")),t["import"](e("./source/shadowmap.essl")),o("buildin.basic",t.source("buildin.basic.vertex"),t.source("buildin.basic.fragment")),o("buildin.lambert",t.source("buildin.lambert.vertex"),t.source("buildin.lambert.fragment")),o("buildin.phong",t.source("buildin.phong.vertex"),t.source("buildin.phong.fragment")),o("buildin.wireframe",t.source("buildin.wireframe.vertex"),t.source("buildin.wireframe.fragment")),o("buildin.skybox",t.source("buildin.skybox.vertex"),t.source("buildin.skybox.fragment")),o("buildin.prez",t.source("buildin.prez.vertex"),t.source("buildin.prez.fragment")),o("buildin.physical",t.source("buildin.physical.vertex"),t.source("buildin.physical.fragment")),t["import"](e("./source/compositor/vertex.essl")),t["import"](e("./source/compositor/coloradjust.essl")),t["import"](e("./source/compositor/blur.essl")),t["import"](e("./source/compositor/lum.essl")),t["import"](e("./source/compositor/lut.essl")),t["import"](e("./source/compositor/output.essl")),t["import"](e("./source/compositor/hdr.essl")),t["import"](e("./source/compositor/lensflare.essl")),t["import"](e("./source/compositor/blend.essl")),t["import"](e("./source/compositor/fxaa.essl")),{get:s,template:o,clear:u}}),define("qtek/Material",["require","./core/Base","./Texture"],function(e){var t=e("./core/Base"),n=e("./Texture"),r=t.derive({name:"",uniforms:null,shader:null,depthTest:!0,depthMask:!0,transparent:!1,blend:null,_enabledUniforms:null},function(){this.name||(this.name="MATERIAL_"+this.__GUID__),this.shader&&this.attachShader(this.shader)},{bind:function(e,t){var r=0,i=t&&t.shader===this.shader;for(var s=0;s<this._enabledUniforms.length;s++){var o=this._enabledUniforms[s],u=this.uniforms[o];if(i&&t.uniforms[o].value===u.value)continue;if(u.value===undefined){console.warn('Uniform value "'+o+'" is undefined');continue}if(u.value===null)continue;if(u.value instanceof Array&&!u.value.length)continue;if(u.value instanceof n){var a=this.shader.setUniform(e,"1i",o,r);if(!a)continue;var f=u.value;e.activeTexture(e.TEXTURE0+r),f.isRenderable()?f.bind(e):f.unbind(e),r++}else if(u.value instanceof Array){if(u.value.length===0)continue;var l=u.value[0];if(l instanceof n){if(!this.shader.hasUniform(o))continue;var c=[];for(var h=0;h<u.value.length;h++){var f=u.value[h];e.activeTexture(e.TEXTURE0+r),f.isRenderable()?f.bind(e):f.unbind(e),c.push(r++)}this.shader.setUniform(e,"1iv",o,c)}else this.shader.setUniform(e,u.type,o,u.value)}else this.shader.setUniform(e,u.type,o,u.value)}},setUniform:function(e,t){var n=this.uniforms[e];n&&(n.value=t)},setUniforms:function(e){for(var t in e){var n=e[t];this.setUniform(t,n)}},enableUniform:function(e){this.uniforms[e]&&!this.isUniformEnabled(e)&&this._enabledUniforms.push(e)},disableUniform:function(e){var t=this._enabledUniforms.indexOf(e);t>=0&&this._enabledUniforms.splice(t,1)},isUniformEnabled:function(e){return this._enabledUniforms.indexOf(e)>=0},set:function(e,t){if(typeof e=="object")for(var n in e){var r=e[n];this.set(n,r)}else{var i=this.uniforms[e];i&&(i.value=t)}},get:function(e){var t=this.uniforms[e];if(t)return t.value},attachShader:function(e,t){var n=this.uniforms;this.uniforms=e.createUniforms(),this.shader=e,this._enabledUniforms=Object.keys(this.uniforms);if(t)for(var r in n)this.uniforms[r]&&(this.uniforms[r].value=n[r].value)},detachShader:function(){this.shader=null,this.uniforms={}}});return r}),define("qtek/math/Vector2",["require","glmatrix"],function(e){var t=e("glmatrix"),n=t.vec2,r=function(e,t){e=e||0,t=t||0,this._array=n.fromValues(e,t),this._dirty=!0};return r.prototype={constructor:r,get x(){return this._array[0]},set x(e){this._array[0]=e,this._dirty=!0},get y(){return this._array[1]},set y(e){this._array[1]=e,this._dirty=!0},add:function(e){return n.add(this._array,this._array,e._array),this._dirty=!0,this},set:function(e,t){return this._array[0]=e,this._array[1]=t,this._dirty=!0,this},setArray:function(e){return this._array[0]=e[0],this._array[1]=e[1],this._dirty=!0,this},clone:function(){return new r(this.x,this.y)},copy:function(e){return n.copy(this._array,e._array),this._dirty=!0,this},cross:function(e,t){return n.cross(e._array,this._array,t._array),e._dirty=!0,this},dist:function(e){return n.dist(this._array,e._array)},distance:function(e){return n.distance(this._array,e._array)},div:function(e){return n.div(this._array,this._array,e._array),this._dirty=!0,this},divide:function(e){return n.divide(this._array,this._array,e._array),this._dirty=!0,this},dot:function(e){return n.dot(this._array,e._array)},len:function(){return n.len(this._array)},length:function(){return n.length(this._array)},lerp:function(e,t,r){return n.lerp(this._array,e._array,t._array,r),this._dirty=!0,this},min:function(e){return n.min(this._array,this._array,e._array),this._dirty=!0,this},max:function(e){return n.max(this._array,this._array,e._array),this._dirty=!0,this},mul:function(e){return n.mul(this._array,this._array,e._array),this._dirty=!0,this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this._dirty=!0,this},negate:function(){return n.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return n.normalize(this._array,this._array),this._dirty=!0,this},random:function(e){return n.random(this._array,e),this._dirty=!0,this},scale:function(e){return n.scale(this._array,this._array,e),this._dirty=!0,this},scaleAndAdd:function(e,t){return n.scaleAndAdd(this._array,this._array,e._array,t),this._dirty=!0,this},sqrDist:function(e){return n.sqrDist(this._array,e._array)},squaredDistance:function(e){return n.squaredDistance(this._array,e._array)},sqrLen:function(){return n.sqrLen(this._array)},squaredLength:function(){return n.squaredLength(this._array)},sub:function(e){return n.sub(this._array,this._array,e._array),this._dirty=!0,this},subtract:function(e){return n.subtract(this._array,this._array,e._array),this._dirty=!0,this},transformMat2:function(e){return n.transformMat2(this._array,this._array,e._array),this._dirty=!0,this},transformMat2d:function(e){return n.transformMat2d(this._array,this._array,e._array),this._dirty=!0,this},transformMat3:function(e){return n.transformMat3(this._array,this._array,e._array),this._dirty=!0,this},transformMat4:function(e){return n.transformMat4(this._array,this._array,e._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},r.add=function(e,t,r){return n.add(e._array,t._array,r._array),e._dirty=!0,e},r.set=function(e,t,r){return n.set(e._array,t,r),e._dirty=!0,e},r.copy=function(e,t){return n.copy(e._array,t._array),e._dirty=!0,e},r.cross=function(e,t,r){return n.cross(e._array,t._array,r._array),e._dirty=!0,e},r.dist=function(e,t){return n.distance(e._array,t._array)},r.distance=r.dist,r.div=function(e,t,r){return n.divide(e._array,t._array,r._array),e._dirty=!0,e},r.divide=r.div,r.dot=function(e,t){return n.dot(e._array,t._array)},r.len=function(e){return n.length(e._array)},r.lerp=function(e,t,r,i){return n.lerp(e._array,t._array,r._array,i),e._dirty=!0,e},r.min=function(e,t,r){return n.min(e._array,t._array,r._array),e._dirty=!0,e},r.max=function(e,t,r){return n.max(e._array,t._array,r._array),e._dirty=!0,e},r.mul=function(e,t,r){return n.multiply(e._array,t._array,r._array),e._dirty=!0,e},r.multiply=r.mul,r.negate=function(e,t){return n.negate(e._array,t._array),e._dirty=!0,e},r.normalize=function(e,t){return n.normalize(e._array,t._array),e._dirty=!0,e},r.random=function(e,t){return n.random(e._array,t),e._dirty=!0,e},r.scale=function(e,t,r){return n.scale(e._array,t._array,r),e._dirty=!0,e},r.scaleAndAdd=function(e,t,r,i){return n.scale(e._array,t._array,r._array,i),e._dirty=!0,e},r.sqrDist=function(e,t){return n.sqrDist(e._array,t._array)},r.squaredDistance=r.sqrDist,r.sqrLen=function(e){return n.sqrLen(e._array)},r.squaredLength=r.sqrLen,r.sub=function(e,t,r){return n.subtract(e._array,t._array,r._array),e._dirty=!0,e},r.subtract=r.sub,r.transformMat2=function(e,t,r){return n.transformMat2(e._array,t._array,r._array),e._dirty=!0,e},r.transformMat2d=function(e,t,r){return n.transformMat2d(e._array,t._array,r._array),e._dirty=!0,e},r.transformMat3=function(e,t,r){return n.transformMat3(e._array,t._array,r._array),e._dirty=!0,e},r.transformMat4=function(e,t,r){return n.transformMat4(e._array,t._array,r._array),e._dirty=!0,e},r}),define("qtek/Renderer",["require","./core/Base","./Texture","./core/glinfo","./core/glenum","./math/BoundingBox","./math/Matrix4","./shader/library","./Material","./math/Vector2","glmatrix"],function(e){var t=e("./core/Base"),n=e("./Texture"),r=e("./core/glinfo"),i=e("./core/glenum"),s=e("./math/BoundingBox"),o=e("./math/Matrix4"),u=e("./shader/library"),a=e("./Material"),f=e("./math/Vector2"),l=e("glmatrix"),c=l.mat4,h=l.vec3,p=0,d=u.get("buildin.prez"),v=new a({shader:d}),m={},g=t.derive(function(){return{canvas:null,width:100,height:100,devicePixelRatio:window.devicePixelRatio||1,color:[0,0,0,0],clear:17664,alhpa:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},_viewportSettings:[],_clearSettings:[],_sceneRendering:null}},function(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height);try{var e={alhpa:this.alhpa,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};this.gl=this.canvas.getContext("webgl",e)||this.canvas.getContext("experimental-webgl",e);if(!this.gl)throw new Error;this.gl.__GLID__=p++,this.width=this.canvas.width,this.height=this.canvas.height,this.resize(this.width,this.height),r.initialize(this.gl)}catch(t){throw"Error creating WebGL Context"}},{resize:function(e,t){var n=this.canvas;typeof e!="undefined"?(n.style.width=e+"px",n.style.height=t+"px",n.width=e*this.devicePixelRatio,n.height=t*this.devicePixelRatio,this.width=e,this.height=t):(this.width=n.width/this.devicePixelRatio,this.height=n.height/this.devicePixelRatio),this.setViewport(0,0,n.width,n.height)},setDevicePixelRatio:function(e){this.devicePixelRatio=e,this.resize(this.width,this.height)},setViewport:function(e,t,n,r){if(typeof e=="object"){var i=e;e=i.x,t=i.y,n=i.width,r=i.height}this.gl.viewport(e,t,n,r),this.viewport={x:e,y:t,width:n,height:r}},saveViewport:function(){this._viewportSettings.push(this.viewport)},restoreViewport:function(){this._viewportSettings.length>0&&this.setViewport(this._viewportSettings.pop())},saveClear:function(){this._clearSettings.push(this.clear)},restoreClear:function(){this._clearSettings.length>0&&(this.clear=this._clearSettings.pop())},render:function(e,t,n,r){var i=this.gl;this._sceneRendering=e;var s=this.color;this.clear&&(i.clearColor(s[0],s[1],s[2],s[3]),i.clear(this.clear)),n||e.update(!1),t.scene||t.update(!0);var o=e.opaqueQueue,u=e.transparentQueue,a=e.material;e.trigger("beforerender",this,e,t);if(u.length>0){var f=c.create(),l=h.create();for(var p=0;p<u.length;p++){var d=u[p];c.multiply(f,t.viewMatrix._array,d.worldTransform._array),h.transformMat4(l,d.position._array,f),d.__depth=l[2]}}o.sort(g.opaqueSortFunc),u.sort(g.transparentSortFunc),e.trigger("beforerender:opaque",this,o),t.sceneBoundingBoxLastFrame.min.set(Infinity,Infinity,Infinity),t.sceneBoundingBoxLastFrame.max.set(-Infinity,-Infinity,-Infinity),i.disable(i.BLEND),i.enable(i.DEPTH_TEST);var v=this.renderQueue(o,t,a,r);e.trigger("afterrender:opaque",this,o,v),e.trigger("beforerender:transparent",this,u),i.enable(i.BLEND);var m=this.renderQueue(u,t,a);e.trigger("afterrender:transparent",this,u,m);var y={};for(var b in v)y[b]=v[b]+m[b];return e.trigger("afterrender",this,e,t,y),y},renderQueue:function(e,t,n,r){var i={faceNumber:0,vertexNumber:0,drawCallNumber:0,meshNumber:0};c.copy(y.VIEW,t.viewMatrix._array),c.copy(y.PROJECTION,t.projectionMatrix._array),c.multiply(y.VIEWPROJECTION,t.projectionMatrix._array,y.VIEW),c.copy(y.VIEWINVERSE,t.worldTransform._array),c.invert(y.PROJECTIONINVERSE,y.PROJECTION),c.invert(y.VIEWPROJECTIONINVERSE,y.VIEWPROJECTION);var s=this.gl,o=this._sceneRendering,u,a,f,l,h,p,g,b;if(r){b=[],d.bind(s),s.colorMask(!1,!1,!1,!1),s.depthMask(!0);for(var w=0;w<e.length;w++){var E=e[w],S=E.worldTransform._array,x=E.geometry;c.multiply(y.WORLDVIEW,y.VIEW,S),c.multiply(y.WORLDVIEWPROJECTION,y.VIEWPROJECTION,S);if(x.boundingBox&&!this._frustumCulling(E,t))continue;if(E.skeleton)continue;E.cullFace!==p&&(p=E.cullFace,s.cullFace(p)),E.frontFace!==g&&(g=E.frontFace,s.frontFace(g)),E.culling!==h&&(h=E.culling,h?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE));var T=d.matrixSemantics.WORLDVIEWPROJECTION;d.setUniform(s,T.type,T.symbol,y.WORLDVIEWPROJECTION),E.render(s,v),b.push(E)}s.depthFunc(s.LEQUAL),s.colorMask(!0,!0,!0,!0),s.depthMask(!1)}else b=e;for(var w=0;w<b.length;w++){var E=b[w],N=n||E.material,C=N.shader,x=E.geometry,S=E.worldTransform._array;c.copy(y.WORLD,S),c.multiply(y.WORLDVIEW,y.VIEW,S),c.multiply(y.WORLDVIEWPROJECTION,y.VIEWPROJECTION,S),(C.matrixSemantics.WORLDINVERSE||C.matrixSemantics.WORLDINVERSETRANSPOSE)&&c.invert(y.WORLDINVERSE,S),(C.matrixSemantics.WORLDVIEWINVERSE||C.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&c.invert(y.WORLDVIEWINVERSE,y.WORLDVIEW),(C.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||C.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&c.invert(y.WORLDVIEWPROJECTIONINVERSE,y.WORLDVIEWPROJECTION);if(x.boundingBox&&!r&&!this._frustumCulling(E,t))continue;if(a!==C){o&&o.isShaderLightNumberChanged(C)&&o.setShaderLightNumber(C);var k=C.bind(s);if(k){if(m[C.__GUID__])continue;m[C.__GUID__]=!0;if(this.throwError)throw new Error(k);this.trigger("error",k)}o&&o.setLightUniforms(C,s),a=C}u!==N&&(r||(N.depthTest!==f&&(N.depthTest?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),f=N.depthTest),N.depthMask!==l&&(s.depthMask(N.depthMask),l=N.depthMask)),N.bind(s,u),u=N,N.transparent&&(N.blend?N.blend(s):(s.blendEquationSeparate(s.FUNC_ADD,s.FUNC_ADD),s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA))));var L=C.matrixSemanticKeys;for(var A=0;A<L.length;A++){var O=L[A],T=C.matrixSemantics[O],M=y[O];if(T.isTranspose){var _=y[T.semanticNoTranspose];c.transpose(M,_)}C.setUniform(s,T.type,T.symbol,M)}E.cullFace!==p&&(p=E.cullFace,s.cullFace(p)),E.frontFace!==g&&(g=E.frontFace,s.frontFace(g)),E.culling!==h&&(h=E.culling,h?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE));var D=E.render(s,n);D&&(i.faceNumber+=D.faceNumber,i.vertexNumber+=D.vertexNumber,i.drawCallNumber+=D.drawCallNumber,i.meshNumber++)}return i},_frustumCulling:function(){var e=new s,t=new o;return function(n,r){var i=n.geometry.boundingBox;t._array=y.WORLDVIEW,e.copy(i),e.applyTransform(t),r.sceneBoundingBoxLastFrame.union(e);if(n.frustumCulling){if(!e.intersectBoundingBox(r.frustum.boundingBox))return!1;t._array=y.PROJECTION,e.max._array[2]>0&&e.min._array[2]<0&&(e.max._array[2]=-1e-20),e.applyProjection(t);var s=e.min._array,o=e.max._array;if(o[0]<-1||s[0]>1||o[1]<-1||s[1]>1||o[2]<-1||s[2]>1)return!1}return!0}}(),disposeScene:function(e){this.disposeNode(e),e.dispose()},disposeNode:function(e){var t={},r=this.gl;e.traverse(function(e){e.geometry&&e.geometry.dispose(r),e.material&&(t[e.material.__GUID__]=e.material),e.dispose&&e.dispose(r)});for(var i in t){var s=t[i];s.shader.dispose(r);for(var o in s.uniforms){var u=s.uniforms[o].value;if(!u)continue;if(u instanceof n)u.dispose(r);else if(u instanceof Array)for(var a=0;a<u.length;a++)u[a]instanceof n&&u[a].dispose(r)}}e._children=[]},disposeShader:function(e){e.dispose(this.gl)},disposeGeometry:function(e){e.dispose(this.gl)},disposeTexture:function(e){e.dispose(this.gl)},disposeFrameBuffer:function(e){e.dispose(this.gl)},dispose:function(){r.dispose(this.gl)},screenToNdc:function(e,t,n){return n||(n=new f),t=this.height-t,n._array[0]=(e-this.viewport.x)/this.viewport.width,n._array[0]=n._array[0]*2-1,n._array[1]=(t-this.viewport.y)/this.viewport.height,n._array[1]=n._array[1]*2-1,n}});g.opaqueSortFunc=function(e,t){return e.material.shader===t.material.shader?e.material===t.material?e.geometry.__GUID__-t.geometry.__GUID__:e.material.__GUID__-t.material.__GUID__:e.material.shader.__GUID__-t.material.shader.__GUID__},g.transparentSortFunc=function(e,t){if(e.__depth===t.__depth)return e.material.shader===t.material.shader?e.material===t.material?e.geometry.__GUID__-t.geometry.__GUID__:e.material.__GUID__-t.material.__GUID__:e.material.shader.__GUID__-t.material.shader.__GUID__;return e.__depth-t.__depth};var y={WORLD:c.create(),VIEW:c.create(),PROJECTION:c.create(),WORLDVIEW:c.create(),VIEWPROJECTION:c.create(),WORLDVIEWPROJECTION:c.create(),WORLDINVERSE:c.create(),VIEWINVERSE:c.create(),PROJECTIONINVERSE:c.create(),WORLDVIEWINVERSE:c.create(),VIEWPROJECTIONINVERSE:c.create(),WORLDVIEWPROJECTIONINVERSE:c.create(),WORLDTRANSPOSE:c.create(),VIEWTRANSPOSE:c.create(),PROJECTIONTRANSPOSE:c.create(),WORLDVIEWTRANSPOSE:c.create(),VIEWPROJECTIONTRANSPOSE:c.create(),WORLDVIEWPROJECTIONTRANSPOSE:c.create(),WORLDINVERSETRANSPOSE:c.create(),VIEWINVERSETRANSPOSE:c.create(),PROJECTIONINVERSETRANSPOSE:c.create(),WORLDVIEWINVERSETRANSPOSE:c.create(),VIEWPROJECTIONINVERSETRANSPOSE:c.create(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:c.create()};return g.COLOR_BUFFER_BIT=i.COLOR_BUFFER_BIT,g.DEPTH_BUFFER_BIT=i.DEPTH_BUFFER_BIT,g.STENCIL_BUFFER_BIT=i.STENCIL_BUFFER_BIT,g}),define("qtek/math/Quaternion",["require","glmatrix"],function(e){var t=e("glmatrix"),n=t.quat,r=function(e,t,r,i){e=e||0,t=t||0,r=r||0,i=i===undefined?1:i,this._array=n.fromValues(e,t,r,i),this._dirty=!0};return r.prototype={constructor:r,get x(){return this._array[0]},set x(e){this._array[0]=e,this._dirty=!0},get y(){return this._array[1]},set y(e){this._array[1]=e,this._dirty=!0},get z(){return this._array[2]},set z(e){this._array[2]=e,this._dirty=!0},get w(){return this._array[3]},set w(e){this._array[3]=e,this._dirty=!0},add:function(e){return n.add(this._array,this._array,e._array),this._dirty=!0,this},calculateW:function(){return n.calculateW(this._array,this._array),this._dirty=!0,this},set:function(e,t,n,r){return this._array[0]=e,this._array[1]=t,this._array[2]=n,this._array[3]=r,this._dirty=!0,this},setArray:function(e){return this._array[0]=e[0],this._array[1]=e[1],this._array[2]=e[2],this._array[3]=e[3],this._dirty=!0,this},clone:function(){return new r(this.x,this.y,this.z,this.w)},conjugate:function(){return n.conjugate(this._array,this._array),this._dirty=!0,this},copy:function(e){return n.copy(this._array,e._array),this._dirty=!0,this},dot:function(e){return n.dot(this._array,e._array)},fromMat3:function(e){return n.fromMat3(this._array,e._array),this._dirty=!0,this},fromMat4:function(){var e=t.mat3,r=e.create();return function(t){return e.fromMat4(r,t._array),e.transpose(r,r),n.fromMat3(this._array,r),this._dirty=!0,this}}(),identity:function(){return n.identity(this._array),this._dirty=!0,this},invert:function(){return n.invert(this._array,this._array),this._dirty=!0,this},len:function(){return n.len(this._array)},length:function(){return n.length(this._array)},lerp:function(e,t,r){return n.lerp(this._array,e._array,t._array,r),this._dirty=!0,this},mul:function(e){return n.mul(this._array,this._array,e._array),this._dirty=!0,this},mulLeft:function(e){return n.multiply(this._array,e._array,this._array),this._dirty=!0,this},multiply:function(e){return n.multiply(this._array,this._array,e._array),this._dirty=!0,this},multiplyLeft:function(e){return n.multiply(this._array,e._array,this._array),this._dirty=!0,this},normalize:function(){return n.normalize(this._array,this._array),this._dirty=!0,this},rotateX:function(e){return n.rotateX(this._array,this._array,e),this._dirty=!0,this},rotateY:function(e){return n.rotateY(this._array,this._array,e),this._dirty=!0,this},rotateZ:function(e){return n.rotateZ(this._array,this._array,e),this._dirty=!0,this},rotationTo:function(e,t){return n.rotationTo(this._array,e._array,t._array),this._dirty=!0,this},setAxes:function(e,t,r){return n.setAxes(this._array,e._array,t._array,r._array),this._dirty=!0,this},setAxisAngle:function(e,t){return n.setAxisAngle(this._array,e._array,t),this._dirty=!0,this},slerp:function(e,t,r){return n.slerp(this._array,e._array,t._array,r),this._dirty=!0,this},sqrLen:function(){return n.sqrLen(this._array)},squaredLength:function(){return n.squaredLength(this._array)},setFromEuler:function(e){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}},r.add=function(e,t,r){return n.add(e._array,t._array,r._array),e._dirty=!0,e},r.set=function(e,t,r,i,s){n.set(e._array,t,r,i,s),e._dirty=!0},r.copy=function(e,t){return n.copy(e._array,t._array),e._dirty=!0,e},r.calculateW=function(e,t){return n.calculateW(e._array,t._array),e._dirty=!0,e},r.conjugate=function(e,t){return n.conjugate(e._array,t._array),e._dirty=!0,e},r.identity=function(e){return n.identity(e._array),e._dirty=!0,e},r.invert=function(e,t){return n.invert(e._array,t._array),e._dirty=!0,e},r.dot=function(e,t){return n.dot(e._array,t._array)},r.len=function(e){return n.length(e._array)},r.lerp=function(e,t,r,i){return n.lerp(e._array,t._array,r._array,i),e._dirty=!0,e},r.slerp=function(e,t,r,i){return n.slerp(e._array,t._array,r._array,i),e._dirty=!0,e},r.mul=function(e,t,r){return n.multiply(e._array,t._array,r._array),e._dirty=!0,e},r.multiply=r.mul,r.rotateX=function(e,t,r){return n.rotateX(e._array,t._array,r),e._dirty=!0,e},r.rotateY=function(e,t,r){return n.rotateY(e._array,t._array,r),e._dirty=!0,e},r.rotateZ=function(e,t,r){return n.rotateZ(e._array,t._array,r),e._dirty=!0,e},r.setAxisAngle=function(e,t,r){return n.setAxisAngle(e._array,t._array,r),e._dirty=!0,e},r.normalize=function(e,t){return n.normalize(e._array,t._array),e._dirty=!0,e},r.sqrLen=function(e){return n.sqrLen(e._array)},r.squaredLength=r.sqrLen,r.fromMat3=function(e,t){return n.fromMat3(e._array,t._array),e._dirty=!0,e},r.setAxes=function(e,t,r,i){return n.setAxes(e._array,t._array,r._array,i._array),e._dirty=!0,e},r.rotationTo=function(e,t,r){return n.rotationTo(e._array,t._array,r._array),e._dirty=!0,e},r}),define("qtek/Node",["require","./core/Base","./math/Vector3","./math/Quaternion","./math/Matrix4","glmatrix"],function(e){var t=e("./core/Base"),n=e("./math/Vector3"),r=e("./math/Quaternion"),i=e("./math/Matrix4"),s=e("glmatrix"),o=s.mat4,u=0,a=t.derive({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,parent:null,scene:null,autoUpdateLocalTransform:!0,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},function(){this.name||(this.name="NODE_"+u++),this.position||(this.position=new n),this.rotation||(this.rotation=new r),this.scale||(this.scale=new n(1,1,1)),this.worldTransform=new i,this.localTransform=new i,this._children=[]},{visible:!0,isRenderable:function(){return!1},setName:function(e){this.scene&&(delete this.scene._nodeRepository[this.name],this.scene._nodeRepository[e]=this),this.name=e},add:function(e){this._inIterating&&console.warn("Add operation can cause unpredictable error when in iterating");if(e.parent===this)return;e.parent&&e.parent.remove(e),e.parent=this,this._children.push(e),this.scene&&this.scene!==e.scene&&e.traverse(this._addSelfToScene,this)},remove:function(e){this._inIterating&&console.warn("Remove operation can cause unpredictable error when in iterating");var t=this._children.indexOf(e);if(t<0)return;this._children.splice(t,1),e.parent=null,this.scene&&e.traverse(this._removeSelfFromScene,this)},_removeSelfFromScene:function(e){e.scene.removeFromScene(e),e.scene=null},_addSelfToScene:function(e,t){t.scene.addToScene(e),e.scene=t.scene},isAncestor:function(e){var t=e.parent;while(t){if(t===this)return!0;t=t.parent}return!1},children:function(){return this._children.slice()},childAt:function(e){return this._children[e]},getChildByName:function(e){for(var t=0;t<this._children.length;t++)if(this._children[t].name===e)return this._children[t]},getDescendantByName:function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];if(n.name===e)return n;var r=n.getDescendantByName(e);if(r)return r}},traverse:function(e,t,n){this._inIterating=!0,(n===undefined||this.constructor===n)&&e(this,t);var r=this._children;for(var i=0,s=r.length;i<s;i++)r[i].traverse(e,this,n);this._inIterating=!1},setLocalTransform:function(e){o.copy(this.localTransform._array,e._array),this.decomposeLocalTransform()},decomposeLocalTransform:function(){this.localTransform.decomposeMatrix(this.scale,this.rotation,this.position)},setWorldTransform:function(e){o.copy(this.worldTransform._array,e._array),this.decomposeWorldTransform()},decomposeWorldTransform:function(){var e=o.create();return function(t){this.parent?(o.invert(e,this.parent.worldTransform._array),o.multiply(this.localTransform._array,e,this.worldTransform._array)):o.copy(this.localTransform._array,t._array),this.localTransform.decomposeMatrix(this.scale,this.rotation,this.position)}}(),updateLocalTransform:function(){var e=this.position,t=this.rotation,n=this.scale;if(e._dirty||n._dirty||t._dirty){var r=this.localTransform._array;o.fromRotationTranslation(r,t._array,e._array),o.scale(r,r,n._array),t._dirty=!1,n._dirty=!1,e._dirty=!1,this._needsUpdateWorldTransform=!0}},updateWorldTransform:function(){this.parent?o.multiply(this.worldTransform._array,this.parent.worldTransform._array,this.localTransform._array):o.copy(this.worldTransform._array,this.localTransform._array)},update:function(e){this.autoUpdateLocalTransform?this.updateLocalTransform():e=!0;if(e||this._needsUpdateWorldTransform)this.updateWorldTransform(),e=!0,this._needsUpdateWorldTransform=!1;for(var t=0,n=this._children.length;t<n;t++)this._children[t].update(e)},getWorldPosition:function(e){var t=this.worldTransform._array;return e?(e._array[0]=t[12],e._array[1]=t[13],e._array[2]=t[14],e):new n(t[12],t[13],t[14])},clone:function(){var e=new this.constructor;e.position.copy(this.position),e.rotation.copy(this.rotation),e.scale.copy(this.scale);for(var t=0;t<this._children.length;t++)e.add(this._children[t].clone());return e},rotateAround:function(){var e=new n,t=new i;return function(n,r,i){e.copy(this.position).subtract(n),this.localTransform.identity(),this.localTransform.translate(n),this.localTransform.rotate(i,r),t.fromRotationTranslation(this.rotation,e),this.localTransform.multiply(t),this.localTransform.scale(this.scale),this.decomposeLocalTransform(),this._needsUpdateWorldTransform=!0}}(),lookAt:function(){var e=new i,t=new n;return function(n,r){e.lookAt(this.position,n,r||this.localTransform.up).invert(),e.decomposeMatrix(t,this.rotation,this.position)}}()});return a}),define("qtek/math/Plane",["require","./Vector3","glmatrix"],function(e){var t=e("./Vector3"),n=e("glmatrix"),r=n.vec3,i=n.mat4,s=n.vec4,o=function(e,n){this.normal=e||new t(0,1,0),this.distance=n||0};return o.prototype={constructor:o,distanceToPoint:function(e){return r.dot(e._array,this.normal._array)-this.distance},projectPoint:function(e,n){n||(n=new t);var i=this.distanceToPoint(e);return r.scaleAndAdd(n._array,e._array,this.normal._array,-i),n._dirty=!0,n},normalize:function(){var e=1/r.len(this.normal._array);r.scale(this.normal._array,e),this.distance*=e},intersectFrustum:function(e){var t=e.vertices,n=this.normal._array,i=r.dot(t[0]._array,n)>this.distance;for(var s=1;s<8;s++)if(r.dot(t[s]._array,n)>this.distance!=i)return!0},intersectLine:function(){var e=r.create();return function(n,i,s){var o=this.distanceToPoint(n),u=this.distanceToPoint(i);if(o>0&&u>0||o<0&&u<0)return null;var a=this.normal._array,f=this.distance,l=n._array;r.sub(e,i._array,n._array),r.normalize(e,e);var c=r.dot(a,e);if(c===0)return null;s||(s=new t);var h=(r.dot(a,l)-f)/c;return r.scaleAndAdd(s._array,l,e,-h),s._dirty=!0,s}}(),applyTransform:function(){var e=i.create(),t=s.create(),n=s.create();return n[3]=1,function(o){o=o._array,r.scale(n,this.normal._array,this.distance),s.transformMat4(n,n,o),this.distance=r.dot(n,this.normal._array),i.invert(e,o),i.transpose(e,e),t[3]=0,r.copy(t,this.normal._array),s.transformMat4(t,t,e),r.copy(this.normal._array,t)}}(),copy:function(e){r.copy(this.normal._array,e.normal._array),this.normal._dirty=!0,this.distance=e.distance},clone:function(){var e=new o;return e.copy(this),e}},o}),define("qtek/math/Frustum",["require","./Vector3","./BoundingBox","./Plane","glmatrix"],function(e){var t=e("./Vector3"),n=e("./BoundingBox"),r=e("./Plane"),i=e("glmatrix"),s=i.vec3,o=function(){this.planes=[];for(var e=0;e<6;e++)this.planes.push(new r);this.boundingBox=new n,this.vertices=[];for(var e=0;e<8;e++)this.vertices[e]=s.fromValues(0,0,0)};return o.prototype={setFromProjection:function(e){var t=this.planes,n=e._array,r=n[0],i=n[1],o=n[2],u=n[3],a=n[4],f=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],v=n[11],m=n[12],g=n[13],y=n[14],b=n[15];s.set(t[0].normal._array,u-r,c-a,v-h),t[0].distance=-(b-m),t[0].normalize(),s.set(t[1].normal._array,u+r,c+a,v+h),t[1].distance=-(b+m),t[1].normalize(),s.set(t[2].normal._array,u+i,c+f,v+p),t[2].distance=-(b+g),t[2].normalize(),s.set(t[3].normal._array,u-i,c-f,v-p),t[3].distance=-(b-g),t[3].normalize(),s.set(t[4].normal._array,u-o,c-l,v-d),t[4].distance=-(b-y),t[4].normalize(),s.set(t[5].normal._array,u+o,c+l,v+d),t[5].distance=-(b+y),t[5].normalize();if(b===0){var w=f/r,E=-y/(d-1),S=-y/(d+1),x=-S/f,T=-E/f;this.boundingBox.min.set(-x*w,-x,S),this.boundingBox.max.set(x*w,x,E);var N=this.vertices;s.set(N[0],-x*w,-x,S),s.set(N[1],-x*w,x,S),s.set(N[2],x*w,-x,S),s.set(N[3],x*w,x,S),s.set(N[4],-T*w,-T,E),s.set(N[5],-T*w,T,E),s.set(N[6],T*w,-T,E),s.set(N[7],T*w,T,E)}else{var C=(-1-m)/r,k=(1-m)/r,L=(1-g)/f,A=(-1-g)/f,O=(-1-y)/d,M=(1-y)/d;this.boundingBox.min.set(C,A,M),this.boundingBox.max.set(k,L,O);for(var _=0;_<8;_++)s.copy(this.vertices[_],this.boundingBox.vertices[_])}},getTransformedBoundingBox:function(){var e=s.create();return function(t,n){var r=this.vertices,i=n._array,o=t.min._array,u=t.max._array,a=r[0];s.transformMat4(e,a,i),s.copy(o,e),s.copy(u,e);for(var f=1;f<8;f++)a=r[f],s.transformMat4(e,a,i),o[0]=Math.min(e[0],o[0]),o[1]=Math.min(e[1],o[1]),o[2]=Math.min(e[2],o[2]),u[0]=Math.max(e[0],u[0]),u[1]=Math.max(e[1],u[1]),u[2]=Math.max(e[2],u[2]);return t.min._dirty=!0,t.max._dirty=!0,t}}()},o}),define("qtek/math/Ray",["require","./Vector3","glmatrix"],function(e){var t=e("./Vector3"),n=e("glmatrix"),r=n.vec3,i=1e-5,s=function(e,n){this.origin=e||new t,this.direction=n||new t};return s.prototype={constructor:s,intersectPlane:function(e,n){var i=e.normal._array,s=e.distance,o=this.origin._array,u=this.direction._array,a=r.dot(i,u);if(a===0)return null;n||(n=new t);var f=(r.dot(i,o)-s)/a;return r.scaleAndAdd(n._array,o,u,-f),n._dirty=!0,n},mirrorAgainstPlane:function(e){var t=r.dot(e.normal._array,this.direction._array);r.scaleAndAdd(this.direction._array,this.direction._array,e.normal._array,-t*2),this.direction._dirty=!0},intersectBoundingBox:function(e,n){var i=this.direction._array,s=this.origin._array,o=e.min._array,u=e.max._array,a=1/i[0],f=1/i[1],l=1/i[2],c,h,p,d,v,m;a>=0?(c=(o[0]-s[0])*a,h=(u[0]-s[0])*a):(h=(o[0]-s[0])*a,c=(u[0]-s[0])*a),f>=0?(p=(o[1]-s[1])*f,d=(u[1]-s[1])*f):(d=(o[1]-s[1])*f,p=(u[1]-s[1])*f);if(c>d||p>h)return null;if(p>c||c!==c)c=p;if(d<h||h!==h)h=d;l>=0?(v=(o[2]-s[2])*l,m=(u[2]-s[2])*l):(m=(o[2]-s[2])*l,v=(u[2]-s[2])*l);if(c>m||v>h)return null;if(v>c||c!==c)c=v;if(m<h||h!==h)h=m;if(h<0)return null;var g=c>=0?c:h;return n||(n=new t),r.scaleAndAdd(n._array,s,i,g),n},intersectTriangle:function(){var e=r.create(),n=r.create(),s=r.create(),o=r.create();return function(u,a,f,l,c){var h=this.direction._array,p=this.origin._array;u=u._array,a=a._array,f=f._array,r.sub(e,a,u),r.sub(n,f,u),r.cross(o,n,h);var d=r.dot(e,o);if(l){if(d>-i)return null}else if(d>-i&&d<i)return null;r.sub(s,p,u);var v=r.dot(o,s)/d;if(v<0||v>1)return null;r.cross(o,e,s);var m=r.dot(h,o)/d;if(m<0||m>1||v+m>1)return null;r.cross(o,e,n);var g=-r.dot(s,o)/d;return g<0?null:(c||(c=new t),r.scaleAndAdd(c._array,p,h,g),c)}}(),applyTransform:function(e){t.add(this.direction,this.direction,this.origin),t.transformMat4(this.origin,this.origin,e),t.transformMat4(this.direction,this.direction,e),t.sub(this.direction,this.direction,this.origin),t.normalize(this.direction,this.direction)},copy:function(e){t.copy(this.origin,e.origin),t.copy(this.direction,e.direction)},clone:function(){var e=new s;return e.copy(this),e}},s}),define("qtek/Camera",["require","./Node","./math/Matrix4","./math/Frustum","./math/BoundingBox","./math/Ray","glmatrix"],function(e){var t=e("./Node"),n=e("./math/Matrix4"),r=e("./math/Frustum"),i=e("./math/BoundingBox"),s=e("./math/Ray"),o=e("glmatrix"),u=o.mat4,a=o.vec3,f=o.vec4,l=t.derive(function(){return{projectionMatrix:new n,invProjectionMatrix:new n,viewMatrix:new n,frustum:new r,sceneBoundingBoxLastFrame:new i}},function(){this.update(!0)},{update:function(e){t.prototype.update.call(this,e),u.invert(this.viewMatrix._array,this.worldTransform._array),this.updateProjectionMatrix(),u.invert(this.invProjectionMatrix._array,this.projectionMatrix._array),this.frustum.setFromProjection(this.projectionMatrix)},updateProjectionMatrix:function(){},castRay:function(){var e=f.create();return function(t,n){var r=n!==undefined?n:new s,i=t._array[0],o=t._array[1];return f.set(e,i,o,-1,1),f.transformMat4(e,e,this.invProjectionMatrix._array),f.transformMat4(e,e,this.worldTransform._array),a.scale(r.origin._array,e,1/e[3]),f.set(e,i,o,1,1),f.transformMat4(e,e,this.invProjectionMatrix._array),f.transformMat4(e,e,this.worldTransform._array),a.scale(e,e,1/e[3]),a.sub(r.direction._array,e,r.origin._array),a.normalize(r.direction._array,r.direction._array),r.direction._dirty=!0,r.origin._dirty=!0,r}}()});return l}),define("qtek/camera/Orthographic",["require","../Camera"],function(e){var t=e("../Camera"),n=t.derive({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},clone:function(){var e=t.prototype.clone.call(this);return e.left=this.left,e.right=this.right,e.near=this.near,e.far=this.far,e.top=this.top,e.bottom=this.bottom,e}});return n}),define("qtek/2d/context/tool/CachedList",["require"],function(e){var t=function(e,t){this.factory=e,this.maxRange=t||50,this._size=0,this._data=[],this._max=0,this._needsClearCount=0};return t.prototype={constructor:t,increase:function(){var e=this._data[this._size];return e||(e=this._data[this._size]=new this.factory),this._size++,e},decrease:function(){this._size>0&&this._size--},clear:function(e){this.tick(e),this._size=0},tick:function(e){this._size>0&&this._max/this._size>2||this._max-this._size>this.maxRange?this._needsClearCount++:this._max<this._size?(this._needsClearCount=0,this._max=this._size):this._needsClearCount=0;if(this._needsClearCount>10){if(e)for(var t=this._size;t<this._data.length;t++)e(this._data[t]);this._max=this._data.length=this._size}},size:function(){return this._size},data:function(){return this._data},get:function(e){return this._data[e]}},t}),define("qtek/2d/context/CanvasElement",["require"],function(e){var t=function(){},n=["hasFill","hasStroke","getHashKey","updateVertices","afterDraw"],r=["updateElements","addElement","clearElements"];t._factories=[];var i=t._factories;return t.register=function(e,n){if(e&&!t._checkElementClass(e))return;if(n&&!t._checkPrimitiveClass(n))return;var r=i.length;return i.push({fElement:e,fPrimitive:n}),r},t._checkElementClass=function(e){var t=!0;for(var r=0;r<n.length;r++){var i=n[r];typeof e.prototype[i]=="undefined"&&(console.warn(i+" method must be implemented in Element"),t=!1)}return t},t._checkPrimitiveClass=function(e){var t=!0;for(var n=0;n<r.length;n++){var i=r[n];typeof e.prototype[i]=="undefined"&&(console.warn(i+" method must be implemented in Element"),t=!1)}return t},t.setPrimitiveClass=function(e,n){if(!t._checkPrimitiveClass(n))return;var r=i[e];r&&(r.fPrimitive=n)},t.setElementClass=function(e,n){if(!t._checkElementClass(n))return;var r=i[e];r&&(r.fElement=n)},t.getPrimitiveClass=function(e){var t=i[e];if(t)return t.fPrimitive},t.getElementClass=function(e){var t=i[e];if(t)return t.fElement},t.createElement=function(e){var t=i[e];if(t)return new t.fElement},t.createPrimitive=function(e){var t=i[e];if(t)return new t.fPrimitive},t.getClassNumber=function(){return i.length},t}),define("qtek/Geometry",["require","./core/Base","./core/glenum","./core/Cache"],function(e){function i(e,t,n,r,i){this.name=e,this.type=t,this.size=n,r&&(this.semantic=r),i?(this._isDynamic=!0,this.value=[]):(this._isDynamic=!1,this.value=null)}function s(e,t,n,r,i){this.name=e,this.type=t,this.buffer=n,this.size=r,this.semantic=i,this.symbol=""}function o(e,t){this.buffer=e,this.count=t}function u(){console.warn("Geometry doesn't implement this method, use DynamicGeometry or StaticGeometry instead")}var t=e("./core/Base"),n=e("./core/glenum"),r=e("./core/Cache");i.prototype.init=function(e){if(!this._isDynamic){if(!this.value||this.value.length!=e*this.size){var t;switch(this.type){case"byte":t=Int8Array;break;case"ubyte":t=Uint8Array;break;case"short":t=Int16Array;break;case"ushort":t=Uint16Array;break;default:t=Float32Array}this.value=new t(e*this.size)}}else console.warn("Dynamic geometry not support init method")},i.prototype.clone=function(e){var t=new i(this.name,this.type,this.size,this.semantic,this._isDynamic);return e&&console.warn("todo"),t};var a=t.derive({boundingBox:null,attributes:{},faces:null,useFace:!0,chunkSize:65535},function(){this._cache=new r,this._attributeList=Object.keys(this.attributes)},{dirty:u,createAttribute:u,removeAttribute:u,getVertexNumber:u,getFaceNumber:u,isUseFace:u,isStatic:u,getEnabledAttributes:u,getBufferChunks:u,generateVertexNormals:u,generateFaceNormals:u,isUniqueVertex:u,generateUniqueVertex:u,generateTangents:u,generateBarycentric:u,applyTransform:u,dispose:u});return a.STATIC_DRAW=n.STATIC_DRAW,a.DYNAMIC_DRAW=n.DYNAMIC_DRAW,a.STREAM_DRAW=n.STREAM_DRAW,a.AttributeBuffer=s,a.IndicesBuffer=o,a.Attribute=i,a}),define("qtek/StaticGeometry",["require","./Geometry","./math/BoundingBox","glmatrix","./core/glenum"],function(e){var t=e("./Geometry"),n=e("./math/BoundingBox"),r=e("glmatrix"),i=e("./core/glenum"),s=r.mat4,o=r.vec3,u=t.derive(function(){return{attributes:{position:new t.Attribute("position","float",3,"POSITION",!1),texcoord0:new t.Attribute("texcoord0","float",2,"TEXCOORD_0",!1),texcoord1:new t.Attribute("texcoord1","float",2,"TEXCOORD_1",!1),normal:new t.Attribute("normal","float",3,"NORMAL",!1),tangent:new t.Attribute("tangent","float",4,"TANGENT",!1),color:new t.Attribute("color","float",4,"COLOR",!1),weight:new t.Attribute("weight","float",3,"WEIGHT",!1),joint:new t.Attribute("joint","float",4,"JOINT",!1),barycentric:new t.Attribute("barycentric","float",3,null,!1)},hint:i.STATIC_DRAW,faces:null,_normalType:"vertex",_enabledAttributes:null}},{dirty:function(){this._cache.dirtyAll(),this._enabledAttributes=null},getVertexNumber:function(){return this.attributes.position.value?this.attributes.position.value.length/3:0},getFaceNumber:function(){return this.faces.length/3},isUseFace:function(){return this.useFace&&this.faces!=null},isStatic:function(){return!0},createAttribute:function(e,n,r,i){var s=new t.Attribute(e,n,r,i,!1);return this.attributes[e]=s,this._attributeList.push(e),s},removeAttribute:function(e){var t=this._attributeList.indexOf(e);return t>=0?(this._attributeList.splice(t,1),delete this.attributes[e],!0):!1},getEnabledAttributes:function(){if(this._enabledAttributes)return this._enabledAttributes;var e=[],t=this.getVertexNumber();for(var n=0;n<this._attributeList.length;n++){var r=this._attributeList[n],i=this.attributes[r];i.value&&i.value.length===t*i.size&&e.push(r)}return this._enabledAttributes=e,e},getBufferChunks:function(e){return this._cache.use(e.__GLID__),this._cache.isDirty()&&(this._updateBuffer(e),this._cache.fresh()),this._cache.get("chunks")},_updateBuffer:function(e){var n=this._cache.get("chunks"),r=!1;n||(n=[],n[0]={attributeBuffers:[],indicesBuffer:null},this._cache.put("chunks",n),r=!0);var i=n[0],s=i.attributeBuffers,o=i.indicesBuffer,u=this.getEnabledAttributes(),a=0,f=0;for(var l=0;l<u.length;l++){var c=u[l],h=this.attributes[c],p;if(!r){for(var d=a;d<s.length;d++)if(s[d].name===c){p=s[d],a=d+1;break}if(!p)for(var d=a-1;d>=0;d--)if(s[d].name===c){p=s[d],a=d;break}}var v;p?v=p.buffer:v=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,v),e.bufferData(e.ARRAY_BUFFER,h.value,this.hint),s[f++]=new t.AttributeBuffer(c,h.type,v,h.size,h.semantic)}s.length=f,!o&&this.isUseFace()&&(o=new t.IndicesBuffer(e.createBuffer(),this.faces.length),i.indicesBuffer=o,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.faces,this.hint))},generateVertexNormals:function(){var e=this.faces,t=this.attributes.position.value,n=this.attributes.normal.value;if(!n||n.length!==t.length)n=this.attributes.normal.value=new Float32Array(t.length);else for(var r=0;r<n.length;r++)n[r]=0;var i=o.create(),s=o.create(),u=o.create(),a=o.create(),f=o.create(),l=o.create();for(var c=0;c<e.length;){var h=e[c++],p=e[c++],d=e[c++];o.set(i,t[h*3],t[h*3+1],t[h*3+2]),o.set(s,t[p*3],t[p*3+1],t[p*3+2]),o.set(u,t[d*3],t[d*3+1],t[d*3+2]),o.sub(a,i,s),o.sub(f,s,u),o.cross(l,a,f);for(var r=0;r<3;r++)n[h*3+r]=n[h*3+r]+l[r],n[p*3+r]=n[p*3+r]+l[r],n[d*3+r]=n[d*3+r]+l[r]}for(var r=0;r<n.length;)o.set(l,n[r],n[r+1],n[r+2]),o.normalize(l,l),n[r++]=l[0],n[r++]=l[1],n[r++]=l[2]},generateFaceNormals:function(){this.isUniqueVertex()||this.generateUniqueVertex();var e=this.faces,t=this.attributes.position.value,n=this.attributes.normal.value,r=o.create(),i=o.create(),s=o.create(),u=o.create(),a=o.create(),f=o.create();n||(n=this.attributes.position.value=new Float32Array(t.length));for(var l=0;l<e.length;){var c=e[l++],h=e[l++],p=e[l++];o.set(r,t[c*3],t[c*3+1],t[c*3+2]),o.set(i,t[h*3],t[h*3+1],t[h*3+2]),o.set(s,t[p*3],t[p*3+1],t[p*3+2]),o.sub(u,r,i),o.sub(a,i,s),o.cross(f,u,a),o.normalize(f,f);for(var d=0;d<3;d++)n[c*3+d]=f[d],n[h*3+d]=f[d],n[p*3+d]=f[d]}},generateTangents:function(){var e=this.getVertexNumber();this.attributes.tangent.value||(this.attributes.tangent.value=new Float32Array(e*4));var t=this.attributes.texcoord0.value,n=this.attributes.position.value,r=this.attributes.tangent.value,i=this.attributes.normal.value,s=[],u=[];for(var a=0;a<e;a++)s[a]=[0,0,0],u[a]=[0,0,0];var f=[0,0,0],l=[0,0,0];for(var a=0;a<this.faces.length;){var c=this.faces[a++],h=this.faces[a++],p=this.faces[a++],d=t[c*2],v=t[h*2],m=t[p*2],g=t[c*2+1],y=t[h*2+1],b=t[p*2+1],w=n[c*3],E=n[h*3],S=n[p*3],x=n[c*3+1],T=n[h*3+1],N=n[p*3+1],C=n[c*3+2],k=n[h*3+2],L=n[p*3+2],A=E-w,O=S-w,M=T-x,_=N-x,D=k-C,P=L-C,H=v-d,B=m-d,j=y-g,F=b-g,I=1/(H*F-j*B);f[0]=(F*A-j*O)*I,f[1]=(F*M-j*_)*I,f[2]=(F*D-j*P)*I,l[0]=(H*O-B*A)*I,l[1]=(H*_-B*M)*I,l[2]=(H*P-B*D)*I,o.add(s[c],s[c],f),o.add(s[h],s[h],f),o.add(s[p],s[p],f),o.add(u[c],u[c],l),o.add(u[h],u[h],l),o.add(u[p],u[p],l)}var q=o.create(),R=o.create(),U=o.create();for(var a=0;a<e;a++){U[0]=i[a*3],U[1]=i[a*3+1],U[2]=i[a*3+2];var z=s[a];o.scale(q,U,o.dot(U,z)),o.sub(q,z,q),o.normalize(q,q),o.cross(R,U,z),r[a*4]=q[0],r[a*4+1]=q[1],r[a*4+2]=q[2],r[a*4+3]=o.dot(R,u[a])<0?-1:1}},isUniqueVertex:function(){return this.isUseFace()?this.getVertexNumber()===this.faces.length:!0},generateUniqueVertex:function(){var e=[];for(var t=0,n=this.getVertexNumber();t<n;t++)e[t]=0;var r=this.getVertexNumber(),i=this.attributes,s=this.faces,o=this.getEnabledAttributes();for(var u=0;u<o.length;u++){var a=o[u],f=new Float32Array(this.faces.length*i[a].size),n=i[a].value.length;for(var t=0;t<n;t++)f[t]=i[a].value[t];i[a].value=f}for(var t=0;t<s.length;t++){var l=s[t];if(e[l]>0){for(var u=0;u<o.length;u++){var a=o[u],c=i[a].value,h=i[a].size;for(var p=0;p<h;p++)c[r*h+p]=c[l*h+p]}s[t]=r,r++}e[l]++}},generateBarycentric:function(){this.isUniqueVertex()||this.generateUniqueVertex();var e=this.attributes.barycentric.value;if(e&&e.length===this.faces.length*3)return;e=this.attributes.barycentric.value=new Float32Array(this.faces.length*3);for(var t=0;t<this.faces.length;)for(var n=0;n<3;n++){var r=this.faces[t++];e[r+n]=1}},convertToDynamic:function(e){for(var t=0;t<this.faces.length;t+=3)e.faces.push(this.face.subarray(t,t+3));var r=this.getEnabledAttributes();for(var i in r){var s=r[i],o=e.attributes[i];o||(o=e.attributes[i]={type:s.type,size:s.size,value:[]},s.semantic&&(o.semantic=s.semantic));for(var t=0;t<s.value.length;t+=s.size)s.size===1?o.value.push(s.array[t]):o.value.push(s.subarray(t,t+s.size))}return this.boundingBox&&(e.boundingBox=new n,e.boundingBox.min.copy(this.boundingBox.min),e.boundingBox.max.copy(this.boundingBox.max)),e},applyTransform:function(e){this.boundingBox&&this.boundingBox.applyTransform(e);var t=this.attributes.position.value,n=this.attributes.normal.value,r=this.attributes.tangent.value;e=e._array;var i=s.create();s.invert(i,e),s.transpose(i,i),o.forEach(t,3,0,null,o.transformMat4,e),n&&o.forEach(n,3,0,null,o.transformMat4,i),r&&o.forEach(r,4,0,null,o.transformMat4,i)},dispose:function(e){this._cache.use(e.__GLID__);var t=this._cache.get("chunks");if(t)for(var n=0;n<t.length;n++){var r=t[n];for(var i=0;i<r.attributeBuffers.length;i++){var s=r.attributeBuffers[i];e.deleteBuffer(s.buffer)}}this._cache.deleteContext(e.__GLID__)}});return u}),define("qtek/2d/context/Geometry2D",["require","qtek/Geometry","qtek/StaticGeometry"],function(e){var t=e("qtek/Geometry"),n=e("qtek/StaticGeometry"),r=t.derive({_enabledAttributes:null,hint:t.DYNAMIC_DRAW},{dirty:function(){this._cache.dirtyAll()},getVertexNumber:n.prototype.getVertexNumber,getFaceNumber:n.prototype.getFaceNumber,isUseFace:n.prototype.isUseFace,getEnabledAttributes:n.prototype.getEnabledAttributes,getBufferChunks:n.prototype.getBufferChunks,_updateBuffer:n.prototype._updateBuffer});return r}),define("qtek/2d/context/tool/color",[],function(){function t(e){return e=Math.round(e),e<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function r(e){return e[e.length-1]==="%"?t(parseFloat(e)/100*255):t(parseInt(e))}function i(e){return e[e.length-1]==="%"?n(parseFloat(e)/100):n(parseFloat(e))}function s(e,t,n){return n<0?n+=1:n>1&&(n-=1),n*6<1?e+(t-e)*n*6:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}function o(n){var o=n.replace(/ /g,"").toLowerCase();if(o in e)return e[o].slice();if(o[0]==="#"){if(o.length===4){var u=parseInt(o.substr(1),16);return u>=0&&u<=4095?[(u&3840)>>4|(u&3840)>>8,u&240|(u&240)>>4,u&15|(u&15)<<4,1]:null}if(o.length===7){var u=parseInt(o.substr(1),16);return u>=0&&u<=16777215?[(u&16711680)>>16,(u&65280)>>8,u&255,1]:null}return null}var a=o.indexOf("("),f=o.indexOf(")");if(a!==-1&&f+1===o.length){var l=o.substr(0,a),c=o.substr(a+1,f-(a+1)).split(","),h=1;switch(l){case"rgba":if(c.length!==4)return null;h=i(c.pop());case"rgb":if(c.length!==3)return null;return[r(c[0]),r(c[1]),r(c[2]),h];case"hsla":if(c.length!==4)return null;h=i(c.pop());case"hsl":if(c.length!==3)return null;var p=(parseFloat(c[0])%360+360)%360/360,d=i(c[1]),v=i(c[2]),m=v<=.5?v*(d+1):v+d-v*d,g=v*2-m;return[t(s(g,m,p+1/3)*255),t(s(g,m,p)*255),t(s(g,m,p-1/3)*255),h];default:return null}}return null}var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};return{parse:o}}),define("qtek/2d/context/DrawingStyle",["require","./tool/color"],function(e){"use strict";var t=e("./tool/color"),n=function(){this.strokeStyle=[0,0,0,1],this.fillStyle=[0,0,0,1]};return n.prototype.lineWidth=1,n.prototype.globalAlpha=1,n.prototype.shadowOffsetX=0,n.prototype.shadowOffsetY=0,n.prototype.shadowBlur=0,n.prototype.shadowColor=[0,0,0],n.prototype.setStrokeStyle=function(e){if(typeof e=="string")var n=t.parse(e);else if(e.length==3||e.length==4)n=e;n?(this.strokeStyle[0]=n[0]/255,this.strokeStyle[1]=n[1]/255,this.strokeStyle[2]=n[2]/255,this.strokeStyle[3]=n[3]||1):(this.strokeStyle[0]=0,this.strokeStyle[1]=0,this.strokeStyle[2]=0,this.strokeStyle[3]=1)},n.prototype.setFillStyle=function(e){var n;if(typeof e=="string")n=t.parse(e);else if(e.length==3||e.length==4)n=e;n?(this.fillStyle[0]=n[0]/255,this.fillStyle[1]=n[1]/255,this.fillStyle[2]=n[2]/255,this.fillStyle[3]=n[3]||1):(this.fillStyle[0]=0,this.fillStyle[1]=0,this.fillStyle[2]=0,this.fillStyle[3]=1)},n.prototype.copy=function(e){this.strokeStyle=e.strokeStyle.slice(),this.fillStyle=e.fillStyle.slice(),this.lineWidth=e.lineWidth,this.globalAlpha=e.globalAlpha,this.shadowOffsetX=e.shadowOffsetX,this.shadowOffsetY=e.shadowOffsetY,this.shadowBlur=e.shadowBlur,this.shadowColor=e.shadowColor.slice()},n.prototype.clone=function(e){},n}),define("qtek/2d/context/tool/math",[],function(){var e={area:function(e){var t=e.length/2;if(t<3)return 0;var n=0;for(var r=(t-1)*2,i=0;i<t*2;){var s=e[r],o=e[r+1],u=e[i],a=e[i+1];r=i,i+=2,n+=s*a-u*o}return n},isCCW:function(e){return this.area(e)<0},triangleArea:function(e,t,n,r,i,s){return(n-e)*(s-r)-(r-t)*(i-n)},isTriangleConvex:function(e,t,n,r,i,s){return(n-e)*(s-r)-(r-t)*(i-n)<0},isPointInTriangle:function(t,n,r,i,s,o,u,a){return!(e.triangleArea(t,n,s,o,u,a)<=0||e.triangleArea(t,n,u,a,r,i)<=0||e.triangleArea(u,a,s,o,r,i)<=0)},approxEqualInt:function(e,t){return Math.abs(e-t)<.1},approxEqual:function(e,t){return Math.abs(e-t)<1e-5},reverse:function(e,t,n){for(var r=0;r<Math.floor(t/2);r++)for(var i=0;i<n;i++){var s=r*n+i,o=(t-r-1)*n+i,u=e[s];e[s]=e[o],e[o]=u}return e}};return e}),define("qtek/2d/context/LineSegment",["require","./tool/math"],function(e){var t=e("./tool/math"),n=function(e,t,r,i){this.type=n.type,this.thickness=0,this.points=[e,t,r,i]};return n.prototype.strokeSteps=1,n.prototype.reverse=function(){t.reverse(this.points,2,2)},n.type=1,n}),define("qtek/2d/context/tool/GJK",["require","./math"],function(e){var t=e("./math"),n=function(){this._D=[0,0],this._S=[0,0]};n.prototype.intersect=function(e,t){var n=this._D,r=this._S;n[0]=e[0]-t[0],n[1]=e[1]-t[1],this._support(e,t,n,r),n[0]=-r[0],n[1]=-r[1];var i=r.slice();for(;;){this._support(e,t,n,r);if(n[0]*r[0]+n[1]*r[1]<=0)return!1;i.push(r[0]),i.push(r[1]);var s=this._updateSimplex(i,n);if(s)return!0}};var r=[0,0],i=[0,0];return n.prototype._updateSimplex=function(e,n){var s=e.length/2;switch(s){case 2:var o=e[2],u=e[3],a=e[0],f=e[1];i[0]=a-o,i[1]=f-u,i[0]*-o+i[1]*-u<0?(e.shift(),e.shift(),n[0]=-o,n[1]=-u):-i[1]*-o+i[0]*-u>0?(n[0]=-i[1],n[1]=i[0]):(n[0]=i[1],n[1]=-i[0]);break;case 3:var o=e[4],u=e[5],a=e[2],f=e[3],l=e[0],c=e[1];t.isTriangleConvex(o,u,l,c,a,f)||(a=e[0],f=e[1],l=e[2],c=e[3]),r[0]=l-o,r[1]=c-u,i[0]=a-o,i[1]=f-u;if(!t.isTriangleConvex(0,0,o,u,l,c))-o*r[0]+ -u*r[1]>0?(e.length=4,e[0]=l,e[1]=c,e[2]=o,e[3]=u,-r[1]*-o+r[0]*-u>0?(n[0]=-r[1],n[1]=r[0]):(n[0]=r[1],n[1]=-r[0])):(e.length=2,e[0]=o,e[1]=u,n[0]=-o,n[1]=-u);else{if(!t.isTriangleConvex(0,0,o,u,a,f))return!0;i[0]*-o+i[1]*-u>0?(e.length=4,e[0]=a,e[1]=f,e[2]=o,e[3]=u,-i[1]*-o+i[0]*-u>0?(n[0]=-i[1],n[1]=i[0]):(n[0]=i[1],n[1]=-i[0])):(e.length=2,e[0]=o,e[1]=u,n[0]=-o,n[1]=-u)}}},n.prototype._support=function(e,t,n,r){var i=-Infinity,s,o,u,a;for(var f=0;f<e.length;){var l=e[f++],c=e[f++],h=l*-n[0]+c*-n[1];h>i&&(i=h,s=l,o=c)}i=-Infinity;for(f=0;f<t.length;)l=t[f++],c=t[f++],h=l*n[0]+c*n[1],h>i&&(i=h,u=l,a=c);return r[0]=u-s,r[1]=a-o,r},n}),define("qtek/2d/context/BezierCurveSegment",["require","./tool/math","glmatrix","./tool/GJK"],function(e){var t=e("./tool/math"),n=e("glmatrix"),r=n.vec3,i=n.vec2,s=n.mat4,o=5e-5,u=e("./tool/GJK"),a=new u,f=function(e){return e<o&&e>-o?0:e},l=function(e,t,n,r,i,s,o,u){this.type=l.type,this.points=[e,t,n,r,i,s,o,u],this.thickness=0,this.coords=[],this.subCurveA=null,this.subCurveB=null,this.subdivisionLevel=0,this.triangles=[]};return l.prototype.strokeSteps=0,l.prototype.fx=0,l.prototype.fy=0,l.prototype.dfx=0,l.prototype.dfy=0,l.prototype.ddfx=0,l.prototype.ddfy=0,l.prototype.dddfx=0,l.prototype.dddfy=0,l.prototype.updateStrokeSegments=function(e,t){var n=this.points,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=(s-r)*e,h=(o-i)*t,p=(u-s)*e,d=(a-o)*t,v=(f-u)*e,m=(l-a)*t,g=Math.sqrt(c*c+h*h)+Math.sqrt(p*p+d*d)+Math.sqrt(v*v+m*m);this.strokeSteps=Math.ceil(g*.25);var y=1/(this.strokeSteps+1),b=y*y,w=b*y,E=3*y,S=3*b,x=6*b,T=6*w,N=r-s*2+u,C=i-o*2+a,k=(s-u)*3-r+f,L=(o-a)*3-i+l;this.fx=n[0],this.fy=n[1],this.dfx=(s-r)*E+N*S+k*w,this.dfy=(o-i)*E+C*S+L*w,this.ddfx=N*x+k*T,this.ddfy=C*x+L*T,this.dddfx=k*T,this.dddfy=L*T},l.prototype.reverse=function(){t.reverse(this.points,4,2),this.coords.length===12&&t.reverse(this.coords,4,3);for(var e=0;e<this.triangles.length;e++)this.triangles[e]=4-this.triangles[e];var n=this.points;this.fx=n[0],this.fy=n[1],this.dfx=-this.dfx,this.dfy=-this.dfy,this.ddfx=-this.ddfx,this.ddfy=-this.ddfy,this.dddfx=-this.dddfx,this.dddfy=-this.dddfy},l.prototype.subdivide=function(e){var t=this.points,n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],c=(i-n)*e+n,h=(s-r)*e+r,p=(o-i)*e+i,d=(u-s)*e+s,v=(a-o)*e+o,m=(f-u)*e+u,g=(p-c)*e+c,y=(d-h)*e+h,b=(v-p)*e+p,w=(m-d)*e+d,E=(b-g)*e+g,S=(w-y)*e+y,x=new l(n,r,c,h,g,y,E,S),T=new l(E,S,b,w,v,m,a,f);x.subdivisionLevel=this.subdivisionLevel+1,T.subdivisionLevel=this.subdivisionLevel+1,this.subCurveA=x,this.subCurveB=T},l.prototype.intersectCurve=function(e){return this.subCurveA?e.subCurveA?this.subCurveA.intersectCurve(e.subCurveA)||this.subCurveA.intersectCurve(e.subCurveB)||this.subCurveB.intersectCurve(e.subCurveA)||this.subCurveB.intersectCurve(e.subCurveB):this.subCurveA.intersectCurve(e)||this.subCurveB.intersectCurve(e):a.intersect(this.points,e.points)},l.prototype.updateTriangles=function(){var e=this._getTriangles();for(var t=0;t<e.length;t++)this.triangles[t]=e[t];this.triangles.length=e.length},l.prototype.updateTextureCoords=function(){var e=r.fromValues(0,0,1),t=r.fromValues(0,0,1),n=r.fromValues(0,0,1),s=r.fromValues(0,0,1),o=r.create(),u,a,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k=1/3,L=-1;return function(A){var O=this.coords,M=this.points,_=M[0],D=M[1],P=M[2],H=M[3],B=M[4],j=M[5],F=M[6],I=M[7];i.set(e,_,D),i.set(t,P,H),i.set(n,B,j),i.set(s,F,I),r.cross(o,s,n),u=r.dot(e,o),r.cross(o,e,s),a=r.dot(t,o),r.cross(o,t,e),l=r.dot(n,o),c=u-2*a+3*l,h=-a+3*l,p=3*l,c=f(c),h=f(h),p=f(p),T=1;if(c==0&&h==0&&p==0)return;c==0&&h==0?(T=p<0?-T:T,O[0]=O[1]=O[2]=0,O[3]=k*T,O[4]=0,O[5]=k,O[6]=2/3*T,O[7]=k*T,O[8]=k,O[9]=O[10]=T,O[11]=1):(E=3*h*h-4*c*p,E=f(E),E==0&&c==0?(d=p,v=3*h,S=v-d,O[0]=d,O[1]=d*d*d,O[2]=1,O[3]=d-k*v,O[4]=d*d*-S,O[5]=1,O[6]=d-2*k*v,O[7]=S*S*d,O[8]=1,O[9]=-S,O[10]=-S*S*S,O[11]=1):E>=0?(w=Math.sqrt(E*3),d=3*h-w,v=6*c,m=3*h+w,g=v,C=Math.sqrt(d*d+v*v),d/=C,v/=C,C=Math.sqrt(m*m+g*g),m/=C,g/=C,S=v-d,x=g-m,T=c<0?-T:T,O[0]=d*m*T,O[1]=d*d*d*T,O[2]=m*m*m,O[3]=k*(3*d*m-d*g-v*m)*T,O[4]=d*d*-S*T,O[5]=m*m*-x,O[6]=k*(v*(g-2*m)+d*(3*m-2*g))*T,O[7]=S*S*d*T,O[8]=x*x*m,O[9]=S*x*T,O[10]=-S*S*S*T,O[11]=-x*x*x):(w=Math.sqrt(-E),d=h-w,v=2*c,m=h+w,g=v,C=Math.sqrt(d*d+v*v),d/=C,v/=C,C=Math.sqrt(m*m+g*g),m/=C,g/=C,y=d/v,b=m/g,y>0&&y<1?L=y:b>0&&b<1?L=b:L=-1,L<0||A?(S=v-d,x=g-m,N=f(d*m),T=c>0&&N<0||c<0&&N>0?-T:T,O[0]=N*T,O[1]=d*d*m*T,O[2]=d*m*m,O[3]=k*(-d*g-v*m+3*d*m)*T,O[4]=-k*d*(d*(g-3*m)+2*v*m)*T,O[5]=-k*m*(d*(2*g-3*m)+v*m),O[6]=k*(v*(g-2*m)+d*(3*m-2*g))*T,O[7]=k*S*(d*(2*g-3*m)+v*m)*T,O[8]=k*x*(d*(g-3*m)+2*v*m),O[9]=S*x*T,O[10]=-S*S*x*T,O[11]=-S*x*x):(this.subdivide(L),this.subCurveA.updateTextureCoords(!0),this.subCurveB.updateTextureCoords(!0)))),this.updateTriangles()}}(),l.prototype._getTriangles=function(){var e=[0,1,3,0,2,3],n=[1,0,3,1,2,3],r=[1,0,2,1,2,3],i=[0,1,3],s=[0,2,3];return function(){var o=this.points,u=o[0],a=o[1],f=o[2],l=o[3],c=o[4],h=o[5],p=o[6],d=o[7],v=t.isTriangleConvex(u,a,f,l,p,d);return v!=t.isTriangleConvex(u,a,c,h,p,d)?e:t.isTriangleConvex(u,a,f,l,c,h)^!v?t.isTriangleConvex(c,h,f,l,p,d)^!v?i:n:t.isTriangleConvex(f,l,c,h,p,d)^!v?s:r}}(),l.type=2,l}),define("qtek/core/LinkedList",["require"],function(e){var t=function(){this.head=null,this.tail=null,this._length=0};return t.prototype.insert=function(e){var n=new t.Entry(e);return this.insertEntry(n),n},t.prototype.insertAt=function(e,n){if(e<0)return;var r=this.head,i=0;while(r&&i!=e)r=r.next,i++;if(r){var s=new t.Entry(n),o=r.prev;o.next=s,s.prev=o,s.next=r,r.prev=s}else this.insert(n)},t.prototype.insertEntry=function(e){this.head?(this.tail.next=e,e.prev=this.tail,this.tail=e):this.head=this.tail=e,this._length++},t.prototype.remove=function(e){var t=e.prev,n=e.next;t?t.next=n:this.head=n,n?n.prev=t:this.tail=t,e.next=e.prev=null,this._length--},t.prototype.removeAt=function(e){if(e<0)return;var t=this.head,n=0;while(t&&n!=e)t=t.next,n++;if(t)return this.remove(t),t.value},t.prototype.getHead=function(){if(this.head)return this.head.value},t.prototype.getTail=function(){if(this.tail)return this.tail.value},t.prototype.getAt=function(e){if(e<0)return;var t=this.head,n=0;while(t&&n!=e)t=t.next,n++;return t.value},t.prototype.indexOf=function(e){var t=this.head,n=0;while(t){if(t.value===e)return n;t=t.next,n++}},t.prototype.length=function(){return this._length},t.prototype.isEmpty=function(){return this._length===0},t.prototype.forEach=function(e,t){var n=this.head,r=0,i=typeof t!="undefined";while(n)i?e.call(t,n.value,r):e(n.value,r),n=n.next,r++},t.prototype.clear=function(){this.tail=this.head=null,this._length=0},t.Entry=function(e){this.value=e,this.next=null,this.prev=null},t}),define("qtek/2d/context/tool/Triangulation2",["require","qtek/core/LinkedList","./math"],function(e){"use strict";function o(e,t){this.p0=e,this.p1=t,this._linkedListEntry=null}var t=e("qtek/core/LinkedList"),n=e("./math"),r=1,i=2,s=5e-4,u=function(){this.points=[],this.triangles=[],this.maxGridNumber=50,this.minGridNumber=0,this._gridNumber=20,this._boundingBox=[[Infinity,Infinity],[-Infinity,-Infinity]],this._nPoints=0,this._nTriangle=0,this._pointTypes=[],this._grids=[],this._gridWidth=0,this._gridHeight=0,this._edgeList=new t,this._edgeOut=[],this._edgeIn=[],this._candidates=[]};return u.prototype.triangulate=function(e){this._nPoints=e.length/2;if(this._nPoints<=3)return;this._gridNumber=Math.ceil(Math.sqrt(this._nPoints)),this._gridNumber=Math.max(Math.min(this._gridNumber,this.maxGridNumber),this.minGridNumber),this.points=e,this._reset(),this._prepare(),this._earClipping(),this.triangles.length=this._nTriangle*3},u.prototype._reset=function(){this._nTriangle=0,this._edgeList.clear(),this._candidates.length=0,this._boundingBox[0][0]=this._boundingBox[0][1]=Infinity,this._boundingBox[1][0]=this._boundingBox[1][1]=-Infinity;var e=this._gridNumber*this._gridNumber,t=this._grids.length;for(var n=0;n<t;n++)this._grids[n].length=0;for(;n<e;n++)this._grids[n]=[];this._grids.length=e;if(t<this._nPoints){t=this._edgeIn.length;for(var n=t;n<this._nPoints;n++)this._edgeIn[n]=this._edgeOut[n]=null}else this._edgeIn.length=this._edgeOut.length=this._nPoints},u.prototype._prepare=function(){var e=this._boundingBox,t=this._nPoints;for(var s=0,o=t-1;s<t;){var u=(s+1)%t,a=this.points[o*2],f=this.points[o*2+1],l=this.points[s*2],c=this.points[s*2+1],h=this.points[u*2],p=this.points[u*2+1];l<e[0][0]&&(e[0][0]=l),c<e[0][1]&&(e[0][1]=c),l>e[1][0]&&(e[1][0]=l),c>e[1][1]&&(e[1][1]=c),e[0][0]-=.1,e[0][1]-=.1,e[1][0]+=.1,e[1][1]+=.1;var d=n.triangleArea(a,f,l,c,h,p);Math.abs(d)<1?(this.points.splice(s*2,2),t--):(this._pointTypes[s]=d<0?r:i,d<0&&this._candidates.push(s),o=s,s++)}this._pointTypes.length=t,this._gridWidth=(e[1][0]-e[0][0])/this._gridNumber,this._gridHeight=(e[1][1]-e[0][1])/this._gridNumber;for(var s=0;s<t;s++)if(this._pointTypes[s]==i){var v=this.points[s*2],m=this.points[s*2+1],g=this._getPointHash(v,m);this._grids[g].push(s)}for(var s=0;s<t-1;s++)this._addEdge(s,s+1);this._addEdge(s,0)},u.prototype._earClipping=function(){var e=this._candidates,t=this._nPoints;while(e.length){var n=!0;for(var r=0;r<e.length;){var i=e[r];this._isEar(i)?(this._clipEar(i),e.splice(r,1),n=!1,t--):r++}n&&(this._clipEar(e.pop()),t--)}},u.prototype._isEar=function(e){var t=this._edgeIn[e],r=this._edgeOut[e],s=t.p0,o=r.p1,u=this.points[s*2],a=this.points[s*2+1],f=this.points[e*2],l=this.points[e*2+1],c=this.points[o*2],h=this.points[o*2+1];if(Math.abs(n.triangleArea(u,a,f,l,c,h))<1)return!0;var p=this._getTriangleGrids(u,a,f,l,c,h);for(var d=p[0][1];d<=p[1][1];d++)for(var v=p[0][0];v<=p[1][0];v++){var m=d*this._gridNumber+v,g=this._grids[m];for(var y=0;y<g.length;y++){var b=g[y];if(this._pointTypes[b]==i){var w=this.points[b*2],E=this.points[b*2+1];if(n.isPointInTriangle(u,a,f,l,c,h,w,E))return!1}}}return!0},u.prototype._clipEar=function(e){var t=this._edgeIn[e],n=this._edgeOut[e],s=this._nTriangle*3;this.triangles[s]=t.p0,this.triangles[s+1]=t.p1,this.triangles[s+2]=n.p1,this._nTriangle++;var o=this._edgeIn[t.p0],u=this._edgeOut[n.p1];this._pointTypes[t.p0]==i&&this.isTriangleConvex2(o.p0,t.p0,n.p1)&&(this._candidates.push(t.p0),this._pointTypes[t.p0]=r),this._pointTypes[n.p1]==i&&this.isTriangleConvex2(t.p0,n.p1,u.p1)&&(this._candidates.push(n.p1),this._pointTypes[n.p1]=r),this._removeEdge(t),this._removeEdge(n),this._addEdge(t.p0,n.p1)},u.prototype._addEdge=function(e,t){var n=new o(e,t);this._edgeOut[e]=n,this._edgeIn[t]=n;var r=this._edgeList.insert(n);return n._linkedListEntry=r,n},u.prototype._removeEdge=function(e){this._edgeList.remove(e._linkedListEntry),this._edgeOut[e.p0]=null,this._edgeIn[e.p1]=null},u.prototype._getPointHash=function(e,t){var n=this._boundingBox;return Math.floor((t-n[0][1])/this._gridHeight)*this._gridNumber+Math.floor((e-n[0][0])/this._gridWidth)},u.prototype._getTriangleGrids=function(){var e=[[-1,-1],[-1,-1]],t,n,r,i;return function(s,o,u,a,f,l){var c=this._boundingBox;return t=r=s,n=i=o,u<t&&(t=u),a<n&&(n=a),u>r&&(r=u),a>i&&(i=a),f<t&&(t=f),l<n&&(n=l),f>r&&(r=f),l>i&&(i=l),e[0][0]=Math.floor((t-c[0][0])/this._gridWidth),e[1][0]=Math.floor((r-c[0][0])/this._gridWidth),e[0][1]=Math.floor((n-c[0][1])/this._gridHeight),e[1][1]=Math.floor((i-c[0][1])/this._gridHeight),e}}(),u.prototype.isTriangleConvex2=function(e,t,n){return this.triangleArea(e,t,n)<0},u.prototype.triangleArea=function(e,t,n){var r=this.points[e*2],i=this.points[e*2+1],s=this.points[t*2],o=this.points[t*2+1],u=this.points[n*2],a=this.points[n*2+1];return(s-r)*(a-o)-(o-i)*(u-s)},u}),define("qtek/2d/context/Polygon",["require","./tool/math","glmatrix","./tool/Triangulation2"],function(e){var t=e("./tool/math"),n=e("glmatrix"),r=n.vec2,i=e("./tool/Triangulation2"),s=new i,o=function(e){this.points=[],this.triangles=[],this._nPoints=0,this._isClosed=!1,this._isEnded=!1,this._x0=0,this._y0=0,this._xi=1,this._yi=1,this._autoUpdateBBox=e,e?this.boundingBox=[r.create(),r.create()]:this.boundingBox=null,this._isStatic=!1};return o.prototype.begin=function(e,t){this._isStatic&&(this._isStatic=!1,this.points=[],this.triangles=[]),this._nPoints=0,this._isClosed=!1,this._isEnded=!1,this.addPoint(e,t),this._x0=this._xi=e,this._y0=this._yi=t;if(this._autoUpdateBBox){var n=this.boundingBox;r.set(n[0],e,t),r.set(n[1],e,t)}},o.prototype.end=function(){if(this._isEnded)return;this.points.length=this._nPoints*2,this._isEnded=!0},o.prototype.addPoint=function(e,t){var n=this._nPoints*2;this.points[n]=e,this.points[n+1]=t,this._xi=e,this._yi=t,this._nPoints++;if(this._autoUpdateBBox){var r=this.boundingBox;e<r[0][0]&&(r[0][0]=e),t<r[0][1]&&(r[0][1]=t),e>r[1][0]&&(r[1][0]=e),t>r[1][1]&&(r[1][1]=t)}},o.prototype.triangulate=function(){if(this._nPoints<3)return;this._nPoints==3?(this.triangles[0]=0,this.triangles[1]=1,this.triangles[2]=2,this.triangles.length=3):(s.triangles=this.triangles,s.triangulate(this.points),this.points=s.points,this._nPoints=this.points.length/2)},o.prototype.checkClose=function(e,n){return this._nPoints>=1&&t.approxEqualInt(e,this._x0)&&t.approxEqualInt(n,this._y0)?(this._isClosed=!0,!0):!1},o.prototype.isCCW=function(){return t.area(this.points)<0},o.prototype.area=function(){return t.area(this.points)},o.prototype.removeDuplicate=function(){var e=this.points,n=this._nPoints*2;for(var r=0;r<n;)x0=e[r],y0=e[r+1],x1=e[(r+2)%n],y1=e[(r+3)%n],t.approxEqualInt(x0,x1)&&t.approxEqualInt(y0,y1)?(e.splice(r,2),this._nPoints--,n-=2):r+=2},o.prototype.updateBoundingBox=function(){this.boundingBox||(this.boundingBox=[r.create(),r.create()]);var e=this.boundingBox,t=this.points;e[0][0]=Infinity,e[0][1]=Infinity,e[1][0]=-Infinity,e[1][1]=-Infinity;for(var n=0;n<this._nPoints*2;){var i=t[n++],s=t[n++];i<e[0][0]&&(e[0][0]=i),s<e[0][1]&&(e[0][1]=s),i>e[1][0]&&(e[1][0]=i),s>e[1][1]&&(e[1][1]=s)}},o.prototype.isPointInPolygon=function(e,t){var n=this.boundingBox;if(n[0][0]>e||n[1][0]<e||n[0][1]>t||n[1][1]<t)return!1},o.prototype.toStatic=function(){if(this._isStatic)return;this.points=new Float32Array(this.points),this.triangles=new Uint32Array(this.triangles),this._isStatic=!0},o.prototype.reverse=function(){t.reverse(this.points,this._nPoints,2)},o}),define("qtek/2d/context/CanvasSubpath",["require","./tool/math","./LineSegment","./BezierCurveSegment","./Polygon","glmatrix"],function(e){var t=e("./tool/math"),n=e("./LineSegment"),r=e("./BezierCurveSegment"),i=e("./Polygon"),s=e("glmatrix"),o=s.vec3,u=s.vec2,a=s.mat4,f=1,l=2,c=3,h=function(){this.basePolygon=new i(!0),this.interiorPolygon=new i(!0),this.fillSegments=[],this.fillCurveSegments=[],this.strokeSegments=[],this.strokeVerticesArray=null,this._nFillSegments=0,this._nStrokeSegments=0,this._nFillCurveSegements=0,this._isClosed=!1,this._isEnded=!1,this._fill=!0,this._stroke=!1};return h.prototype.begin=function(e,t){this._nFillSegments=0,this._nStrokeSegments=0,this._nFillCurveSegements=0,this._isEnded=!1,this._isClosed=!1,this._fill=!1,this._stroke=!1,this.basePolygon.begin(e,t)},h.prototype.end=function(){if(this._isEnded)return;this.strokeSegments.length=this._nStrokeSegments,this.fillSegments.length=this._nFillSegments,this.fillCurveSegments.length=this._nFillCurveSegements,this._isEnded=!0,this.basePolygon.end();var e=this.basePolygon.area();e>0?this.reverse():e==0&&this._nFillCurveSegements>0&&(t.isCCW(this.fillCurveSegments[0].points)||this.reverse())},h.prototype.close=function(e){if(this._isClosed)return;var t=this.basePolygon;if(t._nPoints>1){var r=new n(t._xi,t._yi,t._x0,t._y0);r.thickness=e,this.strokeSegments[this._nStrokeSegments++]=r}this._isClosed=!0},h.prototype.stroke=function(e,t){if(!this._stroke){this._stroke=!0;for(var n=0;n<this.strokeSegments.length;n++){var i=this.strokeSegments[n];i.type==r.type&&i.updateStrokeSegments(e,t)}this._convertLineToPolygon()}},h.prototype.updateStrokeThickness=function(e){if(this._stroke){for(var t=0;t<this.segments.length;t++){var n=this.strokeSegments[t];n.thickness=e}this._convertLineToPolygon()}},h.prototype.fill=function(){this._fill||(this._fill=!0,this._checkOverlap(),this._updateCurveTextureCoords(),this._updateSegments(),this._updateInteriorPolygon(),this.interiorPolygon.triangulate())},h.prototype.addLine=function(e,t,r,i,s){var o=this._checkClose(r,i);o?this._isClosed=!0:this.basePolygon.addPoint(r,i);var u=new n(e,t,r,i);return u.thickness=s,this.strokeSegments[this._nStrokeSegments++]=u,this.fillSegments[this._nFillSegments++]=u,o},h.prototype.addQuadraticBezierCurve=function(e,t,n,r,i,s,o){var u=i,a=s;return i=(i+2*n)/3,s=(s+2*r)/3,n=(e+2*n)/3,r=(t+2*r)/3,this.addCubicBezierCurve(e,t,n,r,i,s,u,a,o)},h.prototype.addCubicBezierCurve=function(e,t,n,i,s,o,u,a,f){var l=this._checkClose(u,a);l?this._isClosed=!0:this.basePolygon.addPoint(u,a);var c=new r(e,t,n,i,s,o,u,a);return c.thickness=f,this.strokeSegments[this._nStrokeSegments++]=c,this.fillSegments[this._nFillSegments++]=c,this.fillCurveSegments[this._nFillCurveSegements++]=c,l},h.prototype.isPointInSubpath=function(e,t){var n=this.interiorPolygon.boundingBox;if(n[0][0]>e||n[1][0]<e||n[0][1]>t||n[1][1]<t)return!1},h.prototype._checkClose=function(e,t){return this.basePolygon.checkClose(e,t)},h.prototype._updateCurveTextureCoords=function(){for(var e=0;e<this.fillSegments.length;e++){var t=this.fillSegments[e];t.type==r.type&&this._updateLeafCurveTextureCoords(t)}},h.prototype._updateLeafCurveTextureCoords=function(e){e.subCurveA?(this._updateLeafCurveTextureCoords(e.subCurveA),this._updateLeafCurveTextureCoords(e.subCurveB)):e.updateTextureCoords()},h.prototype._checkOverlap=function(){var e=[],n=this.fillCurveSegments.length;for(var r=0;r<n;r++)for(var i=r+1;i<n;i++){var s=this.fillCurveSegments[r],o=this.fillCurveSegments[i];s.intersectCurve(o)&&(e.push(s),e.push(o))}while(e.length){var u=e.shift(),a=e.shift();u.subdivide(.5),u.subCurveA.intersectCurve(a)&&Math.abs(t.area(u.subCurveA.points))>1&&(e.push(a),e.push(u.subCurveA)),u.subCurveB.intersectCurve(a)&&Math.abs(t.area(u.subCurveB.points))>1&&(e.push(a),e.push(u.subCurveB))}},h.prototype._updateSegments=function(){this._nFillCurveSegements=0;for(var e=0;e<this._nFillSegments;){var t=this.fillSegments[e];t.type==r.type?t.subCurveA?(this.fillSegments.splice(e,1),this._nFillSegments--,e=this._replaceSubdividedCurve(t,e)):(this.fillCurveSegments[this._nFillCurveSegements++]=t,e++):e++}this.fillCurveSegments.length=this._nFillCurveSegements},h.prototype._replaceSubdividedCurve=function(e,t){return e.subCurveA?(t=this._replaceSubdividedCurve(e.subCurveA,t),this._replaceSubdividedCurve(e.subCurveB,t)):(this.fillSegments.splice(t,0,e),this._nFillSegments++,this.fillCurveSegments[this._nFillCurveSegements++]=e,t+1)},h.prototype._updateInteriorPolygon=function(){var e,i,s,o,u,a,f,l;if(this._nFillSegments<2)return;var c=this.interiorPolygon,h=this.fillSegments[0];c.begin(h.points[0],h.points[1]);for(var p=0;p<this._nFillSegments;p++){var d=this.fillSegments[p];switch(d.type){case n.type:c.addPoint(d.points[2],d.points[3]);break;case r.type:e=d.points[0],i=d.points[1],s=d.points[2],o=d.points[3],u=d.points[4],a=d.points[5],f=d.points[6],l=d.points[7];var v=t.isTriangleConvex(e,i,s,o,f,l);v!=t.isTriangleConvex(e,i,u,a,f,l)?v?(c.addPoint(u,a),c.addPoint(f,l)):(c.addPoint(s,o),c.addPoint(f,l)):v?c.addPoint(f,l):t.isTriangleConvex(e,i,u,a,s,o)?t.isTriangleConvex(s,o,u,a,f,l)?(c.addPoint(s,o),c.addPoint(f,l)):(c.addPoint(s,o),c.addPoint(u,a),c.addPoint(f,l)):t.isTriangleConvex(u,a,s,o,f,l)?(c.addPoint(u,a),c.addPoint(f,l)):(c.addPoint(u,a),c.addPoint(s,o),c.addPoint(f,l));break;default:}}c.end(),c.removeDuplicate()},h.prototype._convertLineToPolygon=function(){var e=u.create(),t=u.create(),i=u.create(),s=u.create(),o=u.create(),a=u.create(),f=u.create(),l=[];for(var c=0;c<4;c++)l[c]=u.create();return function(){var c=0,h=this.strokeSegments.length;for(var p=0;p<h;p++){var d=this.strokeSegments[p];c+=d.strokeSteps*6}if(!this.strokeVerticesArray||this.strokeVerticesArray.length!=c*2)this.strokeVerticesArray=new Float32Array(c*2);var v=this.strokeVerticesArray,m=0,g=this._isClosed?h-1:0;d=this.strokeSegments[g],u.set(e,d.points[0],d.points[1]);for(var y=0,p=g;p<h;y++){d=this.strokeSegments[p];switch(d.type){case n.type:if(y==0){u.set(t,d.points[2],d.points[3]),u.copy(i,t),u.sub(o,t,e),u.normalize(o,o);if(!this._isClosed){u.set(a,o[1],-o[0]);var b=d.thickness/2;u.scaleAndAdd(l[0],e,a,b),u.scaleAndAdd(l[1],e,a,-b)}}else{u.set(i,d.points[2],d.points[3]),u.copy(s,o),u.sub(o,i,t),u.normalize(o,o),u.set(a,s[0]-o[0],s[1]-o[1]),u.normalize(a,a),u.set(f,s[1],-s[0]);var w=u.dot(a,f);w<0&&(u.negate(a,a),w=-w);var b=d.thickness/w/2;u.scaleAndAdd(l[2],t,a,b),u.scaleAndAdd(l[3],t,a,-b),p!==0&&(v[m++]=l[0][0],v[m++]=l[0][1],v[m++]=l[1][0],v[m++]=l[1][1],v[m++]=l[2][0],v[m++]=l[2][1],v[m++]=l[1][0],v[m++]=l[1][1],v[m++]=l[3][0],v[m++]=l[3][1],v[m++]=l[2][0],v[m++]=l[2][1]),u.copy(e,t),u.copy(t,i),u.copy(l[0],l[2]),u.copy(l[1],l[3])}break;case r.type:var E=d.fx,S=d.fy,x=d.dfx,T=d.dfy,N=d.ddfx,C=d.ddfy,k=d.dddfx,L=d.dddfy,A=0;if(y==0){E+=x,S+=T,x+=N,T+=C,N+=k,C+=L,u.set(t,E,S),u.copy(i,t),u.sub(o,t,e),u.normalize(o,o);if(!this._isClosed){u.set(a,o[1],-o[0]);var b=d.thickness/2;u.scaleAndAdd(l[0],e,a,b),u.scaleAndAdd(l[1],e,a,-b)}A=1}for(var O=A;O<d.strokeSteps;O++){var M=s[0]-o[0],_=s[1]-o[1];E+=x,S+=T,x+=N,T+=C,N+=k,C+=L,u.set(i,E+x,S+T),u.copy(s,o),u.sub(o,i,t),u.normalize(o,o),u.set(a,s[0]-o[0],s[1]-o[1]),u.normalize(a,a),u.set(f,s[1],-s[0]);var w=u.dot(a,f);w<0&&(u.negate(a,a),w=-w);var b=d.thickness/w/2;u.scaleAndAdd(l[2],t,a,b),u.scaleAndAdd(l[3],t,a,-b),y==0&&this._isClosed||y==1&&O==A&&this._isClosed||(v[m++]=l[0][0],v[m++]=l[0][1],v[m++]=l[1][0],v[m++]=l[1][1],v[m++]=l[2][0],v[m++]=l[2][1],v[m++]=l[1][0],v[m++]=l[1][1],v[m++]=l[3][0],v[m++]=l[3][1],v[m++]=l[2][0],v[m++]=l[2][1]),u.copy(e,t),u.copy(t,i),u.copy(l[0],l[2]),u.copy(l[1],l[3])}break;default:}this._isClosed?p=y:p++}this._isClosed?(u.set(l[2],v[0],v[1]),u.set(l[3],v[2],v[3])):(u.set(a,o[1],-o[0]),u.scaleAndAdd(l[2],i,a,d.thickness/2),u.scaleAndAdd(l[3],i,a,-d.thickness/2)),v[m++]=l[0][0],v[m++]=l[0][1],v[m++]=l[1][0],v[m++]=l[1][1],v[m++]=l[2][0],v[m++]=l[2][1],v[m++]=l[1][0],v[m++]=l[1][1],v[m++]=l[3][0],v[m++]=l[3][1],v[m++]=l[2][0],v[m++]=l[2][1]}}(),h.prototype.isValid=function(){if(this._nFillSegments>1)return!0;if(this._nFillSegments==1){if(this._nFillCurveSegements>0)return!0;if(this.basePolygon.points.length>2)return!0}},h.prototype.reverse=function(){t.reverse(this.fillSegments,this._nFillSegments,1),t.reverse(this.strokeSegments,this._nStrokeSegments,1);for(var e=0;e<this._nStrokeSegments;e++)this.strokeSegments[e].reverse()},h.prototype.toStatic=function(){this.basePolygon.toStatic(),this.interiorPolygon.toStatic(),this.fillSegments.length=0,this.strokeSegments.length=0,this.fillCurveSegments.length=0},h}),define("qtek/2d/context/CanvasPath",["require","qtek/math/Matrix2d","./DrawingStyle","./CanvasSubpath","./tool/CachedList","./CanvasElement","./tool/math","qtek/core/util"],function(e){var t=e("qtek/math/Matrix2d"),n=e("./DrawingStyle"),r=e("./CanvasSubpath"),i=e("./tool/CachedList"),s=e("./CanvasElement"),o=e("./tool/math"),u=e("qtek/core/util"),a=Math.PI/4,f=Math.PI*2,l=function(){this.eType=l.eType,this.subpaths=new i(r),this.drawingStyle=new n,this.transform=new t,this.depth=0,this._subpath=null,this._fill=!1,this._stroke=!1,this._firstCmd=!1,this._xi=0,this._yi=0,this._verticesData=null,this._fillColorChanged=!0,this._strokeColorChanged=!0,this._isStatic=!1};return l.prototype={constructor:l,getHashKey:function(){return this.eType},setStyle:function(e,t){e=="fillStyle"?this.setFillStyle(t):e=="strokeStyle"?this.setStrokeStyle(t):e!="lineWidth"&&(this.drawingStyle[e]=t)},setStrokeLineWidth:function(e){if(!this._stroke)return;if(this._isStatic){console.warn("Static path can't change its stroke line width");return}if(e!==this.drawingStyle.lineWidth){this.drawingStyle.lineWidth=e;var t=this.subpaths.data();for(var n=0;n<this.subpaths.size();n++)t[n].updateStrokeThickness(e);this._updateStrokeVertices()}},setFillStyle:function(e){this.drawingStyle.setFillStyle(e),this._fillColorChanged=!0},setStrokeStyle:function(e){this.drawingStyle.setStrokeStyle(e),this._strokeColorChanged=!0},setGlobalAlpha:function(e){this.drawingStyle.globalAlpha=e,this._strokeColorChanged=!0,this._fillColorChanged=!0},moveTo:function(e,t){this._subpath&&this._endSubpath(),this._firstCmd=!1,this._subpath=this._beginSubpath(e,t),this._xi=e,this._yi=t},lineTo:function(e,t,n){if(!this._subpath){if(this._firstCmd){this._subpath=this._beginSubpath(e,t),this._xi=e,this._yi=t,this._firstCmd=!1;return}this._subpath=this._beginSubpath(this._xi,this._yi)}var r=this._subpath.addLine(this._xi,this._yi,e,t,n);r&&this._endSubpath(),this._xi=e,this._yi=t},bezierCurveTo:function(e,t,n,r,i,s,o){if(!this._subpath){if(this._firstCmd){this._subpath=this._beginSubpath(i,s),this._xi=i,this._yi=s,this._firstCmd=!1;return}this._subpath=this._beginSubpath(this._xi,this._yi)}var u=this._subpath.addCubicBezierCurve(this._xi,this._yi,e,t,n,r,i,s,o);u&&this._endSubpath(),this._xi=i,this._yi=s},quadraticCurveTo:function(e,t,n,r,i){if(!this._subpath){if(this._firstCmd){this._subpath=this._beginSubpath(n,r),this._xi=n,this._yi=r,this._firstCmd=!1;return}this._subpath=this._beginSubpath(this._xi,this._yi)}var s=this._subpath.addQuadraticBezierCurve(this._xi,this._yi,e,t,n,r,i);s&&this._endSubpath(),this._xi=n,this._yi=r},arc:function(e,t,n,r,i,s,u){typeof s=="undefined"&&(s=!1);var l=e+n*Math.cos(r),c=t+n*Math.sin(r);this._subpath||(this._subpath=this._beginSubpath(l,c),this._xi=l,this._yi=c,this._firstCmd=!1),(!o.approxEqualInt(l,this._xi)||!o.approxEqualInt(c,this._yi))&&this._subpath.addLine(this._xi,this._yi,l,c,u);if(n==0)return;if(o.approxEqual(r,i))return;r%=f,i%=f,r<0&&(r+=f),i<0&&(i+=f),s?r<=i&&(i-=f):r>=i&&(i+=f);var h=i-r,p=Math.ceil(Math.abs(h)/a*n/50);p<4&&(p=4);var d=h/p,v=r,m,g,y,b,w,E,S,x,T=.5522847498;for(var N=0;N<p;N++){m=v+d,s?m<i&&(m=i,d=m-v):m>i&&(m=i,d=m-v),E=e+n*Math.cos(m),S=t+n*Math.sin(m),x=Math.tan(d/2),g=l-T*(c-t)*x,y=c+T*(l-e)*x,b=E+T*(S-t)*x,w=S-T*(E-e)*x;var C=this._subpath.addCubicBezierCurve(l,c,g,y,b,w,E,S,u);if(C){this._endSubpath();break}l=E,c=S,v=m}this._xi=E,this._yi=S},arcTo:function(){},rect:function(e,t,n,r,i){this._endSubpath(),this._subpath=this._beginSubpath(e,t),this._firstCmd=!1,this._subpath.addLine(e,t,e,t+r,i),this._subpath.addLine(e,t+r,e+n,t+r,i),this._subpath.addLine(e+n,t+r,e+n,t,i),this._subpath.addLine(e+n,t,e,t,i),this._xi=e,this._yi=t,this._endSubpath()},begin:function(e){this.subpaths.clear(),this._subpath=null,this._stroke=this._fill=!1,this._isStatic=!1,this._firstCmd=!0},end:function(e){this._endSubpath(),this.updateVertices()},stroke:function(e){this._subpath&&this._endSubpath(),this.drawingStyle.setStrokeStyle(e.strokeStyle),this.drawingStyle.lineWidth=e.lineWidth,this.drawingStyle.globalAlpha=e.globalAlpha,t.copy(this.transform,e.currentTransform);var n=e.currentTransform._array,r=Math.sqrt(n[0]*n[0]+n[1]*n[1]),i=Math.sqrt(n[2]*n[2]+n[3]*n[3]),s=this.subpaths.data();for(var o=0;o<this.subpaths.size();o++)s[o].stroke(r,i);this._stroke=!0},fill:function(e){this._subpath&&this._endSubpath(),this.drawingStyle.setFillStyle(e.fillStyle),this.drawingStyle.globalAlpha=e.globalAlpha,t.copy(this.transform,e.currentTransform);var n=this.subpaths.data();for(var r=0;r<this.subpaths.size();r++)n[r].fill();this._fill=!0},hasFill:function(){return this._fill},hasStroke:function(){return this._stroke},close:function(e){this._subpath&&this._subpath.close(e)},updateVertices:function(){this._verticesData||(this._verticesData={}),this._fill&&this._updateFillVertices(),this._stroke&&this._updateStrokeVertices()},_updateFillVertices:function(){this._verticesData.fill||(this._verticesData.fill={position:null,coord:null});var e=this._verticesData.fill;e.dirty=!0;var t=0,n=this.subpaths.data(),r=this.subpaths.size();for(var i=0;i<r;i++){var s=n[i];if(!s._fill)continue;t+=s.interiorPolygon.triangles.length;for(var o=0;o<s.fillCurveSegments.length;o++)t+=s.fillCurveSegments[o].triangles.length}if(!e.position||e.position.length!==t*3)e.position=new Float32Array(t*3),e.coord=new Float32Array(t*3);var u=e.position,a=e.coord,f=this.depth,l=0;for(var i=0;i<r;i++){var s=n[i];if(!s._fill)continue;var c=s.interiorPolygon;for(var h=0;h<c.triangles.length;h++){var p=c.triangles[h];u[l]=c.points[p*2],u[l+1]=c.points[p*2+1],u[l+2]=f,a[l]=0,a[l+1]=1,a[l+2]=1,l+=3}var d=s.fillCurveSegments;for(var h=0;h<d.length;h++){var v=d[h];for(var m=0;m<v.triangles.length;m++){var p=v.triangles[m],g=v.points,y=v.coords;a[l]=y[p*3],a[l+1]=y[p*3+1],a[l+2]=y[p*3+2],u[l]=g[p*2],u[l+1]=g[p*2+1],u[l+2]=f,l+=3}}}},_updateStrokeVertices:function(){this._verticesData.stroke||(this._verticesData.stroke={position:null});var e=this._verticesData.stroke;e.dirty=!0;var t=0,n=this.subpaths.size(),r=this.subpaths.data();for(var i=0;i<n;i++){var s=r[i];if(!s._stroke)continue;t+=s.strokeVerticesArray.length/2}if(!e.position||e.position.length!==t*3)e.position=new Float32Array(t*3);var o=e.position,u=0,a=this.depth,n=this.subpaths.size(),r=this.subpaths.data();for(var i=0;i<n;i++){var s=r[i],f=s.strokeVerticesArray;if(!s._stroke)continue;for(var l=0;l<f.length/2;l++)o[u]=f[l*2],o[u+1]=f[l*2+1],o[u+2]=a+.002,u+=3}},getFillVertices:function(){return this._verticesData.fill},getFillVertexNumber:function(){return this._verticesData.fill.position.length/3},getStrokeVertices:function(){return this._verticesData.stroke},getStrokeVertexNumber:function(){return this._verticesData.stroke.position.length/3},afterDraw:function(){this.transform._dirty=!1,this._fillColorChanged=!1,this._strokeColorChanged=!1,this._fill&&(this._verticesData.fill.dirty=!1),this._stroke&&(this._verticesData.stroke.dirty=!1)},clone:function(e){var t=new l;return!this._fill&&!this._stroke?(console.warn("Path must have fill or stroke"),t):(t._fill=this._fill,t._stroke=this._stroke,t.depth=e.requestDepthChannel(),t.drawingStyle.copy(this.drawingStyle),t.transform.copy(this.transform),t._verticesData={fill:u.clone(this._verticesData.fill),stroke:u.clone(this._verticesData.stroke)},t._verticesData.fill&&(t._verticesData.fill.dirty=!0),t._verticesData.stroke&&(t._verticesData.stroke.dirty=!0),t)},toStatic:function(){var e=this.subpaths.data(),t=this.subpaths.size();for(var n=0;n<t;n++)e[n].toStatic();this._isStatic=!0},_endSubpath:function(){this._subpath&&(this._subpath.isValid()?this._subpath.end():this.subpaths.decrease(),this._subpath=null)},_beginSubpath:function(e,t){var n=this.subpaths.increase();return n.begin(e,t),n}},l.eType=s.register(l,null,null),l}),define("qtek/Renderable",["require","./Node","./core/glenum"],function(e){function a(e,t,n){this.availableAttributes=e,this.availableAttributeSymbols=t,this.indicesBuffer=n,this.vao=null}var t=e("./Node"),n=e("./core/glenum"),r=0,i=null,s=!0,o,u=function(){this.faceNumber=0,this.vertexNumber=0,this.drawCallNumber=0},f=t.derive({material:null,geometry:null,mode:n.TRIANGLES,_drawCache:null,_renderInfo:null},function(){this._drawCache={},this._renderInfo=new u},{lineWidth:1,culling:!0,cullFace:n.BACK,frontFace:n.CCW,frustumCulling:!0,receiveShadow:!0,castShadow:!0,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&this.visible},render:function(e,t){var u=t||this.material,f=u.shader,l=this.geometry,c=this.mode,h=null,p=l.hint==n.STATIC_DRAW,d=l.getVertexNumber(),v=l.isUseFace(),m=this._renderInfo;m.vertexNumber=d,m.faceNumber=0,m.drawCallNumber=0;var g=!1;o=e.__GLID__+"-"+l.__GUID__+"-"+f.__GUID__,d>l.chunkSize&&v||h&&p?g=!0:l._cache.isDirty()?g=!0:o!==r&&(g=!0),g=!0,r=o;if(!g)s?(e.drawElements(c,i.count,e.UNSIGNED_SHORT,0),m.faceNumber=i.count/3):e.drawArrays(c,0,d),m.drawCallNumber=1;else{var y=this._drawCache[o];if(!y){var b=l.getBufferChunks(e);if(!b)return;y=[];for(var w=0;w<b.length;w++){var E=b[w],S=E.attributeBuffers,x=E.indicesBuffer,T=[],N=[];for(var C=0;C<S.length;C++){var k=S[C],L=k.name,A=k.semantic,O;if(A){var M=f.attribSemantics[A];O=M&&M.symbol}else O=L;O&&f.attributeTemplates[O]&&(T.push(k),N.push(O))}var _=new a(T,N,x);y.push(_)}p&&(this._drawCache[o]=y)}for(var D=0;D<y.length;D++){var _=y[D],P=!0;h&&p&&(_.vao==null?_.vao=h.createVertexArrayOES():P=!1,h.bindVertexArrayOES(_.vao));var T=_.availableAttributes,x=_.indicesBuffer;if(P){var H=f.enableAttributes(e,_.availableAttributeSymbols);for(var C=0;C<T.length;C++){var B=H[C];if(B===-1)continue;var k=T[C],j=k.buffer,F=k.size,I;switch(k.type){case"float":I=e.FLOAT;break;case"byte":I=e.BYTE;break;case"ubyte":I=e.UNSIGNED_BYTE;break;case"short":I=e.SHORT;break;case"ushort":I=e.UNSIGNED_SHORT;break;default:I=e.FLOAT}e.bindBuffer(e.ARRAY_BUFFER,j),e.vertexAttribPointer(B,F,I,!1,0,0),h&&p&&e.enableVertexAttribArray(B)}}(c==n.LINES||c==n.LINE_STRIP||c==n.LINE_LOOP)&&e.lineWidth(this.lineWidth),i=x,s=l.isUseFace(),s?(P&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,x.buffer),e.drawElements(c,x.count,e.UNSIGNED_SHORT,0),m.faceNumber+=x.count/3):e.drawArrays(c,0,d),h&&p&&h.bindVertexArrayOES(null),m.drawCallNumber++}}return m},clone:function(){var e=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling"];return function(){var n=t.prototype.clone.call(this);n.geometry=this.geometry,n.material=this.material;for(var r=0;r<e.length;r++){var i=e[r];n[i]!==this[i]&&(n[i]=this[i])}return n}}()});return f.beforeFrame=function(){r=0},f.POINTS=n.POINTS,f.LINES=n.LINES,f.LINE_LOOP=n.LINE_LOOP,f.LINE_STRIP=n.LINE_STRIP,f.TRIANGLES=n.TRIANGLES,f.TRIANGLE_STRIP=n.TRIANGLE_STRIP,f.TRIANGLE_FAN=n.TRIANGLE_FAN,f.BACK=n.BACK,f.FRONT=n.FRONT,f.FRONT_AND_BACK=n.FRONT_AND_BACK,f.CW=n.CW,f.CCW=n.CCW,f.RenderInfo=u,f}),define("qtek/2d/context/Primitive",["require","qtek/Renderable","./Geometry2D","qtek/Material","qtek/Shader"],function(e){"use strict";var t=e("qtek/Renderable"),n=e("./Geometry2D"),r=e("qtek/Material"),i=e("qtek/Shader"),s=t.derive({culling:!1,mode:t.TRIANGLES},{updateElements:function(){},addElement:function(){},clearElements:function(){},render:t.prototype.render});return s}),define("qtek/2d/context/shader/path.essl",[],function(){return"@export buildin.2d.path.vertex\n\nattribute vec3 position;\nattribute vec4 color;\nattribute vec3 t0;\nattribute vec3 t1;\nattribute vec3 coord;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvarying vec4 v_Color;\nvarying vec3 v_klm;\n\nvoid main()\n{\n    mat3 localTransform = mat3(\n        t0.x, t1.x, 0.0,\n        t0.y, t1.y, 0.0,\n        t0.z, t1.z, 1.0\n    );\n    vec3 pos2d = vec3(position.xy, 1.0);\n    pos2d = localTransform * pos2d;\n    vec4 pos3d = vec4(pos2d.xy, position.z, 1.0);\n\n    v_Color = color;\n    v_klm = coord;\n    gl_Position = worldViewProjection * pos3d;\n}\n\n@end\n\n\n@export buildin.2d.path.fragment\n\nvarying vec4 v_Color;\nvarying vec3 v_klm;\n\n#ifdef ANTIALIASING\n    #extension GL_OES_standard_derivatives : enable\n#endif\n\nvoid main()\n{\n    #ifdef ANTIALIASING\n        // Gradients\n        vec3 px = dFdx(v_klm);\n        vec3 py = dFdy(v_klm);\n        // Chain rule\n        float k2 = v_klm.x * v_klm.x;\n        float c = k2 * v_klm.x - v_klm.y * v_klm.z;\n        float k23 = 3.0 * k2;\n        float cx = k23 * px.x - v_klm.z * px.y - v_klm.y * px.z;\n        float cy = k23 * py.x - v_klm.z * py.y - v_klm.y * py.z;\n        // Signed distance\n        float sd = c / sqrt(cx * cx + cy * cy);\n\n        float alpha = clamp(0.5 - sd, 0.0, 1.0);\n\n    #else\n        float alpha = step(v_klm.x * v_klm.x * v_klm.x, v_klm.y * v_klm.z);\n    #endif\n\n    gl_FragColor = v_Color;\n    gl_FragColor.a *= alpha;\n\n    if (gl_FragColor.a < 1e-3) {\n        discard;\n    }\n}\n\n@end"}),define("qtek/2d/context/PathPrimitive",["require","qtek/Geometry","qtek/Material","qtek/Shader","./Geometry2D","./CanvasPath","./CanvasElement","./Primitive","./shader/path.essl"],function(e){var t=e("qtek/Geometry"),n=e("qtek/Material"),r=e("qtek/Shader"),i=e("./Geometry2D"),s=e("./CanvasPath"),o=e("./CanvasElement"),u=e("./Primitive");r.import(e("./shader/path.essl"));var a=new r({vertex:r.source("buildin.2d.path.vertex"),fragment:r.source("buildin.2d.path.fragment")});a.define("fragment","ANTIALIASING");var f=u.derive(function(){return{geometry:new i({attributes:{position:new t.Attribute("position","float",3,null,!1),color:new t.Attribute("position","float",4,null,!1),t0:new t.Attribute("t0","float",3,null,!1),t1:new t.Attribute("t1","float",3,null,!1),coord:new t.Attribute("coord","float",3,null,!1)}}),material:new n({shader:a,transparent:!0,depthMask:!0,depthTest:!0}),_paths:[],_needsUpdateAll:!1}},{addElement:function(e){this._paths.push(e),this._needsUpdateAll=!0},clearElements:function(){this._paths.length=0},updateElements:function(){var e=this.geometry,t=0;for(var n=0;n<this._paths.length;n++){var r=this._paths[n];r.hasFill()&&(t+=this._paths[n].getFillVertexNumber()),r.hasStroke()&&(t+=this._paths[n].getStrokeVertexNumber())}var i=this._needsUpdateAll;if(!e.attributes.position.value||e.getVertexNumber()!==t)e.attributes.position.value=new Float32Array(t*3),e.attributes.color.value=new Float32Array(t*4),e.attributes.t0.value=new Float32Array(t*3),e.attributes.t1.value=new Float32Array(t*3),e.attributes.coord.value=new Float32Array(t*3),i=!0;var s=0,o=0,u=e.attributes.t0.value,a=e.attributes.t1.value,f=e.attributes.color.value,l=e.attributes.position.value,c=e.attributes.coord.value;for(var n=0;n<this._paths.length;n++){var r=this._paths[n],h=r.transform._array,p=r.depth,d=r.drawingStyle.globalAlpha,v=0,m=0;if(r.hasFill()){v=r.getFillVertexNumber();var g=r.getFillVertices();if(g.dirty||i)c.set(g.coord,s),l.set(g.position,s);for(var y=s+2;y<v*3+s;y+=3)l[y]=p;if(r._fillColorChanged||i){var b=r.drawingStyle.fillStyle;for(var y=0;y<v;y++)f[o++]=b[0],f[o++]=b[1],f[o++]=b[2],f[o++]=b[3]*d}else o+=v*4;s+=v*3}if(r.hasStroke()){m=r.getStrokeVertexNumber();var g=r.getStrokeVertices();(g.dirty||i)&&l.set(g.position,s);if(i)for(var y=s;y<s+m*3;)c[y++]=0,c[y++]=1,c[y++]=1;for(var y=s+2;y<s+m*3;y+=3)l[y]=p+.002;if(r._strokeColorChanged||i){var b=r.drawingStyle.strokeStyle;for(var y=0;y<m;y++)f[o++]=b[0],f[o++]=b[1],f[o++]=b[2],f[o++]=b[3]*d}else o+=m*4}s-=v*3;if(r.transform._dirty||i)for(var y=0;y<v+m;y++)u[s]=h[0],u[s+1]=h[2],u[s+2]=h[4],a[s]=h[1],a[s+1]=h[3],a[s+2]=h[5],s+=3;else s+=(v+m)*3}this._needsUpdateAll=!1,e.dirty()}});return o.setPrimitiveClass(s.eType,f),f}),define("qtek/texture/Texture2D",["require","../Texture","../core/glinfo","../core/glenum"],function(e){var t=e("../Texture"),n=e("../core/glinfo"),r=e("../core/glenum"),i=t.derive(function(){return{image:null,pixels:null,mipmaps:[]}},{update:function(e){e.bindTexture(e.TEXTURE_2D,this._cache.get("webgl_texture")),this.beforeUpdate(e);var i=this.format,s=this.type;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.wrapT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.magFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.minFilter);var o=n.getExtension(e,"EXT_texture_filter_anisotropic");o&&this.anisotropic>1&&e.texParameterf(e.TEXTURE_2D,o.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic);if(s===36193){var u=n.getExtension(e,"OES_texture_half_float");u||(s=r.FLOAT)}this.image?e.texImage2D(e.TEXTURE_2D,0,i,i,s,this.image):i<=t.COMPRESSED_RGBA_S3TC_DXT5_EXT&&i>=t.COMPRESSED_RGB_S3TC_DXT1_EXT?e.compressedTexImage2D(e.TEXTURE_2D,0,i,this.width,this.height,0,this.pixels):e.texImage2D(e.TEXTURE_2D,0,i,this.width,this.height,0,i,s,this.pixels);if(this.useMipmap)if(this.mipmaps.length){if(this.image)for(var a=0;a<this.mipmaps.length;a++)this.mipmaps[a]&&e.texImage2D(e.TEXTURE_2D,a,i,i,s,this.mipmaps[a]);else if(this.pixels){var f=this.width,l=this.height;for(var a=0;a<this.mipmaps.length;a++)this.mipmaps[a]&&(i<=t.COMPRESSED_RGBA_S3TC_DXT5_EXT&&i>=t.COMPRESSED_RGB_S3TC_DXT1_EXT?e.compressedTexImage2D(e.TEXTURE_2D,0,i,f,l,0,this.mipmaps[a]):e.texImage2D(e.TEXTURE_2D,a,i,f,l,0,i,s,this.mipmaps[a])),f/=2,l/=2}}else!this.NPOT&&!this.mipmaps.length&&e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null)},generateMipmap:function(e){e.bindTexture(e.TEXTURE_2D,this._cache.get("webgl_texture")),e.generateMipmap(e.TEXTURE_2D)},isPowerOfTwo:function(){var e,t;return this.image?(e=this.image.width,t=this.image.height):(e=this.width,t=this.height),(e&e-1)===0&&(t&t-1)===0},isRenderable:function(){return this.image?this.image.nodeName==="CANVAS"||this.image.complete:this.width&&this.height},bind:function(e){e.bindTexture(e.TEXTURE_2D,this.getWebGLTexture(e))},unbind:function(e){e.bindTexture(e.TEXTURE_2D,null)},load:function(e){var t=new Image,n=this;return t.onload=function(){n.dirty(),n.trigger("success",n),t.onload=null},t.onerror=function(){n.trigger("error",n),t.onerror=null},t.src=e,this.image=t,this}});return i}),define("qtek/2d/context/CanvasImage",["require","qtek/texture/Texture2D","qtek/math/Matrix2d","./CanvasElement","glmatrix"],function(e){var t=e("qtek/texture/Texture2D"),n=e("qtek/math/Matrix2d"),r=e("./CanvasElement"),i=e("glmatrix"),s=i.vec2,o=[],u=function(e){this._data=e,this._ref=0};u.prototype.reference=function(){return this._ref++,this._data},u.prototype.removeReference=function(){return this._ref>0&&this._ref--,this._ref==0},u.prototype.getData=function(){return this._data};var a=[0,1,2,1,3,2],f=function(e,t,r,i,o,u,a,l,c){this.eType=f.eType,this.image=e,this.depth=0,this._texture=f.getTexture(e),this.transform=new n;var h=1/e.width,p=1/e.height;this.quadPositions=[s.fromValues(u,a),s.fromValues(u,a+c),s.fromValues(u+l,a),s.fromValues(u+l,a+c)],this.quadTexcoords=[s.fromValues(t*h,r*p),s.fromValues(t*h,(r+o)*p),s.fromValues((t+i)*h,r*p),s.fromValues((t+i)*h,(r+o)*p)],this._verticesData=null};return f.prototype={constructor:f,begin:function(){},end:function(e){n.copy(this.transform,e.currentTransform),this.updateVertices()},getTexture:function(){return this._texture},hasFill:function(){return!0},hasStroke:function(){return!1},dispose:function(e){f.disposeImage(this.image,e.renderer.gl)},getHashKey:function(){return this.eType+"_"+this.image.__IID__},updateVertices:function(){this._verticesData||(this._verticesData={position:new Float32Array(18),texcoord:new Float32Array(12)});var e=this._verticesData.position,t=this._verticesData.texcoord,n=this.depth,r=0,i=0;for(var s=0;s<6;s++){var o=a[s];e[r]=this.quadPositions[o][0],e[r+1]=this.quadPositions[o][1],e[r+2]=n,t[i]=this.quadTexcoords[o][0],t[i+1]=this.quadTexcoords[o][1],r+=3,i+=2}},getVertices:function(){return this._verticesData},afterDraw:function(){},clone:function(){}},f.getTexture=function(e){if(typeof e.__IID__=="undefined"||typeof o[e.__IID__]=="undefined"){var n=o.length,r=new t;r.image=e,r.flipY=!1,e.__IID__=n,o.push(new u(r))}return o[e.__IID__].reference()},f.disposeImage=function(e,t){if(!e.__IID__){var n=e.__IID__,r=o[n];if(r){var i=r.removeReference();if(i){r.getData().dispose(t);var s=o[o.length-1];o[n]=s,o.pop(),e.__IID__=n}}}},f.eType=r.register(f,null,null),f}),define("qtek/2d/context/shader/image.essl",[],function(){return"@export buildin.2d.image.vertex\n\nattribute vec3 position;\nattribute vec2 texcoord;\nattribute vec3 t0;\nattribute vec3 t1;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvarying vec2 v_Uv;\n\nvoid main()\n{\n    mat3 localTransform = mat3(\n        t0.x, t1.x, 0.0,\n        t0.y, t1.y, 0.0,\n        t0.z, t1.z, 1.0\n    );\n    vec3 pos2d = vec3(position.xy, 1.0);\n    pos2d = localTransform * pos2d;\n    vec4 pos3d = vec4(pos2d.xy, position.z, 1.0);\n\n    gl_Position = worldViewProjection * pos3d;\n    v_Uv = texcoord;\n}\n\n@end\n\n\n@export buildin.2d.image.fragment\n\nuniform sampler2D sprite;\n\nvarying vec2 v_Uv;\n\nvoid main()\n{\n    gl_FragColor = texture2D(sprite, v_Uv);\n}\n\n@end"}),define("qtek/2d/context/ImagePrimitive",["require","qtek/Geometry","qtek/Material","qtek/Shader","./Geometry2D","./CanvasImage","./CanvasElement","./Primitive","glmatrix","./shader/image.essl"],function(e){var t=e("qtek/Geometry"),n=e("qtek/Material"),r=e("qtek/Shader"),i=e("./Geometry2D"),s=e("./CanvasImage"),o=e("./CanvasElement"),u=e("./Primitive"),a=e("glmatrix"),f=a.vec2;r.import(e("./shader/image.essl"));var l=new r({vertex:r.source("buildin.2d.image.vertex"),fragment:r.source("buildin.2d.image.fragment")});l.enableTexture("sprite");var c=u.derive(function(){return{geometry:new i({attributes:{position:new t.Attribute("position","float",3,null,!1),texcoord:new t.Attribute("texcoord","float",2,null,!1),t0:new t.Attribute("t0","float",3,null,!1),t1:new t.Attribute("t1","float",3,null,!1)}}),material:new n({shader:l,transparent:!0,depthMask:!0,depthTest:!0}),_images:[],_inDescendantOrder:!1}},{addElement:function(e){this._images.push(e)},clearElements:function(){this._images.length=0,this._inDescendantOrder=!1},updateElements:function(e){if(this._images.length==0)return;var t=this.geometry,n=this._images.length*6;if(!t.attributes.position.value||t.getVertexNumber()!==n)t.attributes.position.value=new Float32Array(n*3),t.attributes.texcoord.value=new Float32Array(n*2),t.attributes.t0.value=new Float32Array(n*3),t.attributes.t1.value=new Float32Array(n*3);var r=this._images[0].getTexture();this.material.set("sprite",r);var i=0,s=0,o=t.attributes.t0.value,u=t.attributes.t1.value;if(e&&!this._inDescendantOrder){for(var a=0,f=this._images.length;a<Math.floor(f/2);a++){var l=f-1,c=this._images[a];this._images[a]=this._images[l],this._images[l]=c}this._inDescendantOrder=!0}for(var a=0;a<this._images.length;a++){var h=this._images[a],p=h.depth,d=h.transform._array,v=h.getVertices();t.attributes.position.value.set(v.position,i),t.attributes.texcoord.value.set(v.texcoord,s);for(var m=i+2;m<18+i;m+=3)t.attributes.position.value[m]=p;for(var m=0;m<6;m++)o[i]=d[0],o[i+1]=d[2],o[i+2]=d[4],u[i]=d[1],u[i+1]=d[3],u[i+2]=d[5],i+=3,s+=2}t.dirty()},_sortFunc:function(e,t){return t.depth-e.depth}});return o.setPrimitiveClass(s.eType,c),c}),define("qtek/2d/context/tool/ImageAtlas",["require","../CanvasImage","qtek/Texture"],function(e){var t=e("../CanvasImage"),n=e("qtek/Texture"),r=1024,i=window.devicePixelRatio||1,s=function(){this._canvas=document.createElement("canvas"),this._ctx2d=this._canvas.getContext("2d"),this._offsetX=0,this._offsetY=0,this._texture=null};s.prototype.clear=function(){this._canvas.width=r*i,this._canvas.height=r*i,this._offsetX=this._offsetY=0,this._nBlockSqrt=1,this._ctx2d.clearRect(0,0,this._canvas.width,this._canvas.height),this._ctx2d.scale(i,i),this._texture&&this._texture.dirty()};var o=/([0-9]+)px/;return s.prototype.addText=function(e,r,s,u,a,f){var l=this._ctx2d;l.fillStyle=f.fillStyle,l.strokeStyle=f.strokeStyle,l.font=f.font;var c=this._offsetX,h=this._offsetY,p=l.measureText(e).width;typeof a!="undefined"&&(p=Math.min(p,a));var d=Math.max(+o.exec(l.font)[1],l.measureText("m").width),v=d*1.5;p>this._canvas.width/i&&console.warn("Text width no longer than "+this._canvas.width);if(c+p>this._canvas.width/i){c=0;if(h+v>this._canvas.height/i)return null;h+=v}this._offsetY=h,this._offsetX=c+p,r=="fill"?typeof a!="undefined"?l.fillText(e,c,h+d,a):l.fillText(e,c,h+d):typeof a!="undefined"?l.strokeText(e,c,h+d,a):l.strokeText(e,c,h+d);switch(f.textAlign){case"start":break;case"left":break;case"end":case"right":s-=p;break;case"center":s-=p/2;break;default:}switch(f.textBaseline){case"alphabetic":case"ideographic":case"bottom":u-=d;break;case"top":case"hanging":break;case"middle":u-=d/2;break;default:}var m=new t(this._canvas,c*i,h*i,p*i,v*i,s,u,p,v);return m&&(this._texture=m.getTexture(),this._texture.minFilter=n.NEAREST,this._texture.magFilter=n.NEAREST,this._texture.useMipmap=!1),m},s.prototype.measureText=function(e,t){var e=this._ctx2d;return e.font=_ctx.font,e.measureText(t)},s.prototype.addImage=function(){},s.prototype.getTexture=function(){return this._texture},s.prototype.dispose=function(e){this._texture.dispose(e)},s}),define("qtek/2d/context/Painter",["require","qtek/core/Base","qtek/Shader","qtek/math/Matrix2d","qtek/math/Matrix4","./tool/CachedList","./CanvasElement","./PathPrimitive","./ImagePrimitive","./CanvasPath","./CanvasImage","./tool/ImageAtlas"],function(e){"use strict";var t=e("qtek/core/Base"),n=e("qtek/Shader"),r=e("qtek/math/Matrix2d"),i=e("qtek/math/Matrix4"),s=e("./tool/CachedList"),o=e("./CanvasElement"),u=e("./PathPrimitive"),a=e("./ImagePrimitive"),f=e("./CanvasPath"),l=e("./CanvasImage"),c=e("./tool/ImageAtlas"),h=t.derive(function(){return{transform:new r,ctx:null,_elements:[],_primitives:[],_primitiveLists:[],_textAtlas:new s(c,2),_blending:!0,_blendFunc:null}},function(){var e=o.getClassNumber();for(var t=0;t<e;t++){var n=o.getPrimitiveClass(t);n?this._primitiveLists.push(new s(n,5)):this._primitiveLists.push(null)}this._disposePrimitive=this._disposePrimitive.bind(this),this._disposeImageAtlas=this._disposeImageAtlas.bind(this)},{addElement:function(e){e.depth=this.ctx.requestDepthChannel(),this._elements.push(e)},getElements:function(){return this._elements},draw:function(){var e=this.ctx,t=e.renderer.gl;this._blending?t.enable(t.BLEND):t.disable(t.BLEND);for(var n=0;n<this._primitives.length;n++)i.fromMat2d(this._primitives[n].worldTransform,this.transform),this._blending&&this._blendFunc?this._primitives[n].material.blend=this._blendFunc:this._primitives[n].material.blend=null;e.renderer.renderQueue(this._primitives,e.camera);for(var n=0;n<this._elements.length;n++)this._elements[n].afterDraw()},repaint:function(){for(var e=0;e<this._primitives.length;e++)this._primitives[e].updateElements();this.draw()},enableBlending:function(){this._blending=!0},disableBlending:function(){this._blending=!1},setBlendFunc:function(e){this._blendFunc=e},begin:function(){this.beginTextAtlas();for(var e=0;e<this._primitives.length;e++)this._primitives[e].clearElements();this._primitives.length=0,this._elements.length=0;for(var e=0;e<this._primitiveLists.length;e++)this._primitiveLists[e]&&this._primitiveLists[e].clear(this._disposePrimitive)},end:function(){if(this._blending){var e=null,t;for(var n=0;n<this._elements.length;n++){var r=this._elements[n],i=r.getHashKey();if(r.getHashKey()!=e){var s=this._primitiveLists[r.eType];s&&(t=s.increase(),t.clearElements()),t&&this._primitives.push(t),e=i}t&&t.addElement(r)}for(var n=0;n<this._primitives.length;n++)this._primitives[n].updateElements()}else{for(var n=0;n<this._primitiveLists.length;n++)if(this._primitiveLists[n]){var t=this._primitiveLists[n].increase();t.clearElements(),this._primitives.push(t)}for(var n=0;n<this._elements.length;n++){var r=this._elements[n],t=this._primitiveLists[r.eType].get(0);t.addElement(r)}for(var n=0;n<this._primitives.length;n++)this._primitives[n].updateElements(!0)}},beginTextAtlas:function(){this._textAtlas.clear(this._disposeImageAtlas)},getNewTextAtlas:function(){var e=this._textAtlas.increase();return e.clear(),e},endTextAtlas:function(){},dispose:function(){this.begin()},_disposePrimitive:function(e){e.geometry.dispose(this.ctx.renderer.gl)},_disposeImageAtlas:function(e){e.dispose(this.ctx.renderer.gl)},_eleDepthSortFunc:function(e,t){return e.depth-t.depth}});return h}),define("qtek/DynamicGeometry",["require","./Geometry","./math/BoundingBox","./core/glenum","glmatrix"],function(e){var t=e("./Geometry"),n=e("./math/BoundingBox"),r=e("./core/glenum"),i=e("glmatrix"),s=i.vec3,o=i.mat4,u=Array.prototype.slice,a=t.derive(function(){return{attributes:{position:new t.Attribute("position","float",3,"POSITION",!0),texcoord0:new t.Attribute("texcoord0","float",2,"TEXCOORD_0",!0),texcoord1:new t.Attribute("texcoord1","float",2,"TEXCOORD_1",!0),normal:new t.Attribute("normal","float",3,"NORMAL",!0),tangent:new t.Attribute("tangent","float",4,"TANGENT",!0),color:new t.Attribute("color","float",4,"COLOR",!0),weight:new t.Attribute("weight","float",3,"WEIGHT",!0),joint:new t.Attribute("joint","float",4,"JOINT",!0),barycentric:new t.Attribute("barycentric","float",3,null,!0)},hint:r.DYNAMIC_DRAW,faces:[],_enabledAttributes:null,_arrayChunks:[]}},{updateBoundingBox:function(){this.boundingBox||(this.boundingBox=new n),this.boundingBox.updateFromVertices(this.attributes.position.value)},dirty:function(e){if(!e){this.dirty("indices");for(var t in this.attributes)this.dirty(t);return}this._cache.dirtyAll(e),this._cache.dirtyAll(),this._enabledAttributes=null},getVertexNumber:function(){return this.attributes.position.value.length},getFaceNumber:function(){return this.faces.length},isUseFace:function(){return this.useFace&&this.faces.length>0},isSplitted:function(){return this.getVertexNumber()>this.chunkSize},isStatic:function(){return!1},createAttribute:function(e,n,r,i){var s=new t.Attribute(e,n,r,i,!0);return this.attributes[e]=s,this._attributeList.push(e),s},removeAttribute:function(e){var t=this._attributeList.indexOf(e);return t>=0?(this._attributeList.splice(t,1),delete this.attributes[e],!0):!1},getEnabledAttributes:function(){if(this._enabledAttributes)return this._enabledAttributes;var e={},t=this.getVertexNumber();for(var n=0;n<this._attributeList.length;n++){var r=this._attributeList[n],i=this.attributes[r];i.value.length&&i.value.length===t&&(e[r]=i)}return this._enabledAttributes=e,e},_getDirtyAttributes:function(){var e=this.getEnabledAttributes();if(this._cache.miss("chunks"))return e;var t={},n=!0;for(var r in e)this._cache.isDirty(r)&&(t[r]=e[r],n=!1);if(!n)return t},getChunkNumber:function(){return this._arrayChunks.length},getBufferChunks:function(e){this._cache.use(e.__GLID__);if(this._cache.isDirty()){var t=this._getDirtyAttributes(),n=this._cache.isDirty("indices");n=n&&this.isUseFace();if(t){this._updateAttributesAndIndicesArrays(t,n),this._updateBuffer(e,t,n);for(var r in t)this._cache.fresh(r);this._cache.fresh("indices"),this._cache.fresh()}}return this._cache.get("chunks")},_updateAttributesAndIndicesArrays:function(e,t){var n=this,r=this.getVertexNumber(),i=[],s=[],o={};for(var u in e)switch(D){case"byte":o[u]=Int8Array;break;case"ubyte":o[u]=Uint8Array;break;case"short":o[u]=Int16Array;break;case"ushort":o[u]=Uint16Array;break;default:o[u]=Float32Array}var a=function(t){if(n._arrayChunks[t])return n._arrayChunks[t];var s={attributeArrays:{},indicesArray:null};for(var o in e)s.attributeArrays[o]=null;for(var u=0;u<r;u++)i[u]=-1;return n._arrayChunks.push(s),s},f=Object.keys(e);if(r>this.chunkSize&&this.isUseFace()){var l=0,c,h=[0],p=[];for(v=0;v<r;v++)p[v]=-1,i[v]=-1;if(t)for(v=0;v<this.faces.length;v++)s[v]=[0,0,0];c=a(l);var d=0;for(var v=0;v<this.faces.length;v++){var m=this.faces[v],g=s[v];d+3>this.chunkSize&&(l++,h[l]=v,d=0,c=a(l));for(var y=0;y<3;y++){var b=m[y],w=i[b]===-1;for(var E=0;E<f.length;E++){var u=f[E],S=c.attributeArrays[u],x=e[u].value,T=e[u].size;S||(S=c.attributeArrays[u]=[]);if(w){T===1&&(S[d]=x[b]);for(var N=0;N<T;N++)S[d*T+N]=x[b][N]}}w?(i[b]=d,g[y]=d,d++):g[y]=i[b]}}for(var C=0;C<this._arrayChunks.length;C++){var k=this._arrayChunks[C];for(var u in k.attributeArrays){var L=k.attributeArrays[u];L instanceof Array&&(k.attributeArrays[u]=new o[u](L))}}if(t){var A,O,M,k;for(var C=0;C<this._arrayChunks.length;C++){A=h[C],O=h[C+1]||this.faces.length,M=0,k=this._arrayChunks[C];var _=k.indicesArray;_||(_=k.indicesArray=new Uint16Array((O-A)*3));for(var v=A;v<O;v++)_[M++]=s[v][0],_[M++]=s[v][1],_[M++]=s[v][2]}}}else{var k=a(0);if(t){var _=k.indicesArray;_||(_=k.indicesArray=new Uint16Array(this.faces.length*3));var M=0;for(var v=0;v<this.faces.length;v++)_[M++]=this.faces[v][0],_[M++]=this.faces[v][1],_[M++]=this.faces[v][2]}for(var u in e){var x=e[u].value,D=e[u].type,T=e[u].size,S=k.attributeArrays[u],P=r*T;if(!S||S.length!==P)S=new o[u](P),k.attributeArrays[u]=S;if(T===1)for(var v=0;v<x.length;v++)S[v]=x[v];else{var M=0;for(var v=0;v<x.length;v++)for(var N=0;N<T;N++)S[M++]=x[v][N]}}}},_updateBuffer:function(e,n,r){var i=this._cache.get("chunks"),s=!1;if(!i){i=[];for(var o=0;o<this._arrayChunks.length;o++)i[o]={attributeBuffers:[],indicesBuffer:null};this._cache.put("chunks",i),s=!0}for(var u=0;u<this._arrayChunks.length;u++){var a=i[u];a||(a=i[u]={attributeBuffers:[],indicesBuffer:null});var f=a.attributeBuffers,l=a.indicesBuffer,c=this._arrayChunks[u],h=c.attributeArrays,p=c.indicesArray,d=0,v=0;for(var m in n){var g=n[m],y=g.type,b=g.semantic,w=g.size,E;if(!s){for(var o=v;o<f.length;o++)if(f[o].name===m){E=f[o],v=o+1;break}if(!E)for(var o=v-1;o>=0;o--)if(f[o].name===m){E=f[o],v=o;break}}var S;E?S=E.buffer:S=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,S),e.bufferData(e.ARRAY_BUFFER,h[m],this.hint),f[d++]=new t.AttributeBuffer(m,y,S,w,b)}f.length=d,r&&(l||(l=new t.IndicesBuffer(e.createBuffer(),p.length),a.indicesBuffer=l),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l.buffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,p,this.hint))}},generateVertexNormals:function(){var e=this.faces,t=e.length,n=this.attributes.position.value,r=this.attributes.normal.value,i=s.create(),o=s.create(),u=s.create();for(var a=0;a<r.length;a++)s.set(r[a],0,0,0);for(var a=r.length;a<n.length;a++)r[a]=[0,0,0];for(var f=0;f<t;f++){var l=e[f],c=l[0],h=l[1],p=l[2],d=n[c],v=n[h],m=n[p];s.sub(o,d,v),s.sub(u,v,m),s.cross(i,o,u),s.add(r[c],r[c],i),s.add(r[h],r[h],i),s.add(r[p],r[p],i)}for(var a=0;a<r.length;a++)s.normalize(r[a],r[a])},generateFaceNormals:function(){this.isUniqueVertex()||this.generateUniqueVertex();var e=this.faces,t=e.length,n=this.attributes.position.value,r=this.attributes.normal.value,i=s.create(),o=s.create(),a=s.create(),f=r.length===n.length;for(var l=0;l<t;l++){var c=e[l],h=c[0],p=c[1],d=c[2],v=n[h],m=n[p],g=n[d];s.sub(o,v,m),s.sub(a,m,g),s.cross(i,o,a),f?(s.copy(r[h],i),s.copy(r[p],i),s.copy(r[d],i)):r[h]=r[p]=r[d]=u.call(i)}},generateTangents:function(){var e=this.attributes.texcoord0.value,t=this.attributes.position.value,n=this.attributes.tangent.value,r=this.attributes.normal.value,i=[],o=[],u=this.getVertexNumber();for(var a=0;a<u;a++)i[a]=[0,0,0],o[a]=[0,0,0];var f=[0,0,0],l=[0,0,0];for(var a=0;a<this.faces.length;a++){var c=this.faces[a],h=c[0],p=c[1],d=c[2],v=e[h],m=e[p],g=e[d],y=t[h],b=t[p],w=t[d],E=b[0]-y[0],S=w[0]-y[0],x=b[1]-y[1],T=w[1]-y[1],N=b[2]-y[2],C=w[2]-y[2],k=m[0]-v[0],L=g[0]-v[0],A=m[1]-v[1],O=g[1]-v[1],M=1/(k*O-A*L);f[0]=(O*E-A*S)*M,f[1]=(O*x-A*T)*M,f[2]=(O*N-A*C)*M,l[0]=(k*S-L*E)*M,l[1]=(k*T-L*x)*M,l[2]=(k*C-L*N)*M,s.add(i[h],i[h],f),s.add(i[p],i[p],f),s.add(i[d],i[d],f),s.add(o[h],o[h],l),s.add(o[p],o[p],l),s.add(o[d],o[d],l)}var _=[0,0,0,0],D=[0,0,0];for(var a=0;a<u;a++){var P=r[a],H=i[a];s.scale(_,P,s.dot(P,H)),s.sub(_,H,_),s.normalize(_,_),s.cross(D,P,H),_[3]=s.dot(D,o[a])<0?-1:1,n[a]=_.slice()}},isUniqueVertex:function(){return this.isUseFace()?this.getVertexNumber()===this.faces.length*3:!0},generateUniqueVertex:function(){var e=[];for(var t=0;t<this.getVertexNumber();t++)e[t]=0;var n=this.getVertexNumber(),r=this.getEnabledAttributes(),i=this.faces,s=Object.keys(r);for(var t=0;t<i.length;t++){var o=i[t];for(var a=0;a<3;a++){var f=o[a];if(e[f]>0){for(var l=0;l<s.length;l++){var c=s[l],h=r[c].value,p=r[c].size;p===1?h.push(h[f]):h.push(u.call(h[f]))}o[a]=n,n++}e[f]++}}this.dirty()},generateBarycentric:function(){var e=[1,0,0],t=[0,0,1],n=[0,1,0];return function(){this.isUniqueVertex()||this.generateUniqueVertex();var r=this.attributes.barycentric.value;if(r.length==this.faces.length*3)return;var i,s,o,u;for(var a=0;a<this.faces.length;a++)u=this.faces[a],i=u[0],s=u[1],o=u[2],r[i]=e,r[s]=t,r[o]=n}}(),convertToStatic:function(e){this._updateAttributesAndIndicesArrays(this.getEnabledAttributes(),!0);if(this._arrayChunks.length>1)console.warn("Large geometry will discard chunks when convert to StaticGeometry");else if(this._arrayChunks.length===0)return e;var t=this._arrayChunks[0],r=this.getEnabledAttributes();for(var i in r){var s=r[i],o=e.attributes[i];o||(o=e.attributes[i]={type:s.type,size:s.size,value:null},s.semantic&&(o.semantic=s.semantic)),o.value=t.attributeArrays[i]}return e.faces=t.indicesArray,this.boundingBox&&(e.boundingBox=new n,e.boundingBox.min.copy(this.boundingBox.min),e.boundingBox.max.copy(this.boundingBox.max)),e},applyTransform:function(e){this.boundingBox&&this.boundingBox.applyTransform(e);var t=this.attributes.position.value,n=this.attributes.normal.value,r=this.attributes.tangent.value;e=e._array;for(var i=0;i<t.length;i++)s.transformMat4(t[i],t[i],e);var u=o.create();o.invert(u,e),o.transpose(u,u);for(var i=0;i<n.length;i++)s.transformMat4(n[i],n[i],u);for(var i=0;i<r.length;i++)s.transformMat4(r[i],r[i],u)},dispose:function(e){this._cache.use(e.__GLID__);var t=this._cache.get("chunks");if(t)for(var n=0;n<t.length;n++){var r=t[n];for(var i=0;i<r.attributeBuffers.length;i++){var s=r.attributeBuffers[i];e.deleteBuffer(s.buffer)}}this._cache.deleteContext(e.__GLID__)}});return a}),define("qtek/geometry/Plane",["require","../DynamicGeometry","../math/BoundingBox"],function(e){var t=e("../DynamicGeometry"),n=e("../math/BoundingBox"),r=t.derive({widthSegments:1,heightSegments:1},function(){this.build()},{build:function(){var e=this.heightSegments,t=this.widthSegments,r=this.attributes.position.value,i=this.attributes.texcoord0.value,s=this.attributes.normal.value,o=this.faces;r.length=0,i.length=0,s.length=0,o.length=0;for(var u=0;u<=e;u++){var a=u/e;for(var f=0;f<=t;f++){var l=f/t;r.push([2*l-1,2*a-1,0]),i&&i.push([l,a]),s&&s.push([0,0,1]);if(f<t&&u<e){var c=f+u*(t+1);o.push([c,c+1,c+t+1]),o.push([c+t+1,c+1,c+t+2])}}}this.boundingBox=new n,this.boundingBox.min.set(-1,-1,0),this.boundingBox.max.set(1,1,0)}});return r}),define("qtek/Mesh",["require","./Renderable","./core/glenum"],function(e){var t=e("./Renderable"),n=e("./core/glenum"),r=t.derive({mode:n.TRIANGLES,skeleton:null,joints:null},function(){this.joints||(this.joints=[])},{render:function(e,n){var r=n||this.material;if(this.skeleton){var i=this.skeleton.getSubSkinMatrices(this.__GUID__,this.joints);r.shader.setUniformBySemantic(e,"SKIN_MATRIX",i)}return t.prototype.render.call(this,e,n)}});return r.POINTS=n.POINTS,r.LINES=n.LINES,r.LINE_LOOP=n.LINE_LOOP,r.LINE_STRIP=n.LINE_STRIP,r.TRIANGLES=n.TRIANGLES,r.TRIANGLE_STRIP=n.TRIANGLE_STRIP,r.TRIANGLE_FAN=n.TRIANGLE_FAN,r.BACK=n.BACK,r.FRONT=n.FRONT,r.FRONT_AND_BACK=n.FRONT_AND_BACK,r.CW=n.CW,r.CCW=n.CCW,r}),define("qtek/compositor/Pass",["require","../core/Base","../camera/Orthographic","../geometry/Plane","../Shader","../Material","../Mesh","../core/glinfo","../core/glenum"],function(e){var t=e("../core/Base"),n=e("../camera/Orthographic"),r=e("../geometry/Plane"),i=e("../Shader"),s=e("../Material"),o=e("../Mesh"),u=e("../core/glinfo"),a=e("../core/glenum"),f=new r,l=new o({geometry:f}),c=new n,h=t.derive(function(){return{fragment:"",outputs:null,material:null}},function(){var e=new i({vertex:i.source("buildin.compositor.vertex"),fragment:this.fragment}),t=new s({shader:e});e.enableTexturesAll(),this.material=t},{setUniform:function(e,t){var n=this.material.uniforms[e];n&&(n.value=t)},getUniform:function(e){var t=this.material.uniforms[e];if(t)return t.value},attachOutput:function(e,t){this.outputs||(this.outputs={}),t=t||a.COLOR_ATTACHMENT0,this.outputs[t]=e},detachOutput:function(e){for(var t in this.outputs)this.outputs[t]===e&&(this.outputs[t]=null)},bind:function(e,t){if(this.outputs)for(var n in this.outputs){var r=this.outputs[n];r&&t.attach(e.gl,r,n)}t&&t.bind(e)},unbind:function(e,t){t.unbind(e)},render:function(e,t){var n=e.gl;l.material=this.material;if(t){this.bind(e,t);var r=u.getExtension(n,"EXT_draw_buffers");if(r&&this.outputs){var i=[];for(var s in this.outputs)s=+s,s>=n.COLOR_ATTACHMENT0&&s<=n.COLOR_ATTACHMENT0+8&&i.push(s);r.drawBuffersEXT(i)}}this.trigger("beforerender",this,e),n.disable(n.BLEND),n.clear(n.DEPTH_BUFFER_BIT),e.renderQueue([l],c),this.trigger("afterrender",this,e),t&&this.unbind(e,t)}});return h}),define("qtek/texture/TextureCube",["require","../Texture","../core/glinfo","../core/glenum","../core/util"],function(e){function u(e){return e.nodeName==="CANVAS"||e.complete}var t=e("../Texture"),n=e("../core/glinfo"),r=e("../core/glenum"),i=e("../core/util"),s={px:"TEXTURE_CUBE_MAP_POSITIVE_X",py:"TEXTURE_CUBE_MAP_POSITIVE_Y",pz:"TEXTURE_CUBE_MAP_POSITIVE_Z",nx:"TEXTURE_CUBE_MAP_NEGATIVE_X",ny:"TEXTURE_CUBE_MAP_NEGATIVE_Y",nz:"TEXTURE_CUBE_MAP_NEGATIVE_Z"},o=t.derive(function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null}}},{update:function(e){e.bindTexture(e.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),this.beforeUpdate(e);var t=this.format,i=this.type;e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,this.wrapS),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,this.wrapT),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,this.magFilter),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,this.minFilter);var o=n.getExtension(e,"EXT_texture_filter_anisotropic");o&&this.anisotropic>1&&e.texParameterf(e.TEXTURE_CUBE_MAP,o.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic);if(i===36193){var u=n.getExtension(e,"OES_texture_half_float");u||(i=r.FLOAT)}for(var a in this.image){var f=this.image[a];f?e.texImage2D(e[s[a]],0,t,t,i,f):e.texImage2D(e[s[a]],0,t,this.width,this.height,0,t,i,this.pixels[a])}!this.NPOT&&this.useMipmap&&e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null)},generateMipmap:function(e){e.bindTexture(e.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),e.generateMipmap(e.TEXTURE_CUBE_MAP)},bind:function(e){e.bindTexture(e.TEXTURE_CUBE_MAP,this.getWebGLTexture(e))},unbind:function(e){e.bindTexture(e.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){function e(e){return e&e-1===0}return this.image.px?e(this.image.px.width)&&e(this.image.px.height):e(this.width)&&e(this.height)},isRenderable:function(){return this.image.px?u(this.image.px)&&u(this.image.nx)&&u(this.image.py)&&u(this.image.ny)&&u(this.image.pz)&&u(this.image.nz):this.width&&this.height},load:function(e){var t=0,n=this;return i.each(e,function(e,r){var i=new Image;i.onload=function(){t--,t===0&&(n.dirty(),n.trigger("success",n)),i.onload=null},i.onerror=function(){t--,i.onerror=null},t++,i.src=e,n.image[r]=i}),this}});return o}),define("qtek/FrameBuffer",["require","./core/Base","./texture/TextureCube","./core/glinfo","./core/glenum","./core/Cache"],function(e){var t=e("./core/Base"),n=e("./texture/TextureCube"),r=e("./core/glinfo"),i=e("./core/glenum"),s=e("./core/Cache"),o=t.derive({depthBuffer:!0,_attachedTextures:null,_width:0,_height:0,_depthTextureAttached:!1,_renderBufferWidth:0,_renderBufferHeight:0,_binded:!1},function(){this._cache=new s,this._attachedTextures={}},{resize:function(e,t){this._width=e,this._height=t},bind:function(e){var t=e.gl;this._binded||(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer(t)),this._binded=!0),this._cache.put("viewport",e.viewport),e.setViewport(0,0,this._width,this._height),this._cache.miss("renderbuffer")&&this.depthBuffer&&!this._depthTextureAttached&&this._cache.put("renderbuffer",t.createRenderbuffer());if(!this._depthTextureAttached&&this.depthBuffer){var n=this._width,r=this._height,i=this._cache.get("renderbuffer");if(n!==this._renderBufferWidth||r!==this._renderBufferHeight)t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n,r),this._renderBufferWidth=n,this._renderBufferHeight=r,t.bindRenderbuffer(t.RENDERBUFFER,null);this._cache.get("renderbuffer_attached")||(t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),this._cache.put("renderbuffer_attached",!0))}},unbind:function(e){var t=e.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),this._binded=!1,this._cache.use(t.__GLID__);var r=this._cache.get("viewport");r&&e.setViewport(r.x,r.y,r.width,r.height);for(var i in this._attachedTextures){var s=this._attachedTextures[i];if(!s.NPOT&&s.useMipmap){var o=s instanceof n?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;t.bindTexture(o,s.getWebGLTexture(t)),t.generateMipmap(o),t.bindTexture(o,null)}}},getFrameBuffer:function(e){return this._cache.use(e.__GLID__),this._cache.miss("framebuffer")&&this._cache.put("framebuffer",e.createFramebuffer()),this._cache.get("framebuffer")},attach:function(e,t,n,s,o){if(!t.width)throw new Error("The texture attached to color buffer is not a valid.");this._binded||(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer(e)),this._binded=!0),this._width=t.width,this._height=t.height,n=n||e.COLOR_ATTACHMENT0,s=s||e.TEXTURE_2D,o=o||0;if(n===e.DEPTH_ATTACHMENT){var u=r.getExtension(e,"WEBGL_depth_texture");if(!u){console.error(" Depth texture is not supported by the browser ");return}if(t.format!==i.DEPTH_COMPONENT){console.error("The texture attached to depth buffer is not a valid.");return}this._cache.put("renderbuffer_attached",!1),this._depthTextureAttached=!0}this._attachedTextures[n]=t,e.framebufferTexture2D(e.FRAMEBUFFER,n,s,t.getWebGLTexture(e),o)},detach:function(){},dispose:function(e){this._cache.use(e.__GLID__);var t=this._cache.get("renderbuffer");t&&e.deleteRenderbuffer(t);var n=this._cache.get("framebuffer");n&&e.deleteFramebuffer(n),this._cache.deleteContext(e.__GLID__)}});return o.COLOR_ATTACHMENT0=i.COLOR_ATTACHMENT0,o.DEPTH_ATTACHMENT=i.DEPTH_ATTACHMENT,o.STENCIL_ATTACHMENT=i.STENCIL_ATTACHMENT,o.DEPTH_STENCIL_ATTACHMENT=i.DEPTH_STENCIL_ATTACHMENT,o}),define("qtek/2d/context/shader/deferred/blend.essl",[],function(){return"@export buildin.2d.deferred.blend\n\nuniform sampler2D color1;\nuniform sampler2D depth1;\n\nuniform sampler2D color2;\nuniform sampler2D depth2;\n\nvarying vec2 v_Texcoord;\n\nfloat decodeFloat(const in vec4 colour)\n{\n    const vec4 bitShifts = vec4(1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0);\n    return dot(colour, bitShifts);\n}\n\nvoid main()\n{\n\n    vec4 c1 = texture2D(color1, v_Texcoord);\n    vec4 c2 = texture2D(color2, v_Texcoord);\n\n    #ifdef DEPTH_DECODE\n        float d1 = decodeFloat(texture2D(depth1, v_Texcoord));\n        float d2 = decodeFloat(texture2D(depth2, v_Texcoord));\n    #else\n        float d1 = texture2D(depth1, v_Texcoord).r;\n        float d2 = texture2D(depth2, v_Texcoord).r;\n    #endif\n\n    if (d1 > d2) {\n        gl_FragColor.rgb = c1.rgb * (1.0 - c2.a) + c2.rgb;\n    } else {\n        gl_FragColor.rgb = c2.rgb * (1.0 - c1.a) + c1.rgb;\n    }\n    gl_FragColor.a = c1.a + c2.a - c1.a *c2.a;\n\n    // TODO premultiplied alpha in renderer?\n    gl_FragColor.rgb /= gl_FragColor.a;\n}\n\n@end"}),define("qtek/2d/context/shader/deferred/depth.essl",[],function(){return"@export buildin.2d.deferred.depth.vertex\n\nattribute vec3 position;\nattribute vec3 t0;\nattribute vec3 t1;\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nvoid main()\n{\n    mat3 localTransform = mat3(\n        t0.x, t1.x, 0.0,\n        t0.y, t1.y, 0.0,\n        t0.z, t1.z, 1.0\n    );\n    vec3 pos2d = vec3(position.xy, 1.0);\n    pos2d = localTransform * pos2d;\n    vec4 pos3d = vec4(pos2d.xy, position.z, 1.0);\n\n    gl_Position = worldViewProjection * pos3d;\n}\n\n@end\n\n@export buildin.2d.deferred.depth.fragment\n\nvec4 encodeFloat(const in float depth)\n{\n    const vec4 bitShifts = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n\n    const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n    vec4 res = fract( depth * bitShifts );\n    res -= res.xxyz * bit_mask;\n\n    return res;\n}\n\nvoid main()\n{\n    float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)\n                    / (gl_DepthRange.far - gl_DepthRange.near);\n\n    gl_FragColor = encodeFloat(depth);\n}\n\n@end\n\n"}),define("qtek/2d/context/DeferredPainter",["require","qtek/core/Base","qtek/Shader","qtek/Material","qtek/compositor/Pass","qtek/FrameBuffer","qtek/core/glinfo","qtek/texture/Texture2D","qtek/math/Matrix2d","qtek/math/Matrix4","./tool/CachedList","./CanvasElement","./PathPrimitive","./ImagePrimitive","./CanvasPath","./CanvasImage","./tool/ImageAtlas","./shader/deferred/blend.essl","./shader/deferred/depth.essl"],function(e){var t=e("qtek/core/Base"),n=e("qtek/Shader"),r=e("qtek/Material"),i=e("qtek/compositor/Pass"),s=e("qtek/FrameBuffer"),o=e("qtek/core/glinfo"),u=e("qtek/texture/Texture2D"),a=e("qtek/math/Matrix2d"),f=e("qtek/math/Matrix4"),l=e("./tool/CachedList"),c=e("./CanvasElement"),h=e("./PathPrimitive"),p=e("./ImagePrimitive"),d=e("./CanvasPath"),v=e("./CanvasImage"),m=e("./tool/ImageAtlas");n.import(e("./shader/deferred/blend.essl")),n.import(e("./shader/deferred/depth.essl"));var g=new n({vertex:n.source("buildin.2d.deferred.depth.vertex"),fragment:n.source("buildin.2d.deferred.depth.fragment")}),y=new r({shader:g}),b=new i({fragment:n.source("buildin.2d.deferred.blend")}),w=t.derive(function(){return{transform:new a,ctx:null,_elements:[],_pathPrimitives:[],_imagePrimitives:[],_textAtlas:new l(m,2),_imagePrimitiveList:new l(p),_pathPrimitiveList:new l(h,2),_pathColorTexture:null,_pathDepthTexture:null,_imageColorTexture:null,_imageDepthTexture:null,frameBuffer:new s,_blendFunc:null}},{addElement:function(e){e.depth=this.ctx.requestDepthChannel(),this._elements.push(e)},getElements:function(){return this._elements},draw:function(){var e=this.ctx,t=e.renderer.gl;t.depthMask(!0),t.enable(t.BLEND);for(var n=0;n<this._pathPrimitives.length;n++)f.fromMat2d(this._pathPrimitives[n].worldTransform,this.transform),this._pathPrimitives[n].material.blend=this._blendFunc;for(var n=0;n<this._imagePrimitives.length;n++)f.fromMat2d(this._imagePrimitives[n].worldTransform,this.transform),this._imagePrimitives[n].material.blend=this._blendFunc;if(this._pathPrimitives.length==0||this._imagePrimitives.length==0)this._pathPrimitives.length>0&&e.renderer.renderQueue(this._pathPrimitives,e.camera),this._imagePrimitives.length>0&&e.renderer.renderQueue(this._imagePrimitives,e.camera);else{var r=o.getExtension(t,"WEBGL_depth_texture");this._pathColorTexture=this._checkTexture(this._pathColorTexture,e),this._pathDepthTexture=this._checkTexture(this._pathDepthTexture,e),this._imageColorTexture=this._checkTexture(this._imageColorTexture,e),this._imageDepthTexture=this._checkTexture(this._imageDepthTexture,e),r&&(this._pathDepthTexture.format=t.DEPTH_COMPONENT,this._pathDepthTexture.type=t.UNSIGNED_SHORT,this._imageDepthTexture.format=t.DEPTH_COMPONENT,this._imageDepthTexture.type=t.UNSIGNED_SHORT),this.frameBuffer.attach(t,this._pathColorTexture),r&&this.frameBuffer.attach(t,this._pathDepthTexture,t.DEPTH_ATTACHMENT),this.frameBuffer.bind(e.renderer),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e.renderer.renderQueue(this._pathPrimitives,e.camera),r||(this.frameBuffer.attach(t,this._pathDepthTexture),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e.renderer.renderQueue(this._pathPrimitives,e.camera,y)),this.frameBuffer.attach(t,this._imageColorTexture),r&&this.frameBuffer.attach(t,this._imageDepthTexture,t.DEPTH_ATTACHMENT),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e.renderer.renderQueue(this._imagePrimitives,e.camera),r||(this.frameBuffer.attach(t,this._imageDepthTexture),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e.renderer.renderQueue(this._imagePrimitives,e.camera,y)),this.frameBuffer.unbind(e.renderer),t.depthMask(!1),t.disable(t.DEPTH_TEST),b.setUniform("color1",this._pathColorTexture),b.setUniform("depth1",this._pathDepthTexture),b.setUniform("color2",this._imageColorTexture),b.setUniform("depth2",this._imageDepthTexture),b.material.depthTest=!1,b.material.depthMask=!1,b.material.transparent=!0,r?b.material.shader.unDefine("fragment","DEPTH_DECODE"):b.material.shader.define("fragment","DEPTH_DECODE"),e.renderer.clear=0,b.render(e.renderer),e.renderer.clear=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT}for(var n=0;n<this._elements.length;n++)this._elements[n].afterDraw()},_checkTexture:function(e,t){if(!e||e.width!==t.renderer.width||e.height!==t.renderer.height)e&&e.dispose(t.renderer.gl),e=new u({width:t.renderer.width,height:t.renderer.height,minFilter:t.renderer.gl.NEAREST,magFilter:t.renderer.gl.NEAREST});return e},repaint:function(){for(var e=0;e<this._pathPrimitives.length;e++)this._pathPrimitives[e].updateElements();for(var e=0;e<this._imagePrimitives.length;e++)this._imagePrimitives[e].updateElements();this.draw()},setBlendFunc:function(e){this._blendFunc=e},begin:function(){this.beginTextAtlas();for(var e=0;e<this._pathPrimitives.length;e++)this._pathPrimitives[e].clearElements();for(var e=0;e<this._imagePrimitives.length;e++)this._imagePrimitives[e].clearElements();this._pathPrimitives.length=0,this._elements.length=0,this._imagePrimitiveList.clear(this._disposePrimitive),this._pathPrimitiveList.clear(this._disposePrimitive)},end:function(){var e,t,n=null;for(var r=0;r<this._elements.length;r++){var i=this._elements[r];switch(i.eType){case v.eType:var s=i.getHashKey();n!==s&&(n=s,t=this._imagePrimitiveList.increase(),this._imagePrimitives.push(t)),t.addElement(i);break;case d.eType:e||(e=this._pathPrimitiveList.increase(),this._pathPrimitives.push(e)),e.addElement(i);break;default:console.warn("Deferred painter only support CanvasImage and CanvasPath")}}for(var r=0;r<this._pathPrimitives.length;r++)this._pathPrimitives[r].updateElements();for(var r=0;r<this._imagePrimitives.length;r++)this._imagePrimitives[r].updateElements()},beginTextAtlas:function(){this._textAtlas.clear(this._disposeImageAtlas)},getNewTextAtlas:function(){var e=this._textAtlas.increase();return e.clear(),e},dispose:function(){this.begin()},_disposePrimitive:function(e){e.geometry.dispose(this.ctx.renderer.gl)},_disposeImageAtlas:function(e){e.dispose(this.ctx.renderer.gl)},_eleDepthSortFunc:function(e,t){return e.depth-t.depth}});return w}),define("qtek/2d/context/States",["require","glmatrix"],function(e){var t=e("glmatrix"),n=t.mat2d,r=function(){this._matrix=n.create()};return r.prototype={constructor:r,load:function(e){e.strokeStyle=this.strokeStyle,e.fillStyle=this.fillStyle,e.globalAlpha=this.globalAlpha,e.lineWidth=this.lineWidth,e.font=this.font,e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,n.copy(e.currentTransform._array,this._matrix)},save:function(e){this.strokeStyle=e.strokeStyle,this.fillStyle=e.fillStyle,this.globalAlpha=e.globalAlpha,this.lineWidth=e.lineWidth,this.font=e.font,this.textBaseline=e.textBaseline,this.textAlign=e.textAlign,n.copy(this._matrix,e.currentTransform._array)}},r}),define("qtek/2d/context/Context2D",["require","qtek/math/Matrix2d","glmatrix","qtek/core/Base","qtek/Renderer","qtek/camera/Orthographic","./Painter","./DeferredPainter","./CanvasPath","./CanvasImage","./States"],function(e){"use strict";var t=e("qtek/math/Matrix2d"),n=e("glmatrix"),r=n.vec2,i=n.mat2d,s=e("qtek/core/Base"),o=e("qtek/Renderer"),u=e("qtek/camera/Orthographic"),a=e("./Painter"),f=e("./DeferredPainter"),l=e("./CanvasPath"),c=e("./CanvasImage"),h=e("./States"),p=r.create(),d=s.derive({canvas:null,renderer:null,camera:null,depthChannelGap:.01,_path:null,_polygon:null,_painter:null,_textAtlas:null,_depth:1},function(){var e=this.canvas.width,n=this.canvas.height;this.canvas&&!this.renderer&&(this.renderer=new o({canvas:this.canvas})),this.camera||(this.camera=new u({left:-e/2,right:e/2,top:n/2,bottom:-n/2,far:50,near:0}),this.camera.scale.y=-1,this.camera.position.x=e/2,this.camera.position.y=n/2,this.camera.position.z=this.camera.far,this.camera.update(!0)),this.currentTransform=new t,this._statesStack=[]},{strokeStyle:"#000000",fillStyle:"#000000",globalAlpha:1,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic",lineWidth:1,lineCap:"",lineJoin:"",save:function(){var e=new h;e.save(this),this._statesStack.push(e)},restore:function(){if(this._statesStack.length>0){var e=this._statesStack.pop();e.load(this)}},scale:function(e,t){p[0]=e,p[1]=t;var n=this.currentTransform._array;i.scale(n,n,p)},rotate:function(e){var t=this.currentTransform._array;i.rotate(t,t,e)},translate:function(e,t){p[0]=e,p[1]=t;var n=this.currentTransform._array;i.translate(n,n,p)},transform:function(e,t,n,r,i,s){var o=this.currentTransform._array,u=o[0],a=o[1],f=o[2],l=o[3],c=o[4],h=o[5];o[0]=e*u+t*f,o[1]=e*a+t*l,o[2]=n*u+r*f,o[3]=n*a+r*l,o[4]=u*i+f*s+c,o[5]=a*i+l*s+h},setTransform:function(e,t,n,r,i,s){var o=this.currentTransform._array;o[0]=e,o[1]=t,o[2]=n,o[3]=r,o[4]=i,o[5]=s},drawImage:function(e,t,n,r,i,s,o,u,a){if(!this._painter)return;this._path&&this.endPath(),arguments.length==3?(s=t,o=n,t=0,n=0,u=r=e.width,a=i=e.height):arguments.length==5&&(s=t,o=n,u=r,a=i,t=0,n=0,r=e.height,i=e.height);var f=new c(e,t,n,r,i,s,o,u,a);return f.end(this),this._painter.addElement(f),f},createLinearGradient:function(){},createRadialGradient:function(){},createPattern:function(){},strokeText:function(e,t,n,r){return this._drawText(e,"stroke",t,n,r)},fillText:function(e,t,n,r){return this._drawText(e,"fill",t,n,r)},_drawText:function(e,t,n,r,i){if(!this._painter)return;this._path&&this.endPath(),this._textAtlas||(this._textAtlas=this._painter.getNewTextAtlas());var s=this._textAtlas.addText(e,t,n,r,i,this);return s||(this._textAtlas=this._painter.getNewTextAtlas(),s=this._textAtlas.addText(e,t,n,r,i,this)),s.end(this),this._painter.addElement(s),s},measureText:function(e){return this._textAtlas||(this._textAtlas=this._painter.getNewTextAtlas()),this._textAtlas.measureText(e)},clearRect:function(){},fillRect:function(){},strokeRect:function(){},beginPath:function(e){return this._path&&this.endPath(),e||(e=new l),e.begin(this),this._path=e,e},closePath:function(){this._path&&this._path.close(this.lineWidth)},fill:function(){this._path&&this._path.fill(this)},stroke:function(){this._path&&this._path.stroke(this)},clip:function(){console.warn("TODO")},moveTo:function(e,t){this._path&&this._path.moveTo(e,t)},lineTo:function(e,t){this._path&&this._path.lineTo(e,t,this.lineWidth)},quadraticCurveTo:function(e,t,n,r){this._path&&this._path.quadraticCurveTo(e,t,n,r,this.lineWidth)},bezierCurveTo:function(e,t,n,r,i,s){this._path&&this._path.bezierCurveTo(e,t,n,r,i,s,this.lineWidth)},arc:function(e,t,n,r,i,s){this._path&&this._path.arc(e,t,n,r,i,s,this.lineWidth)},arcTo:function(){},rect:function(e,t,n,r){this._path&&this._path.rect(e,t,n,r,this.lineWidth)},isPointInPath:function(){},createImageData:function(){},getImageData:function(){},putImageData:function(){},beginDraw:function(e,t){return e||(t=="deferred"?e=new f:e=new a),this.setPainter(e),e},setPainter:function(e){this._painter!==e&&(this._painter&&this._painter.end(),this.clearDepth(),e.ctx=this,this._textAtlas=null,this._painter=e,e.begin())},addPath:function(e){this._painter&&this._painter.addElement(e)},addImage:function(e){this._painter&&this._painter.addElement(e)},clearColor:function(e){var t=this.renderer.gl;e&&t.clearColor(e[0],e[1],e[2],e[3]),t.clear(t.COLOR_BUFFER_BIT)},clearDepth:function(){var e=this.renderer.gl;e.clear(e.DEPTH_BUFFER_BIT),this._depth=1},clear:function(e){var t=this.renderer.gl;e&&t.clearColor(e[0],e[1],e[2],e[3]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this._depth=1},endDraw:function(){this._painter&&(this._path&&this.endPath(),this._painter.end(),this._painter.draw(),this._painter=null)},repaint:function(e){this.clearDepth(),e.repaint()},draw:function(e){this.clearDepth(),e.draw()},endPath:function(){this._path&&(this._path.end(this),this._painter&&this._painter.addElement(this._path),this._path=null)},requestDepthChannel:function(){return this.setDepthChannel(this._depth+this.depthChannelGap),this._depth},setDepthChannel:function(e){this._depth=e,this._depth>this.camera.far&&(this.camera.far*=2,this.camera.position.z=this.camera.far,this.camera.update(!0))},identity:function(){i.identity(this.currentTransform._array)},resize:function(e,t){this.renderer.resize(e,t),e=this.renderer.width,t=this.renderer.height,this.camera.left=-e/2,this.camera.right=e/2,this.camera.top=t/2,this.camera.bottom=-t/2,this.camera.position.x=e/2,this.camera.position.y=t/2,this.camera.update(!0)}});return d}),define("zrender-x/tool/area",["require","../tool/util"],function(e){function a(e,r,i,s){if(!r||!e)return!1;var o=e.type;if(!y(r.__rect||e.getRect(r),i,s))return!1;var u=f(e,r,i,s);if(typeof u!="undefined")return u;if(o!="bezier-curve"&&e.buildPath&&n.isPointInPath)return n=n||t.getContext(),l(e,n,r,i,s);if(n.getImageData)return c(e,r,i,s);switch(o){case"heart":case"droplet":case"ellipse":return!0;case"trochoid":var a=r.location=="out"?r.r1+r.r2+r.d:r.r1-r.r2+r.d;return b(r,i,s,a);case"rose":return b(r,i,s,r.maxr);default:return!1}}function f(e,t,n,r){switch(e.type){case"line":return d(t,n,r);case"broken-line":return m(t,n,r);case"text":return!0;case"ring":return g(t,n,r);case"rectangle":return!0;case"circle":return b(t,n,r,t.r);case"sector":return w(t,n,r);case"path":return S(e,t,n,r);case"polygon":case"star":case"isogon":return E(t,n,r);case"image":return!0}}function l(e,t,n,r,i){return t.beginPath(),e.buildPath(t,n),t.closePath(),t.isPointInPath(r,i)}function c(e,n,r,i){var s=n.__rect||e.getRect(n),o=t.getPixelContext(),u=t.getPixelOffset();return t.adjustCanvasSize(r,i),o.clearRect(s.x,s.y,s.width,s.height),o.beginPath(),e.brush(o,{style:n}),o.closePath(),h(o,r+u.x,i+u.y)}function h(e,t,n,r){var i;typeof r!="undefined"?(r=Math.floor((r||1)/2),i=e.getImageData(t-r,n-r,r+r,r+r).data):i=e.getImageData(t,n,1,1).data;var s=i.length;while(s--)if(i[s]!==0)return!0;return!1}function p(e,t,n,r){return!a(e,t,n,r)}function d(e,t,n){var r=e.xStart,i=e.yStart,s=e.xEnd,o=e.yEnd,u=Math.max(e.lineWidth,5),a=0,f=r;if(r<s){if(t<r-u||t>s+u)return}else if(t<s-u||t>r+u)return;if(i<o){if(n<i-u||n>o+u)return}else if(n<o-u||n>i+u)return;if(r===s)return Math.abs(t-r)<=u/2;a=(i-o)/(r-s),f=(r*o-s*i)/(r-s);var l=(a*t-n+f)*(a*t-n+f)/(a*a+1);return l<=u/2*u/2}function m(e,t,n){var r=e.pointList;for(var i=0,s=r.length-1;i<s;i++){v.xStart=r[i][0],v.yStart=r[i][1],v.xEnd=r[i+1][0],v.yEnd=r[i+1][1],v.lineWidth=Math.max(e.lineWidth,10);if(d(v,t,n))return!0}return!1}function g(e,t,n){return b(e,t,n,e.r)&&!b({x:e.x,y:e.y},t,n,e.r0||0)}function y(e,t,n){return t>=e.x&&t<=e.x+e.width&&n>=e.y&&n<=e.y+e.height}function b(e,t,n,r){return(t-e.x)*(t-e.x)+(n-e.y)*(n-e.y)<r*r}function w(e,t,n){if(!b(e,t,n,e.r)||e.r0>0&&b({x:e.x,y:e.y},t,n,e.r0))return!1;if(Math.abs(e.endAngle-e.startAngle)>=360)return!0;var r=(360-Math.atan2(n-e.y,t-e.x)/Math.PI*180)%360,i=(360+e.endAngle)%360,s=(360+e.startAngle)%360;return i>s?r>=s&&r<=i:!(r>=i&&r<=s)}function E(e,t,n){var r,i,s=e.pointList,o=s.length,u=!1,a=!0,f;for(r=0;r<o;++r)if(s[r][0]==t&&s[r][1]==n){a=!1,u=!0;break}if(a){a=!1,u=!1;for(r=0,i=o-1;r<o;i=r++)if(s[r][1]<n&&n<s[i][1]||s[i][1]<n&&n<s[r][1]){if(t<=s[r][0]||t<=s[i][0]){f=(n-s[r][1])*(s[i][0]-s[r][0])/(s[i][1]-s[r][1])+s[r][0];if(t<f)u=!u;else if(t==f){u=!0;break}}}else if(n==s[r][1]){if(t<s[r][0]){s[r][1]>s[i][1]?--n:++n;break}}else if(s[r][1]==s[i][1]&&n==s[r][1]&&(s[r][0]<t&&t<s[i][0]||s[i][0]<t&&t<s[r][0])){u=!0;break}}return u}function S(e,t,r,i){t.pointList||e.buildPath(n,t);var s=t.pointList,o=!1;for(var u=0,a=s.length;u<a;u++){o=E({pointList:s[u]},r,i);if(o)break}return o}function x(e,i){var o=e+":"+i;if(r[o])return r[o];n=n||t.getContext(),n.save(),i&&(n.font=i),e=(e+"").split("\n");var a=0;for(var f=0,l=e.length;f<l;f++)a=Math.max(n.measureText(e[f]).width,a);return n.restore(),r[o]=a,++s>u&&(s=0,r={}),a}function T(e,r){var s=e+":"+r;if(i[s])return i[s];n=n||t.getContext(),n.save(),r&&(n.font=r),e=(e+"").split("\n");var a=(n.measureText("国").width+2)*e.length;return n.restore(),i[s]=a,++o>u&&(o=0,i={}),a}var t=e("../tool/util"),n,r={},i={},s=0,o=0,u=2e4,v={xStart:0,yStart:0,xEnd:0,yEnd:0,lineWidth:0};return{isInside:a,isOutside:p,getTextWidth:x,getTextHeight:T}}),define("zrender-x/shape/mixin/Transformable",["require","glmatrix","../../tool/math","glmatrix"],function(e){var t=e("glmatrix"),n=t.mat2d,r=e("../../tool/math"),t=e("glmatrix"),i=t.vec2,s=t.vec3,o=t.vec4,u=i.create(),a=function(){this.position||(this.position=i.create()),typeof this.rotation=="undefined"&&(this.rotation=s.create()),this.scale||(this.scale=o.fromValues(1,1,0,0)),this.needLocalTransform=!1,this.needTransform=!1};return a.prototype={constructor:a,updateNeedTransform:function(){this.needLocalTransform=Math.abs(this.rotation[0])>1e-4||Math.abs(this.position[0])>1e-4||Math.abs(this.position[1])>1e-4||Math.abs(this.scale[0]-1)>1e-4||Math.abs(this.scale[1]-1)>1e-4},updateTransform:function(){this.updateNeedTransform(),this.parent?this.needTransform=this.needLocalTransform||this.parent.needTransform:this.needTransform=this.needLocalTransform;if(!this.needTransform)return;var e=this.transform||n.create();this.needLocalTransform&&r.updateTransform(e,this.position,this.rotation,this.scale),this.transform=e,this.parent&&this.parent.needTransform&&(this.needLocalTransform?n.mul(this.transform,this.parent.transform,this.transform):n.copy(this.transform,this.parent.transform))},setTransform:function(e){if(this.needTransform){var t=this.transform;e.transform(t[0],t[1],t[2],t[3],t[4],t[5])}}},a}),define("zrender-x/tool/color",["require","../tool/util"],function(e){function f(e){r=e}function l(){r=i}function c(e,t){return e=+e||0,t=t||r,t[e%t.length]}function h(e){s=e}function p(){o=s}function d(){return s}function v(e,r,i,s,o,u,a){n||(n=t.getContext());var f=n.createRadialGradient(e,r,i,s,o,u);for(var l=0,c=a.length;l<c;l++)f.addColorStop(a[l][0],a[l][1]);return f.__nonRecursion=!0,f}function m(e,r,i,s,o){n||(n=t.getContext());var u=n.createLinearGradient(e,r,i,s);for(var a=0,f=o.length;a<f;a++)u.addColorStop(o[a][0],o[a][1]);return u.__nonRecursion=!0,u}function g(e,t,n){e=S(e),t=S(t),e=F(e),t=F(t);var r=[],i=(t[0]-e[0])/n,s=(t[1]-e[1])/n,o=(t[2]-e[2])/n;for(var u=0,a=e[0],f=e[1],l=e[2];u<n;u++)r[u]=b([R(Math.floor(a),[0,255]),R(Math.floor(f),[0,255]),R(Math.floor(l),[0,255])]),a+=i,f+=s,l+=o;return a=t[0],f=t[1],l=t[2],r[u]=b([a,f,l]),r}function y(e,t){var n=[],r=e.length;t===undefined&&(t=20);if(r===1)n=g(e[0],e[0],t);else if(r>1)for(var i=0,s=r-1;i<s;i++){var o=g(e[i],e[i+1],t);i<s-1&&o.pop(),n=n.concat(o)}return n}function b(e,t){t=t||"rgb";if(e&&(e.length===3||e.length===4)){e=q(e,function(e){return e>1?Math.ceil(e):e});if(t.indexOf("hex")>-1)return e=q(e.slice(0,3),function(e){return e=Number(e).toString(16),e.length===1?"0"+e:e}),"#"+e.join("");if(t.indexOf("hs")>-1){var n=q(e.slice(1,3),function(e){return e+"%"});e[1]=n[0],e[2]=n[1]}return t.indexOf("a")>-1?(e.length===3&&e.push(1),e[3]=R(e[3],[0,1]),t+"("+e.slice(0,4).join(",")+")"):t+"("+e.slice(0,3).join(",")+")"}}function w(e){e=_(e),e.indexOf("#")>-1&&(e=x(e));var t=e.replace(/[rgbahsvl%\(\)]/ig,"").split(",");return t=q(t,function(e){return Number(e)}),t}function E(e,t){var n=F(e),r=n[3];return typeof r=="undefined"&&(r=1),e.indexOf("hsb")>-1?n=U(n):e.indexOf("hsl")>-1&&(n=z(n)),t.indexOf("hsb")>-1||t.indexOf("hsv")>-1?n=X(n):t.indexOf("hsl")>-1&&(n=V(n)),n[3]=r,b(n,t)}function S(e){return E(e,"rgba")}function x(e){return E(e,"rgb")}function T(e){return E(e,"hex")}function N(e){return E(e,"hsva")}function C(e){return E(e,"hsv")}function k(e){return E(e,"hsba")}function L(e){return E(e,"hsb")}function A(e){return E(e,"hsla")}function O(e){return E(e,"hsl")}function M(e){for(var t in a)if(T(a[t])===T(e))return t;return null}function _(e){return e=String(e),e=e.replace(/(^\s*)|(\s*$)/g,""),/^[^#]*?$/i.test(e)&&(e=e.replace(/\s/g,"")),e}function D(e){a[e]&&(e=a[e]),e=_(e),e=e.replace(/hsv/i,"hsb");if(/^#[0-9a-f]{3}$/i.test(e)){var t=e.replace("#","").split("");e="#"+t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}return e}function P(e,t){var n=t>0?1:-1;typeof t=="undefined"&&(t=0),t=Math.abs(t)>1?1:Math.abs(t),e=x(e);var r=F(e);for(var i=0;i<3;i++)n===1?r[i]=Math.floor(r[i]*(1-t)):r[i]=Math.floor((255-r[i])*t+r[i]);return"rgb("+r.join(",")+")"}function H(e){var t=F(S(e));return t=q(t,function(e){return 255-e}),b(t,"rgb")}function B(e,t,n){typeof n=="undefined"&&(n=.5),n=1-R(n,[0,1]);var r=n*2-1,i=F(S(e)),s=F(S(t)),o=i[3]-s[3],u=((r*o===-1?r:(r+o)/(1+r*o))+1)/2,a=1-u,f=[];for(var l=0;l<3;l++)f[l]=i[l]*u+s[l]*a;var c=i[3]*n+s[3]*(1-n);return c=Math.max(0,Math.min(1,c)),i[3]===1&&s[3]===1?b(f,"rgb"):(f[3]=c,b(f,"rgba"))}function j(){return T("rgb("+Math.round(Math.random()*256)+","+Math.round(Math.random()*256)+","+Math.round(Math.random()*256)+")")}function F(e){e=D(e);var t=e.match(u);if(t===null)throw new Error("The color format error");var n,r,i=[],s;if(t[2])n=t[2].replace("#","").split(""),s=[n[0]+n[1],n[2]+n[3],n[4]+n[5]],i=q(s,function(e){return R(parseInt(e,16),[0,255])});else if(t[4]){var o=t[4].split(",");r=o[3],s=o.slice(0,3),i=q(s,function(e){return e=Math.floor(e.indexOf("%")>0?parseInt(e,0)*2.55:e),R(e,[0,255])}),typeof r!="undefined"&&i.push(R(parseFloat(r),[0,1]))}else if(t[5]||t[6]){var a=(t[5]||t[6]).split(","),f=parseInt(a[0],0)/360,l=a[1],c=a[2];r=a[3],i=q([l,c],function(e){return R(parseFloat(e)/100,[0,1])}),i.unshift(f),typeof r!="undefined"&&i.push(R(parseFloat(r),[0,1]))}return i}function I(e,t){t===null&&(t=1);var n=F(S(e));return n[3]=R(Number(t).toFixed(4),[0,1]),b(n,"rgba")}function q(e,t){if(typeof t!="function")throw new TypeError;var n=e?e.length:0;for(var r=0;r<n;r++)e[r]=t(e[r]);return e}function R(e,t){return e<=t[0]?e=t[0]:e>=t[1]&&(e=t[1]),e}function U(e){var t=e[0],n=e[1],r=e[2],i,s,o;if(n===0)i=r*255,s=r*255,o=r*255;else{var u=t*6;u===6&&(u=0);var a=Math.floor(u),f=r*(1-n),l=r*(1-n*(u-a)),c=r*(1-n*(1-(u-a))),h=0,p=0,d=0;a===0?(h=r,p=c,d=f):a===1?(h=l,p=r,d=f):a===2?(h=f,p=r,d=c):a===3?(h=f,p=l,d=r):a===4?(h=c,p=f,d=r):(h=r,p=f,d=l),i=h*255,s=p*255,o=d*255}return[i,s,o]}function z(e){var t=e[0],n=e[1],r=e[2],i,s,o;if(n===0)i=r*255,s=r*255,o=r*255;else{var u;r<.5?u=r*(1+n):u=r+n-n*r;var a=2*r-u;i=255*W(a,u,t+1/3),s=255*W(a,u,t),o=255*W(a,u,t-1/3)}return[i,s,o]}function W(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),6*n<1?e+(t-e)*6*n:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function X(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=s-i,u=s,a,f;if(o===0)a=0,f=0;else{f=o/s;var l=((s-t)/6+o/2)/o,c=((s-n)/6+o/2)/o,h=((s-r)/6+o/2)/o;t===s?a=h-c:n===s?a=1/3+l-h:r===s&&(a=2/3+c-l),a<0&&(a+=1),a>1&&(a-=1)}return a*=360,f*=100,u*=100,[a,f,u]}function V(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=s-i,u=(s+i)/2,a,f;if(o===0)a=0,f=0;else{u<.5?f=o/(s+i):f=o/(2-s-i);var l=((s-t)/6+o/2)/o,c=((s-n)/6+o/2)/o,h=((s-r)/6+o/2)/o;t===s?a=h-c:n===s?a=1/3+l-h:r===s&&(a=2/3+c-l),a<0&&(a+=1),a>1&&(a-=1)}return a*=360,f*=100,u*=100,[a,f,u]}var t=e("../tool/util"),n,r=["#ff9277"," #dddd00"," #ffc877"," #bbe3ff"," #d5ffbb","#bbbbff"," #ddb000"," #b0dd00"," #e2bbff"," #ffbbe3","#ff7777"," #ff9900"," #83dd00"," #77e3ff"," #778fff","#c877ff"," #ff77ab"," #ff6600"," #aa8800"," #77c7ff","#ad77ff"," #ff77ff"," #dd0083"," #777700"," #00aa00","#0088aa"," #8400dd"," #aa0088"," #dd0000"," #772e00"],i=r,s="rgba(255,255,0,0.5)",o=s,u=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,a={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#0ff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000",blanchedalmond:"#ffebcd",blue:"#00f",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#f0f",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#0f0",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#f0f",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#f00",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#fff",whitesmoke:"#f5f5f5",yellow:"#ff0",yellowgreen:"#9acd32"};return{customPalette:f,resetPalette:l,getColor:c,getHighlightColor:d,customHighlight:h,resetHighlight:p,getRadialGradient:v,getLinearGradient:m,getGradientColors:y,getStepColors:g,reverse:H,mix:B,lift:P,trim:_,random:j,toRGB:x,toRGBA:S,toHex:T,toHSL:O,toHSLA:A,toHSB:L,toHSBA:k,toHSV:C,toHSVA:N,toName:M,toColor:b,toArray:w,alpha:I,getData:F}}),define("zrender-x/shape/Base",["require","../tool/area","glmatrix","../tool/guid","qtek/core/util","../tool/math","./mixin/Transformable","../tool/event","../tool/color"],function(e){function l(e,n,r,i,s,o){var u=t.getTextWidth(e,i),a=t.getTextHeight("国",i);e=(e+"").split("\n");switch(s){case"end":case"right":n-=u;break;case"center":n-=u/2}switch(o){case"top":break;case"bottom":r-=a*e.length;break;default:r-=a*e.length/2}return{x:n,y:r,width:u,height:a*e.length}}function c(e){this.id=e.id||s(),this.isDynamic=!1;for(var t in e)this[t]=e[t];this.style=this.style||{},this.isShapeChanged=!0,this.isTextChanged=!0,this._path=null,this._textImageList=[],this._transformChanged=!1,this.__dirty=!0,a.call(this),f.call(this)}var t=e("../tool/area"),n=e("glmatrix"),r=n.vec2,i=n.mat2d,s=e("../tool/guid"),o=e("qtek/core/util"),u=e("../tool/math"),a=e("./mixin/Transformable"),f=e("../tool/event").Dispatcher;o.extend(c.prototype,a.prototype),o.extend(c.prototype,f.prototype),c.prototype.draggable=!1,c.prototype.clickable=!1,c.prototype.hoverable=!1,c.prototype.zlevel=0,c.prototype.z=0,c.prototype.ignore=!1,c.prototype.invisible=!1,c.prototype._isHighlight=!1,c.prototype.clone=function(e){!this._path&&e&&this.brush(e,!1);var t=new this.constructor({});return e&&(t._path=this._path.clone(e),t._textImageList=this._textImageList.slice()),t.zlevel=this.zlevel,t.style=this.cloneStyle(),t.isShapeChanged=!1,t},c.prototype.cloneStyle=function(){if(this.style)return o.clone(this.style)},c.prototype.setStyle=function(e,t){switch(e){case"brushType":case"lineWidth":t!==this.style[e]&&(this.isShapeChanged=!0);break;case"text":case"textFont":case"textBaseline":case"textAlign":case"textPosition":case"textColor":t!==this.style[e]&&(this.isTextChanged=!0);break;default:t!==this.style[e]&&(this.__dirty=!0)}this.style[e]=t},c.prototype.hashable=function(){return!1},c.prototype.brush=function(e){var t;this._isHighlight?t=this.getHighlightStyle(this.style,this.highlightStyle):t=this.style,this.brushTypeOnly&&(t.brushType=this.brushTypeOnly),this.brushTypeOnly=="stroke"&&(t.strokeColor=t.strokeColor||t.color);var n=!1;if(!this._path||this.isShapeChanged){var r,s=this.hashable();s&&(r=this.getHashPath(t),r&&(this._path=r.clone(e),this.buildPath(null,t),this._transformChanged=!0));if(!r){e.save(),this.setContext(e,t),this.setTransform(e),this._path&&!s?e.beginPath(this._path):this._path=e.beginPath(),this.buildPath(e,t);switch(t.brushType){case"both":e.fill();case"stroke":t.lineWidth>0&&e.stroke();break;default:e.fill()}e.endPath(),n=!0,s?this.putHashPath(this._path):this.isDynamic||this._path.toStatic(),e.restore()}this.isShapeChanged=!1}n||(this._transformChanged&&this.transform&&(i.copy(this._path.transform._array,this.transform),this._path.transform._dirty=!0),typeof t.opacity!="undefined"&&this._path.setGlobalAlpha(t.opacity),typeof t.color!="undefined"&&this._path.setFillStyle(t.color),typeof t.strokeColor!="undefined"&&this._path.setStrokeStyle(t.strokeColor),e.addPath(this._path));if(t.text)if(this.isTextChanged)e._painter&&(e.save(),this.setTransform(e),this.drawText(e,t,this.style),e.restore());else{this.isTextChanged=!1;for(var o=0;o<this._textImageList.length;o++){var u=this._textImageList[o];this.transform&&i.copy(u.transform._array,this.transform),u.transform._dirty=!0,e.addImage(u)}}};var h=[["color","fillStyle"],["strokeColor","strokeStyle"],["opacity","globalAlpha"],["lineWidth","lineWidth"]];c.prototype.setContext=function(e,t){for(var n=0,r=h.length;n<r;n++){var i=h[n][0],s=t[i],o=h[n][1];typeof s!="undefined"&&(e[o]=s)}},c.prototype.hover=function(){this._isHighlight=!0},c.prototype.leaveHover=function(){this._isHighlight=!1},c.prototype.getHighlightStyle=function(t,n){var r={};for(var i in t)r[i]=t[i];var s=e("../tool/color"),o=s.getHighlightColor();for(var i in n)typeof n[i]!="undefined"&&(r[i]=n[i]);return r},c.prototype.drift=function(e,t){this.position[0]+=e,this.position[1]+=t};var p=r.create();return c.prototype.isCover=function(e,n){p[0]=e,p[1]=n,r.transformMat2d(p,p,this.invTransform),e=p[0],n=p[1];var i=this.style.__rect;return i||(i=this.style.__rect=this.getRect(this.style)),e>=i.x&&e<=i.x+i.width&&n>=i.y&&n<=i.y+i.height?t.isInside(this,this.style,e,n):!1},c.prototype.drawText=function(e,t,n){t.textColor=t.textColor||t.color||t.strokeColor,e.fillStyle=t.textColor,t.textPosition=="inside"&&(e.shadowColor="rgba(0,0,0,0)");var r=10,i,s,o,u,a=t.textPosition||this.textPosition||"top";switch(a){case"inside":case"top":case"bottom":case"left":case"right":if(this.getRect){var f=(n||t).__rect||this.getRect(n||t);switch(a){case"inside":o=f.x+f.width/2,u=f.y+f.height/2,i="center",s="middle",t.brushType!="stroke"&&t.textColor==t.color&&(e.fillStyle="#fff");break;case"left":o=f.x-r,u=f.y+f.height/2,i="end",s="middle";break;case"right":o=f.x+f.width+r,u=f.y+f.height/2,i="start",s="middle";break;case"top":o=f.x+f.width/2,u=f.y-r,i="center",s="bottom";break;case"bottom":o=f.x+f.width/2,u=f.y+f.height+r,i="center",s="top"}}break;case"start":case"end":var l,c,h,p;if(typeof t.pointList!="undefined"){var d=t.pointList;if(d.length<2)return;var v=d.length;switch(a){case"start":l=d[0][0],c=d[1][0],h=d[0][1],p=d[1][1];break;case"end":l=d[v-2][0],c=d[v-1][0],h=d[v-2][1],p=d[v-1][1]}}else l=t.xStart||0,c=t.xEnd||0,h=t.yStart||0,p=t.yEnd||0;switch(a){case"start":i=l<c?"end":"start",s=h<p?"bottom":"top",o=l,u=h;break;case"end":i=l<c?"start":"end",s=h<p?"top":"bottom",o=c,u=p}r-=4,l!=c?o-=i=="end"?r:-r:i="center",h!=p?u-=s=="bottom"?r:-r:s="middle";break;case"specific":o=t.textX||0,u=t.textY||0,i="start",s="middle"}if(o!=null&&u!=null)return this._fillText(e,t.text,o,u,t.textFont,t.textAlign||i,t.textBaseline||s)},c.prototype._fillText=function(e,n,r,i,s,o,u){s&&(e.font=s),e.textAlign=o,e.textBaseline=u;var a=l(n,r,i,s,o,u);n=(n+"").split("\n");var f=t.getTextHeight("国",s);switch(u){case"top":i=a.y;break;case"bottom":i=a.y+f;break;default:i=a.y+f/2}for(var c=0,h=n.length;c<h;c++){var p=e.fillText(n[c],r,i);this._textImageList.push(p),i+=f}},c.prototype.isSilent=function(){return!(this.hoverable||this.draggable||this.onmousemove||this.onmouseover||this.onmouseout||this.onmousedown||this.onmouseup||this.onclick||this.ondragenter||this.ondragover||this.ondragleave||this.ondrop)},c.prototype.updateTransform=function(){var e=i.create();return function(){a.prototype.updateTransform.call(this);if(!this.transform)return;var t=e,n=this.transform;t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||t[4]!==n[4]||t[5]!==n[5]?this._transformChanged=!0:this._transformChanged=!1,i.copy(e,this.transform),this.invTransform||(this.invTransform=i.create()),i.invert(this.invTransform,this.transform)}}(),c}),define("zrender-x/shape/Image",["require","./Base","../tool/util"],function(e){function s(e){i.call(this,e)}var t={},n=[],r,i=e("./Base");return s.prototype={type:"image",brush:function(e,i){var s=this.style||{},o=s.image,u=this;if(typeof o=="string"){var a=o;t[a]?o=t[a]:(o=new Image,o.onload=function(){o.onload=null,clearTimeout(r),n.push(u),r=setTimeout(function(){i(n),n=[]},10)},t[a]=o,o.src=a)}if(o){if(window.ActiveXObject){if(o.readyState!="complete")return}else if(!o.complete)return;e.save(),this.setContext(e,s),this.setTransform(e);var f=s.width||o.width,l=s.height||o.height,c=s.x,h=s.y;if(s.sWidth&&s.sHeight){var p=s.sx||0,d=s.sy||0;e.drawImage(o,p,d,s.sWidth,s.sHeight,c,h,f,l)}else if(s.sx&&s.sy){var p=s.sx,d=s.sy,v=f-p,m=l-d;e.drawImage(o,p,d,v,m,c,h,f,l)}else e.drawImage(o,c,h,f,l);s.width=f,s.height=l,this.style.width=f,this.style.height=l,s.text&&this.drawText(e,s,this.style),e.restore()}},buildPath:function(e,t){e.rect(t.x,t.y,t.width,t.height);return},getRect:function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}}},e("../tool/util").inherits(s,i),s}),define("zrender-x/Painter",["require","./Layer","./config","./tool/util","./tool/log","glmatrix","qtek/2d/context/Context2D","./shape/Image"],function(e){function l(){return!1}function c(e,t){this.root=e,this.zrInstance=null,this.storage=t,e.innerHTML="",this._width=this._getWidth(),this._height=this._getHeight();var n=document.createElement("div");this._domRoot=n,n.onselectstart=l,n.style.position="relative",n.style.overflow="hidden",n.style.width=this._width+"px",n.style.height=this._height+"px",e.appendChild(n),this.shapeToImage=this._createShapeToImageProcessor(),canvasElem=h(0,"canvas",this),n.appendChild(canvasElem),this._canvas=canvasElem,this._ctx=new f({canvas:canvasElem}),this._layers={},this._layerConfig={},this._deferredPainting=this._deferredPainting.bind(this)}function h(e,t,n){var r=document.createElement(t),i=n._width,s=n._height;return r.style.position="absolute",r.style.left=0,r.style.top=0,r.style.width=i+"px",r.style.height=s+"px",r.setAttribute("width",i),r.setAttribute("height",s),r.setAttribute("data-zr-dom-id",e),r}var t=e("./Layer"),n=e("./config"),r=e("./tool/util"),i=e("./tool/log"),s=e("glmatrix"),o=s.vec2,u=s.mat2d,a=window.devicePixelRatio||1,f=e("qtek/2d/context/Context2D");return c.prototype.render=function(e){this.refresh(e)},c.prototype.cloneShape=function(e){return e.clone(this._ctx)},c.prototype.refresh=function(e){var t=this._ctx;t.clear();var n=this.zrInstance.storage.getShapeList(!0);return this._paintList(n),typeof e=="function"&&e(),this},c.prototype._paintList=function(e){var t=this._updateLayerStatus(e),n,r,i=this._ctx;for(var s in this._layers)s!=="hover"&&this._layers[s].unusedCount++;for(var o=0,a=e.length;o<a;o++){var f=e[o];if(r!==f.zlevel){n&&i.endDraw(),n=this.getLayer(f.zlevel),n.updateTransform(),r=f.zlevel,n.unusedCount=0;var l=n.bundle,c=n.getConfig("blending"),h=n.getConfig("blendFunc");if(l&&!n.dirty)u.copy(l.transform._array,n.transform),c&&l.setBlendFunc(h),i.draw(l);else{if(!n.bundle||n.isPainterTypeChanged()){var p=n.getConfig("painterType");c||(p="normal"),n.bundle=i.beginDraw(null,p)}else i.beginDraw(n.bundle);l=n.bundle,p=="normal"&&(c?l.enableBlending():l.disableBlending()),l.setBlendFunc(h),u.copy(l.transform._array,n.transform)}}n.dirty&&(f.brush(this._ctx,this._deferredPainting),f.__dirty=!1)}l&&i.endDraw();for(var s in this._layers){var d=this._layers[s];d.dirty=!1,d.unusedCount>=10?delete this._layers[s]:d.unusedCount==1&&d.clear()}},c.prototype.getLayer=function(e){var n=this._layers[e];return n||(n=new t(e,this),n.config=this._layerConfig[e],this._layers[e]=n),n},c.prototype._updateLayerStatus=function(e){var t=this._layers,n={};for(var r in t)n[r]=t[r].elCount,t[r].elCount=0;for(var i=0,s=e.length;i<s;i++){var o=e[i],u=o.zlevel,a=t[u];if(a){a.elCount++;if(a.dirty)continue;a.dirty=o.__dirty}}for(var r in t)n[r]!==t[r].elCount&&(t[r].dirty=!0)},c.prototype._deferredPainting=function(e){for(var t=0;t<e.length;t++)this.zrInstance.modShape(e[t].id);this.zrInstance.refresh()},c.prototype.resize=function(){var e=this._domRoot;e.style.display="none";var t=this._getWidth(),n=this._getHeight();e.style.display="";if(this._width!=t||n!=this._height)this._width=t,this._height=n,e.style.width=t+"px",e.style.height=n+"px",this._ctx.resize(t,n);return this},c.prototype.dispose=function(){this.root.innerHTML=""},c.prototype.modLayer=function(e,t){if(t){this._layerConfig[e]?r.merge(this._layerConfig[e],t,!0):this._layerConfig[e]=t;var n=this._layers[e];n&&(n.config=this._layerConfig[e])}},c.prototype.getWidth=function(){return this._width},c.prototype.getHeight=function(){return this._height},c.prototype.clear=function(){for(var e in this._layers){var t=this._layers[e];t.clear()}this._ctx.clear(),this._layers={}},c.prototype._getWidth=function(){var e=this.root,t=e.currentStyle||document.defaultView.getComputedStyle(e);return((e.clientWidth||parseInt(t.width,10))-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10)).toFixed(0)-0},c.prototype._getHeight=function(){var e=this.root,t=e.currentStyle||document.defaultView.getComputedStyle(e);return((e.clientHeight||parseInt(t.height,10))-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)).toFixed(0)-0},c.prototype._shapeToImage=function(t,n,r,i,s,o,u){s.style.width=r+"px",s.style.height=i+"px",s.setAttribute("width",r*u),s.setAttribute("height",i*u),o.clearRect(0,0,r*u,i*u);var a={position:n.position,rotation:n.rotation,scale:n.scale};n.position=[0,0,0],n.rotation=0,n.scale=[1,1],n&&n.brush(o);var f=e("./shape/Image"),l=new f({id:t,style:{x:0,y:0,image:s.toDataURL()}});return a.position!=null&&(l.position=n.position=a.position),a.rotation!=null&&(l.rotation=n.rotation=a.rotation),a.scale!=null&&(l.scale=n.scale=a.scale),l},c.prototype._createShapeToImageProcessor=function(){var e=this,t=document.createElement("canvas"),n=t.getContext("2d"),r=window.devicePixelRatio||1;return function(i,s,o,u){return e._shapeToImage(i,s,o,u,t,n,r)}},c}),define("zrender-x/shape/Group",["require","../tool/guid","../tool/util","../tool/event","./mixin/Transformable"],function(e){function s(e){e=e||{},this.id=e.id||t();for(var n in e)this[n]=e[n];this.type="group",this._children=[],this._storage=null,this.__dirty=!0,i.call(this),r.call(this)}var t=e("../tool/guid"),n=e("../tool/util"),r=e("../tool/event").Dispatcher,i=e("./mixin/Transformable");return s.prototype.children=function(){return this._children.slice()},s.prototype.childAt=function(e){return this._children[e]},s.prototype.addChild=function(e){if(e==this)return;if(e.parent==this)return;e.parent&&e.parent.removeChild(e),this._children.push(e),e.parent=this,this._storage&&this._storage!==e._storage&&(this._storage.add(e),e.addChildrenToStorage(this.storage))},s.prototype.removeChild=function(e){var t=n.indexOf(this._children,e);this._children.splice(t,1),e.parent=null,e._storage&&(this._storage.del(e.id),e.delChildrenFromStorage(e._storage))},s.prototype.each=function(e,t){var n=!!t;for(var r=0;r<this._children.length;r++){var i=this._children[r];n?e.call(t,i):e(i)}},s.prototype.iterate=function(e,t){var n=!!t;for(var r=0;r<this._children.length;r++){var i=this._children[r];n?e.call(t,i):e(i),i.type==="group"&&i.iterate(e,t)}},s.prototype.addChildrenToStorage=function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];e.addToMap(n),n.type==="group"&&n.addChildrenToStorage(e)}},s.prototype.delChildrenFromStorage=function(e){for(var t=0;t<this._children.length;t++){var n=this._children[t];e.delFromMap(n),n.type==="group"&&n.delChildrenFromStorage(e)}},n.merge(s.prototype,i.prototype,!0),n.merge(s.prototype,r.prototype,!0),s}),define("zrender-x/Storage",["require","./tool/util","./shape/Group"],function(e){function i(e,t){return e.zlevel==t.zlevel?e.__renderidx-t.__renderidx:e.zlevel-t.zlevel}function s(){this._elements={},this._roots=[],this._shapeList=[],this._shapeListOffset=0}var t=e("./tool/util"),n=e("./shape/Group"),r={hover:!1,normal:"down",update:!1};return s.prototype.iterShape=function(e,t){t||(t=r),t.update&&this.updateShapeList();switch(t.normal){case"down":var n=this._shapeList.length;while(n--)if(e(this._shapeList[n]))return this;break;default:for(var i=0,n=this._shapeList.length;i<n;i++)if(e(this._shapeList[i]))return this}return this},s.prototype.getShapeList=function(e){return e&&this.updateShapeList(),this._shapeList},s.prototype.updateShapeList=function(){this._shapeListOffset=0;for(var e=0,t=this._roots.length;e<t;e++){var n=this._roots[e];this._updateAndAddShape(n)}this._shapeList.length=this._shapeListOffset;for(var e=0,t=this._shapeList.length;e<t;e++)this._shapeList[e].__renderidx=e;this._shapeList.sort(i)},s.prototype._updateAndAddShape=function(e){e.updateTransform();if(e.type=="group"){for(var t=0;t<e._children.length;t++){var n=e._children[t];n.__dirty=e.__dirty||n.__dirty,this._updateAndAddShape(n)}e.__dirty=!1}else this._shapeList[this._shapeListOffset++]=e},s.prototype.mod=function(e,r){var i=this._elements[e];return i&&(i instanceof n||(i.style.__rect=null),i.__dirty=!0,r&&t.merge(i,r,!0)),this},s.prototype.drift=function(e,t,n){var r=this._elements[e];return r&&(r.needTransform=!0,(!r.ondrift||r.ondrift&&!r.ondrift(t,n))&&r.drift(t,n)),this},s.prototype.addRoot=function(e){e instanceof n&&e.addChildrenToStorage(this),this.addToMap(e),this._roots.push(e)},s.prototype.delRoot=function(e){if(typeof e=="undefined"){for(var r=0;r<this._roots.length;r++){var i=this._roots[r];i instanceof n&&i.delChildrenFromStorage(this)}this._elements={},this._hoverElements=[],this._roots=[];return}if(e instanceof Array){for(var r=0,s=e.length;r<s;r++)this.delRoot(e[r]);return}var o;typeof e=="string"?o=this._elements[e]:o=e;var u=t.indexOf(this._roots,o);u>=0&&(this.delFromMap(o.id),this._roots.splice(u,1),o instanceof n&&o.delChildrenFromStorage(this))},s.prototype.addToMap=function(e){return!e instanceof n&&(e.style.__rect=null),this._elements[e.id]=e,this},s.prototype.get=function(e){return this._elements[e]},s.prototype.delFromMap=function(e){return delete this._elements[e],this},s.prototype.dispose=function(){this._elements=this._renderList=this._roots=this._hoverElements=null},s}),define("zrender-x/animation/easing",[],function(){var e={Linear:function(e){return e},QuadraticIn:function(e){return e*e},QuadraticOut:function(e){return e*(2-e)},QuadraticInOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)},CubicIn:function(e){return e*e*e},CubicOut:function(e){return--e*e*e+1},CubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},QuarticIn:function(e){return e*e*e*e},QuarticOut:function(e){return 1- --e*e*e*e},QuarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)},QuinticIn:function(e){return e*e*e*e*e},QuinticOut:function(e){return--e*e*e*e*e+1},QuinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},SinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},SinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},SinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},ExponentialIn:function(e){return e===0?0:Math.pow(1024,e-1)},ExponentialOut:function(e){return e===1?1:1-Math.pow(2,-10*e)},ExponentialInOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)},CircularIn:function(e){return 1-Math.sqrt(1-e*e)},CircularOut:function(e){return Math.sqrt(1- --e*e)},CircularInOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},ElasticIn:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)))},ElasticOut:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/r)+1)},ElasticInOut:function(e){var t,n=.1,r=.4;return e===0?0:e===1?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?-0.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r):n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)*.5+1)},BackIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},BackOut:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},BackInOut:function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)},BounceIn:function(t){return 1-e.BounceOut(1-t)},BounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},BounceInOut:function(t){return t<.5?e.BounceIn(t*2)*.5:e.BounceOut(t*2-1)*.5+.5}};return e}),define("zrender-x/animation/Clip",["require","./easing"],function(e){function n(e){this.target=e.target||null,this._life=e.life||1e3,this._delay=e.delay||0,this._startTime=(new Date).getTime()+this._delay,this._endTime=this._startTime+this._life*1e3,this.loop=typeof e.loop=="undefined"?!1:e.loop,this.gap=e.gap||0,this.easing=e.easing||"Linear",this.onframe=e.onframe,this.ondestroy=e.ondestroy||null,this.onrestart=e.onrestart||null}var t=e("./easing");return n.prototype={step:function(e){var n=(e-this._startTime)/this._life;if(n<0)return;n=Math.min(n,1);var r=typeof this.easing=="string"?t[this.easing]:this.easing,i=typeof r=="function"?r(n):n;return this.fire("onframe",i),n==1?this.loop?(this.restart(),"onrestart"):(this._needsRemove=!0,"ondestroy"):null},restart:function(){var e=(new Date).getTime(),t=(e-this._startTime)%this._life;this._startTime=e-t+this.gap},fire:function(e,t){this[e]&&this[e](this.target,t)},constructor:n},n}),define("zrender-x/animation/Animation",["require","./Clip","../tool/color","../tool/util","../tool/event"],function(e){function u(e){e=e||{},this.stage=e.stage||{},this.onframe=e.onframe||function(){},this._clips=[],this._running=!1,this._time=0,i.call(this)}function a(e,t){return e[t]}function f(e,t,n){e[t]=n}function l(e,t,n){return(t-e)*n+e}function c(e,t,n,r,i){var s=e.length;if(i==1)for(var o=0;o<s;o++)r[o]=l(e[o],t[o],n);else{var u=e[0].length;for(var o=0;o<s;o++)for(var a=0;a<u;a++)r[o][a]=l(e[o][a],t[o][a],n)}}function h(e){switch(typeof e){case"undefined":case"string":return!1}return typeof e.length!="undefined"}function p(e,t,n,r,i,s,o,u,a){var f=e.length;if(a==1)for(var l=0;l<f;l++)u[l]=d(e[l],t[l],n[l],r[l],i,s,o);else{var c=e[0].length;for(var l=0;l<f;l++)for(var h=0;h<c;h++)u[l][h]=d(e[l][h],t[l][h],n[l][h],r[l][h],i,s,o)}}function d(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t}function v(e){if(h(e)){var t=e.length;if(h(e[0])){var n=[];for(var r=0;r<t;r++)n.push(o.call(e[r]));return n}return o.call(e)}return e}function m(e){return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.floor(e[2]),"rgba("+e.join(",")+")"}function g(e,t,n,r){this._tracks={},this._target=e,this._loop=t||!1,this._getter=n||a,this._setter=r||f,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]}var t=e("./Clip"),n=e("../tool/color"),r=e("../tool/util"),i=e("../tool/event").Dispatcher,s=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){setTimeout(e,16)},o=Array.prototype.slice;return u.prototype={add:function(e){this._clips.push(e)},remove:function(e){var t=r.indexOf(this._clips,e);t>=0&&this._clips.splice(t,1)},update:function(){var e=(new Date).getTime(),t=e-this._time,n=this._clips,r=n.length,i=[],s=[];for(var o=0;o<r;o++){var u=n[o],a=u.step(e);a&&(i.push(a),s.push(u))}this.stage.update&&this.stage.update();for(var o=0;o<r;)n[o]._needsRemove?(n[o]=n[r-1],n.pop(),r--):o++;r=i.length;for(var o=0;o<r;o++)s[o].fire(i[o]);this._time=e,this.onframe(t),this.dispatch("frame",t)},start:function(){function t(){e._running&&(e.update(),s(t))}var e=this;this._running=!0,this._time=(new Date).getTime(),s(t)},stop:function(){this._running=!1},clear:function(){this._clips=[]},animate:function(e,t){t=t||{};var n=new g(e,t.loop,t.getter,t.setter);return n.animation=this,n},constructor:u},r.merge(u.prototype,i.prototype,!0),g.prototype={when:function(e,t){for(var n in t)this._tracks[n]||(this._tracks[n]=[],e!==0&&this._tracks[n].push({time:0,value:v(this._getter(this._target,n))})),this._tracks[n].push({time:parseInt(e,10),value:t[n]});return this},during:function(e){return this._onframeList.push(e),this},start:function(e){var r=this,i=this._setter,s=this._getter,o=r._onframeList.length,u=e==="spline",a=function(){r._clipCount--;if(r._clipCount===0){r._tracks={};var e=r._doneList.length;for(var t=0;t<e;t++)r._doneList[t].call(r)}},f=function(f,v){var g=f.length;if(!g)return;var y=f[0].value,b=h(y),w=!1,E=b&&h(y[0])?2:1;f.sort(function(e,t){return e.time-t.time});var S;if(!g)return;S=f[g-1].time;var x=[],T=[];for(var N=0;N<g;N++){x.push(f[N].time/S);var C=f[N].value;typeof C=="string"&&(C=n.toArray(C),C.length===0&&(C[0]=C[1]=C[2]=0,C[3]=1),w=!0),T.push(C)}var k=0,L=0,A,N,O,M,_,D,P;if(w)var H=[0,0,0,0];var B=function(e,t){if(t<L){A=Math.min(k+1,g-1);for(N=A;N>=0;N--)if(x[N]<=t)break;N=Math.min(N,g-2)}else{for(N=k;N<g;N++)if(x[N]>t)break;N=Math.min(N-1,g-2)}k=N,L=t;var n=x[N+1]-x[N];if(n===0)return;O=(t-x[N])/n;if(u){_=T[N],M=T[N===0?N:N-1],D=T[N>g-2?g-1:N+1],P=T[N>g-3?g-1:N+2];if(b)p(M,_,D,P,O,O*O,O*O*O,s(e,v),E);else{var a;w?(a=p(M,_,D,P,O,O*O,O*O*O,H,1),a=m(H)):a=d(M,_,D,P,O,O*O,O*O*O),i(e,v,a)}}else if(b)c(T[N],T[N+1],O,s(e,v),E);else{var a;w?(c(T[N],T[N+1],O,H,1),a=m(H)):a=l(T[N],T[N+1],O),i(e,v,a)}for(N=0;N<o;N++)r._onframeList[N](e,t)},j=new t({target:r._target,life:S,loop:r._loop,delay:r._delay,onframe:B,ondestroy:a});e&&e!=="spline"&&(j.easing=e),r._clipList.push(j),r._clipCount++,r.animation.add(j)};for(var v in this._tracks)f(this._tracks[v],v);return this},stop:function(){for(var e=0;e<this._clipList.length;e++){var t=this._clipList[e];this.animation.remove(t)}this._clipList=[]},delay:function(e){return this._delay=e,this},done:function(e){return this._doneList.push(e),this}},u}),define("zrender-x/zrender",["require","./tool/util","./tool/log","./tool/guid","./Handler","./Painter","./Storage","./animation/Animation","./tool/env"],function(e){function l(e){return function(){var t=e.animatingShapes;for(var n=0,r=t.length;n<r;n++)e.storage.mod(t[n].id);if(t.length||e._needsRefreshNextFrame)e.refresh(),e._needsRefreshNextFrame=!1}}function c(t,n){this.id=t,this.env=e("./tool/env"),this.storage=new o,this.painter=new s(n),this.painter.zrInstance=this,this.handler=new i(n,this.storage,this.painter),this.animatingShapes=[],this.animation=new u({stage:{update:l(this)}}),this.animation.start(),this._needsRefreshNextFrame=!1}var t=e("./tool/util"),n=e("./tool/log"),r=e("./tool/guid"),i=e("./Handler"),s=e("./Painter"),o=e("./Storage"),u=e("./animation/Animation"),a={},f={};return f.version="2.0.1",f.init=function(e,t){var n=new c(r(),e,t||{});return a[n.id]=n,n},f.dispose=function(e){if(e)e.dispose();else{for(var t in a)a[t].dispose();a={}}return f},f.getInstance=function(e){return a[e]},f.delInstance=function(e){return delete a[e],f},c.prototype.getId=function(){return this.id},c.prototype.addShape=function(e){return this.storage.addRoot(e),this},c.prototype.addGroup=function(e){return this.storage.addRoot(e),this},c.prototype.delShape=function(e){return this.storage.delRoot(e),this},c.prototype.delGroup=function(e){return this.storage.delRoot(e),this},c.prototype.modShape=function(e,t){return this.storage.mod(e,t),this},c.prototype.modGroup=function(e,t){return this.storage.mod(e,t),this},c.prototype.modLayer=function(e,t){return this.painter.modLayer(e,t),this},c.prototype.getLayer=function(e){return this.painter.getLayer(e)},c.prototype.render=function(e){return this.painter.render(e),this},c.prototype.refresh=function(e){return this.painter.refresh(e),this},c.prototype.refreshNextFrame=function(){return this._needsRefreshNextFrame=!0,this},c.prototype.update=function(e,t){return this.painter.update(e,t),this},c.prototype.resize=function(){return this.painter.resize(),this},c.prototype.animate=function(e,r,i){var s=this.storage.get(e);if(s){var o;if(r){var u=r.split("."),a=s;for(var f=0,l=u.length;f<l;f++){if(!a)continue;a=a[u[f]]}a&&(o=a)}else o=s;if(!o){n('Property "'+r+'" is not existed in shape '+e);return}var c=this.animatingShapes;return typeof s.__aniCount=="undefined"&&(s.__aniCount=0),s.__aniCount===0&&c.push(s),s.__aniCount++,this.animation.animate(o,{loop:i}).done(function(){s.__aniCount--;if(s.__aniCount===0){var e=t.indexOf(c,s);c.splice(e,1)}})}n('Shape "'+e+'" not existed')},c.prototype.cloneShape=function(e){return this.painter.cloneShape(e)},c.prototype.clearAnimation=function(){this.animation.clear()},c.prototype.showLoading=function(e){return this.painter.showLoading(e),this},c.prototype.hideLoading=function(){return this.painter.hideLoading(),this},c.prototype.getWidth=function(){return this.painter.getWidth()},c.prototype.getHeight=function(){return this.painter.getHeight()},c.prototype.toDataURL=function(e,t,n){return this.painter.toDataURL(e,t,n)},c.prototype.shapeToImage=function(e,t,n){var i=r();return this.painter.shapeToImage(i,e,t,n)},c.prototype.on=function(e,t){return this.handler.on(e,t),this},c.prototype.un=function(e,t){return this.handler.un(e,t),this},c.prototype.trigger=function(e,t){return this.handler.trigger(e,t),this},c.prototype.clear=function(){return this.storage.delRoot(),this.painter.clear(),this},c.prototype.dispose=function(){this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.animatingShapes=this.storage=this.painter=this.handler=null,f.delInstance(this.id)},f}),define("zrender-x",["zrender-x/zrender"],function(e){return e}),define("zrender-x/shape/Rose",["require","./Base","../tool/math","../tool/util"],function(e){function n(e){this.brushTypeOnly="stroke",t.call(this,e)}var t=e("./Base");return n.prototype={type:"rose",setStyle:function(e,n){switch(e){case"x":case"y":case"r":case"k":case"n":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(t,n){var r,i,s=n.r,o,u=n.k,a=n.n||1,f=n.x,l=n.y,c=e("../tool/math");t.moveTo(f,l);for(var h=0,p=s.length;h<p;h++){o=s[h];for(var d=0;d<=360*a;d++)r=o*c.sin(u/a*d%360,!0)*c.cos(d,!0)+f,i=o*c.sin(u/a*d%360,!0)*c.sin(d,!0)+l,t.lineTo(r,i)}},getRect:function(e){if(e.__rect)return e.__rect;var t=e.r,n=e.x,r=e.y,i=0;for(var s=0,o=t.length;s<o;s++)t[s]>i&&(i=t[s]);e.maxr=i;var u;return e.brushType=="stroke"||e.brushType=="fill"?u=e.lineWidth||1:u=0,e.__rect={x:-i-u+n,y:-i-u+r,width:2*i+3*u,height:2*i+3*u},e.__rect}},e("../tool/util").inherits(n,t),n}),define("zrender-x/shape/Trochoid",["require","./Base","../tool/math","../tool/util"],function(e){function n(e){this.brushTypeOnly="stroke",t.call(this,e)}var t=e("./Base");return n.prototype={type:"trochoid",setStyle:function(e,n){switch(e){case"x":case"y":case"r":case"r0":case"d":case"location":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(t,n){var r,i,s,o,u=n.r,a=n.r0,f=n.d,l=n.x,c=n.y,h=n.location=="out"?1:-1,p=e("../tool/math");if(n.location&&u<=a){alert("参数错误");return}var d=0,v=1,m;r=(u+h*a)*Math.cos(0)-h*f*Math.cos(0)+l,i=(u+h*a)*Math.sin(0)-f*Math.sin(0)+c,t.moveTo(r,i);do d++;while(a*d%(u+h*a)!==0);do m=Math.PI/180*v,s=(u+h*a)*Math.cos(m)-h*f*Math.cos((u/a+h)*m)+l,o=(u+h*a)*Math.sin(m)-f*Math.sin((u/a+h)*m)+c,t.lineTo(s,o),v++;while(v<=a*d/(u+h*a)*360)},getRect:function(e){if(e.__rect)return e.__rect;var t=e.r,n=e.r0,r=e.d,i=e.location=="out"?1:-1,s=t+r+i*n,o=e.x,u=e.y,a;return e.brushType=="stroke"||e.brushType=="fill"?a=e.lineWidth||1:a=0,e.__rect={x:-s-a+o,y:-s-a+u,width:2*s+2*a,height:2*s+2*a},e.__rect}},e("../tool/util").inherits(n,t),n}),define("qtek/core/LRU",["require","./LinkedList"],function(e){var t=e("./LinkedList"),n=function(e){this._list=new t,this._map={},this._maxSize=e||10};return n.prototype.setMaxSize=function(e){this._maxSize=e},n.prototype.put=function(e,t){if(typeof this._map[e]=="undefined"){var n=this._list.length();if(n>=this._maxSize&&n>0){var r=this._list.head;this._list.remove(r),delete this._map[r.key]}var i=this._list.insert(t);i.key=e,this._map[e]=i}},n.prototype.get=function(e){var t=this._map[e];if(typeof t!="undefined")return t!==this._list.tail&&(this._list.remove(t),this._list.insertEntry(t)),t.value},n.prototype.remove=function(e){var t=this._map[e];typeof t!="undefined"&&(delete this._map[e],this._list.remove(t))},n.prototype.clear=function(){this._list.clear(),this._map={}},n}),define("zrender-x/shape/Circle",["require","./Base","qtek/core/util","qtek/core/LRU","../tool/util"],function(e){function s(e){t.call(this,e),this._shapeHash=""}var t=e("./Base"),n=e("qtek/core/util"),r=e("qtek/core/LRU"),i=new r(10);return s.prototype={type:"circle",setStyle:function(e,n){switch(e){case"x":case"y":case"r":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){e&&e.arc(t.x,t.y,t.r,0,Math.PI*2,!0);return},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-e.r-t/2),y:Math.round(e.y-e.r-t/2),width:e.r*2+t,height:e.r*2+t},e.__rect},hashable:function(){return!0},getHashPath:function(){this._shapeHash=this.style.x+"-"+this.style.y+"-"+this.style.r+"-"+this.style.brushType;var e=i.get(this._shapeHash);return e},putHashPath:function(e){i.put(this._shapeHash,e)}},e("../tool/util").inherits(s,t),s}),define("zrender-x/shape/Ring",["require","./Base","../tool/util"],function(e){function n(e){t.call(this,e)}var t=e("./Base");return n.prototype={type:"ring",setStyle:function(e,n){switch(e){case"x":case"y":case"r":case"r0":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){e.arc(t.x,t.y,t.r,0,Math.PI*2,!1),e.moveTo(t.x+t.r0,t.y),e.arc(t.x,t.y,t.r0,0,Math.PI*2,!0);return},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-e.r-t/2),y:Math.round(e.y-e.r-t/2),width:e.r*2+t,height:e.r*2+t},e.__rect}},e("../tool/util").inherits(n,t),n}),define("zrender-x/shape/util/smoothSpline",["require","glmatrix"],function(e){function r(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t}var t=e("glmatrix"),n=t.vec2;return function(e,t){var i=e.length,s=[],o=0;for(var u=1;u<i;u++)o+=n.distance(e[u-1],e[u]);var a=o/5;a=a<i?i:a;for(var u=0;u<a;u++){var f=u/(a-1)*(t?i:i-1),l=Math.floor(f),c=f-l,h,p=e[l%i],d,v;t?(h=e[(l-1+i)%i],d=e[(l+1)%i],v=e[(l+2)%i]):(h=e[l===0?l:l-1],d=e[l>i-2?i-1:l+1],v=e[l>i-3?i-1:l+2]);var m=c*c,g=c*m;s.push([r(h[0],p[0],d[0],v[0],c,m,g),r(h[1],p[1],d[1],v[1],c,m,g)])}return s}}),define("zrender-x/shape/util/smoothBezier",["require","glmatrix"],function(e){var t=e("glmatrix"),n=t.vec2;return function(e,t,r){var i=[],s=[],o=[],u=[],a,f;for(var l=0,c=e.length;l<c;l++){var h=e[l],a,f;if(r)a=e[l?l-1:c-1],f=e[(l+1)%c];else{if(l===0||l===c-1){i.push(e[l]);continue}a=e[l-1],f=e[l+1]}n.sub(s,f,a),n.scale(s,s,t);var p=n.distance(h,a),d=n.distance(h,f),v=p+d;p/=v,d/=v,n.scale(o,s,-p),n.scale(u,s,d),i.push(n.add([],h,o)),i.push(n.add([],h,u))}return r&&i.push(i.shift()),i}}),define("zrender-x/shape/util/dashedLineTo",[],function(){return function(e,t,n,r,i,s){s=typeof s!="number"?5:s;var o=r-t,u=i-n,a=Math.floor(Math.sqrt(o*o+u*u)/s);for(var f=0;f<a;++f)e[f%2?"lineTo":"moveTo"](t+o/a*f,n+u/a*f)}}),define("zrender-x/shape/Polygon",["require","./Base","./util/smoothSpline","./util/smoothBezier","./util/dashedLineTo","../tool/util"],function(e){function s(e){t.call(this,e)}var t=e("./Base"),n=e("./util/smoothSpline"),r=e("./util/smoothBezier"),i=e("./util/dashedLineTo");return s.prototype={type:"polygon",setStyle:function(e,n){switch(e){case"pointList":this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n;break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){var s=t.pointList,o=s[0],u=s[s.length-1];o&&u&&o[0]==u[0]&&o[1]==u[1]&&s.pop();if(s.length<2)return;if(t.smooth&&t.smooth!=="spline"){var a=r(s,t.smooth,!0);e.moveTo(s[0][0],s[0][1]);var f,l,c,h=s.length;for(var p=0;p<h;p++)f=a[p*2],l=a[p*2+1],c=s[(p+1)%h],e.bezierCurveTo(f[0],f[1],l[0],l[1],c[0],c[1])}else{t.smooth==="spline"&&(s=n(s,!0));if(!t.lineType||t.lineType=="solid"){e.moveTo(s[0][0],s[0][1]);for(var p=1,d=s.length;p<d;p++)e.lineTo(s[p][0],s[p][1]);e.lineTo(s[0][0],s[0][1])}else if(t.lineType=="dashed"||t.lineType=="dotted"){var v=t._dashLength||(t.lineWidth||1)*(t.lineType=="dashed"?5:1);t._dashLength=v,e.moveTo(s[0][0],s[0][1]);for(var p=1,d=s.length;p<d;p++)i(e,s[p-1][0],s[p-1][1],s[p][0],s[p][1],v);i(e,s[s.length-1][0],s[s.length-1][1],s[0][0],s[0][1],v)}}return},getRect:function(e){if(e.__rect)return e.__rect;var t=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MAX_VALUE,i=Number.MIN_VALUE,s=e.pointList;for(var o=0,u=s.length;o<u;o++)s[o][0]<t&&(t=s[o][0]),s[o][0]>n&&(n=s[o][0]),s[o][1]<r&&(r=s[o][1]),s[o][1]>i&&(i=s[o][1]);var a;return e.brushType=="stroke"||e.brushType=="fill"?a=e.lineWidth||1:a=0,e.__rect={x:Math.round(t-a/2),y:Math.round(r-a/2),width:n-t+a,height:i-r+a},e.__rect}},e("../tool/util").inherits(s,t),s}),define("zrender-x/shape/Sector",["require","../tool/math","./Base","./Ring","./Polygon","../tool/util"],function(e){function r(e){n.call(this,e)}var t=e("../tool/math"),n=e("./Base");return r.prototype={type:"sector",setStyle:function(e,t){switch(e){case"x":case"y":case"r":case"r0":case"startAngle":case"endAngle":t!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=t);break;default:n.prototype.setStyle.call(this,e,t)}},buildPath:function(e,n){var r=n.x,i=n.y,s=typeof n.r0=="undefined"?0:n.r0,o=n.r,u=n.startAngle,a=n.endAngle;if(Math.abs(a-u)>=360){e.arc(r,i,o,0,Math.PI*2,!1),s!==0&&(e.moveTo(r+s,i),e.arc(r,i,s,0,Math.PI*2,!0));return}u=t.degreeToRadian(u),a=t.degreeToRadian(a);var f=Math.PI*2,l=Math.cos(u),c=Math.sin(u);e.moveTo(l*s+r,i-c*s),e.lineTo(l*o+r,i-c*o),e.arc(r,i,o,f-u,f-a,!0),e.lineTo(Math.cos(a)*s+r,i-Math.sin(a)*s),s!==0&&e.arc(r,i,s,f-a,f-u,!1);return},getRect:function(n){if(n.__rect)return n.__rect;var r=n.x,i=n.y,s=typeof n.r0=="undefined"?0:n.r0,o=n.r,u=n.startAngle,a=n.endAngle;if(Math.abs(a-u)>=360)return n.__rect=e("./Ring").prototype.getRect(n),n.__rect;u=(720+u)%360,a=(720+a)%360,a<=u&&(a+=360);var f=[];return u<=90&&a>=90&&f.push([r,i-o]),u<=180&&a>=180&&f.push([r-o,i]),u<=270&&a>=270&&f.push([r,i+o]),u<=360&&a>=360&&f.push([r+o,i]),u=t.degreeToRadian(u),a=t.degreeToRadian(a),f.push([Math.cos(u)*s+r,i-Math.sin(u)*s]),f.push([Math.cos(u)*o+r,i-Math.sin(u)*o]),f.push([Math.cos(a)*o+r,i-Math.sin(a)*o]),f.push([Math.cos(a)*s+r,i-Math.sin(a)*s]),n.__rect=e("./Polygon").prototype.getRect({brushType:n.brushType,lineWidth:n.lineWidth,pointList:f}),n.__rect}},e("../tool/util").inherits(r,n),r}),define("zrender-x/shape/Ellipse",["require","./Base","../tool/util"],function(e){function n(e){t.call(this,e)}var t=e("./Base");return n.prototype={type:"ellipse",setStyle:function(e,n){switch(e){case"x":case"y":case"a":case"b":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){var n=.5522848,r=t.x,i=t.y,s=t.a,o=t.b,u=s*n,a=o*n;e.moveTo(r-s,i),e.bezierCurveTo(r-s,i-a,r-u,i-o,r,i-o),e.bezierCurveTo(r+u,i-o,r+s,i-a,r+s,i),e.bezierCurveTo(r+s,i+a,r+u,i+o,r,i+o),e.bezierCurveTo(r-u,i+o,r-s,i+a,r-s,i)},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-e.a-t/2),y:Math.round(e.y-e.b-t/2),width:e.a*2+t,height:e.b*2+t},e.__rect}},e("../tool/util").inherits(n,t),n}),define("zrender-x/shape/Rectangle",["require","./Base","../tool/util"],function(e){function n(e){t.call(this,e)}var t=e("./Base");return n.prototype={type:"rectangle",setStyle:function(e,n){switch(e){case"x":case"y":case"width":case"height":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;case"radius":n!=this.style.radius?(this.isShapeChanged=!0,this.__dirty=!0):n instanceof Array&&(n[0]!==this.style.radius[0]||n[1]!==this.style.radius[1]||n[2]!==this.style.radius[2]||n[3]!==this.style.radius[3])&&(this.isShapeChanged=!0,this.__dirty=!0),this.style[e]=n;break;default:t.prototype.setStyle.call(this,e,n)}},_buildRadiusPath:function(e,t){var n=t.x,r=t.y,i=t.width,s=t.height,o=t.radius,u,a,f,l;typeof o=="number"?u=a=f=l=o:o instanceof Array?o.length===1?u=a=f=l=o[0]:o.length===2?(u=f=o[0],a=l=o[1]):o.length===3?(u=o[0],a=l=o[1],f=o[2]):(u=o[0],a=o[1],f=o[2],l=o[3]):u=a=f=l=0,e.moveTo(n+u,r),e.lineTo(n+i-a,r),a!==0&&e.quadraticCurveTo(n+i,r,n+i,r+a),e.lineTo(n+i,r+s-f),f!==0&&e.quadraticCurveTo(n+i,r+s,n+i-f,r+s),e.lineTo(n+l,r+s),l!==0&&e.quadraticCurveTo(n,r+s,n,r+s-l),e.lineTo(n,r+u),u!==0&&e.quadraticCurveTo(n,r,n+u,r)},buildPath:function(e,t){t.radius?this._buildRadiusPath(e,t):(e.moveTo(t.x,t.y),e.lineTo(t.x+t.width,t.y),e.lineTo(t.x+t.width,t.y+t.height),e.lineTo(t.x,t.y+t.height),e.lineTo(t.x,t.y));return},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-t/2),y:Math.round(e.y-t/2),width:e.width+t,height:e.height+t},e.__rect}},e("../tool/util").inherits(n,t),n}),define("zrender-x/shape/Text",["require","../tool/area","./Base","glmatrix","../tool/util"],function(e){function o(e){n.call(this,e),this._textPrevious=""}var t=e("../tool/area"),n=e("./Base"),r=e("glmatrix"),i=r.vec2,s=r.mat2d;return o.prototype={type:"text",brush:function(e){var n=this.style;if(typeof n.text=="undefined")return;if(!!this.isTextChanged){this.isTextChanged=!1,e.save(),this.setContext(e,n),this.setTransform(e),this._textImageList.length=0,n.textFont&&(e.font=n.textFont),e.textAlign=n.textAlign||"start",e.textBaseline=n.textBaseline||"middle";var o=(n.text+"").split("\n"),u=t.getTextHeight("国",n.textFont),a=this.getRect(n),f=n.x,l;n.textBaseline=="top"?l=a.y:n.textBaseline=="bottom"?l=a.y+u:l=a.y+u/2;for(var r=0,c=o.length;r<c;r++){if(n.maxWidth)switch(n.brushType){case"fill":this._textImageList.push(e.fillText(o[r],f,l,n.maxWidth));break;case"stroke":this._textImageList.push(e.strokeText(o[r],f,l,n.maxWidth));break;case"both":this._textImageList.push(e.fillText(o[r],f,l,n.maxWidth)),this._textImageList.push(e.strokeText(o[r],f,l,n.maxWidth));break;default:this._textImageList.push(e.fillText(o[r],f,l,n.maxWidth))}else switch(n.brushType){case"fill":this._textImageList.push(e.fillText(o[r],f,l));break;case"stroke":this._textImageList.push(e.strokeText(o[r],f,l));break;case"both":this._textImageList.push(e.fillText(o[r],f,l)),this._textImageList.push(e.strokeText(o[r],f,l));break;default:this._textImageList.push(e.fillText(o[r],f,l))}l+=u}e.restore();return}for(var r=0;r<this._textImageList.length;r++){var i=this._textImageList[r];this.transform&&(s.copy(i.transform._array,this.transform),i.transform._dirty=!0),e.addImage(i)}},getRect:function(e){if(e.__rect)return e.__rect;var n=t.getTextWidth(e.text,e.textFont),r=t.getTextHeight(e.text,e.textFont),i=e.x;e.textAlign=="end"||e.textAlign=="right"?i-=n:e.textAlign=="center"&&(i-=n/2);var s;return e.textBaseline=="top"?s=e.y:e.textBaseline=="bottom"?s=e.y-r:s=e.y-r/2,e.__rect={x:i,y:s,width:n,height:r},e.__rect}},e("../tool/util").inherits(o,n),o}),define("zrender-x/shape/Heart",["require","./Base","../tool/util"],function(e){function n(e){t.call(this,e)}var t=e("./Base");return n.prototype={type:"heart",setStyle:function(e,n){switch(e){case"x":case"y":case"a":case"b":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){e.moveTo(t.x,t.y),e.bezierCurveTo(t.x+t.a/2,t.y-t.b*2/3,t.x+t.a*2,t.y+t.b/3,t.x,t.y+t.b),e.bezierCurveTo(t.x-t.a*2,t.y+t.b/3,t.x-t.a/2,t.y-t.b*2/3,t.x,t.y);return},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-e.a-t/2),y:Math.round(e.y-e.b/4-t/2),width:e.a*2+t,height:e.b*5/4+t},e.__rect}},e("../tool/util").inherits(n,t),n}),define("zrender-x/shape/Droplet",["require","./Base","../tool/util"],function(e){function n(e){t.call(this,e)}var t=e("./Base");return n.prototype={type:"droplet",setStyle:function(e,n){switch(e){case"x":case"y":case"a":case"b":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){e.moveTo(t.x,t.y+t.a),e.bezierCurveTo(t.x+t.a,t.y+t.a,t.x+t.a*3/2,t.y-t.a/3,t.x,t.y-t.b),e.bezierCurveTo(t.x-t.a*3/2,t.y-t.a/3,t.x-t.a,t.y+t.a,t.x,t.y+t.a)},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-e.a-t/2),y:Math.round(e.y-e.b-t/2),width:e.a*2+t,height:e.a+e.b+t},e.__rect}},e("../tool/util").inherits(n,t),n}),define("zrender-x/shape/Line",["require","./Base","./util/dashedLineTo","../tool/util"],function(e){function r(e){this.brushTypeOnly="stroke",this.textPosition="end",t.call(this,e)}var t=e("./Base"),n=e("./util/dashedLineTo");return r.prototype={type:"line",setStyle:function(e,n){switch(e){case"xStart":case"yStart":case"xEnd":case"yEnd":case"lineType":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){if(!t.lineType||t.lineType=="solid")e.moveTo(t.xStart,t.yStart),e.lineTo(t.xEnd,t.yEnd);else if(t.lineType=="dashed"||t.lineType=="dotted"){var r=(t.lineWidth||1)*(t.lineType=="dashed"?5:1);n(e,t.xStart,t.yStart,t.xEnd,t.yEnd,r)}},getRect:function(e){if(e.__rect)return e.__rect;var t=e.lineWidth||1;return e.__rect={x:Math.min(e.xStart,e.xEnd)-t,y:Math.min(e.yStart,e.yEnd)-t,width:Math.abs(e.xStart-e.xEnd)+t,height:Math.abs(e.yStart-e.yEnd)+t},e.__rect}},e("../tool/util").inherits(r,t),r}),define("zrender-x/shape/Star",["require","../tool/math","./Base","qtek/core/LRU","../tool/util"],function(e){function a(e){s.call(this,e)}var t=e("../tool/math"),n=Math.sin,r=Math.cos,i=Math.PI,s=e("./Base"),o=e("qtek/core/LRU"),u=new o(10);return a.prototype={type:"star",setStyle:function(e,t){switch(e){case"x":case"y":case"r":case"r0":case"n":t!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=t);break;default:s.prototype.setStyle.call(this,e,t)}},buildPath:function(e,t){var s=t.n;if(!s||s<2)return;var o=t.x,u=t.y,a=t.r,f=t.r0;f==null&&(f=s>4?a*r(2*i/s)/r(i/s):a/3);var l=i/s,c=-i/2,h=o+a*r(c),p=u+a*n(c);c+=l;var d=t.pointList=[];d.push([h,p]);for(var v=0,m=s*2-1,g;v<m;v++)g=v%2===0?f:a,d.push([o+g*r(c),u+g*n(c)]),c+=l;d.push([h,p]);if(e){e.moveTo(d[0][0],d[0][1]);for(var v=0;v<d.length;v++)e.lineTo(d[v][0],d[v][1])}return},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-e.r-t/2),y:Math.round(e.y-e.r-t/2),width:e.r*2+t,height:e.r*2+t},e.__rect},hashable:function(){return!0},getHashPath:function(e){this._shapeHash=e.x+"-"+e.y+"-"+e.r0+"-"+e.r+"-"+e.n+"-"+e.brushType;var t=u.get(this._shapeHash);return t},putHashPath:function(e){u.put(this._shapeHash,e)}},e("../tool/util").inherits(a,s),a}),define("zrender-x/shape/Isogon",["require","./Base","../tool/util"],function(e){function s(e){i.call(this,e)}var t=Math.sin,n=Math.cos,r=Math.PI,i=e("./Base");return s.prototype={type:"isogon",setStyle:function(e,t){switch(e){case"x":case"y":case"r":case"n":t!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=t);break;default:i.prototype.setStyle.call(this,e,t)}},buildPath:function(e,i){var s=i.n;if(!s||s<2)return;var o=i.x,u=i.y,a=i.r,f=2*r/s,l=-r/2,c=o+a*n(l),h=u+a*t(l);l+=f;var p=i.pointList=[];p.push([c,h]);for(var d=0,v=s-1;d<v;d++)p.push([o+a*n(l),u+a*t(l)]),l+=f;p.push([c,h]),e.moveTo(p[0][0],p[0][1]);for(var d=0;d<p.length;d++)e.lineTo(p[d][0],p[d][1]);return},getRect:function(e){if(e.__rect)return e.__rect;var t;return e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0,e.__rect={x:Math.round(e.x-e.r-t/2),y:Math.round(e.y-e.r-t/2),width:e.r*2+t,height:e.r*2+t},e.__rect}},e("../tool/util").inherits(s,i),s}),define("zrender-x/shape/BezierCurve",["require","./Base","../tool/util"],function(e){function n(e){this.brushTypeOnly="stroke",this.textPosition="end",t.call(this,e)}var t=e("./Base");return n.prototype={type:"bezier-curve",setStyle:function(e,n){switch(e){case"xStart":case"yStart":case"cpX1":case"cpX2":case"cpY1":case"cpY2":case"xEnd":case"yEnd":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){e.moveTo(t.xStart,t.yStart),typeof t.cpX2!="undefined"&&typeof t.cpY2!="undefined"?e.bezierCurveTo(t.cpX1,t.cpY1,t.cpX2,t.cpY2,t.xEnd,t.yEnd):e.quadraticCurveTo(t.cpX1,t.cpY1,t.xEnd,t.yEnd)},getRect:function(e){if(e.__rect)return e.__rect;var t=Math.min(e.xStart,e.xEnd,e.cpX1),n=Math.min(e.yStart,e.yEnd,e.cpY1),r=Math.max(e.xStart,e.xEnd,e.cpX1),i=Math.max(e.yStart,e.yEnd,e.cpY1),s=e.cpX2,o=e.cpY2;typeof s!="undefined"&&typeof o!="undefined"&&(t=Math.min(t,s),n=Math.min(n,o),r=Math.max(r,s),i=Math.max(i,o));var u=e.lineWidth||1;return e.__rect={x:t-u,y:n-u,width:r-t+u,height:i-n+u},e.__rect}},e("../tool/util").inherits(n,t),n}),define("zrender-x/shape/BrokenLine",["require","./Base","./util/smoothSpline","./util/smoothBezier","./util/dashedLineTo","./Polygon","../tool/util"],function(e){function s(e){this.brushTypeOnly="stroke",this.textPosition="end",t.call(this,e)}var t=e("./Base"),n=e("./util/smoothSpline"),r=e("./util/smoothBezier"),i=e("./util/dashedLineTo");return s.prototype={type:"broken-line",setStyle:function(e,n){this.style[e]=n;switch(e){case"pointList":this.isShapeChanged=!0,this.__dirty=!0;break;case"smooth":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0);break;default:t.prototype.setStyle.call(this,e,n)}},buildPath:function(e,t){var s=t.pointList;if(s.length<2)return;if(t.smooth&&t.smooth!=="spline"){var o=r(s,t.smooth);e.moveTo(s[0][0],s[0][1]);var u,a,f;for(var l=0,c=s.length;l<c-1;l++)u=o[l*2],a=o[l*2+1],f=s[l+1],e.bezierCurveTo(u[0],u[1],a[0],a[1],f[0],f[1])}else{t.smooth==="spline"&&(s=n(s));if(!t.lineType||t.lineType=="solid"){e.moveTo(s[0][0],s[0][1]);for(var l=1,c=s.length;l<c;l++)e.lineTo(s[l][0],s[l][1])}else if(t.lineType=="dashed"||t.lineType=="dotted"){var h=(t.lineWidth||1)*(t.lineType=="dashed"?5:1);e.moveTo(s[0][0],s[0][1]);for(var l=1,c=s.length;l<c;l++)i(e,s[l-1][0],s[l-1][1],s[l][0],s[l][1],h)}}return},getRect:function(t){return e("./Polygon").prototype.getRect(t)}},e("../tool/util").inherits(s,t),s}),define("zrender-x/shape/Path",["require","./Base","../tool/util"],function(e){function n(e){t.call(this,e)}var t=e("./Base");return n.prototype={type:"path",setStyle:function(e,n){switch(e){case"path":n!==this.style[e]&&(this.isShapeChanged=!0,this.__dirty=!0,this.style[e]=n);break;default:t.prototype.setStyle.call(this,e,n)}},_parsePathData:function(e){if(!e)return[];var t=e,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(/-/g," -"),t=t.replace(/  /g," "),t=t.replace(/ /g,","),t=t.replace(/,,/g,",");var r;for(r=0;r<n.length;r++)t=t.replace(new RegExp(n[r],"g"),"|"+n[r]);var i=t.split("|"),s=[],o=0,u=0;for(r=1;r<i.length;r++){var a=i[r],f=a.charAt(0);a=a.slice(1),a=a.replace(new RegExp("e,-","g"),"e-");var l=a.split(",");l.length>0&&l[0]===""&&l.shift();for(var c=0;c<l.length;c++)l[c]=parseFloat(l[c]);while(l.length>0){if(isNaN(l[0]))break;var h=null,p=[],d,v,m,g,y,b,w,E,S=o,x=u;switch(f){case"l":o+=l.shift(),u+=l.shift(),h="L",p.push(o,u);break;case"L":o=l.shift(),u=l.shift(),p.push(o,u);break;case"m":o+=l.shift(),u+=l.shift(),h="M",p.push(o,u),f="l";break;case"M":o=l.shift(),u=l.shift(),h="M",p.push(o,u),f="L";break;case"h":o+=l.shift(),h="L",p.push(o,u);break;case"H":o=l.shift(),h="L",p.push(o,u);break;case"v":u+=l.shift(),h="L",p.push(o,u);break;case"V":u=l.shift(),h="L",p.push(o,u);break;case"C":p.push(l.shift(),l.shift(),l.shift(),l.shift()),o=l.shift(),u=l.shift(),p.push(o,u);break;case"c":p.push(o+l.shift(),u+l.shift(),o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="C",p.push(o,u);break;case"S":d=o,v=u,m=s[s.length-1],m.command==="C"&&(d=o+(o-m.points[2]),v=u+(u-m.points[3])),p.push(d,v,l.shift(),l.shift()),o=l.shift(),u=l.shift(),h="C",p.push(o,u);break;case"s":d=o,v=u,m=s[s.length-1],m.command==="C"&&(d=o+(o-m.points[2]),v=u+(u-m.points[3])),p.push(d,v,o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="C",p.push(o,u);break;case"Q":p.push(l.shift(),l.shift()),o=l.shift(),u=l.shift(),p.push(o,u);break;case"q":p.push(o+l.shift(),u+l.shift()),o+=l.shift(),u+=l.shift(),h="Q",p.push(o,u);break;case"T":d=o,v=u,m=s[s.length-1],m.command==="Q"&&(d=o+(o-m.points[0]),v=u+(u-m.points[1])),o=l.shift(),u=l.shift(),h="Q",p.push(d,v,o,u);break;case"t":d=o,v=u,m=s[s.length-1],m.command==="Q"&&(d=o+(o-m.points[0]),v=u+(u-m.points[1])),o+=l.shift(),u+=l.shift(),h="Q",p.push(d,v,o,u);break;case"A":g=l.shift(),y=l.shift(),b=l.shift(),w=l.shift(),E=l.shift(),S=o,x=u,o=l.shift(),u=l.shift(),h="A",p=this._convertPoint(S,x,o,u,w,E,g,y,b);break;case"a":g=l.shift(),y=l.shift(),b=l.shift(),w=l.shift(),E=l.shift(),S=o,x=u,o+=l.shift(),u+=l.shift(),h="A",p=this._convertPoint(S,x,o,u,w,E,g,y,b)}s.push({command:h||f,points:p})}(f==="z"||f==="Z")&&s.push({command:"z",points:[]})}return s},_convertPoint:function(e,t,n,r,i,s,o,u,a){var f=a*(Math.PI/180),l=Math.cos(f)*(e-n)/2+Math.sin(f)*(t-r)/2,c=-1*Math.sin(f)*(e-n)/2+Math.cos(f)*(t-r)/2,h=l*l/(o*o)+c*c/(u*u);h>1&&(o*=Math.sqrt(h),u*=Math.sqrt(h));var p=Math.sqrt((o*o*u*u-o*o*c*c-u*u*l*l)/(o*o*c*c+u*u*l*l));i===s&&(p*=-1),isNaN(p)&&(p=0);var d=p*o*c/u,v=p*-u*l/o,m=(e+n)/2+Math.cos(f)*d-Math.sin(f)*v,g=(t+r)/2+Math.sin(f)*d+Math.cos(f)*v,y=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},b=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(y(e)*y(t))},w=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(b(e,t))},E=w([1,0],[(l-d)/o,(c-v)/u]),S=[(l-d)/o,(c-v)/u],x=[(-1*l-d)/o,(-1*c-v)/u],T=w(S,x);return b(S,x)<=-1&&(T=Math.PI),b(S,x)>=1&&(T=0),s===0&&T>0&&(T-=2*Math.PI),s===1&&T<0&&(T+=2*Math.PI),[m,g,o,u,E,T,f,s]},buildPath:function(e,t){var n=t.path,r=this._parsePathData(n),i=t.x||0,s=t.y||0,o,u=t.pointList=[],a=[];for(var f=0,l=r.length;f<l;f++){r[f].command.toUpperCase()=="M"&&(a.length>0&&u.push(a),a=[]),o=r[f].points;for(var c=0,h=o.length;c<h;c+=2)a.push([o[c]+i,o[c+1]+s])}a.length>0&&u.push(a);var p;for(var f=0,l=r.length;f<l;f++){p=r[f].command,o=r[f].points;for(var c=0,h=o.length;c<h;c++)c%2===0?o[c]+=i:o[c]+=s;switch(p){case"L":e.lineTo(o[0],o[1]);break;case"M":e.moveTo(o[0],o[1]);break;case"C":e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":var d=o[0],v=o[1],m=o[2],g=o[3],y=o[4],b=o[5],w=o[6],E=o[7],S=m>g?m:g,x=m>g?1:m/g,T=m>g?g/m:1;e.translate(d,v),e.rotate(w),e.scale(x,T),e.arc(0,0,S,y,y+b,1-E),e.scale(1/x,1/T),e.rotate(-w),e.translate(-d,-v);break;case"z":e.closePath()}}return},getRect:function(e){if(e.__rect)return e.__rect;var t;e.brushType=="stroke"||e.brushType=="fill"?t=e.lineWidth||1:t=0;var n=Number.MAX_VALUE,r=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,o=e.x||0,u=e.y||0,a=this._parsePathData(e.path);for(var f=0;f<a.length;f++){var l=a[f].points;for(var c=0;c<l.length;c++)c%2===0?(l[c]+o<n&&(n=l[c]+o),l[c]+o>r&&(r=l[c]+o)):(l[c]+u<i&&(i=l[c]+u),l[c]+u>s&&(s=l[c]+u))}var h;return n===Number.MAX_VALUE||r===Number.MIN_VALUE||i===Number.MAX_VALUE||s===Number.MIN_VALUE?h={x:0,y:0,width:0,height:0}:h={x:Math.round(n-t/2),y:Math.round(i-t/2),width:r-n+t,height:s-i+t},e.__rect=h,h}},e("../tool/util").inherits(n,t),n}),define("qtek/core/request",["require"],function(e){function t(e){var t=new XMLHttpRequest;t.open("get",e.url),t.responseType=e.responseType||"text",e.onprogress&&(t.onprogress=function(t){if(t.lengthComputable){var n=t.loaded/t.total;e.onprogress(n,t.loaded,t.total)}else e.onprogress(null)}),t.onload=function(n){e.onload&&e.onload(t.response)},e.onerror&&(t.onerror=e.onerror),t.send(null)}return{get:t}}),define("qtek/async/Task",["require","../core/mixin/notifier","../core/request","../core/util"],function(e){function s(e,t){var r=new i;return n.get({url:e,responseType:t,onload:function(e){r.resolve(e)},onerror:function(e){r.reject(e)}}),r}var t=e("../core/mixin/notifier"),n=e("../core/request"),r=e("../core/util"),i=function(){this._fullfilled=!1,this._rejected=!1};return i.prototype.resolve=function(e){this._fullfilled=!0,this._rejected=!1,this.trigger("success",e)},i.prototype.reject=function(e){this._rejected=!0,this._fullfilled=!1,this.trigger("error",e)},i.prototype.isFullfilled=function(){return this._fullfilled},i.prototype.isRejected=function(){return this._rejected},i.prototype.isSettled=function(){return this._fullfilled||this._rejected},r.extend(i.prototype,t),i.makeRequestTask=function(e,t){if(typeof e=="string")return s(e,t);if(e.url){var n=e;return s(n.url,n.responseType)}if(e instanceof Array){var r=e,i=[];return r.forEach(function(e){var t,n;typeof e=="string"?t=e:Object(e)===e&&(t=e.url,n=e.responseType),i.push(s(t,n))}),i}},i.makeTask=function(){return new i},r.extend(i.prototype,t),i}),define("qtek/async/TaskGroup",["require","../core/util","./Task"],function(e){var t=e("../core/util"),n=e("./Task"),r=function(){n.apply(this,arguments),this._tasks=[],this._fulfilledNumber=0,this._rejectedNumber=0},i=function(){};return i.prototype=n.prototype,r.prototype=new i,r.prototype.constructor=r,r.prototype.all=function(e){var n=e.length,r=this,i=[];return e.length===0?(setTimeout(function(){r.resolve(i)}),this):(this._tasks=e,this._fulfilledNumber=0,this._rejectedNumber=0,t.each(e,function(e,t){e.once("success",function(s){n--,r._fulfilledNumber++,e._fulfilled=!0,e._rejected=!1,i[t]=s,n===0&&r.resolve(i)}),e.once("error",function(){r._rejectedNumber++,e._fulfilled=!1,e._rejected=!0,r.reject(e)})}),this)},r.prototype.allSettled=function(e){var n=e.length,r=!1,i=this,s=[];return e.length===0?(setTimeout(function(){i.trigger("success",s)}),this):(this._tasks=e,t.each(e,function(e,t){e.once("success",function(o){n--,i._fulfilledNumber++,e._fulfilled=!0,e._rejected=!1,s[t]=o,r=!0,n===0&&i.resolve(s)}),e.once("error",function(o){n--,i._rejectedNumber++,e._fulfilled=!1,e._rejected=!0,s[t]=null,n===0&&(r?i.resolve(s):i.reject(s))})}),this)},r.prototype.getFulfilledNumber=function(e){if(e){var t=0;for(var n=0;n<this._tasks.length;n++){var i=this._tasks[n];i instanceof r?t+=i.getFulfilledNumber(e):i._fulfilled&&(t+=1)}return t}return this._fulfilledNumber},r.prototype.getRejectedNumber=function(e){if(e){var t=0;for(var n=0;n<this._tasks.length;n++){var i=this._tasks[n];i instanceof r?t+=i.getRejectedNumber(e):i._rejected&&(t+=1)}return t}return this._rejectedNumber},r.prototype.getSettledNumber=function(e){if(e){var t=0;for(var n=0;n<this._tasks.length;n++){var i=this._tasks[n];if(i instanceof r)t+=i.getSettledNumber(e);else if(i._rejected||i._fulfilled)t+=1}return t}return this._fulfilledNumber+this._rejectedNumber},r.prototype.getTaskNumber=function(e){if(e){var t=0;for(var n=0;n<this._tasks.length;n++){var i=this._tasks[n];i instanceof r?t+=i.getTaskNumber(e):t+=1}return t}return this._tasks.length},r});